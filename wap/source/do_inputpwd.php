<?php  if(!defined('IN_UCHOME')) { exit('Access Denied'); } if(submitcheck('pwdsubmit')) { $blogid = empty($_POST['blogid'])?0:intval($_POST['blogid']); $albumid = empty($_POST['albumid'])?0:intval($_POST['albumid']); $itemarr = array(); if($blogid) { $query = $_SGLOBAL['db']->query("\x53E\114\x45C\x54 * \x46\122\117\115 ".tname('blog')." WHERE blogid='$blogid'"); $itemarr = $_SGLOBAL['db']->fetch_array($query); $itemurl = "space.ph\160?uid=$itemarr[uid]&\144\157=blog&id=$itemarr[blogid]"; $cookiename = 'view_pwd_blog_'.$blogid; } elseif($albumid) { $query = $_SGLOBAL['db']->query("\x53\105\x4cE\103\x54 * F\122\117M ".tname('album')." WHERE albumid='$albumid'"); $itemarr = $_SGLOBAL['db']->fetch_array($query); $itemurl = "space.\x70\150\160?uid=$itemarr[uid]&\144\x6f=album&id=$itemarr[albumid]"; $cookiename = 'view_pwd_album_'.$albumid; } if(empty($itemarr)) { showmessage('news_does_not_exist'); }
if($itemarr['password'] && $_POST['viewpwd'] == $itemarr['password']) { ssetcookie($cookiename, md5(md5($itemarr['password']))); showmessage('proved_to_be_successful', $itemurl); } else { showmessage('password_is_not_passed', $itemurl); } } ; ?>
