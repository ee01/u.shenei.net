define("common:widget/ui/arch/history",function(t){function e(){this._popState=!1,this._useHash=!1,this._updating=!1,this.supportPushState=!!window.history.pushState}var o=t("common:widget/ui/base/base"),i=t("common:widget/ui/utils/utils"),n=t("common:widget/ui/base/events");return o.extend(e.prototype,n,{init:function(){this.supportPushState?o(window).bind("popstate",this._popStateHandler.bind(this)):(this._updateState=this._updateState4NotSupportPopState,"onhashchange"in window&&(this._useHash=!0,o(window).bind("hashchange",this._hashChangeHandler.bind(this)))),this._popState=!1},forward:function(t){if(!this._popState){this._updating=!0,this._updateState(t);var e=this;setTimeout(function(){e._updating=!1})}},_updateState:function(t){window.history.pushState(t,"",window.location.pathname+"?"+this._encodeQuery(t))},_updateState4NotSupportPopState:function(t){window.location.href="#"+this._encodeHash(t)},_encodeQuery:function(t){return i.jsonToQuery(i.encodeJsonForQuery(t))},_encodeHash:function(t){return i.jsonToQuery(i.encodeJsonForQuery(t))},_decodeHash:function(t){return i.decodeJsonForQuery(i.queryToJson(t))},_popStateHandler:function(t){var e=t.originalEvent.state;this._popState=!0,this.dispatchEvent("popstate",{state:e}),this._popState=!1},_hashChangeHandler:function(){if(!this._updating){var t=window.location.hash,e=t?this._decodeHash(t.substr(1)):{};this._popState=!0,this.dispatchEvent("popstate",{state:e}),this._popState=!1}}}),e});