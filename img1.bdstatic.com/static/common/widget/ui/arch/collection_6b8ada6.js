define("common:widget/ui/arch/collection",function(t){function e(t,e){var n=this,a=e;n.dataProxy=t,n.getCache=function(t){return!a&&t&&(a=new r({startPn:n.dataProxy.startPn})),a},n.configCache=function(t,e){a?a.modify(t,!!e):a=new r(t)}}var n=t("common:widget/ui/base/base"),a=t("common:widget/ui/base/events"),r=t("common:widget/ui/arch/localdb");return n.extend(e.prototype,a,{get:function(t,e,a,r){e=1*(e||0),a=1*(a||0);var o,i=new n.Deferred,c=this.getCache(),s=this.dataProxy,f=this;return c&&(o=c.select(t,e,a,s.startPn)),o&&o.length&&o.length>=(a||0)?i.resolve(o):s?(s.fetch(t,e,a,o).then(function(n){n.dataSet&&n.dataSet.length&&("undefined"==typeof n.offset||n.offset===!1?f.put.apply(f,n.dataSet,r):f.putAt(n.dataSet,n.offset,r),o=c.select(t,e,a)),i.resolve(o)},function(){i.reject({msg:"fetch data from dataProxy error"})}),i):i.resolve(o)},putAt:function(t,e,n){var a=this.getCache(!0);a.insertAt(e,t,n)},put:function(){var t=this.getCache(!0);t.insert.apply(t,arguments)},getList:function(){var t=this.getCache(!0);return t.getList()}}),e.create=function(t,a){var o=t.pk,i=t.indexes,c=new r({primaryKey:o,indexes:i}),s=new e(t.dataProxy,c);return a&&n.extend(s,a),s},e});