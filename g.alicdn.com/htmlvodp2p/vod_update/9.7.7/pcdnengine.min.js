var pcdnEngine=function(){"use strict";var t,e=function(){function t(){}return t.is_debug=function(){return t.is_debug_},t.is_rtc_debug=function(){return t.is_rtc_debug_},t.is_dump=function(){return t.is_dump_},t.init=function(){if(!t.is_init_){t.load_storage(),this.random_=Math.random();try{t.pcdn_init_data_time_=(new Date).toLocaleString("chinese",{hour12:!1})}catch(e){}}},t.load_storage=function(){t.is_debug_="1"===localStorage.getItem("pcdn_debug"),t.is_rtc_debug_="1"===localStorage.getItem("pcdn_rtc_debug"),t.is_dump_="1"===localStorage.getItem("pcdn_dump"),t.pcdn_peer_id_=t.GUtils.get_peer_id(!1),t.use_pre_=t.GUtils.get_is_pre()},t.forbid_send_realtime_log=function(){return!t.is_send_realtime_log_||this.send_realtime_log_per_>0&&t.random_>t.send_realtime_log_per_},t.forbid_send_wdc_log=function(){return!t.is_send_wdc_log_||this.send_wdc_log_per_>0&&t.random_>t.send_wdc_log_per_},t.can_use_edge=function(){return t.random_<t.use_edge_per_},t.isAllowReportAddress=function(){return!!t.is_send_realtime_log_&&(this.send_address_log_per_>0&&t.random_<t.send_address_log_per_)},t.browerName="unkonw",t.browerVersion=0,t.pcdn_init_data_time_="",t.is_debug_=!1,t.is_rtc_debug_=!1,t.is_dump_=!1,t.is_init_=!1,t.web_cna_="",t.use_pre_="0",t.rid_no_control_=!0,t.use_pgw_=!0,t.change_resize_=!1,t.is_send_realtime_log_=!0,t.is_send_wdc_log_=!1,t.send_realtime_log_per_=1,t.send_wdc_log_per_=1,t.send_address_log_per_=.1,t.calculate_speed_cdn_per_=.8,t.calculate_speed_p2p_per_=.2,t.publish_have_ts_per_=.1,t.publish_sub_have_ts_per_=.8,t.subrid_batch_size_=10,t.publish_batch_size_=20,t.del_batch_size_=40,t.random_=0,t.rtc_not_close_=0,t.use_m3u8_filesize_=!0,t.pcdn_peer_id_="",t.oid_="",t.type_="vod",t.client_type_=2,t.cid_="",t.asn_str_="0",t.asn_code_=0,t.area_str_="11",t.location_str_="11",t.location_code_=11,t.peer_level_=3,t.local_login_time_stamp_ms_=0,t.server_current_time_stamp_ms_=0,t.server_current_tickcount_=0,t.log_code_=0,t.is_use_p2p_=!0,t.is_dyt_=!1,t.peakmode_=0,t.force_peakmode_=!1,t.use_edge_per_=0,t.is_use_proxy_=!1,t.max_peer_count_=20,t.disconnect_max_peer_count_=30,t.max_edge_count_=4,t.protocal_net_timeout_ms_=8e3,t.login_dx_seconds_=600,t.address_dx_seconds_=120,t.address_ergent_dx_seconds_=60,t.publish_dx_seconds_=180,t.publish_rid_dx_seconds_=60,t.update_m3u8_to_db_dx_seconds_number=120,t.send_ccd_dx_seconds_=60,t.send_rl_dx_seconds_=300,t.send_ccd_timeout_seconds_=30,t.send_ccd_retry_cn_=3,t.download_roi_min_dx_ms_=200,t.p2p_per_max_connect_count_=8,t.p2p_connect_retry_interval_=1500,t.ability_val_hls_live_=2048,t.ability_val_hls_vod_=1024,t.live_server_type_=4,t.vod_server_type_=2,t.live_peer_quality_=4,t.live_net_ability_=1,t.live_bak_max_cnt_=0,t.login_special_dx_seconds_=600,t.login_err_time_threshold_=10,t.update_tsinfo_dx_seconds_=60,t.chunk_width_KB_=32,t.memory_pool_length_=6,t.max_ts_count_=4,t.cdn_limit_duration_seconds_=10,t.edge_limit_duration_seconds_=30,t.cdn_connect_timeout_ms_=8e3,t.cdn_retry_max_count_=2,t.cdn_timeout_done_=!0,t.p2p_concurrent_request_count_=20,t.p2p_first_multi_request_count_=4,t.p2p_ignore_zero_peers_=!1,t.db_read_timeout_ms_=7e3,t.core_req_timeout_ms_=2e4,t.report_wdc_time_sec_=40,t.p2p_all_cdn_ratio_=.05,t.p2p_connect_timeout_ms_=2e4,t.p2p_rtc_offer_timeout_ms_=1e4,t.p2p_top_list_size_=30,t.p2p_max_requsting_cn_=6,t.p2p_requst_timer_ms_=200,t.p2p_requst_mn_timeout_ms_=1e3,t.p2p_requst_min_timeout_ms_=300,t.p2p_requst_middle_timeout_ms_=800,t.p2p_requst_max_timeout_ms_=1200,t.p2p_close_unactive_dx_ms_=9e4,t.p2p_loader_expire_ms_=1e4,t.p2p_loader_use_edge_ms_=5e3,t.val1_1_="%*&#(",t.val1_2_="@!3wE",t.va12_1_="(&#gH",t.val2_2_="47!@)",t.dm_="",t.dms_="",t.uri_="../iku/log/acc",t.oid_send_="",t.ccd_type_value_=7,t.module_name_prefix_="pcdn-",t.module_name_suffix_="vod-html5-ccd",t.module_name_plx_="vod-html5-plx",t.room_id_="",t.IS_USE_CACHE=1,t.TASK_NUM=20,t.CHUNK_SIZE=65536,t.db_max_used_space_=1073741824,t.lv2_cache_count_=6,t.is_now_proxy_=!1,t}(),r="object"==typeof Reflect?Reflect:null,n=r&&"function"==typeof r.apply?r.apply:function(t,e,r){return Function.prototype.apply.call(t,e,r)};t=r&&"function"==typeof r.ownKeys?r.ownKeys:Object.getOwnPropertySymbols?function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:function(t){return Object.getOwnPropertyNames(t)};var i=Number.isNaN||function(t){return t!=t};function o(){o.init.call(this)}var s=o,a=function(t,e){return new Promise((function(r,n){function i(r){t.removeListener(e,o),n(r)}function o(){"function"==typeof t.removeListener&&t.removeListener("error",i),r([].slice.call(arguments))}g(t,e,o,{once:!0}),"error"!==e&&function(t,e,r){"function"==typeof t.on&&g(t,"error",e,r)}(t,i,{once:!0})}))};o.EventEmitter=o,o.prototype._events=void 0,o.prototype._eventsCount=0,o.prototype._maxListeners=void 0;var c=10;function u(t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}function h(t){return void 0===t._maxListeners?o.defaultMaxListeners:t._maxListeners}function d(t,e,r,n){var i,o,s,a;if(u(r),void 0===(o=t._events)?(o=t._events=Object.create(null),t._eventsCount=0):(void 0!==o.newListener&&(t.emit("newListener",e,r.listener?r.listener:r),o=t._events),s=o[e]),void 0===s)s=o[e]=r,++t._eventsCount;else if("function"==typeof s?s=o[e]=n?[r,s]:[s,r]:n?s.unshift(r):s.push(r),(i=h(t))>0&&s.length>i&&!s.warned){s.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=t,c.type=e,c.count=s.length,a=c,console&&console.warn&&console.warn(a)}return t}function l(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function _(t,e,r){var n={fired:!1,wrapFn:void 0,target:t,type:e,listener:r},i=l.bind(n);return i.listener=r,n.wrapFn=i,i}function p(t,e,r){var n=t._events;if(void 0===n)return[];var i=n[e];return void 0===i?[]:"function"==typeof i?r?[i.listener||i]:[i]:r?function(t){for(var e=new Array(t.length),r=0;r<e.length;++r)e[r]=t[r].listener||t[r];return e}(i):b(i,i.length)}function f(t){var e=this._events;if(void 0!==e){var r=e[t];if("function"==typeof r)return 1;if(void 0!==r)return r.length}return 0}function b(t,e){for(var r=new Array(e),n=0;n<e;++n)r[n]=t[n];return r}function g(t,e,r,n){if("function"==typeof t.on)n.once?t.once(e,r):t.on(e,r);else{if("function"!=typeof t.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t);t.addEventListener(e,(function i(o){n.once&&t.removeEventListener(e,i),r(o)}))}}Object.defineProperty(o,"defaultMaxListeners",{enumerable:!0,get:function(){return c},set:function(t){if("number"!=typeof t||t<0||i(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");c=t}}),o.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},o.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||i(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this},o.prototype.getMaxListeners=function(){return h(this)},o.prototype.emit=function(t){for(var e=[],r=1;r<arguments.length;r++)e.push(arguments[r]);var i="error"===t,o=this._events;if(void 0!==o)i=i&&void 0===o.error;else if(!i)return!1;if(i){var s;if(e.length>0&&(s=e[0]),s instanceof Error)throw s;var a=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw a.context=s,a}var c=o[t];if(void 0===c)return!1;if("function"==typeof c)n(c,this,e);else{var u=c.length,h=b(c,u);for(r=0;r<u;++r)n(h[r],this,e)}return!0},o.prototype.addListener=function(t,e){return d(this,t,e,!1)},o.prototype.on=o.prototype.addListener,o.prototype.prependListener=function(t,e){return d(this,t,e,!0)},o.prototype.once=function(t,e){return u(e),this.on(t,_(this,t,e)),this},o.prototype.prependOnceListener=function(t,e){return u(e),this.prependListener(t,_(this,t,e)),this},o.prototype.removeListener=function(t,e){var r,n,i,o,s;if(u(e),void 0===(n=this._events))return this;if(void 0===(r=n[t]))return this;if(r===e||r.listener===e)0==--this._eventsCount?this._events=Object.create(null):(delete n[t],n.removeListener&&this.emit("removeListener",t,r.listener||e));else if("function"!=typeof r){for(i=-1,o=r.length-1;o>=0;o--)if(r[o]===e||r[o].listener===e){s=r[o].listener,i=o;break}if(i<0)return this;0===i?r.shift():function(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}(r,i),1===r.length&&(n[t]=r[0]),void 0!==n.removeListener&&this.emit("removeListener",t,s||e)}return this},o.prototype.off=o.prototype.removeListener,o.prototype.removeAllListeners=function(t){var e,r,n;if(void 0===(r=this._events))return this;if(void 0===r.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==r[t]&&(0==--this._eventsCount?this._events=Object.create(null):delete r[t]),this;if(0===arguments.length){var i,o=Object.keys(r);for(n=0;n<o.length;++n)"removeListener"!==(i=o[n])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(e=r[t]))this.removeListener(t,e);else if(void 0!==e)for(n=e.length-1;n>=0;n--)this.removeListener(t,e[n]);return this},o.prototype.listeners=function(t){return p(this,t,!0)},o.prototype.rawListeners=function(t){return p(this,t,!1)},o.listenerCount=function(t,e){return"function"==typeof t.listenerCount?t.listenerCount(e):f.call(t,e)},o.prototype.listenerCount=f,o.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]},s.once=a;var m=function(t,e){return(m=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])})(t,e)};function y(t){var e="function"==typeof Symbol&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function v(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var n,i,o=r.call(t),s=[];try{for(;(void 0===e||e-- >0)&&!(n=o.next()).done;)s.push(n.value)}catch(a){i={error:a}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return s}function R(t,e){for(var r=0,n=e.length,i=t.length;r<n;r++,i++)t[i]=e[r];return t}var w,S=function(){function t(){}return t.is_debug=function(){return null!=t.GlobalConfig&&t.GlobalConfig.is_debug()},t.is_rtc_debug=function(){return null!=t.GlobalConfig&&t.GlobalConfig.is_rtc_debug()},t.is_dump=function(){return null!=t.GlobalConfig&&t.GlobalConfig.is_dump()},t.log=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];t.is_debug()&&console.log(R([t.TAG],v(arguments)).join(""))},t.rtclog=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];t.is_rtc_debug()&&console.log(R([t.TAG],v(arguments)).join(""))},t.info=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];t.is_debug()&&console.info(R([t.TAG],v(arguments)).join(""))},t.warn=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];t.is_debug()&&console.warn(R([t.TAG],v(arguments)).join(""))},t.error=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];t.is_debug()&&console.error(R([t.TAG],v(arguments)).join(""))},t.flog=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];console.log(R([t.TAG],v(arguments)).join(""))},t.GlobalConfig=null,t.TAG="[PCDN]",t.LTAG=")[PCDN]",t}(),T=function(){function t(){}return t.LOGIN="login",t.CONTROL1="control1",t.ADDRESS="address",t.MQTT="MQTT",t.P2PDATA="p2p|",t.PeerTsDataComplete="ptscom|",t.RtcConnected="RtcConnected",t.RtcDisconnect="RtcDisconnect",t.RtcRidPublish="RtcRidPublish",t.RtcNotifyTs="RtcNotifyTs",t.STREAM_CHANGED="streamChanged",t}();function C(t,e){return T.P2PDATA+e+"|"+t}function E(t,e){return T.PeerTsDataComplete+t+"|"+e}!function(t){t.INIT="init",t.LOGING="loging",t.SUCCESS="success",t.FAIL="fail",t.ERROR="error"}(w||(w={}));var P,x=function(){function t(t,e,r,n){this.cmd=t,this.sid=e||"",this.from=r||"",this.data=n||""}return t.prototype.is_valid=function(){return this.sid.length>0&&this.from.length>0},t}(),I=function(){function t(){}return t.toStr=function(e){switch(e){case t.CDN:return"CDN";case t.P2P:return"P2P";case t.DB:return"DB";default:return"UNKNONW"}},t.CDN=0,t.P2P=1,t.DB=2,t}();!function(t){t[t.NEW=0]="NEW",t[t.LOADING=1]="LOADING",t[t.FAILED=2]="FAILED",t[t.COMPLETE=3]="COMPLETE"}(P||(P={}));var L=function(){function t(){}return t.version="9.7.15.6191",t.version_unit=0,t}(),M="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function k(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function A(t,e,r){return t(r={path:e,exports:{},require:function(t,e){return B(null==e&&r.path)}},r.exports),r.exports}function O(t){if(t.__esModule)return t;var e=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(t).forEach((function(r){var n=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(e,r,n.get?n:{enumerable:!0,get:function(){return t[r]}})})),e}function B(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}var D=O(Object.freeze({__proto__:null,default:{}})),U=A((function(t,e){var r;t.exports=r=r||function(t,e){var r;if("undefined"!=typeof window&&window.crypto&&(r=window.crypto),!r&&"undefined"!=typeof window&&window.msCrypto&&(r=window.msCrypto),!r&&void 0!==M&&M.crypto&&(r=M.crypto),!r)try{r=D}catch(f){}var n=function(){if(r){if("function"==typeof r.getRandomValues)try{return r.getRandomValues(new Uint32Array(1))[0]}catch(f){}if("function"==typeof r.randomBytes)try{return r.randomBytes(4).readInt32LE()}catch(f){}}throw new Error("Native crypto module could not be used to get secure random number.")},i=Object.create||function(){function t(){}return function(e){var r;return t.prototype=e,r=new t,t.prototype=null,r}}(),o={},s=o.lib={},a=s.Base={extend:function(t){var e=i(this);return t&&e.mixIn(t),e.hasOwnProperty("init")&&this.init!==e.init||(e.init=function(){e.$super.init.apply(this,arguments)}),e.init.prototype=e,e.$super=this,e},create:function(){var t=this.extend();return t.init.apply(t,arguments),t},init:function(){},mixIn:function(t){for(var e in t)t.hasOwnProperty(e)&&(this[e]=t[e]);t.hasOwnProperty("toString")&&(this.toString=t.toString)},clone:function(){return this.init.prototype.extend(this)}},c=s.WordArray=a.extend({init:function(t,r){t=this.words=t||[],this.sigBytes=r!=e?r:4*t.length},toString:function(t){return(t||h).stringify(this)},concat:function(t){var e=this.words,r=t.words,n=this.sigBytes,i=t.sigBytes;if(this.clamp(),n%4)for(var o=0;o<i;o++){var s=r[o>>>2]>>>24-o%4*8&255;e[n+o>>>2]|=s<<24-(n+o)%4*8}else for(o=0;o<i;o+=4)e[n+o>>>2]=r[o>>>2];return this.sigBytes+=i,this},clamp:function(){var e=this.words,r=this.sigBytes;e[r>>>2]&=4294967295<<32-r%4*8,e.length=t.ceil(r/4)},clone:function(){var t=a.clone.call(this);return t.words=this.words.slice(0),t},random:function(t){for(var e=[],r=0;r<t;r+=4)e.push(n());return new c.init(e,t)}}),u=o.enc={},h=u.Hex={stringify:function(t){for(var e=t.words,r=t.sigBytes,n=[],i=0;i<r;i++){var o=e[i>>>2]>>>24-i%4*8&255;n.push((o>>>4).toString(16)),n.push((15&o).toString(16))}return n.join("")},parse:function(t){for(var e=t.length,r=[],n=0;n<e;n+=2)r[n>>>3]|=parseInt(t.substr(n,2),16)<<24-n%8*4;return new c.init(r,e/2)}},d=u.Latin1={stringify:function(t){for(var e=t.words,r=t.sigBytes,n=[],i=0;i<r;i++){var o=e[i>>>2]>>>24-i%4*8&255;n.push(String.fromCharCode(o))}return n.join("")},parse:function(t){for(var e=t.length,r=[],n=0;n<e;n++)r[n>>>2]|=(255&t.charCodeAt(n))<<24-n%4*8;return new c.init(r,e)}},l=u.Utf8={stringify:function(t){try{return decodeURIComponent(escape(d.stringify(t)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(t){return d.parse(unescape(encodeURIComponent(t)))}},_=s.BufferedBlockAlgorithm=a.extend({reset:function(){this._data=new c.init,this._nDataBytes=0},_append:function(t){"string"==typeof t&&(t=l.parse(t)),this._data.concat(t),this._nDataBytes+=t.sigBytes},_process:function(e){var r,n=this._data,i=n.words,o=n.sigBytes,s=this.blockSize,a=o/(4*s),u=(a=e?t.ceil(a):t.max((0|a)-this._minBufferSize,0))*s,h=t.min(4*u,o);if(u){for(var d=0;d<u;d+=s)this._doProcessBlock(i,d);r=i.splice(0,u),n.sigBytes-=h}return new c.init(r,h)},clone:function(){var t=a.clone.call(this);return t._data=this._data.clone(),t},_minBufferSize:0});s.Hasher=_.extend({cfg:a.extend(),init:function(t){this.cfg=this.cfg.extend(t),this.reset()},reset:function(){_.reset.call(this),this._doReset()},update:function(t){return this._append(t),this._process(),this},finalize:function(t){return t&&this._append(t),this._doFinalize()},blockSize:16,_createHelper:function(t){return function(e,r){return new t.init(r).finalize(e)}},_createHmacHelper:function(t){return function(e,r){return new p.HMAC.init(t,r).finalize(e)}}});var p=o.algo={};return o}(Math)})),N=(A((function(t,e){var r,n,i,o,s,a,c;t.exports=(i=(n=c=U).lib,o=i.Base,s=i.WordArray,(a=n.x64={}).Word=o.extend({init:function(t,e){this.high=t,this.low=e}}),a.WordArray=o.extend({init:function(t,e){t=this.words=t||[],this.sigBytes=e!=r?e:8*t.length},toX32:function(){for(var t=this.words,e=t.length,r=[],n=0;n<e;n++){var i=t[n];r.push(i.high),r.push(i.low)}return s.create(r,this.sigBytes)},clone:function(){for(var t=o.clone.call(this),e=t.words=this.words.slice(0),r=e.length,n=0;n<r;n++)e[n]=e[n].clone();return t}}),c)})),A((function(t,e){var r;t.exports=(r=U,function(){if("function"==typeof ArrayBuffer){var t=r.lib.WordArray,e=t.init;(t.init=function(t){if(t instanceof ArrayBuffer&&(t=new Uint8Array(t)),(t instanceof Int8Array||"undefined"!=typeof Uint8ClampedArray&&t instanceof Uint8ClampedArray||t instanceof Int16Array||t instanceof Uint16Array||t instanceof Int32Array||t instanceof Uint32Array||t instanceof Float32Array||t instanceof Float64Array)&&(t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength)),t instanceof Uint8Array){for(var r=t.byteLength,n=[],i=0;i<r;i++)n[i>>>2]|=t[i]<<24-i%4*8;e.call(this,n,r)}else e.apply(this,arguments)}).prototype=t}}(),r.lib.WordArray)})),A((function(t,e){var r;t.exports=(r=U,function(){var t=r,e=t.lib.WordArray,n=t.enc;function i(t){return t<<8&4278255360|t>>>8&16711935}n.Utf16=n.Utf16BE={stringify:function(t){for(var e=t.words,r=t.sigBytes,n=[],i=0;i<r;i+=2){var o=e[i>>>2]>>>16-i%4*8&65535;n.push(String.fromCharCode(o))}return n.join("")},parse:function(t){for(var r=t.length,n=[],i=0;i<r;i++)n[i>>>1]|=t.charCodeAt(i)<<16-i%2*16;return e.create(n,2*r)}},n.Utf16LE={stringify:function(t){for(var e=t.words,r=t.sigBytes,n=[],o=0;o<r;o+=2){var s=i(e[o>>>2]>>>16-o%4*8&65535);n.push(String.fromCharCode(s))}return n.join("")},parse:function(t){for(var r=t.length,n=[],o=0;o<r;o++)n[o>>>1]|=i(t.charCodeAt(o)<<16-o%2*16);return e.create(n,2*r)}}}(),r.enc.Utf16)})),A((function(t,e){var r;t.exports=(r=U,function(){var t=r,e=t.lib.WordArray;function n(t,r,n){for(var i=[],o=0,s=0;s<r;s++)if(s%4){var a=n[t.charCodeAt(s-1)]<<s%4*2|n[t.charCodeAt(s)]>>>6-s%4*2;i[o>>>2]|=a<<24-o%4*8,o++}return e.create(i,o)}t.enc.Base64={stringify:function(t){var e=t.words,r=t.sigBytes,n=this._map;t.clamp();for(var i=[],o=0;o<r;o+=3)for(var s=(e[o>>>2]>>>24-o%4*8&255)<<16|(e[o+1>>>2]>>>24-(o+1)%4*8&255)<<8|e[o+2>>>2]>>>24-(o+2)%4*8&255,a=0;a<4&&o+.75*a<r;a++)i.push(n.charAt(s>>>6*(3-a)&63));var c=n.charAt(64);if(c)for(;i.length%4;)i.push(c);return i.join("")},parse:function(t){var e=t.length,r=this._map,i=this._reverseMap;if(!i){i=this._reverseMap=[];for(var o=0;o<r.length;o++)i[r.charCodeAt(o)]=o}var s=r.charAt(64);if(s){var a=t.indexOf(s);-1!==a&&(e=a)}return n(t,e,i)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),r.enc.Base64)})),A((function(t,e){var r;t.exports=(r=U,function(t){var e=r,n=e.lib,i=n.WordArray,o=n.Hasher,s=e.algo,a=[];!function(){for(var e=0;e<64;e++)a[e]=4294967296*t.abs(t.sin(e+1))|0}();var c=s.MD5=o.extend({_doReset:function(){this._hash=new i.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(t,e){for(var r=0;r<16;r++){var n=e+r,i=t[n];t[n]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8)}var o=this._hash.words,s=t[e+0],c=t[e+1],_=t[e+2],p=t[e+3],f=t[e+4],b=t[e+5],g=t[e+6],m=t[e+7],y=t[e+8],v=t[e+9],R=t[e+10],w=t[e+11],S=t[e+12],T=t[e+13],C=t[e+14],E=t[e+15],P=o[0],x=o[1],I=o[2],L=o[3];P=u(P,x,I,L,s,7,a[0]),L=u(L,P,x,I,c,12,a[1]),I=u(I,L,P,x,_,17,a[2]),x=u(x,I,L,P,p,22,a[3]),P=u(P,x,I,L,f,7,a[4]),L=u(L,P,x,I,b,12,a[5]),I=u(I,L,P,x,g,17,a[6]),x=u(x,I,L,P,m,22,a[7]),P=u(P,x,I,L,y,7,a[8]),L=u(L,P,x,I,v,12,a[9]),I=u(I,L,P,x,R,17,a[10]),x=u(x,I,L,P,w,22,a[11]),P=u(P,x,I,L,S,7,a[12]),L=u(L,P,x,I,T,12,a[13]),I=u(I,L,P,x,C,17,a[14]),P=h(P,x=u(x,I,L,P,E,22,a[15]),I,L,c,5,a[16]),L=h(L,P,x,I,g,9,a[17]),I=h(I,L,P,x,w,14,a[18]),x=h(x,I,L,P,s,20,a[19]),P=h(P,x,I,L,b,5,a[20]),L=h(L,P,x,I,R,9,a[21]),I=h(I,L,P,x,E,14,a[22]),x=h(x,I,L,P,f,20,a[23]),P=h(P,x,I,L,v,5,a[24]),L=h(L,P,x,I,C,9,a[25]),I=h(I,L,P,x,p,14,a[26]),x=h(x,I,L,P,y,20,a[27]),P=h(P,x,I,L,T,5,a[28]),L=h(L,P,x,I,_,9,a[29]),I=h(I,L,P,x,m,14,a[30]),P=d(P,x=h(x,I,L,P,S,20,a[31]),I,L,b,4,a[32]),L=d(L,P,x,I,y,11,a[33]),I=d(I,L,P,x,w,16,a[34]),x=d(x,I,L,P,C,23,a[35]),P=d(P,x,I,L,c,4,a[36]),L=d(L,P,x,I,f,11,a[37]),I=d(I,L,P,x,m,16,a[38]),x=d(x,I,L,P,R,23,a[39]),P=d(P,x,I,L,T,4,a[40]),L=d(L,P,x,I,s,11,a[41]),I=d(I,L,P,x,p,16,a[42]),x=d(x,I,L,P,g,23,a[43]),P=d(P,x,I,L,v,4,a[44]),L=d(L,P,x,I,S,11,a[45]),I=d(I,L,P,x,E,16,a[46]),P=l(P,x=d(x,I,L,P,_,23,a[47]),I,L,s,6,a[48]),L=l(L,P,x,I,m,10,a[49]),I=l(I,L,P,x,C,15,a[50]),x=l(x,I,L,P,b,21,a[51]),P=l(P,x,I,L,S,6,a[52]),L=l(L,P,x,I,p,10,a[53]),I=l(I,L,P,x,R,15,a[54]),x=l(x,I,L,P,c,21,a[55]),P=l(P,x,I,L,y,6,a[56]),L=l(L,P,x,I,E,10,a[57]),I=l(I,L,P,x,g,15,a[58]),x=l(x,I,L,P,T,21,a[59]),P=l(P,x,I,L,f,6,a[60]),L=l(L,P,x,I,w,10,a[61]),I=l(I,L,P,x,_,15,a[62]),x=l(x,I,L,P,v,21,a[63]),o[0]=o[0]+P|0,o[1]=o[1]+x|0,o[2]=o[2]+I|0,o[3]=o[3]+L|0},_doFinalize:function(){var e=this._data,r=e.words,n=8*this._nDataBytes,i=8*e.sigBytes;r[i>>>5]|=128<<24-i%32;var o=t.floor(n/4294967296),s=n;r[15+(i+64>>>9<<4)]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8),r[14+(i+64>>>9<<4)]=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8),e.sigBytes=4*(r.length+1),this._process();for(var a=this._hash,c=a.words,u=0;u<4;u++){var h=c[u];c[u]=16711935&(h<<8|h>>>24)|4278255360&(h<<24|h>>>8)}return a},clone:function(){var t=o.clone.call(this);return t._hash=this._hash.clone(),t}});function u(t,e,r,n,i,o,s){var a=t+(e&r|~e&n)+i+s;return(a<<o|a>>>32-o)+e}function h(t,e,r,n,i,o,s){var a=t+(e&n|r&~n)+i+s;return(a<<o|a>>>32-o)+e}function d(t,e,r,n,i,o,s){var a=t+(e^r^n)+i+s;return(a<<o|a>>>32-o)+e}function l(t,e,r,n,i,o,s){var a=t+(r^(e|~n))+i+s;return(a<<o|a>>>32-o)+e}e.MD5=o._createHelper(c),e.HmacMD5=o._createHmacHelper(c)}(Math),r.MD5)})),A((function(t,e){var r,n,i,o,s,a,c,u;t.exports=(n=(r=u=U).lib,i=n.WordArray,o=n.Hasher,s=r.algo,a=[],c=s.SHA1=o.extend({_doReset:function(){this._hash=new i.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(t,e){for(var r=this._hash.words,n=r[0],i=r[1],o=r[2],s=r[3],c=r[4],u=0;u<80;u++){if(u<16)a[u]=0|t[e+u];else{var h=a[u-3]^a[u-8]^a[u-14]^a[u-16];a[u]=h<<1|h>>>31}var d=(n<<5|n>>>27)+c+a[u];d+=u<20?1518500249+(i&o|~i&s):u<40?1859775393+(i^o^s):u<60?(i&o|i&s|o&s)-1894007588:(i^o^s)-899497514,c=s,s=o,o=i<<30|i>>>2,i=n,n=d}r[0]=r[0]+n|0,r[1]=r[1]+i|0,r[2]=r[2]+o|0,r[3]=r[3]+s|0,r[4]=r[4]+c|0},_doFinalize:function(){var t=this._data,e=t.words,r=8*this._nDataBytes,n=8*t.sigBytes;return e[n>>>5]|=128<<24-n%32,e[14+(n+64>>>9<<4)]=Math.floor(r/4294967296),e[15+(n+64>>>9<<4)]=r,t.sigBytes=4*e.length,this._process(),this._hash},clone:function(){var t=o.clone.call(this);return t._hash=this._hash.clone(),t}}),r.SHA1=o._createHelper(c),r.HmacSHA1=o._createHmacHelper(c),u.SHA1)})),A((function(t,e){var r;t.exports=(r=U,function(t){var e=r,n=e.lib,i=n.WordArray,o=n.Hasher,s=e.algo,a=[],c=[];!function(){function e(e){for(var r=t.sqrt(e),n=2;n<=r;n++)if(!(e%n))return!1;return!0}function r(t){return 4294967296*(t-(0|t))|0}for(var n=2,i=0;i<64;)e(n)&&(i<8&&(a[i]=r(t.pow(n,.5))),c[i]=r(t.pow(n,1/3)),i++),n++}();var u=[],h=s.SHA256=o.extend({_doReset:function(){this._hash=new i.init(a.slice(0))},_doProcessBlock:function(t,e){for(var r=this._hash.words,n=r[0],i=r[1],o=r[2],s=r[3],a=r[4],h=r[5],d=r[6],l=r[7],_=0;_<64;_++){if(_<16)u[_]=0|t[e+_];else{var p=u[_-15],f=(p<<25|p>>>7)^(p<<14|p>>>18)^p>>>3,b=u[_-2],g=(b<<15|b>>>17)^(b<<13|b>>>19)^b>>>10;u[_]=f+u[_-7]+g+u[_-16]}var m=n&i^n&o^i&o,y=(n<<30|n>>>2)^(n<<19|n>>>13)^(n<<10|n>>>22),v=l+((a<<26|a>>>6)^(a<<21|a>>>11)^(a<<7|a>>>25))+(a&h^~a&d)+c[_]+u[_];l=d,d=h,h=a,a=s+v|0,s=o,o=i,i=n,n=v+(y+m)|0}r[0]=r[0]+n|0,r[1]=r[1]+i|0,r[2]=r[2]+o|0,r[3]=r[3]+s|0,r[4]=r[4]+a|0,r[5]=r[5]+h|0,r[6]=r[6]+d|0,r[7]=r[7]+l|0},_doFinalize:function(){var e=this._data,r=e.words,n=8*this._nDataBytes,i=8*e.sigBytes;return r[i>>>5]|=128<<24-i%32,r[14+(i+64>>>9<<4)]=t.floor(n/4294967296),r[15+(i+64>>>9<<4)]=n,e.sigBytes=4*r.length,this._process(),this._hash},clone:function(){var t=o.clone.call(this);return t._hash=this._hash.clone(),t}});e.SHA256=o._createHelper(h),e.HmacSHA256=o._createHmacHelper(h)}(Math),r.SHA256)})),A((function(t,e){var r,n,i,o,s,a;t.exports=(n=(r=a=U).lib.WordArray,i=r.algo,o=i.SHA256,s=i.SHA224=o.extend({_doReset:function(){this._hash=new n.init([3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428])},_doFinalize:function(){var t=o._doFinalize.call(this);return t.sigBytes-=4,t}}),r.SHA224=o._createHelper(s),r.HmacSHA224=o._createHmacHelper(s),a.SHA224)})),A((function(t,e){var r;t.exports=(r=U,function(){var t=r,e=t.lib.Hasher,n=t.x64,i=n.Word,o=n.WordArray,s=t.algo;function a(){return i.create.apply(i,arguments)}var c=[a(1116352408,3609767458),a(1899447441,602891725),a(3049323471,3964484399),a(3921009573,2173295548),a(961987163,4081628472),a(1508970993,3053834265),a(2453635748,2937671579),a(2870763221,3664609560),a(3624381080,2734883394),a(310598401,1164996542),a(607225278,1323610764),a(1426881987,3590304994),a(1925078388,4068182383),a(2162078206,991336113),a(2614888103,633803317),a(3248222580,3479774868),a(3835390401,2666613458),a(4022224774,944711139),a(264347078,2341262773),a(604807628,2007800933),a(770255983,1495990901),a(1249150122,1856431235),a(1555081692,3175218132),a(1996064986,2198950837),a(2554220882,3999719339),a(2821834349,766784016),a(2952996808,2566594879),a(3210313671,3203337956),a(3336571891,1034457026),a(3584528711,2466948901),a(113926993,3758326383),a(338241895,168717936),a(666307205,1188179964),a(773529912,1546045734),a(1294757372,1522805485),a(1396182291,2643833823),a(1695183700,2343527390),a(1986661051,1014477480),a(2177026350,1206759142),a(2456956037,344077627),a(2730485921,1290863460),a(2820302411,3158454273),a(3259730800,3505952657),a(3345764771,106217008),a(3516065817,3606008344),a(3600352804,1432725776),a(4094571909,1467031594),a(275423344,851169720),a(430227734,3100823752),a(506948616,1363258195),a(659060556,3750685593),a(883997877,3785050280),a(958139571,3318307427),a(1322822218,3812723403),a(1537002063,2003034995),a(1747873779,3602036899),a(1955562222,1575990012),a(2024104815,1125592928),a(2227730452,2716904306),a(2361852424,442776044),a(2428436474,593698344),a(2756734187,3733110249),a(3204031479,2999351573),a(3329325298,3815920427),a(3391569614,3928383900),a(3515267271,566280711),a(3940187606,3454069534),a(4118630271,4000239992),a(116418474,1914138554),a(174292421,2731055270),a(289380356,3203993006),a(460393269,320620315),a(685471733,587496836),a(852142971,1086792851),a(1017036298,365543100),a(1126000580,2618297676),a(1288033470,3409855158),a(1501505948,4234509866),a(1607167915,987167468),a(1816402316,1246189591)],u=[];!function(){for(var t=0;t<80;t++)u[t]=a()}();var h=s.SHA512=e.extend({_doReset:function(){this._hash=new o.init([new i.init(1779033703,4089235720),new i.init(3144134277,2227873595),new i.init(1013904242,4271175723),new i.init(2773480762,1595750129),new i.init(1359893119,2917565137),new i.init(2600822924,725511199),new i.init(528734635,4215389547),new i.init(1541459225,327033209)])},_doProcessBlock:function(t,e){for(var r=this._hash.words,n=r[0],i=r[1],o=r[2],s=r[3],a=r[4],h=r[5],d=r[6],l=r[7],_=n.high,p=n.low,f=i.high,b=i.low,g=o.high,m=o.low,y=s.high,v=s.low,R=a.high,w=a.low,S=h.high,T=h.low,C=d.high,E=d.low,P=l.high,x=l.low,I=_,L=p,M=f,k=b,A=g,O=m,B=y,D=v,U=R,N=w,q=S,F=T,j=C,V=E,z=P,H=x,G=0;G<80;G++){var W,K,X=u[G];if(G<16)K=X.high=0|t[e+2*G],W=X.low=0|t[e+2*G+1];else{var Z=u[G-15],Q=Z.high,Y=Z.low,J=(Q>>>1|Y<<31)^(Q>>>8|Y<<24)^Q>>>7,$=(Y>>>1|Q<<31)^(Y>>>8|Q<<24)^(Y>>>7|Q<<25),tt=u[G-2],et=tt.high,rt=tt.low,nt=(et>>>19|rt<<13)^(et<<3|rt>>>29)^et>>>6,it=(rt>>>19|et<<13)^(rt<<3|et>>>29)^(rt>>>6|et<<26),ot=u[G-7],st=ot.high,at=ot.low,ct=u[G-16],ut=ct.high,ht=ct.low;K=(K=(K=J+st+((W=$+at)>>>0<$>>>0?1:0))+nt+((W+=it)>>>0<it>>>0?1:0))+ut+((W+=ht)>>>0<ht>>>0?1:0),X.high=K,X.low=W}var dt,lt=U&q^~U&j,_t=N&F^~N&V,pt=I&M^I&A^M&A,ft=L&k^L&O^k&O,bt=(I>>>28|L<<4)^(I<<30|L>>>2)^(I<<25|L>>>7),gt=(L>>>28|I<<4)^(L<<30|I>>>2)^(L<<25|I>>>7),mt=(U>>>14|N<<18)^(U>>>18|N<<14)^(U<<23|N>>>9),yt=(N>>>14|U<<18)^(N>>>18|U<<14)^(N<<23|U>>>9),vt=c[G],Rt=vt.high,wt=vt.low,St=z+mt+((dt=H+yt)>>>0<H>>>0?1:0),Tt=gt+ft;z=j,H=V,j=q,V=F,q=U,F=N,U=B+(St=(St=(St=St+lt+((dt+=_t)>>>0<_t>>>0?1:0))+Rt+((dt+=wt)>>>0<wt>>>0?1:0))+K+((dt+=W)>>>0<W>>>0?1:0))+((N=D+dt|0)>>>0<D>>>0?1:0)|0,B=A,D=O,A=M,O=k,M=I,k=L,I=St+(bt+pt+(Tt>>>0<gt>>>0?1:0))+((L=dt+Tt|0)>>>0<dt>>>0?1:0)|0}p=n.low=p+L,n.high=_+I+(p>>>0<L>>>0?1:0),b=i.low=b+k,i.high=f+M+(b>>>0<k>>>0?1:0),m=o.low=m+O,o.high=g+A+(m>>>0<O>>>0?1:0),v=s.low=v+D,s.high=y+B+(v>>>0<D>>>0?1:0),w=a.low=w+N,a.high=R+U+(w>>>0<N>>>0?1:0),T=h.low=T+F,h.high=S+q+(T>>>0<F>>>0?1:0),E=d.low=E+V,d.high=C+j+(E>>>0<V>>>0?1:0),x=l.low=x+H,l.high=P+z+(x>>>0<H>>>0?1:0)},_doFinalize:function(){var t=this._data,e=t.words,r=8*this._nDataBytes,n=8*t.sigBytes;return e[n>>>5]|=128<<24-n%32,e[30+(n+128>>>10<<5)]=Math.floor(r/4294967296),e[31+(n+128>>>10<<5)]=r,t.sigBytes=4*e.length,this._process(),this._hash.toX32()},clone:function(){var t=e.clone.call(this);return t._hash=this._hash.clone(),t},blockSize:32});t.SHA512=e._createHelper(h),t.HmacSHA512=e._createHmacHelper(h)}(),r.SHA512)})),A((function(t,e){var r,n,i,o,s,a,c,u;t.exports=(n=(r=u=U).x64,i=n.Word,o=n.WordArray,s=r.algo,a=s.SHA512,c=s.SHA384=a.extend({_doReset:function(){this._hash=new o.init([new i.init(3418070365,3238371032),new i.init(1654270250,914150663),new i.init(2438529370,812702999),new i.init(355462360,4144912697),new i.init(1731405415,4290775857),new i.init(2394180231,1750603025),new i.init(3675008525,1694076839),new i.init(1203062813,3204075428)])},_doFinalize:function(){var t=a._doFinalize.call(this);return t.sigBytes-=16,t}}),r.SHA384=a._createHelper(c),r.HmacSHA384=a._createHmacHelper(c),u.SHA384)})),A((function(t,e){var r;t.exports=(r=U,function(t){var e=r,n=e.lib,i=n.WordArray,o=n.Hasher,s=e.x64.Word,a=e.algo,c=[],u=[],h=[];!function(){for(var t=1,e=0,r=0;r<24;r++){c[t+5*e]=(r+1)*(r+2)/2%64;var n=(2*t+3*e)%5;t=e%5,e=n}for(t=0;t<5;t++)for(e=0;e<5;e++)u[t+5*e]=e+(2*t+3*e)%5*5;for(var i=1,o=0;o<24;o++){for(var a=0,d=0,l=0;l<7;l++){if(1&i){var _=(1<<l)-1;_<32?d^=1<<_:a^=1<<_-32}128&i?i=i<<1^113:i<<=1}h[o]=s.create(a,d)}}();var d=[];!function(){for(var t=0;t<25;t++)d[t]=s.create()}();var l=a.SHA3=o.extend({cfg:o.cfg.extend({outputLength:512}),_doReset:function(){for(var t=this._state=[],e=0;e<25;e++)t[e]=new s.init;this.blockSize=(1600-2*this.cfg.outputLength)/32},_doProcessBlock:function(t,e){for(var r=this._state,n=this.blockSize/2,i=0;i<n;i++){var o=t[e+2*i],s=t[e+2*i+1];o=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8),s=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8),(x=r[i]).high^=s,x.low^=o}for(var a=0;a<24;a++){for(var l=0;l<5;l++){for(var _=0,p=0,f=0;f<5;f++)_^=(x=r[l+5*f]).high,p^=x.low;var b=d[l];b.high=_,b.low=p}for(l=0;l<5;l++){var g=d[(l+4)%5],m=d[(l+1)%5],y=m.high,v=m.low;for(_=g.high^(y<<1|v>>>31),p=g.low^(v<<1|y>>>31),f=0;f<5;f++)(x=r[l+5*f]).high^=_,x.low^=p}for(var R=1;R<25;R++){var w=(x=r[R]).high,S=x.low,T=c[R];T<32?(_=w<<T|S>>>32-T,p=S<<T|w>>>32-T):(_=S<<T-32|w>>>64-T,p=w<<T-32|S>>>64-T);var C=d[u[R]];C.high=_,C.low=p}var E=d[0],P=r[0];for(E.high=P.high,E.low=P.low,l=0;l<5;l++)for(f=0;f<5;f++){var x=r[R=l+5*f],I=d[R],L=d[(l+1)%5+5*f],M=d[(l+2)%5+5*f];x.high=I.high^~L.high&M.high,x.low=I.low^~L.low&M.low}x=r[0];var k=h[a];x.high^=k.high,x.low^=k.low}},_doFinalize:function(){var e=this._data,r=e.words;this._nDataBytes;var n=8*e.sigBytes,o=32*this.blockSize;r[n>>>5]|=1<<24-n%32,r[(t.ceil((n+1)/o)*o>>>5)-1]|=128,e.sigBytes=4*r.length,this._process();for(var s=this._state,a=this.cfg.outputLength/8,c=a/8,u=[],h=0;h<c;h++){var d=s[h],l=d.high,_=d.low;l=16711935&(l<<8|l>>>24)|4278255360&(l<<24|l>>>8),_=16711935&(_<<8|_>>>24)|4278255360&(_<<24|_>>>8),u.push(_),u.push(l)}return new i.init(u,a)},clone:function(){for(var t=o.clone.call(this),e=t._state=this._state.slice(0),r=0;r<25;r++)e[r]=e[r].clone();return t}});e.SHA3=o._createHelper(l),e.HmacSHA3=o._createHmacHelper(l)}(Math),r.SHA3)})),A((function(t,e){var r;t.exports=(r=U,function(t){var e=r,n=e.lib,i=n.WordArray,o=n.Hasher,s=e.algo,a=i.create([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13]),c=i.create([5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11]),u=i.create([11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6]),h=i.create([8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11]),d=i.create([0,1518500249,1859775393,2400959708,2840853838]),l=i.create([1352829926,1548603684,1836072691,2053994217,0]),_=s.RIPEMD160=o.extend({_doReset:function(){this._hash=i.create([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(t,e){for(var r=0;r<16;r++){var n=e+r,i=t[n];t[n]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8)}var o,s,_,v,R,w,S,T,C,E,P,x=this._hash.words,I=d.words,L=l.words,M=a.words,k=c.words,A=u.words,O=h.words;for(w=o=x[0],S=s=x[1],T=_=x[2],C=v=x[3],E=R=x[4],r=0;r<80;r+=1)P=o+t[e+M[r]]|0,P+=r<16?p(s,_,v)+I[0]:r<32?f(s,_,v)+I[1]:r<48?b(s,_,v)+I[2]:r<64?g(s,_,v)+I[3]:m(s,_,v)+I[4],P=(P=y(P|=0,A[r]))+R|0,o=R,R=v,v=y(_,10),_=s,s=P,P=w+t[e+k[r]]|0,P+=r<16?m(S,T,C)+L[0]:r<32?g(S,T,C)+L[1]:r<48?b(S,T,C)+L[2]:r<64?f(S,T,C)+L[3]:p(S,T,C)+L[4],P=(P=y(P|=0,O[r]))+E|0,w=E,E=C,C=y(T,10),T=S,S=P;P=x[1]+_+C|0,x[1]=x[2]+v+E|0,x[2]=x[3]+R+w|0,x[3]=x[4]+o+S|0,x[4]=x[0]+s+T|0,x[0]=P},_doFinalize:function(){var t=this._data,e=t.words,r=8*this._nDataBytes,n=8*t.sigBytes;e[n>>>5]|=128<<24-n%32,e[14+(n+64>>>9<<4)]=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8),t.sigBytes=4*(e.length+1),this._process();for(var i=this._hash,o=i.words,s=0;s<5;s++){var a=o[s];o[s]=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8)}return i},clone:function(){var t=o.clone.call(this);return t._hash=this._hash.clone(),t}});function p(t,e,r){return t^e^r}function f(t,e,r){return t&e|~t&r}function b(t,e,r){return(t|~e)^r}function g(t,e,r){return t&r|e&~r}function m(t,e,r){return t^(e|~r)}function y(t,e){return t<<e|t>>>32-e}e.RIPEMD160=o._createHelper(_),e.HmacRIPEMD160=o._createHmacHelper(_)}(),r.RIPEMD160)})),A((function(t,e){var r,n,i;t.exports=(n=(r=U).lib.Base,i=r.enc.Utf8,void(r.algo.HMAC=n.extend({init:function(t,e){t=this._hasher=new t.init,"string"==typeof e&&(e=i.parse(e));var r=t.blockSize,n=4*r;e.sigBytes>n&&(e=t.finalize(e)),e.clamp();for(var o=this._oKey=e.clone(),s=this._iKey=e.clone(),a=o.words,c=s.words,u=0;u<r;u++)a[u]^=1549556828,c[u]^=909522486;o.sigBytes=s.sigBytes=n,this.reset()},reset:function(){var t=this._hasher;t.reset(),t.update(this._iKey)},update:function(t){return this._hasher.update(t),this},finalize:function(t){var e=this._hasher,r=e.finalize(t);return e.reset(),e.finalize(this._oKey.clone().concat(r))}})))})),A((function(t,e){var r,n,i,o,s,a,c,u,h;t.exports=(n=(r=h=U).lib,i=n.Base,o=n.WordArray,s=r.algo,a=s.SHA1,c=s.HMAC,u=s.PBKDF2=i.extend({cfg:i.extend({keySize:4,hasher:a,iterations:1}),init:function(t){this.cfg=this.cfg.extend(t)},compute:function(t,e){for(var r=this.cfg,n=c.create(r.hasher,t),i=o.create(),s=o.create([1]),a=i.words,u=s.words,h=r.keySize,d=r.iterations;a.length<h;){var l=n.update(e).finalize(s);n.reset();for(var _=l.words,p=_.length,f=l,b=1;b<d;b++){f=n.finalize(f),n.reset();for(var g=f.words,m=0;m<p;m++)_[m]^=g[m]}i.concat(l),u[0]++}return i.sigBytes=4*h,i}}),r.PBKDF2=function(t,e,r){return u.create(r).compute(t,e)},h.PBKDF2)})),A((function(t,e){var r,n,i,o,s,a,c,u;t.exports=(n=(r=u=U).lib,i=n.Base,o=n.WordArray,s=r.algo,a=s.MD5,c=s.EvpKDF=i.extend({cfg:i.extend({keySize:4,hasher:a,iterations:1}),init:function(t){this.cfg=this.cfg.extend(t)},compute:function(t,e){for(var r,n=this.cfg,i=n.hasher.create(),s=o.create(),a=s.words,c=n.keySize,u=n.iterations;a.length<c;){r&&i.update(r),r=i.update(t).finalize(e),i.reset();for(var h=1;h<u;h++)r=i.finalize(r),i.reset();s.concat(r)}return s.sigBytes=4*c,s}}),r.EvpKDF=function(t,e,r){return c.create(r).compute(t,e)},u.EvpKDF)})),A((function(t,e){var r;t.exports=void((r=U).lib.Cipher||function(t){var e=r,n=e.lib,i=n.Base,o=n.WordArray,s=n.BufferedBlockAlgorithm,a=e.enc;a.Utf8;var c=a.Base64,u=e.algo.EvpKDF,h=n.Cipher=s.extend({cfg:i.extend(),createEncryptor:function(t,e){return this.create(this._ENC_XFORM_MODE,t,e)},createDecryptor:function(t,e){return this.create(this._DEC_XFORM_MODE,t,e)},init:function(t,e,r){this.cfg=this.cfg.extend(r),this._xformMode=t,this._key=e,this.reset()},reset:function(){s.reset.call(this),this._doReset()},process:function(t){return this._append(t),this._process()},finalize:function(t){return t&&this._append(t),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function t(t){return"string"==typeof t?y:g}return function(e){return{encrypt:function(r,n,i){return t(n).encrypt(e,r,n,i)},decrypt:function(r,n,i){return t(n).decrypt(e,r,n,i)}}}}()});n.StreamCipher=h.extend({_doFinalize:function(){return this._process(!0)},blockSize:1});var d=e.mode={},l=n.BlockCipherMode=i.extend({createEncryptor:function(t,e){return this.Encryptor.create(t,e)},createDecryptor:function(t,e){return this.Decryptor.create(t,e)},init:function(t,e){this._cipher=t,this._iv=e}}),_=d.CBC=function(){var e=l.extend();function r(e,r,n){var i,o=this._iv;o?(i=o,this._iv=t):i=this._prevBlock;for(var s=0;s<n;s++)e[r+s]^=i[s]}return e.Encryptor=e.extend({processBlock:function(t,e){var n=this._cipher,i=n.blockSize;r.call(this,t,e,i),n.encryptBlock(t,e),this._prevBlock=t.slice(e,e+i)}}),e.Decryptor=e.extend({processBlock:function(t,e){var n=this._cipher,i=n.blockSize,o=t.slice(e,e+i);n.decryptBlock(t,e),r.call(this,t,e,i),this._prevBlock=o}}),e}(),p=(e.pad={}).Pkcs7={pad:function(t,e){for(var r=4*e,n=r-t.sigBytes%r,i=n<<24|n<<16|n<<8|n,s=[],a=0;a<n;a+=4)s.push(i);var c=o.create(s,n);t.concat(c)},unpad:function(t){var e=255&t.words[t.sigBytes-1>>>2];t.sigBytes-=e}};n.BlockCipher=h.extend({cfg:h.cfg.extend({mode:_,padding:p}),reset:function(){var t;h.reset.call(this);var e=this.cfg,r=e.iv,n=e.mode;this._xformMode==this._ENC_XFORM_MODE?t=n.createEncryptor:(t=n.createDecryptor,this._minBufferSize=1),this._mode&&this._mode.__creator==t?this._mode.init(this,r&&r.words):(this._mode=t.call(n,this,r&&r.words),this._mode.__creator=t)},_doProcessBlock:function(t,e){this._mode.processBlock(t,e)},_doFinalize:function(){var t,e=this.cfg.padding;return this._xformMode==this._ENC_XFORM_MODE?(e.pad(this._data,this.blockSize),t=this._process(!0)):(t=this._process(!0),e.unpad(t)),t},blockSize:4});var f=n.CipherParams=i.extend({init:function(t){this.mixIn(t)},toString:function(t){return(t||this.formatter).stringify(this)}}),b=(e.format={}).OpenSSL={stringify:function(t){var e=t.ciphertext,r=t.salt;return(r?o.create([1398893684,1701076831]).concat(r).concat(e):e).toString(c)},parse:function(t){var e,r=c.parse(t),n=r.words;return 1398893684==n[0]&&1701076831==n[1]&&(e=o.create(n.slice(2,4)),n.splice(0,4),r.sigBytes-=16),f.create({ciphertext:r,salt:e})}},g=n.SerializableCipher=i.extend({cfg:i.extend({format:b}),encrypt:function(t,e,r,n){n=this.cfg.extend(n);var i=t.createEncryptor(r,n),o=i.finalize(e),s=i.cfg;return f.create({ciphertext:o,key:r,iv:s.iv,algorithm:t,mode:s.mode,padding:s.padding,blockSize:t.blockSize,formatter:n.format})},decrypt:function(t,e,r,n){return n=this.cfg.extend(n),e=this._parse(e,n.format),t.createDecryptor(r,n).finalize(e.ciphertext)},_parse:function(t,e){return"string"==typeof t?e.parse(t,this):t}}),m=(e.kdf={}).OpenSSL={execute:function(t,e,r,n){n||(n=o.random(8));var i=u.create({keySize:e+r}).compute(t,n),s=o.create(i.words.slice(e),4*r);return i.sigBytes=4*e,f.create({key:i,iv:s,salt:n})}},y=n.PasswordBasedCipher=g.extend({cfg:g.cfg.extend({kdf:m}),encrypt:function(t,e,r,n){var i=(n=this.cfg.extend(n)).kdf.execute(r,t.keySize,t.ivSize);n.iv=i.iv;var o=g.encrypt.call(this,t,e,i.key,n);return o.mixIn(i),o},decrypt:function(t,e,r,n){n=this.cfg.extend(n),e=this._parse(e,n.format);var i=n.kdf.execute(r,t.keySize,t.ivSize,e.salt);return n.iv=i.iv,g.decrypt.call(this,t,e,i.key,n)}})}())})),A((function(t,e){var r;t.exports=((r=U).mode.CFB=function(){var t=r.lib.BlockCipherMode.extend();function e(t,e,r,n){var i,o=this._iv;o?(i=o.slice(0),this._iv=void 0):i=this._prevBlock,n.encryptBlock(i,0);for(var s=0;s<r;s++)t[e+s]^=i[s]}return t.Encryptor=t.extend({processBlock:function(t,r){var n=this._cipher,i=n.blockSize;e.call(this,t,r,i,n),this._prevBlock=t.slice(r,r+i)}}),t.Decryptor=t.extend({processBlock:function(t,r){var n=this._cipher,i=n.blockSize,o=t.slice(r,r+i);e.call(this,t,r,i,n),this._prevBlock=o}}),t}(),r.mode.CFB)})),A((function(t,e){var r,n,i;t.exports=((i=U).mode.CTR=(r=i.lib.BlockCipherMode.extend(),n=r.Encryptor=r.extend({processBlock:function(t,e){var r=this._cipher,n=r.blockSize,i=this._iv,o=this._counter;i&&(o=this._counter=i.slice(0),this._iv=void 0);var s=o.slice(0);r.encryptBlock(s,0),o[n-1]=o[n-1]+1|0;for(var a=0;a<n;a++)t[e+a]^=s[a]}}),r.Decryptor=n,r),i.mode.CTR)})),A((function(t,e){var r;t.exports=((r=U).mode.CTRGladman=function(){var t=r.lib.BlockCipherMode.extend();function e(t){if(255==(t>>24&255)){var e=t>>16&255,r=t>>8&255,n=255&t;255===e?(e=0,255===r?(r=0,255===n?n=0:++n):++r):++e,t=0,t+=e<<16,t+=r<<8,t+=n}else t+=1<<24;return t}function n(t){return 0===(t[0]=e(t[0]))&&(t[1]=e(t[1])),t}var i=t.Encryptor=t.extend({processBlock:function(t,e){var r=this._cipher,i=r.blockSize,o=this._iv,s=this._counter;o&&(s=this._counter=o.slice(0),this._iv=void 0),n(s);var a=s.slice(0);r.encryptBlock(a,0);for(var c=0;c<i;c++)t[e+c]^=a[c]}});return t.Decryptor=i,t}(),r.mode.CTRGladman)})),A((function(t,e){var r,n,i;t.exports=((i=U).mode.OFB=(r=i.lib.BlockCipherMode.extend(),n=r.Encryptor=r.extend({processBlock:function(t,e){var r=this._cipher,n=r.blockSize,i=this._iv,o=this._keystream;i&&(o=this._keystream=i.slice(0),this._iv=void 0),r.encryptBlock(o,0);for(var s=0;s<n;s++)t[e+s]^=o[s]}}),r.Decryptor=n,r),i.mode.OFB)})),A((function(t,e){var r,n;t.exports=((n=U).mode.ECB=((r=n.lib.BlockCipherMode.extend()).Encryptor=r.extend({processBlock:function(t,e){this._cipher.encryptBlock(t,e)}}),r.Decryptor=r.extend({processBlock:function(t,e){this._cipher.decryptBlock(t,e)}}),r),n.mode.ECB)})),A((function(t,e){var r;t.exports=((r=U).pad.AnsiX923={pad:function(t,e){var r=t.sigBytes,n=4*e,i=n-r%n,o=r+i-1;t.clamp(),t.words[o>>>2]|=i<<24-o%4*8,t.sigBytes+=i},unpad:function(t){var e=255&t.words[t.sigBytes-1>>>2];t.sigBytes-=e}},r.pad.Ansix923)})),A((function(t,e){var r;t.exports=((r=U).pad.Iso10126={pad:function(t,e){var n=4*e,i=n-t.sigBytes%n;t.concat(r.lib.WordArray.random(i-1)).concat(r.lib.WordArray.create([i<<24],1))},unpad:function(t){var e=255&t.words[t.sigBytes-1>>>2];t.sigBytes-=e}},r.pad.Iso10126)})),A((function(t,e){var r;t.exports=((r=U).pad.Iso97971={pad:function(t,e){t.concat(r.lib.WordArray.create([2147483648],1)),r.pad.ZeroPadding.pad(t,e)},unpad:function(t){r.pad.ZeroPadding.unpad(t),t.sigBytes--}},r.pad.Iso97971)})),A((function(t,e){var r;t.exports=((r=U).pad.ZeroPadding={pad:function(t,e){var r=4*e;t.clamp(),t.sigBytes+=r-(t.sigBytes%r||r)},unpad:function(t){var e=t.words,r=t.sigBytes-1;for(r=t.sigBytes-1;r>=0;r--)if(e[r>>>2]>>>24-r%4*8&255){t.sigBytes=r+1;break}}},r.pad.ZeroPadding)})),A((function(t,e){var r;t.exports=((r=U).pad.NoPadding={pad:function(){},unpad:function(){}},r.pad.NoPadding)})),A((function(t,e){var r,n,i,o;t.exports=(n=(r=o=U).lib.CipherParams,i=r.enc.Hex,r.format.Hex={stringify:function(t){return t.ciphertext.toString(i)},parse:function(t){var e=i.parse(t);return n.create({ciphertext:e})}},o.format.Hex)})),A((function(t,e){var r;t.exports=(r=U,function(){var t=r,e=t.lib.BlockCipher,n=t.algo,i=[],o=[],s=[],a=[],c=[],u=[],h=[],d=[],l=[],_=[];!function(){for(var t=[],e=0;e<256;e++)t[e]=e<128?e<<1:e<<1^283;var r=0,n=0;for(e=0;e<256;e++){var p=n^n<<1^n<<2^n<<3^n<<4;p=p>>>8^255&p^99,i[r]=p,o[p]=r;var f=t[r],b=t[f],g=t[b],m=257*t[p]^16843008*p;s[r]=m<<24|m>>>8,a[r]=m<<16|m>>>16,c[r]=m<<8|m>>>24,u[r]=m,m=16843009*g^65537*b^257*f^16843008*r,h[p]=m<<24|m>>>8,d[p]=m<<16|m>>>16,l[p]=m<<8|m>>>24,_[p]=m,r?(r=f^t[t[t[g^f]]],n^=t[t[n]]):r=n=1}}();var p=[0,1,2,4,8,16,32,64,128,27,54],f=n.AES=e.extend({_doReset:function(){if(!this._nRounds||this._keyPriorReset!==this._key){for(var t=this._keyPriorReset=this._key,e=t.words,r=t.sigBytes/4,n=4*((this._nRounds=r+6)+1),o=this._keySchedule=[],s=0;s<n;s++)s<r?o[s]=e[s]:(u=o[s-1],s%r?r>6&&s%r==4&&(u=i[u>>>24]<<24|i[u>>>16&255]<<16|i[u>>>8&255]<<8|i[255&u]):(u=i[(u=u<<8|u>>>24)>>>24]<<24|i[u>>>16&255]<<16|i[u>>>8&255]<<8|i[255&u],u^=p[s/r|0]<<24),o[s]=o[s-r]^u);for(var a=this._invKeySchedule=[],c=0;c<n;c++){if(s=n-c,c%4)var u=o[s];else u=o[s-4];a[c]=c<4||s<=4?u:h[i[u>>>24]]^d[i[u>>>16&255]]^l[i[u>>>8&255]]^_[i[255&u]]}}},encryptBlock:function(t,e){this._doCryptBlock(t,e,this._keySchedule,s,a,c,u,i)},decryptBlock:function(t,e){var r=t[e+1];t[e+1]=t[e+3],t[e+3]=r,this._doCryptBlock(t,e,this._invKeySchedule,h,d,l,_,o),r=t[e+1],t[e+1]=t[e+3],t[e+3]=r},_doCryptBlock:function(t,e,r,n,i,o,s,a){for(var c=this._nRounds,u=t[e]^r[0],h=t[e+1]^r[1],d=t[e+2]^r[2],l=t[e+3]^r[3],_=4,p=1;p<c;p++){var f=n[u>>>24]^i[h>>>16&255]^o[d>>>8&255]^s[255&l]^r[_++],b=n[h>>>24]^i[d>>>16&255]^o[l>>>8&255]^s[255&u]^r[_++],g=n[d>>>24]^i[l>>>16&255]^o[u>>>8&255]^s[255&h]^r[_++],m=n[l>>>24]^i[u>>>16&255]^o[h>>>8&255]^s[255&d]^r[_++];u=f,h=b,d=g,l=m}f=(a[u>>>24]<<24|a[h>>>16&255]<<16|a[d>>>8&255]<<8|a[255&l])^r[_++],b=(a[h>>>24]<<24|a[d>>>16&255]<<16|a[l>>>8&255]<<8|a[255&u])^r[_++],g=(a[d>>>24]<<24|a[l>>>16&255]<<16|a[u>>>8&255]<<8|a[255&h])^r[_++],m=(a[l>>>24]<<24|a[u>>>16&255]<<16|a[h>>>8&255]<<8|a[255&d])^r[_++],t[e]=f,t[e+1]=b,t[e+2]=g,t[e+3]=m},keySize:8});t.AES=e._createHelper(f)}(),r.AES)})),A((function(t,e){var r;t.exports=(r=U,function(){var t=r,e=t.lib,n=e.WordArray,i=e.BlockCipher,o=t.algo,s=[57,49,41,33,25,17,9,1,58,50,42,34,26,18,10,2,59,51,43,35,27,19,11,3,60,52,44,36,63,55,47,39,31,23,15,7,62,54,46,38,30,22,14,6,61,53,45,37,29,21,13,5,28,20,12,4],a=[14,17,11,24,1,5,3,28,15,6,21,10,23,19,12,4,26,8,16,7,27,20,13,2,41,52,31,37,47,55,30,40,51,45,33,48,44,49,39,56,34,53,46,42,50,36,29,32],c=[1,2,4,6,8,10,12,14,15,17,19,21,23,25,27,28],u=[{0:8421888,268435456:32768,536870912:8421378,805306368:2,1073741824:512,1342177280:8421890,1610612736:8389122,1879048192:8388608,2147483648:514,2415919104:8389120,2684354560:33280,2952790016:8421376,3221225472:32770,3489660928:8388610,3758096384:0,4026531840:33282,134217728:0,402653184:8421890,671088640:33282,939524096:32768,1207959552:8421888,1476395008:512,1744830464:8421378,2013265920:2,2281701376:8389120,2550136832:33280,2818572288:8421376,3087007744:8389122,3355443200:8388610,3623878656:32770,3892314112:514,4160749568:8388608,1:32768,268435457:2,536870913:8421888,805306369:8388608,1073741825:8421378,1342177281:33280,1610612737:512,1879048193:8389122,2147483649:8421890,2415919105:8421376,2684354561:8388610,2952790017:33282,3221225473:514,3489660929:8389120,3758096385:32770,4026531841:0,134217729:8421890,402653185:8421376,671088641:8388608,939524097:512,1207959553:32768,1476395009:8388610,1744830465:2,2013265921:33282,2281701377:32770,2550136833:8389122,2818572289:514,3087007745:8421888,3355443201:8389120,3623878657:0,3892314113:33280,4160749569:8421378},{0:1074282512,16777216:16384,33554432:524288,50331648:1074266128,67108864:1073741840,83886080:1074282496,100663296:1073758208,117440512:16,134217728:540672,150994944:1073758224,167772160:1073741824,184549376:540688,201326592:524304,218103808:0,234881024:16400,251658240:1074266112,8388608:1073758208,25165824:540688,41943040:16,58720256:1073758224,75497472:1074282512,92274688:1073741824,109051904:524288,125829120:1074266128,142606336:524304,159383552:0,176160768:16384,192937984:1074266112,209715200:1073741840,226492416:540672,243269632:1074282496,260046848:16400,268435456:0,285212672:1074266128,301989888:1073758224,318767104:1074282496,335544320:1074266112,352321536:16,369098752:540688,385875968:16384,402653184:16400,419430400:524288,436207616:524304,452984832:1073741840,469762048:540672,486539264:1073758208,503316480:1073741824,520093696:1074282512,276824064:540688,293601280:524288,310378496:1074266112,327155712:16384,343932928:1073758208,360710144:1074282512,377487360:16,394264576:1073741824,411041792:1074282496,427819008:1073741840,444596224:1073758224,461373440:524304,478150656:0,494927872:16400,511705088:1074266128,528482304:540672},{0:260,1048576:0,2097152:67109120,3145728:65796,4194304:65540,5242880:67108868,6291456:67174660,7340032:67174400,8388608:67108864,9437184:67174656,10485760:65792,11534336:67174404,12582912:67109124,13631488:65536,14680064:4,15728640:256,524288:67174656,1572864:67174404,2621440:0,3670016:67109120,4718592:67108868,5767168:65536,6815744:65540,7864320:260,8912896:4,9961472:256,11010048:67174400,12058624:65796,13107200:65792,14155776:67109124,15204352:67174660,16252928:67108864,16777216:67174656,17825792:65540,18874368:65536,19922944:67109120,20971520:256,22020096:67174660,23068672:67108868,24117248:0,25165824:67109124,26214400:67108864,27262976:4,28311552:65792,29360128:67174400,30408704:260,31457280:65796,32505856:67174404,17301504:67108864,18350080:260,19398656:67174656,20447232:0,21495808:65540,22544384:67109120,23592960:256,24641536:67174404,25690112:65536,26738688:67174660,27787264:65796,28835840:67108868,29884416:67109124,30932992:67174400,31981568:4,33030144:65792},{0:2151682048,65536:2147487808,131072:4198464,196608:2151677952,262144:0,327680:4198400,393216:2147483712,458752:4194368,524288:2147483648,589824:4194304,655360:64,720896:2147487744,786432:2151678016,851968:4160,917504:4096,983040:2151682112,32768:2147487808,98304:64,163840:2151678016,229376:2147487744,294912:4198400,360448:2151682112,425984:0,491520:2151677952,557056:4096,622592:2151682048,688128:4194304,753664:4160,819200:2147483648,884736:4194368,950272:4198464,1015808:2147483712,1048576:4194368,1114112:4198400,1179648:2147483712,1245184:0,1310720:4160,1376256:2151678016,1441792:2151682048,1507328:2147487808,1572864:2151682112,1638400:2147483648,1703936:2151677952,1769472:4198464,1835008:2147487744,1900544:4194304,1966080:64,2031616:4096,1081344:2151677952,1146880:2151682112,1212416:0,1277952:4198400,1343488:4194368,1409024:2147483648,1474560:2147487808,1540096:64,1605632:2147483712,1671168:4096,1736704:2147487744,1802240:2151678016,1867776:4160,1933312:2151682048,1998848:4194304,2064384:4198464},{0:128,4096:17039360,8192:262144,12288:536870912,16384:537133184,20480:16777344,24576:553648256,28672:262272,32768:16777216,36864:537133056,40960:536871040,45056:553910400,49152:553910272,53248:0,57344:17039488,61440:553648128,2048:17039488,6144:553648256,10240:128,14336:17039360,18432:262144,22528:537133184,26624:553910272,30720:536870912,34816:537133056,38912:0,43008:553910400,47104:16777344,51200:536871040,55296:553648128,59392:16777216,63488:262272,65536:262144,69632:128,73728:536870912,77824:553648256,81920:16777344,86016:553910272,90112:537133184,94208:16777216,98304:553910400,102400:553648128,106496:17039360,110592:537133056,114688:262272,118784:536871040,122880:0,126976:17039488,67584:553648256,71680:16777216,75776:17039360,79872:537133184,83968:536870912,88064:17039488,92160:128,96256:553910272,100352:262272,104448:553910400,108544:0,112640:553648128,116736:16777344,120832:262144,124928:537133056,129024:536871040},{0:268435464,256:8192,512:270532608,768:270540808,1024:268443648,1280:2097152,1536:2097160,1792:268435456,2048:0,2304:268443656,2560:2105344,2816:8,3072:270532616,3328:2105352,3584:8200,3840:270540800,128:270532608,384:270540808,640:8,896:2097152,1152:2105352,1408:268435464,1664:268443648,1920:8200,2176:2097160,2432:8192,2688:268443656,2944:270532616,3200:0,3456:270540800,3712:2105344,3968:268435456,4096:268443648,4352:270532616,4608:270540808,4864:8200,5120:2097152,5376:268435456,5632:268435464,5888:2105344,6144:2105352,6400:0,6656:8,6912:270532608,7168:8192,7424:268443656,7680:270540800,7936:2097160,4224:8,4480:2105344,4736:2097152,4992:268435464,5248:268443648,5504:8200,5760:270540808,6016:270532608,6272:270540800,6528:270532616,6784:8192,7040:2105352,7296:2097160,7552:0,7808:268435456,8064:268443656},{0:1048576,16:33555457,32:1024,48:1049601,64:34604033,80:0,96:1,112:34603009,128:33555456,144:1048577,160:33554433,176:34604032,192:34603008,208:1025,224:1049600,240:33554432,8:34603009,24:0,40:33555457,56:34604032,72:1048576,88:33554433,104:33554432,120:1025,136:1049601,152:33555456,168:34603008,184:1048577,200:1024,216:34604033,232:1,248:1049600,256:33554432,272:1048576,288:33555457,304:34603009,320:1048577,336:33555456,352:34604032,368:1049601,384:1025,400:34604033,416:1049600,432:1,448:0,464:34603008,480:33554433,496:1024,264:1049600,280:33555457,296:34603009,312:1,328:33554432,344:1048576,360:1025,376:34604032,392:33554433,408:34603008,424:0,440:34604033,456:1049601,472:1024,488:33555456,504:1048577},{0:134219808,1:131072,2:134217728,3:32,4:131104,5:134350880,6:134350848,7:2048,8:134348800,9:134219776,10:133120,11:134348832,12:2080,13:0,14:134217760,15:133152,2147483648:2048,2147483649:134350880,2147483650:134219808,2147483651:134217728,2147483652:134348800,2147483653:133120,2147483654:133152,2147483655:32,2147483656:134217760,2147483657:2080,2147483658:131104,2147483659:134350848,2147483660:0,2147483661:134348832,2147483662:134219776,2147483663:131072,16:133152,17:134350848,18:32,19:2048,20:134219776,21:134217760,22:134348832,23:131072,24:0,25:131104,26:134348800,27:134219808,28:134350880,29:133120,30:2080,31:134217728,2147483664:131072,2147483665:2048,2147483666:134348832,2147483667:133152,2147483668:32,2147483669:134348800,2147483670:134217728,2147483671:134219808,2147483672:134350880,2147483673:134217760,2147483674:134219776,2147483675:0,2147483676:133120,2147483677:2080,2147483678:131104,2147483679:134350848}],h=[4160749569,528482304,33030144,2064384,129024,8064,504,2147483679],d=o.DES=i.extend({_doReset:function(){for(var t=this._key.words,e=[],r=0;r<56;r++){var n=s[r]-1;e[r]=t[n>>>5]>>>31-n%32&1}for(var i=this._subKeys=[],o=0;o<16;o++){var u=i[o]=[],h=c[o];for(r=0;r<24;r++)u[r/6|0]|=e[(a[r]-1+h)%28]<<31-r%6,u[4+(r/6|0)]|=e[28+(a[r+24]-1+h)%28]<<31-r%6;for(u[0]=u[0]<<1|u[0]>>>31,r=1;r<7;r++)u[r]=u[r]>>>4*(r-1)+3;u[7]=u[7]<<5|u[7]>>>27}var d=this._invSubKeys=[];for(r=0;r<16;r++)d[r]=i[15-r]},encryptBlock:function(t,e){this._doCryptBlock(t,e,this._subKeys)},decryptBlock:function(t,e){this._doCryptBlock(t,e,this._invSubKeys)},_doCryptBlock:function(t,e,r){this._lBlock=t[e],this._rBlock=t[e+1],l.call(this,4,252645135),l.call(this,16,65535),_.call(this,2,858993459),_.call(this,8,16711935),l.call(this,1,1431655765);for(var n=0;n<16;n++){for(var i=r[n],o=this._lBlock,s=this._rBlock,a=0,c=0;c<8;c++)a|=u[c][((s^i[c])&h[c])>>>0];this._lBlock=s,this._rBlock=o^a}var d=this._lBlock;this._lBlock=this._rBlock,this._rBlock=d,l.call(this,1,1431655765),_.call(this,8,16711935),_.call(this,2,858993459),l.call(this,16,65535),l.call(this,4,252645135),t[e]=this._lBlock,t[e+1]=this._rBlock},keySize:2,ivSize:2,blockSize:2});function l(t,e){var r=(this._lBlock>>>t^this._rBlock)&e;this._rBlock^=r,this._lBlock^=r<<t}function _(t,e){var r=(this._rBlock>>>t^this._lBlock)&e;this._lBlock^=r,this._rBlock^=r<<t}t.DES=i._createHelper(d);var p=o.TripleDES=i.extend({_doReset:function(){var t=this._key.words;if(2!==t.length&&4!==t.length&&t.length<6)throw new Error("Invalid key length - 3DES requires the key length to be 64, 128, 192 or >192.");var e=t.slice(0,2),r=t.length<4?t.slice(0,2):t.slice(2,4),i=t.length<6?t.slice(0,2):t.slice(4,6);this._des1=d.createEncryptor(n.create(e)),this._des2=d.createEncryptor(n.create(r)),this._des3=d.createEncryptor(n.create(i))},encryptBlock:function(t,e){this._des1.encryptBlock(t,e),this._des2.decryptBlock(t,e),this._des3.encryptBlock(t,e)},decryptBlock:function(t,e){this._des3.decryptBlock(t,e),this._des2.encryptBlock(t,e),this._des1.decryptBlock(t,e)},keySize:6,ivSize:2,blockSize:2});t.TripleDES=i._createHelper(p)}(),r.TripleDES)})),A((function(t,e){var r;t.exports=(r=U,function(){var t=r,e=t.lib.StreamCipher,n=t.algo,i=n.RC4=e.extend({_doReset:function(){for(var t=this._key,e=t.words,r=t.sigBytes,n=this._S=[],i=0;i<256;i++)n[i]=i;i=0;for(var o=0;i<256;i++){var s=i%r,a=e[s>>>2]>>>24-s%4*8&255;o=(o+n[i]+a)%256;var c=n[i];n[i]=n[o],n[o]=c}this._i=this._j=0},_doProcessBlock:function(t,e){t[e]^=o.call(this)},keySize:8,ivSize:0});function o(){for(var t=this._S,e=this._i,r=this._j,n=0,i=0;i<4;i++){r=(r+t[e=(e+1)%256])%256;var o=t[e];t[e]=t[r],t[r]=o,n|=t[(t[e]+t[r])%256]<<24-8*i}return this._i=e,this._j=r,n}t.RC4=e._createHelper(i);var s=n.RC4Drop=i.extend({cfg:i.cfg.extend({drop:192}),_doReset:function(){i._doReset.call(this);for(var t=this.cfg.drop;t>0;t--)o.call(this)}});t.RC4Drop=e._createHelper(s)}(),r.RC4)})),A((function(t,e){var r;t.exports=(r=U,function(){var t=r,e=t.lib.StreamCipher,n=t.algo,i=[],o=[],s=[],a=n.Rabbit=e.extend({_doReset:function(){for(var t=this._key.words,e=this.cfg.iv,r=0;r<4;r++)t[r]=16711935&(t[r]<<8|t[r]>>>24)|4278255360&(t[r]<<24|t[r]>>>8);var n=this._X=[t[0],t[3]<<16|t[2]>>>16,t[1],t[0]<<16|t[3]>>>16,t[2],t[1]<<16|t[0]>>>16,t[3],t[2]<<16|t[1]>>>16],i=this._C=[t[2]<<16|t[2]>>>16,4294901760&t[0]|65535&t[1],t[3]<<16|t[3]>>>16,4294901760&t[1]|65535&t[2],t[0]<<16|t[0]>>>16,4294901760&t[2]|65535&t[3],t[1]<<16|t[1]>>>16,4294901760&t[3]|65535&t[0]];for(this._b=0,r=0;r<4;r++)c.call(this);for(r=0;r<8;r++)i[r]^=n[r+4&7];if(e){var o=e.words,s=o[0],a=o[1],u=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8),h=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8),d=u>>>16|4294901760&h,l=h<<16|65535&u;for(i[0]^=u,i[1]^=d,i[2]^=h,i[3]^=l,i[4]^=u,i[5]^=d,i[6]^=h,i[7]^=l,r=0;r<4;r++)c.call(this)}},_doProcessBlock:function(t,e){var r=this._X;c.call(this),i[0]=r[0]^r[5]>>>16^r[3]<<16,i[1]=r[2]^r[7]>>>16^r[5]<<16,i[2]=r[4]^r[1]>>>16^r[7]<<16,i[3]=r[6]^r[3]>>>16^r[1]<<16;for(var n=0;n<4;n++)i[n]=16711935&(i[n]<<8|i[n]>>>24)|4278255360&(i[n]<<24|i[n]>>>8),t[e+n]^=i[n]},blockSize:4,ivSize:2});function c(){for(var t=this._X,e=this._C,r=0;r<8;r++)o[r]=e[r];for(e[0]=e[0]+1295307597+this._b|0,e[1]=e[1]+3545052371+(e[0]>>>0<o[0]>>>0?1:0)|0,e[2]=e[2]+886263092+(e[1]>>>0<o[1]>>>0?1:0)|0,e[3]=e[3]+1295307597+(e[2]>>>0<o[2]>>>0?1:0)|0,e[4]=e[4]+3545052371+(e[3]>>>0<o[3]>>>0?1:0)|0,e[5]=e[5]+886263092+(e[4]>>>0<o[4]>>>0?1:0)|0,e[6]=e[6]+1295307597+(e[5]>>>0<o[5]>>>0?1:0)|0,e[7]=e[7]+3545052371+(e[6]>>>0<o[6]>>>0?1:0)|0,this._b=e[7]>>>0<o[7]>>>0?1:0,r=0;r<8;r++){var n=t[r]+e[r],i=65535&n,a=n>>>16,c=((i*i>>>17)+i*a>>>15)+a*a,u=((4294901760&n)*n|0)+((65535&n)*n|0);s[r]=c^u}t[0]=s[0]+(s[7]<<16|s[7]>>>16)+(s[6]<<16|s[6]>>>16)|0,t[1]=s[1]+(s[0]<<8|s[0]>>>24)+s[7]|0,t[2]=s[2]+(s[1]<<16|s[1]>>>16)+(s[0]<<16|s[0]>>>16)|0,t[3]=s[3]+(s[2]<<8|s[2]>>>24)+s[1]|0,t[4]=s[4]+(s[3]<<16|s[3]>>>16)+(s[2]<<16|s[2]>>>16)|0,t[5]=s[5]+(s[4]<<8|s[4]>>>24)+s[3]|0,t[6]=s[6]+(s[5]<<16|s[5]>>>16)+(s[4]<<16|s[4]>>>16)|0,t[7]=s[7]+(s[6]<<8|s[6]>>>24)+s[5]|0}t.Rabbit=e._createHelper(a)}(),r.Rabbit)})),A((function(t,e){var r;t.exports=(r=U,function(){var t=r,e=t.lib.StreamCipher,n=t.algo,i=[],o=[],s=[],a=n.RabbitLegacy=e.extend({_doReset:function(){var t=this._key.words,e=this.cfg.iv,r=this._X=[t[0],t[3]<<16|t[2]>>>16,t[1],t[0]<<16|t[3]>>>16,t[2],t[1]<<16|t[0]>>>16,t[3],t[2]<<16|t[1]>>>16],n=this._C=[t[2]<<16|t[2]>>>16,4294901760&t[0]|65535&t[1],t[3]<<16|t[3]>>>16,4294901760&t[1]|65535&t[2],t[0]<<16|t[0]>>>16,4294901760&t[2]|65535&t[3],t[1]<<16|t[1]>>>16,4294901760&t[3]|65535&t[0]];this._b=0;for(var i=0;i<4;i++)c.call(this);for(i=0;i<8;i++)n[i]^=r[i+4&7];if(e){var o=e.words,s=o[0],a=o[1],u=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8),h=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8),d=u>>>16|4294901760&h,l=h<<16|65535&u;for(n[0]^=u,n[1]^=d,n[2]^=h,n[3]^=l,n[4]^=u,n[5]^=d,n[6]^=h,n[7]^=l,i=0;i<4;i++)c.call(this)}},_doProcessBlock:function(t,e){var r=this._X;c.call(this),i[0]=r[0]^r[5]>>>16^r[3]<<16,i[1]=r[2]^r[7]>>>16^r[5]<<16,i[2]=r[4]^r[1]>>>16^r[7]<<16,i[3]=r[6]^r[3]>>>16^r[1]<<16;for(var n=0;n<4;n++)i[n]=16711935&(i[n]<<8|i[n]>>>24)|4278255360&(i[n]<<24|i[n]>>>8),t[e+n]^=i[n]},blockSize:4,ivSize:2});function c(){for(var t=this._X,e=this._C,r=0;r<8;r++)o[r]=e[r];for(e[0]=e[0]+1295307597+this._b|0,e[1]=e[1]+3545052371+(e[0]>>>0<o[0]>>>0?1:0)|0,e[2]=e[2]+886263092+(e[1]>>>0<o[1]>>>0?1:0)|0,e[3]=e[3]+1295307597+(e[2]>>>0<o[2]>>>0?1:0)|0,e[4]=e[4]+3545052371+(e[3]>>>0<o[3]>>>0?1:0)|0,e[5]=e[5]+886263092+(e[4]>>>0<o[4]>>>0?1:0)|0,e[6]=e[6]+1295307597+(e[5]>>>0<o[5]>>>0?1:0)|0,e[7]=e[7]+3545052371+(e[6]>>>0<o[6]>>>0?1:0)|0,this._b=e[7]>>>0<o[7]>>>0?1:0,r=0;r<8;r++){var n=t[r]+e[r],i=65535&n,a=n>>>16,c=((i*i>>>17)+i*a>>>15)+a*a,u=((4294901760&n)*n|0)+((65535&n)*n|0);s[r]=c^u}t[0]=s[0]+(s[7]<<16|s[7]>>>16)+(s[6]<<16|s[6]>>>16)|0,t[1]=s[1]+(s[0]<<8|s[0]>>>24)+s[7]|0,t[2]=s[2]+(s[1]<<16|s[1]>>>16)+(s[0]<<16|s[0]>>>16)|0,t[3]=s[3]+(s[2]<<8|s[2]>>>24)+s[1]|0,t[4]=s[4]+(s[3]<<16|s[3]>>>16)+(s[2]<<16|s[2]>>>16)|0,t[5]=s[5]+(s[4]<<8|s[4]>>>24)+s[3]|0,t[6]=s[6]+(s[5]<<16|s[5]>>>16)+(s[4]<<16|s[4]>>>16)|0,t[7]=s[7]+(s[6]<<8|s[6]>>>24)+s[5]|0}t.RabbitLegacy=e._createHelper(a)}(),r.RabbitLegacy)})),A((function(t,e){t.exports=U}))),q=j,F=null;try{F=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(ae){}function j(t,e,r){this.low=0|t,this.high=0|e,this.unsigned=!!r}function V(t){return!0===(t&&t.__isLong__)}j.prototype.__isLong__,Object.defineProperty(j.prototype,"__isLong__",{value:!0}),j.isLong=V;var z={},H={};function G(t,e){var r,n,i;return e?(i=0<=(t>>>=0)&&t<256)&&(n=H[t])?n:(r=K(t,(0|t)<0?-1:0,!0),i&&(H[t]=r),r):(i=-128<=(t|=0)&&t<128)&&(n=z[t])?n:(r=K(t,t<0?-1:0,!1),i&&(z[t]=r),r)}function W(t,e){if(isNaN(t))return e?rt:et;if(e){if(t<0)return rt;if(t>=J)return at}else{if(t<=-$)return ct;if(t+1>=$)return st}return t<0?W(-t,e).neg():K(t%Y|0,t/Y|0,e)}function K(t,e,r){return new j(t,e,r)}j.fromInt=G,j.fromNumber=W,j.fromBits=K;var X=Math.pow;function Z(t,e,r){if(0===t.length)throw Error("empty string");if("NaN"===t||"Infinity"===t||"+Infinity"===t||"-Infinity"===t)return et;if("number"==typeof e?(r=e,e=!1):e=!!e,(r=r||10)<2||36<r)throw RangeError("radix");var n;if((n=t.indexOf("-"))>0)throw Error("interior hyphen");if(0===n)return Z(t.substring(1),e,r).neg();for(var i=W(X(r,8)),o=et,s=0;s<t.length;s+=8){var a=Math.min(8,t.length-s),c=parseInt(t.substring(s,s+a),r);if(a<8){var u=W(X(r,a));o=o.mul(u).add(W(c))}else o=(o=o.mul(i)).add(W(c))}return o.unsigned=e,o}function Q(t,e){return"number"==typeof t?W(t,e):"string"==typeof t?Z(t,e):K(t.low,t.high,"boolean"==typeof e?e:t.unsigned)}j.fromString=Z,j.fromValue=Q;var Y=4294967296,J=Y*Y,$=J/2,tt=G(1<<24),et=G(0);j.ZERO=et;var rt=G(0,!0);j.UZERO=rt;var nt=G(1);j.ONE=nt;var it=G(1,!0);j.UONE=it;var ot=G(-1);j.NEG_ONE=ot;var st=K(-1,2147483647,!1);j.MAX_VALUE=st;var at=K(-1,-1,!0);j.MAX_UNSIGNED_VALUE=at;var ct=K(0,-2147483648,!1);j.MIN_VALUE=ct;var ut=j.prototype;ut.toInt=function(){return this.unsigned?this.low>>>0:this.low},ut.toNumber=function(){return this.unsigned?(this.high>>>0)*Y+(this.low>>>0):this.high*Y+(this.low>>>0)},ut.toString=function(t){if((t=t||10)<2||36<t)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(ct)){var e=W(t),r=this.div(e),n=r.mul(e).sub(this);return r.toString(t)+n.toInt().toString(t)}return"-"+this.neg().toString(t)}for(var i=W(X(t,6),this.unsigned),o=this,s="";;){var a=o.div(i),c=(o.sub(a.mul(i)).toInt()>>>0).toString(t);if((o=a).isZero())return c+s;for(;c.length<6;)c="0"+c;s=""+c+s}},ut.getHighBits=function(){return this.high},ut.getHighBitsUnsigned=function(){return this.high>>>0},ut.getLowBits=function(){return this.low},ut.getLowBitsUnsigned=function(){return this.low>>>0},ut.getNumBitsAbs=function(){if(this.isNegative())return this.eq(ct)?64:this.neg().getNumBitsAbs();for(var t=0!=this.high?this.high:this.low,e=31;e>0&&0==(t&1<<e);e--);return 0!=this.high?e+33:e+1},ut.isZero=function(){return 0===this.high&&0===this.low},ut.eqz=ut.isZero,ut.isNegative=function(){return!this.unsigned&&this.high<0},ut.isPositive=function(){return this.unsigned||this.high>=0},ut.isOdd=function(){return 1==(1&this.low)},ut.isEven=function(){return 0==(1&this.low)},ut.equals=function(t){return V(t)||(t=Q(t)),(this.unsigned===t.unsigned||this.high>>>31!=1||t.high>>>31!=1)&&(this.high===t.high&&this.low===t.low)},ut.eq=ut.equals,ut.notEquals=function(t){return!this.eq(t)},ut.neq=ut.notEquals,ut.ne=ut.notEquals,ut.lessThan=function(t){return this.comp(t)<0},ut.lt=ut.lessThan,ut.lessThanOrEqual=function(t){return this.comp(t)<=0},ut.lte=ut.lessThanOrEqual,ut.le=ut.lessThanOrEqual,ut.greaterThan=function(t){return this.comp(t)>0},ut.gt=ut.greaterThan,ut.greaterThanOrEqual=function(t){return this.comp(t)>=0},ut.gte=ut.greaterThanOrEqual,ut.ge=ut.greaterThanOrEqual,ut.compare=function(t){if(V(t)||(t=Q(t)),this.eq(t))return 0;var e=this.isNegative(),r=t.isNegative();return e&&!r?-1:!e&&r?1:this.unsigned?t.high>>>0>this.high>>>0||t.high===this.high&&t.low>>>0>this.low>>>0?-1:1:this.sub(t).isNegative()?-1:1},ut.comp=ut.compare,ut.negate=function(){return!this.unsigned&&this.eq(ct)?ct:this.not().add(nt)},ut.neg=ut.negate,ut.add=function(t){V(t)||(t=Q(t));var e=this.high>>>16,r=65535&this.high,n=this.low>>>16,i=65535&this.low,o=t.high>>>16,s=65535&t.high,a=t.low>>>16,c=0,u=0,h=0,d=0;return h+=(d+=i+(65535&t.low))>>>16,u+=(h+=n+a)>>>16,c+=(u+=r+s)>>>16,c+=e+o,K((h&=65535)<<16|(d&=65535),(c&=65535)<<16|(u&=65535),this.unsigned)},ut.subtract=function(t){return V(t)||(t=Q(t)),this.add(t.neg())},ut.sub=ut.subtract,ut.multiply=function(t){if(this.isZero())return et;if(V(t)||(t=Q(t)),F)return K(F.mul(this.low,this.high,t.low,t.high),F.get_high(),this.unsigned);if(t.isZero())return et;if(this.eq(ct))return t.isOdd()?ct:et;if(t.eq(ct))return this.isOdd()?ct:et;if(this.isNegative())return t.isNegative()?this.neg().mul(t.neg()):this.neg().mul(t).neg();if(t.isNegative())return this.mul(t.neg()).neg();if(this.lt(tt)&&t.lt(tt))return W(this.toNumber()*t.toNumber(),this.unsigned);var e=this.high>>>16,r=65535&this.high,n=this.low>>>16,i=65535&this.low,o=t.high>>>16,s=65535&t.high,a=t.low>>>16,c=65535&t.low,u=0,h=0,d=0,l=0;return d+=(l+=i*c)>>>16,h+=(d+=n*c)>>>16,d&=65535,h+=(d+=i*a)>>>16,u+=(h+=r*c)>>>16,h&=65535,u+=(h+=n*a)>>>16,h&=65535,u+=(h+=i*s)>>>16,u+=e*c+r*a+n*s+i*o,K((d&=65535)<<16|(l&=65535),(u&=65535)<<16|(h&=65535),this.unsigned)},ut.mul=ut.multiply,ut.divide=function(t){if(V(t)||(t=Q(t)),t.isZero())throw Error("division by zero");var e,r,n;if(F)return this.unsigned||-2147483648!==this.high||-1!==t.low||-1!==t.high?K((this.unsigned?F.div_u:F.div_s)(this.low,this.high,t.low,t.high),F.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?rt:et;if(this.unsigned){if(t.unsigned||(t=t.toUnsigned()),t.gt(this))return rt;if(t.gt(this.shru(1)))return it;n=rt}else{if(this.eq(ct))return t.eq(nt)||t.eq(ot)?ct:t.eq(ct)?nt:(e=this.shr(1).div(t).shl(1)).eq(et)?t.isNegative()?nt:ot:(r=this.sub(t.mul(e)),n=e.add(r.div(t)));if(t.eq(ct))return this.unsigned?rt:et;if(this.isNegative())return t.isNegative()?this.neg().div(t.neg()):this.neg().div(t).neg();if(t.isNegative())return this.div(t.neg()).neg();n=et}for(r=this;r.gte(t);){e=Math.max(1,Math.floor(r.toNumber()/t.toNumber()));for(var i=Math.ceil(Math.log(e)/Math.LN2),o=i<=48?1:X(2,i-48),s=W(e),a=s.mul(t);a.isNegative()||a.gt(r);)a=(s=W(e-=o,this.unsigned)).mul(t);s.isZero()&&(s=nt),n=n.add(s),r=r.sub(a)}return n},ut.div=ut.divide,ut.modulo=function(t){return V(t)||(t=Q(t)),F?K((this.unsigned?F.rem_u:F.rem_s)(this.low,this.high,t.low,t.high),F.get_high(),this.unsigned):this.sub(this.div(t).mul(t))},ut.mod=ut.modulo,ut.rem=ut.modulo,ut.not=function(){return K(~this.low,~this.high,this.unsigned)},ut.and=function(t){return V(t)||(t=Q(t)),K(this.low&t.low,this.high&t.high,this.unsigned)},ut.or=function(t){return V(t)||(t=Q(t)),K(this.low|t.low,this.high|t.high,this.unsigned)},ut.xor=function(t){return V(t)||(t=Q(t)),K(this.low^t.low,this.high^t.high,this.unsigned)},ut.shiftLeft=function(t){return V(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?K(this.low<<t,this.high<<t|this.low>>>32-t,this.unsigned):K(0,this.low<<t-32,this.unsigned)},ut.shl=ut.shiftLeft,ut.shiftRight=function(t){return V(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?K(this.low>>>t|this.high<<32-t,this.high>>t,this.unsigned):K(this.high>>t-32,this.high>=0?0:-1,this.unsigned)},ut.shr=ut.shiftRight,ut.shiftRightUnsigned=function(t){if(V(t)&&(t=t.toInt()),0===(t&=63))return this;var e=this.high;return t<32?K(this.low>>>t|e<<32-t,e>>>t,this.unsigned):K(32===t?e:e>>>t-32,0,this.unsigned)},ut.shru=ut.shiftRightUnsigned,ut.shr_u=ut.shiftRightUnsigned,ut.toSigned=function(){return this.unsigned?K(this.low,this.high,!1):this},ut.toUnsigned=function(){return this.unsigned?this:K(this.low,this.high,!0)},ut.toBytes=function(t){return t?this.toBytesLE():this.toBytesBE()},ut.toBytesLE=function(){var t=this.high,e=this.low;return[255&e,e>>>8&255,e>>>16&255,e>>>24,255&t,t>>>8&255,t>>>16&255,t>>>24]},ut.toBytesBE=function(){var t=this.high,e=this.low;return[t>>>24,t>>>16&255,t>>>8&255,255&t,e>>>24,e>>>16&255,e>>>8&255,255&e]},j.fromBytes=function(t,e,r){return r?j.fromBytesLE(t,e):j.fromBytesBE(t,e)},j.fromBytesLE=function(t,e){return new j(t[0]|t[1]<<8|t[2]<<16|t[3]<<24,t[4]|t[5]<<8|t[6]<<16|t[7]<<24,e)},j.fromBytesBE=function(t,e){return new j(t[4]<<24|t[5]<<16|t[6]<<8|t[7],t[0]<<24|t[1]<<16|t[2]<<8|t[3],e)};var ht=function(){function t(){}return t.ULongToNumber=function(t){return q.fromBits(t.low,t.high,!0).toNumber()},t.LongToNumber=function(t){return q.fromBits(t.low,t.high,!1).toNumber()},t.NumberToLong=function(t){return q.fromNumber(t,!1)},t.NumberToULong=function(t){return q.fromNumber(t,!0)},t.stringToString=function(t){return t||""},t.md5_str=function(t){var e=N.lib.WordArray.create(t);return N.MD5(e).toString().toUpperCase()},t.getUUid=function(t,e){var r="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),n=[],i=0;if(e=e||r.length,t)for(i=0;i<t;i++)n[i]=r[0|Math.random()*e];else{var o=void 0;for(n[8]=n[13]=n[18]=n[23]="-",n[14]="4",i=0;i<36;i++)n[i]||(o=0|16*Math.random(),n[i]=r[19==i?3&o|8:o])}return n.join("")},t}(),dt=function(){function t(){}return t.get_peerid_head=function(t){return t?"E01000":"E00000"},t.generate_old_peer_id=function(e){var r=t.get_peerid_head(e);return r+ht.getUUid(t.PEER_ID_LENGTH-r.length,16)},t.nowMs=function(){return 0==e.server_current_time_stamp_ms_&&(e.server_current_time_stamp_ms_=(new Date).getTime(),e.server_current_tickcount_=t.getTickCountMs()),e.server_current_time_stamp_ms_+(t.getTickCountMs()-e.server_current_tickcount_)},t.getTickCountMs=function(){return window.performance.now()},t.nowSec=function(){return Math.floor((new Date).getTime()/1e3)},t.get_peer_id=function(r){var n=r?"pcdn-peer-id-live":"pcdn-peer-id",i=localStorage.getItem(n);if(null!=i&&40===i.length)return i;var o=t.generate_old_peer_id(r)+e.cid_+"H5"+e.web_cna_;return i="E0"+(r?"100000":"000000")+ht.md5_str(o),S.log("cna:",e.web_cna_,",peerid:",i),localStorage.setItem(n,i),i},t.get_is_pre=function(){var t=localStorage.getItem("pcdn_use_pre");return null!=t?t:"0"},t.SetIsEqual=function(t,e){var r,n;if(t.size!==e.size)return!1;try{for(var i=y(t),o=i.next();!o.done;o=i.next()){var s=o.value;if(!e.has(s))return!1}}catch(a){r={error:a}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}return!0},t.asynTask=function(t,e){var r={timeoutId_:-1};r.timeoutId_=window.setTimeout((function(){t&&t(),r.timeoutId_>=0&&(window.clearInterval(r.timeoutId_),r.timeoutId_=-1)}),e)},t.isEdgePeer=function(t){if(t.length<=3)return!1;var e=t.substring(0,3);return"600"==e||"601"==e||"610"==e},t.PEER_ID_LENGTH=40,t}();e.GUtils=dt;var lt,_t,pt,ft=function(){function t(){}return t.get_down_detail=function(){var r="----------------------------\n";return r+="version:\t"+L.version+"\n",r+="PlayDuration:\t"+this.duration.toFixed(2)+"s\n",r+="startDataTime:\t"+e.pcdn_init_data_time_+"\n",r+="server_time_stamp:\t"+dt.nowMs()+"\n",r+="T1:\t"+this._T1.toLocaleString()+"\n",r+="T2:\t"+this._T2.toLocaleString()+"\n",r+="T3:\t"+this._T3.toLocaleString()+"\n",r+="T5:\t"+this._T5.toLocaleString()+"\n",r+="T8:\t"+this._T8.toLocaleString()+"\n",r+="P2P[1-T1/T8]:\t"+t.get_L_t1_t8()+"%\n",r+="waste[(T1+T2+T3-T8)/T8]:\t"+t.get_tx_ty(this._T1+this._T2+this._T3-this._T8,t._T8)+"%\n",r+="[T2/T8]:\t"+t.get_tx_ty(t._T2,t._T8)+"%\n",r+="[T3/T8]:\t"+t.get_tx_ty(t._T3,t._T8)+"%\n",r+="[T5/T1]:\t"+t.get_tx_ty(t._T5,t._T1)+"%\n",r+="[T5/T8]:\t"+t.get_tx_ty(t._T5,t._T8)+"%\n",r+="----------------------------"},t.get_tx_ty=function(t,e){return 0===e?"0.0":(100*t/e).toFixed(2).toString()},t.get_L_t1_t8=function(){return 0===t._T8?"0.0":(100-100*t._T1/t._T8).toFixed(2).toString()},t.get_t5_t8=function(){return t.get_tx_ty(t._T5,t._T8)},t.T1_add=function(t){this._T1+=t},Object.defineProperty(t,"T1_total",{get:function(){return this._T1},enumerable:!1,configurable:!0}),Object.defineProperty(t,"T1_diff",{get:function(){var t=this._T1-this._T1_last;return this._T1_last=this._T1,t},enumerable:!1,configurable:!0}),Object.defineProperty(t,"T1_diff_r",{get:function(){var t=this._T1-this._T1_last_r;return this._T1_last_r=this._T1,t},enumerable:!1,configurable:!0}),t.T2_add=function(t){this._T2+=t},Object.defineProperty(t,"T2_total",{get:function(){return this._T2},enumerable:!1,configurable:!0}),Object.defineProperty(t,"T2_diff",{get:function(){var t=this._T2-this._T2_last;return this._T2_last=this._T2,t},enumerable:!1,configurable:!0}),Object.defineProperty(t,"T2_diff_r",{get:function(){var t=this._T2-this._T2_last_r;return this._T2_last_r=this._T2,t},enumerable:!1,configurable:!0}),t.T3_add=function(t){this._T3+=t},Object.defineProperty(t,"T3_total",{get:function(){return this._T3},enumerable:!1,configurable:!0}),Object.defineProperty(t,"T3_diff",{get:function(){var t=this._T3-this._T3_last;return this._T3_last=this._T3,t},enumerable:!1,configurable:!0}),Object.defineProperty(t,"T3_diff_r",{get:function(){var t=this._T3-this._T3_last_r;return this._T3_last_r=this._T3,t},enumerable:!1,configurable:!0}),t.T4_add=function(t){this._T4+=t},Object.defineProperty(t,"T4_total",{get:function(){return this._T4},enumerable:!1,configurable:!0}),Object.defineProperty(t,"T4_diff",{get:function(){var t=this._T4-this._T4_last;return this._T4_last=this._T4,t},enumerable:!1,configurable:!0}),Object.defineProperty(t,"T4_diff_r",{get:function(){var t=this._T4-this._T4_last_r;return this._T4_last_r=this._T4,t},enumerable:!1,configurable:!0}),t.T4_sub=function(t){this._T4-=t},t.T5_add=function(t){this._T5+=t},Object.defineProperty(t,"T5_total",{get:function(){return this._T5},enumerable:!1,configurable:!0}),Object.defineProperty(t,"T5_diff",{get:function(){var t=this._T5-this._T5_last;return this._T5_last=this._T5,t},enumerable:!1,configurable:!0}),Object.defineProperty(t,"T5_diff_r",{get:function(){var t=this._T5-this._T5_last_r;return this._T5_last_r=this._T5,t},enumerable:!1,configurable:!0}),t.T8_add=function(t){this._T8+=t},Object.defineProperty(t,"T8_total",{get:function(){return this._T8},enumerable:!1,configurable:!0}),Object.defineProperty(t,"T8_diff",{get:function(){var t=this._T8-this._T8_last;return this._T8_last=this._T8,t},enumerable:!1,configurable:!0}),Object.defineProperty(t,"T8_diff_r",{get:function(){var t=this._T8-this._T8_last_r;return this._T8_last_r=this._T8,t},enumerable:!1,configurable:!0}),t.wastePer=function(){return 0==this._T8?0:100*(t._T1+this._T2+this._T3-this._T8)/this._T8},t.hasCdnErrRecord=function(){return null!==this.cdnErrRecordMap_&&this.cdnErrRecordMap_.size>0},t.clearCdnErrRecord=function(){null!==this.cdnErrRecordMap_&&this.cdnErrRecordMap_.clear()},t.getCdnErrRecord=function(){return this.cdnErrRecordMap_},t.recordP2pDataError=function(t){var e=this.p2pErrRecordMap_.get(t);null!=e?(e++,this.p2pErrRecordMap_.set(t,e)):this.p2pErrRecordMap_.set(t,1)},t.hasP2pErrRecord=function(){return null!==this.p2pErrRecordMap_&&this.p2pErrRecordMap_.size>0},t.clearP2pErrRecord=function(){null!==this.p2pErrRecordMap_&&this.p2pErrRecordMap_.clear()},t.getP2pErrRecord=function(){return this.p2pErrRecordMap_},t.getLoginErrTimes=function(){return this.loginErrTimes_},t.setLoginErrTimes=function(t){t?this.loginErrTimes_=0:this.loginErrTimes_+=1},t.addRtcBytes=function(t,e){e?(++this.rtcSendCount_,this.rtcSendBytes_+=t):(++this.rtcRecvCount_,this.rtcRecvBytes_+=t)},t.addMqttBytes=function(t,e){e?(++this.mqttSendCount_,this.mqttSendBytes_+=t):(++this.mqttRecvCount_,this.mqttRecvBytes_+=t)},t.dumpRtc=function(){var t={mqttSendCount:this.mqttSendCount_.toLocaleString(),mqttRecvCount:this.mqttRecvCount_.toLocaleString(),mqttSendBytes:this.mqttSendBytes_.toLocaleString(),mqttRecvBytes:this.mqttRecvBytes_.toLocaleString(),rtcSendCount:this.rtcSendCount_.toLocaleString(),rtcRecvCount:this.rtcRecvCount_.toLocaleString(),rtcSendBytes:this.rtcSendBytes_.toLocaleString(),rtcRecvBytes:this.rtcRecvBytes_.toLocaleString()};return JSON.stringify(t,null,2)},t._T1=0,t._T2=0,t._T3=0,t._T4=0,t._T5=0,t._T8=0,t._T1_last=0,t._T2_last=0,t._T3_last=0,t._T4_last=0,t._T5_last=0,t._T8_last=0,t._T1_last_r=0,t._T2_last_r=0,t._T3_last_r=0,t._T4_last_r=0,t._T5_last_r=0,t._T8_last_r=0,t.tsSn=0,t.loadSize=0,t.totalSize=0,t.loadMode=0,t.cdnSpeed=0,t.p2pSpeed=0,t.duration=0,t.cdnErrRecordMap_=new Map,t.p2pErrRecordMap_=new Map,t.loginErrTimes_=0,t.rtcSendBytes_=0,t.rtcRecvBytes_=0,t.rtcSendCount_=0,t.rtcRecvCount_=0,t.mqttSendBytes_=0,t.mqttRecvBytes_=0,t.mqttSendCount_=0,t.mqttRecvCount_=0,t}(),bt=function(){function t(e,r){this.bufferCount_=Math.ceil(r/t.WORD_LENGTH),this.buffer_=new Uint32Array(this.bufferCount_),this.bitLength_=r,this.buffer_.fill(0),this.isFull_=!1,this.sn_=e}return t.prototype.getBuffer32Count=function(){return this.bufferCount_},t.prototype.getBitLength=function(){return this.bitLength_},t.prototype.isON=function(e){return 0!=(this.buffer_[e/t.WORD_LENGTH|0]&1<<e%t.WORD_LENGTH)},t.prototype.isOnRange=function(t,e){for(var r=t;r<e;++r)if(!this.isON(r))return!1;return!0},t.prototype.isOnLast=function(){return this.isON(this.bitLength_-1)},t.prototype.setON=function(e){e>=this.bitLength_||(this.buffer_[e/t.WORD_LENGTH|0]|=1<<e%t.WORD_LENGTH)},t.prototype.setOFF=function(e){e>=this.bitLength_||(this.buffer_[e/t.WORD_LENGTH|0]&=~(1<<e%t.WORD_LENGTH))},t.prototype.setAllON=function(){if(!(this.bufferCount_<0)&&(this.buffer_.fill(t.MAX_NUMBER),0!=this.bitLength_%t.WORD_LENGTH)){var e=this.bitLength_%t.WORD_LENGTH;this.buffer_[this.bufferCount_-1]=(1<<e)-1}},t.lsb=function(t){for(var e=0,r=t&-t;r>>>=1;++e);return e},t.prototype.lowZeroPos=function(){for(var e=0,r=0;r<this.bufferCount_;++r){var n=this.buffer_[r];if(0==n)break;if(t.MAX_NUMBER!=n){e+=t.lsb(~n);break}e+=t.WORD_LENGTH}return e>this.bitLength_?this.bitLength_:e},t.prototype.lowZeroArray=function(e,r,n,i){for(var o=0,s=e,a=0;n.length<r&&a<this.bitLength_;)s>=this.bitLength_&&(i.checkStartTimer(),s=0),0!=s%t.WORD_LENGTH||t.MAX_NUMBER!=this.buffer_[s/t.WORD_LENGTH|0]?(0==(this.buffer_[s/t.WORD_LENGTH|0]&1<<s%t.WORD_LENGTH)&&(++o,i.isDwningMn(s)?S.rtclog("[rtc][p2p][data][ignore]sn:",this.sn_,",begin:",e,",mn:",s):(S.rtclog("[rtc][p2p][data][add]sn:",this.sn_,",mn:",s),n.push(s))),++a,++s):(a+=t.WORD_LENGTH,s+=t.WORD_LENGTH);return S.rtclog("[rtc][p2p][lowZeroArray]sn:",this.sn_,", begin:",e,", maxCn:",r,", mns:",n,", ret:",o),o},t.bitsCount32=function(t){return 16843009*((t=(858993459&(t-=t>>>1&1431655765))+(t>>>2&858993459))+(t>>>4)&252645135)>>>24},t.prototype.getAllBitsCount=function(e){for(var r=0,n=0;n<this.bufferCount_;++n){var i=this.buffer_[n];0!=i&&(t.MAX_NUMBER!=i?r+=t.bitsCount32(i):r+=t.WORD_LENGTH)}return e&&r>this.bitLength_?this.bitLength_:r},t.prototype.write=function(t,e){t>=this.bufferCount_||(this.buffer_[t]=e)},t.prototype.isFull=function(t){return t?this.lowZeroPos()>=this.bitLength_:(this.isFull_||(this.isFull_=this.lowZeroPos()>=this.bitLength_),this.isFull_)},t.WORD_LENGTH=32,t.MAX_NUMBER=4294967295,t}(),gt=function(){function t(){this.hitCount_=0,this.mallocCount_=0,this.freeCount_=0,this.list_=new Array}return t.instance=function(){return null==t.instance_&&(t.instance_=new t),t.instance_},t.prototype.length=function(){return this.list_.length},t.prototype.mallocArrayBuffer=function(t){var e,r,n=0;try{for(var i=y(this.list_),o=i.next();!o.done;o=i.next()){var s=o.value;if(s.byteLength>t)return this.list_.splice(n,1),++this.hitCount_,s;++n}}catch(a){e={error:a}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(e)throw e.error}}return new ArrayBuffer(t)},t.prototype.dump=function(){var t,e,r="";try{for(var n=y(this.list_),i=n.next();!i.done;i=n.next()){r+=i.value.byteLength.toLocaleString()+"|"}}catch(s){t={error:s}}finally{try{i&&!i.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}var o={hit:this.hitCount_,malloc:this.mallocCount_,free:this.freeCount_,"hit%":(100*this.hitCount_/Math.max(1,this.mallocCount_)).toFixed(2)+"%",info:r};return JSON.stringify(o)},t.prototype.mallocUint8Array=function(t){return++this.mallocCount_,new Uint8Array(this.mallocArrayBuffer(t),0,t)},t.prototype.free=function(t){if(++this.freeCount_,e.memory_pool_length_<=0)0!=this.list_.length&&this.list_.splice(0,this.list_.length);else for(ArrayBuffer.isView(t)?this.list_.push(t.buffer):this.list_.push(t);this.list_.length>e.memory_pool_length_;){for(var r=4e9,n=0,i=0,o=this.list_.length;i<o;++i){var s=this.list_[i];r>s.byteLength&&(r=s.byteLength,n=i)}try{delete this.list_[n]}catch(ae){S.error("delete Array excelpt",ae)}this.list_.splice(n,1)}},t.instance_=null,t}(),mt=function(){function t(t,e,r){if(this.isDestoryed_=!1,this.chunkWidthBytes_=e,r){this.bufferByteLength_=r.byteLength;var n=ArrayBuffer.isView(r)?r.buffer:r,i=ArrayBuffer.isView(r)?r.byteOffset:0;this.buffer_=new Uint8Array(n,i,this.bufferByteLength_)}else this.bufferByteLength_=t,this.buffer_=gt.instance().mallocUint8Array(this.bufferByteLength_);this.bufferByteLength_!=this.buffer_.byteLength&&S.warn("BigBuffer error"),this.chunkCount_=Math.ceil(this.bufferByteLength_/this.chunkWidthBytes_),this.chunkArray_=new Array(this.chunkCount_);for(var o=this.buffer_.buffer,s=this.buffer_.byteOffset,a=0,c=0;a<this.chunkCount_;++a,c+=this.chunkWidthBytes_){var u=a==this.chunkCount_-1?this.bufferByteLength_%this.chunkWidthBytes_:this.chunkWidthBytes_;0==u&&(u=this.chunkWidthBytes_),this.chunkArray_[a]=new Uint8Array(o,s+c,u)}}return t.prototype.getBufferByteLength=function(){return this.bufferByteLength_},t.prototype.getChunkCount=function(){return this.chunkCount_},t.prototype.getchunkWidthBytes=function(){return this.chunkWidthBytes_},t.prototype.getChunkArray=function(){return this.chunkArray_},t.prototype.getAllBuffer=function(){return this.buffer_},t.fromBuffer=function(e,r){return new t(0,r,e)},t.prototype.destory=function(){this.isDestoryed_||(this.isDestoryed_=!0,gt.instance().free(this.buffer_))},t.prototype.write=function(t,e){if(this.isDestoryed_)return-1;if(t>=this.chunkCount_||t<0)return-2;var r=this.chunkArray_[t];return r.length!=e.byteLength?-3:(r.set(new Uint8Array(e)),0)},t.safeGetUint8Array=function(t){return ArrayBuffer.isView(t)?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):new Uint8Array(t)},t.prototype.writeAll=function(e){var r=t.safeGetUint8Array(this.buffer_),n=t.safeGetUint8Array(e);return r.byteLength!=n.byteLength?(S.warn("mem diffrent ts size:",r.byteLength,",cdn:",n.byteLength),!1):(r.set(n),!0)},t.prototype.read=function(t){return t>=this.chunkCount_||t<0?null:this.chunkArray_[t]},t}(),yt=function(){function t(t){this.isInited=!1,this.pc_=null,this.chunkWidthKB=1,this.byteLength_=1,this.sn_=t,this.mem_=new mt(1,1,null),this.bm_=new bt(t,1)}return t.prototype.init=function(t,e){this.chunkWidthKB=e,this.byteLength_=t,this.mem_.destory(),this.mem_=new mt(t,1024*this.chunkWidthKB,null);var r=this.mem_.getChunkCount();this.bm_=new bt(this.sn_,r),this.isInited=!0,S.log("[TsTask]sn:",this.sn_,", byte_len:",this.byteLength_,", mem_count:",r)},t.prototype.getAllBuffer=function(){return this.mem_.getAllBuffer()},t.prototype.writeAllData=function(t){var e=t.byteLength;if(0!=e)if(this.mem_.writeAll(t))this.bm_.setAllON();else{this.mem_.destory(),this.byteLength_=e,this.mem_=new mt(e,1024*this.chunkWidthKB,null);var r=this.mem_.getChunkCount();this.bm_=new bt(this.sn_,r),this.bm_.setAllON()}},t.prototype.getWritedBytes=function(){var t=this.mem_,e=this.bm_,r=t.getchunkWidthBytes(),n=r*e.getAllBitsCount(!0);if(n>0&&e.isOnLast()){var i=t.getBufferByteLength()%r;0!=i&&(n-=r-i)}return n},t.prototype.getChunkCount=function(){return this.mem_.getChunkCount()},t.prototype.getChunkSize=function(t){return t==this.mem_.getChunkCount()-1?this.byteLength_%(1024*this.chunkWidthKB):1024*this.chunkWidthKB},t.prototype.findUnfinishChunkIndex=function(){var t=this.bm_.lowZeroPos();return t=t>=this.bm_.getBitLength()?-1:t},t.prototype.findUnfinishTaskArray=function(t,e,r){return this.bm_.lowZeroArray(t,e,r,this.pc_)},t.prototype.isChunkFinished=function(t){return this.bm_.isON(t)},t.prototype.setBuffer=function(t,e){var r=this.mem_.write(t,e);return 0===r&&this.bm_.setON(t),r},t.prototype.getBuffer=function(t){return this.mem_.read(t)},t.prototype.getChunkArray=function(){if(!S.is_debug()&&!S.is_dump())return[];var t=Math.ceil(64/this.chunkWidthKB),e=Math.ceil(this.mem_.getChunkCount()/t),r=this.mem_.getChunkCount()%t;r=r>0?r:t;for(var n=[],i=0;i<e;i++){var o=i*t,s=i==e-1?o+r:o+t;n.push({state:this.bm_.isOnRange(o,s)?3:0})}return n},t.prototype.destory=function(){this.mem_.destory()},t}(),vt=function(){function t(t){this.callback_=t,this.request_url_=""}return t.prototype.request=function(t,e){var r,n=e.method,i=e.data,o=e.timeout||0,s=e.callbackDataType;window.XMLHttpRequest&&(r=new XMLHttpRequest,o>0&&(r.timeout=o),r.onreadystatechange=function(){if(4==r.readyState)if(200==r.status){if("fb"!=s)this.callback_&&this.callback_(null,r.responseText);else(t=r.response)&&0!==t.byteLength?this.callback_&&this.callback_(null,t):this.callback_&&this.callback_("status:empty")}else{var t=r.response;this.callback_&&this.callback_("status:"+r.status,t)}}.bind(this),r.onerror=function(t){}.bind(this),r.ontimeout=function(){this.callback_&&this.callback_("timeout")}.bind(this),r.open(n,t,!0),"fb"===s&&(r.responseType="arraybuffer"),r.send(i))},t.prototype.get=function(t,e){var r={method:"get",timeout:e,callbackDataType:"txt"};this.request(t,r)},t.prototype.post=function(t,e,r,n){this.request_url_=t;var i={method:"post",timeout:e,data:r,callbackDataType:n};this.request(t,i)},t}(),Rt=function(){function t(){}return t.getRealTimeLogUrl=function(){return"youku.com"==t.MAIN_DOMAIN?t.REALLOG_REPORT:t.REALLOG_PRE+t.MAIN_DOMAIN+t.REALLOG_SUF},t.INTER_DOMAIN="youku.tv",t.INNER_DOMAIN="youku.com",t.MAIN_DOMAIN="youku.com",t.PORTAL_PRE="pis-pcdn.",t.PORTAL_SUF="/f/pcdn/i.php",t.REALLOG_PRE="pss-common.",t.REALLOG_SUF="/pclog",t.REALLOG_REPORT="pcapp-data-collect.youku.com/pclog",t.PRE_PORTAL_URI="pre-pis-pcdn.youku.com/f/pcdn/i.php",t.PORTAL_HTTPS="https://",t.PORTAL_HTTP="http://",t.val1_3="%g)4gv",t.val2_3="$%UO77",t.trackerURL="",t.pgwURL="",t.csnURL="",t.cpsURL="",t.wdcURL="",t.ORIGIN_DOMAIN="",t.PTC="http://",t.PTCS="../../https@",t.mqtt_host_="",t.mqtt_port_="",t.mqtt_username_="",t.mqtt_pwd_="",t.mqtt_ping_dx_second_=60,t.mqtt_connect_timeout_ms_=2e4,t.mqtt_reconnect_dx_ms_=3e4,t.STUN_HOST="",t.STUN_PORT="",t.STUN_USER_ID="",t.STUN_PASSWORD="",t.ICE_SERVERS={},t}(),wt=function(){function t(){}return t.getDomin=function(t){var e=t.indexOf("://");if(-1!==e){var r=t.substring(e+3),n=r.indexOf("/");return-1!==n?r.substr(0,n):r}},t.getURI=function(t){var e=t.indexOf("?"),r=t.indexOf("://"),n=t.indexOf("/",r+3);return-1!==e?t.substring(n,e):t.substring(n,t.length)},t.getURLWithParam=function(t){var e=t.indexOf("://"),r=t.indexOf("/",e+3);return t.substring(r,t.length)},t.getVal1=function(){return e.val1_1_+e.val1_2_+Rt.val1_3},t.getVal2=function(){return e.va12_1_+e.val2_2_+Rt.val2_3},t.GetVersionUint=function(){return L.version_unit<1&&(L.version_unit=t.parseVersionToUint(L.version)),L.version_unit},t.GetVersionULong=function(){return null!=t.version_ulong_||(t.version_ulong_=q.fromNumber(t.GetVersionUint(),!0)),t.version_ulong_},t.getLocationULong=function(){return t.location_ulong_},t.initLocationULong=function(e){t.location_ulong_=q.fromNumber(e,!0)},t.GetVersion=function(){return L.version},t.parseVersionToUint=function(t){var e=0,r=48,n=t.split(".");if(n.length<4)return 0;for(var i=0;i<4;i++,r-=16)3==i&&"0"==n[i].charAt(0)&&(n[i]=n[i].substring(1,n[i].length)),e+=parseInt(n[i])*Math.pow(2,r);return e},t.get_window_url_param=function(t){var e=window.location.search.substr(1),r=new RegExp("(^|&)"+t+"=([^&]*)(&|$)","i"),n=e.match(r);return null!=n?unescape(n[2]):null},t.get_window_url_param_int=function(e,r){var n=t.get_window_url_param(e);return null!=n?parseInt(n,10):r},t.getSS=function(t){return!1===t?Rt.PTC+e.dm_+e.uri_:Rt.PTCS+e.dms_+e.uri_},t.get_rid_v1=function(t){var e=t.substr(0,8);return parseInt(e,16)},t.get_rid_v2=function(t){var e=t.substr(8,16);return q.fromString(e,!0,16)},t.get_rid_v3=function(t){var e=t.substr(24,16);return q.fromString(e,!0,16)},t.get_rid_v4=function(t){var e=t.substr(40,8);return parseInt(e,16)},t.get_peerid_v1=function(t){var e=t.substr(0,8);return parseInt(e,16)},t.get_peerid_v2=function(t){var e=t.substr(8,16);return q.fromString(e,!0,16)},t.get_peerid_v3=function(t){var e=t.substr(24,16);return q.fromString(e,!0,16)},t.get_md5_v1=function(t){var e=t.substr(0,8);return parseInt(e,16)},t.get_md5_v2=function(t){var e=t.substr(8,16);return q.fromString(e,!0,16)},t.get_md5_v3=function(t){var e=t.substr(24,16);return q.fromString(e,!0,16)},t.is_rid_zero=function(t){return 0==t.v1()&&0==t.v2().low&&0==t.v2().high&&0==t.v3().low&&0==t.v3().high&&0==t.v4()},t.get_rid_to_string=function(e){var r="";return r+=t.pad(e.v1().toString(16).toUpperCase(),8),r+=t.pad(new q(e.v2().low,e.v2().high,!0).toString(16).toUpperCase(),16),r+=t.pad(new q(e.v3().low,e.v3().high,!0).toString(16).toUpperCase(),16),r+=t.pad(e.v4().toString(16).toUpperCase(),8)},t.get_peerid_to_string=function(e){var r="";return r+=t.pad(e.v1().toString(16).toUpperCase(),8),r+=t.pad(new q(e.v2().low,e.v2().high,!0).toString(16).toUpperCase(),16),r+=t.pad(new q(e.v3().low,e.v3().high,!0).toString(16).toUpperCase(),16)},t.pad=function(t,e){for(var r=t.length;r<e;)t="0"+t,r++;return t},t.getRidFromUrl=function(e){var r=e.lastIndexOf("rid=");if(r>0){var n=e.substring(r+4),i=n.indexOf("&"),o=void 0;if(48!=(o=i>0?n.substring(0,i):n).length||"000000000000000000000000000000000000000000000000"==o)return;return t.modifyRid(o)}},t.getSubRid=function(r,n){if(48!=r.length||"000000000000000000000000000000000000000000000000"==r||n<0)return r;var i=(Math.floor(n/e.subrid_batch_size_)+1).toString(16).toUpperCase();return i?r.substring(0,44)+t.pad(i,4):r},t.getRootRid=function(t){return 48!=t.length?t:t.substring(0,44)+"0000"},t.getSubBeginSn=function(t){if(48!=t.length)return 0;var r=parseInt(t.substring(44,48),16);return r<=0?0:(r-1)*e.subrid_batch_size_},t.modifyRid=function(t){var e=t.length-6;return t.substring(0,e)+"04"+t.substring(e+2)},t.fullM3u8Url2M3u8Url=function(t){var e=t.indexOf("?");return e>0?t.substring(0,e):t},t.getOriginAuthM3U8Url=function(t){return t},t.getOriginAuthTsUrl=function(t){return t},t.isEmpty=function(t){return void 0===t||null==t||""==t},t.getBrowser=function(){try{var t=navigator.userAgent.toLowerCase(),e=t.match(/(msie|firefox|chrome|opera|version).*?([\d.]+)/);if(null!=e&&null!=e[1])return e[1]}catch(ae){}return""},t.uint8ArrayToString=function(t){for(var e="",r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},t.isDytM3U8=function(t){var e=t.lastIndexOf("dyt=");if(e>0){var r=t.substring(e+4),n=r.indexOf("&");return"1"===(n>0?r.substring(0,n):r)}return!1},t.isUpsM3u8=function(t){return t.lastIndexOf("/playlist/m3u8?")>0},t.checkInternational=function(){var t;(null===(t=null===window||void 0===window?void 0:window.location)||void 0===t?void 0:t.hostname.includes("youku.tv"))?Rt.MAIN_DOMAIN=Rt.INTER_DOMAIN:Rt.MAIN_DOMAIN=Rt.INNER_DOMAIN},t.sid_length_=40,t.version_ulong_=null,t.location_ulong_=new q(11),t}();!function(t){t[t.LOGIN_STATUS_ERR=1e3]="LOGIN_STATUS_ERR",t[t.LOGIN_JSON_PARSE_ERR=1001]="LOGIN_JSON_PARSE_ERR",t[t.ADDRESS_STATUS_ERR=1010]="ADDRESS_STATUS_ERR",t[t.ADDRESS_UPPEERS_EMPTY=1011]="ADDRESS_UPPEERS_EMPTY",t[t.ADDRESS_ARG_ERR=1012]="ADDRESS_ARG_ERR",t[t.KEEP_STATUS_ERR=1020]="KEEP_STATUS_ERR",t[t.KEEP_ARG_ERR=1020]="KEEP_ARG_ERR",t[t.CONTROL1_STATUS_ERR=1030]="CONTROL1_STATUS_ERR",t[t.CONTROL1_ARG_ERR=1031]="CONTROL1_ARG_ERR",t[t.PUBLISH_STATUS_ERR=1040]="PUBLISH_STATUS_ERR",t[t.PUBLISH_ARG_ERR=1041]="PUBLISH_ARG_ERR",t[t.UNPUBLISH_STATUS_ERR=1050]="UNPUBLISH_STATUS_ERR",t[t.MQTT_OFFLINE_ERR=1060]="MQTT_OFFLINE_ERR",t[t.P2P_TS_DL_ERR=1070]="P2P_TS_DL_ERR",t[t.P2P_SWITCH_CDN_ERR=1071]="P2P_SWITCH_CDN_ERR"}(lt||(lt={})),function(t){t.DEFAULT="default",t.ERROR="h5_error",t.EVENT="h5_event"}(_t||(_t={})),function(t){t.DEFAULT="default",t.CDNERR="cdnerr",t.P2PERR="p2perr",t.ADDRESS="address"}(pt||(pt={}));var St,Tt=function(){function t(){this.http_request_=new vt(this.callback.bind(this))}return t.reportWebRtcSupport=function(r){if(!e.forbid_send_realtime_log()){var n="";n=Rt.PORTAL_HTTPS+Rt.getRealTimeLogUrl()+"@cid=h5vodp2p",n+="&logtype="+_t.EVENT,n+="&subtype=webrtcspt",n+="&loc="+e.location_str_,n+="&ver="+wt.GetVersion(),n+="&browser="+e.browerName,n+="&browserver="+e.browerVersion,n+="&wrtcscode="+r,n+="&",new vt((function(){})).get(n,t.timeout_ms_)}},t.reportStart=function(){if(!e.forbid_send_realtime_log()){var r="";r=Rt.PORTAL_HTTPS+Rt.getRealTimeLogUrl()+"@cid=h5vodp2p",r+="&logtype="+_t.EVENT,r+="&subtype=start",r+="&loc="+e.location_str_,r+="&ver="+wt.GetVersion(),r+="&",new vt((function(){})).get(r,t.timeout_ms_)}},t.reportAdress=function(r,n){if(!e.forbid_send_realtime_log()&&e.isAllowReportAddress()){var i=Rt.PORTAL_HTTPS+Rt.getRealTimeLogUrl()+"@cid=h5vodp2p";i+="&logtype="+_t.EVENT,i+="&subtype="+pt.ADDRESS,i+="&loc="+e.location_str_,i+="&ver="+wt.GetVersion(),i+="&pid="+e.pcdn_peer_id_,i+="&roomid="+e.room_id_,i+="&rid="+r,i+="&cn="+n,i+="&",new vt((function(){})).get(i,t.timeout_ms_)}},t.reportError=function(r){if(!e.forbid_send_realtime_log()){var n="";n=Rt.PORTAL_HTTPS+Rt.getRealTimeLogUrl()+"@cid=h5vodp2p",n+="&logtype="+_t.ERROR,n+="&subtype="+pt.DEFAULT,n+="&errcode="+r.errcode,n+="&loc="+e.location_str_,n+="&ver="+wt.GetVersion(),n+="&browserver="+e.browerVersion,n+="&peerid="+e.pcdn_peer_id_,new vt((function(){})).get(n,t.timeout_ms_)}},t.reportWDC=function(r,n,i){if(!e.forbid_send_wdc_log()){var o="";o=Rt.wdcURL+"/wdc/info-upload?product=PCDN&module=h5vod&type=1",o+="&cid="+e.cid_,o+="&peerid="+e.pcdn_peer_id_,o+="&ver="+wt.GetVersion(),o+="&os="+e.browerName,o+="&osv="+e.browerVersion,o+="&flag1="+(n?"1":"0"),o+="&flag2="+i.toString(),o+="&flag3=0&flag4=0",new vt((function(){})).post(o,t.timeout_ms_,r,"txt")}},t.prototype.request=function(r){if(!e.forbid_send_realtime_log()){var n="";n=Rt.PORTAL_HTTPS+Rt.getRealTimeLogUrl()+"@cid=h5vodp2p",n+="&logtype="+r.logtype,n+="&subtype="+(null==r.subtype?"default":r.subtype),n+="&roomid="+e.room_id_,n+="&errcode="+r.errcode,n+="&extra="+r.ext,n+="&browser="+e.browerName,n+="&loc="+e.location_str_,n+="&ver="+wt.GetVersion(),n+="&browserver="+e.browerVersion,r.logtype===_t.ERROR&&(n+="&peerid="+e.pcdn_peer_id_),void 0===r.errcnt?n+="&errcnt=0":n+="&errcnt="+r.errcnt,void 0===r.t1?n+="&t1=0":n+="&t1="+r.t1,void 0===r.t3?n+="&t3=0":n+="&t3="+r.t3,void 0===r.t5?n+="&t5=0":n+="&t5="+r.t5,void 0===r.t8?n+="&t8=0":n+="&t8="+r.t8,void 0===r.rconfail?n+="&rconfail=0":n+="&rconfail="+r.rconfail,void 0===r.rconsucc?n+="&rconsucc=0":n+="&rconsucc="+r.rconsucc,void 0===r.curconnet?(n+="&curcon=0",n+="&curcontm=0"):r.curconnet>=0&&(n+="&curcon="+r.curconnet,n+="&curcontm=1"),void 0===r.activecount?(n+="&acon=0",n+="&acontm=0"):(n+="&acon="+r.activecount,n+="&acontm=1"),void 0===r.streamchangecount?(n+="&scc=0",n+="&scctm=0"):(n+="&scc="+r.streamchangecount,n+="&scctm=1"),void 0===r.used_space?n+="&usp=0":n+="&usp="+r.used_space,void 0===r.t2?n+="&t2=0":n+="&t2="+r.t2,void 0===r.activeedgecount?(n+="&aec=0",n+="&aecm=0"):(n+="&aec="+r.activeedgecount,n+="&aecm=1"),n+="&",this.http_request_.get(n,t.timeout_ms_)}},t.prototype.callback=function(t,e){},t.timeout_ms_=5e3,t}(),Ct=function(){function t(r,n,i,o,s,a,c,u,h,d,l){if(this.p2pSeter_=null,this.rid_=void 0,this.sn_=0,this.tsUrl_="",this.tsLength_=0,this.loadState_=P.NEW,this.loadMode_=I.CDN,this.loadModeStep_="",this.p2pExpire_=!1,this.loadClient_=null,this.timeConsuming_ms_=0,this.timestamp_=0,this.isSaved_=!1,this.isRead_=!1,this.isRequest_=!1,this.isDBLoadTimeout_=!1,this.timeDBCleanId_=-1,this.expireTime_=1e4,this.isDestroyed_=!1,this.expireTime_=e.db_read_timeout_ms_,this.chunkWidthKB_=r,this.p2pSeter_=n,this.rid_=i,this.did_=o,this.sn_=s,this.tsUrl_=a,this.tsLength_=c,this.isRequest_=u,this.onLoadFinish_=h,this.onLoadFailed_=d,this.onLoadStart_=l,this.tsTask_=new yt(s),this.realtime_logmonitor_=new Tt,t.CacheManager.hasTsData(i,s)){this.loadState_=P.COMPLETE,this.loadMode_=I.DB,this.loadModeStep_+="d";var _=this;t.P2PManager.instance().engine_.SendDBCacheToPlayer(s),this.getBufferFromDB((function(t){if(_.isDBLoadTimeout_)return S.log("[TsLoader]getBufferFromDB,sn:",s,", expire, but got"),void ft.recordP2pDataError(98);if(_.stopTimeout(),t)try{S.log("[TsLoader]requestTSData,sn:",s,", is already completed,","bufferLength: ",t.byteLength),_.isSaved_=!0,ft.T3_add(t.byteLength),_.onFilesize(t.byteLength),_.tsTask_.init(t.byteLength,_.chunkWidthKB_),_.tsTask_.writeAllData(t),_.onLoadFinish_?(ft.loadMode=I.DB,ft.tsSn=_.sn_,ft.loadSize=t.byteLength,ft.totalSize=_.tsLength_,_.onLoadFinish_(_.sn_,t.length,!1,-1)):(S.error("[TsLoader][onLoadFinish_]func is null sn:",s),_.isDestroyed_?ft.recordP2pDataError(96):(ft.recordP2pDataError(95),_.isSaved_=!1,_.tsTask_.destory(),_.tsTask_=new yt(s),_.onDBFail()))}catch(ae){ft.recordP2pDataError(99),_.isSaved_=!1,_.tsTask_.destory(),_.tsTask_=new yt(s),_.onDBFail()}else _.onDBFail()})),this.startTimeout()}}return t.prototype.startTimeout=function(){this.timeDBCleanId_=window.setTimeout(this.onDBTimeout.bind(this),this.expireTime_)},t.prototype.isComplete=function(){return P.COMPLETE==this.loadState},t.prototype.isCdnMode=function(){return I.CDN==this.loadMode_},t.prototype.isP2pMode=function(){return I.P2P==this.loadMode_},t.prototype.isDbMode=function(){return I.DB==this.loadMode_},t.prototype.isUsed=function(){return this.loadState_==P.FAILED||this.isRead_&&this.isSaved_},t.prototype.isRequested=function(){return this.isRequest_},t.prototype.hasGoodPeer=function(){return null!=this.p2pSeter_&&this.p2pSeter_.hasGoodClientVod(this.rid_,this.sn_)},t.prototype.setRead=function(){this.isRead_=!0},t.prototype.setUsed=function(){this.isRead_=!0,this.isSaved_=!0},t.prototype.setRequest=function(){this.isRequest_=!0},t.prototype.tsUrl=function(){return this.tsUrl_},t.prototype.updateBitmap=function(){if(this.rid_){var e=t.CacheManager.m3u8Bitmap.get(this.rid_);e&&this.sn_>=0&&this.sn_<e.tsList.length&&e.tsList[this.sn_]&&(e.tsList[this.sn_]=!1,t.CacheManager.needUpdateM3u8Arr.add(this.rid_))}},t.prototype.load=function(r,n){S.log(this.loadClient_?"":"[xplayer]","[ts]load,start,sn:",this.sn_,",mode:",I.toStr(r),",buf:",n.toFixed(2));var i=I.CDN==r;if(this.loadState_>P.LOADING)return S.log("[ts]load,ignore,because failed,","sn:",this.sn_,",old mode:",I.toStr(this.loadMode_)),void ft.recordP2pDataError(P.FAILED==this.loadState_?55:56);var o=!1;if(!this.p2pExpire_&&0!=this.timestamp_){var s=dt.nowMs()-this.timestamp_;I.P2P==this.loadMode_&&(n<e.edge_limit_duration_seconds_||s>e.p2p_loader_use_edge_ms_)&&(o=!0,S.log("[xplayer][ts]loader can use edge, sn:",this.sn_)),this.isRequest_&&s>e.p2p_loader_expire_ms_&&(S.log("[xplayer][ts]load expire, sn:",this.sn_,",old mode:",I.toStr(this.loadMode_)),this.p2pExpire_=!0)}if(i||this.p2pExpire_){if(this.loadClient_&&I.P2P==this.loadMode_){if(this.tsTask_.isInited){var a=this.tsTask_.getWritedBytes();ft.T4_sub(a),S.log("[ts][xplayer]load,waste,because buf:",n.toFixed(1),",sn:",this.sn_,",bytes:",a,",did:",this.did_)}this.timestamp_=0,this.loadClient_.destory(),this.loadClient_=null,this.tsTask_.isInited&&(this.tsTask_.destory(),this.tsTask_=new yt(this.sn_));var c={logtype:_t.ERROR,subtype:pt.P2PERR,errcode:lt.P2P_SWITCH_CDN_ERR};this.realtime_logmonitor_.request(c),this.p2pSeter_&&this.p2pSeter_.sort_clients()}this.loadMode_=I.CDN}else this.loadClient_&&I.CDN==this.loadMode_?S.log("[ts]load()ignore p2p,now cdn,sn:",this.sn_):this.loadMode_=I.P2P;null==this.loadClient_&&(I.CDN==this.loadMode_?(this.loadModeStep_+="c",this.loadClient_=new t.CdnClient(this.chunkWidthKB_,this.tsUrl_,this.rid_,this.sn_,this.tsLength_,this.tsTask_,this.onLoadFinish.bind(this),this.onFilesize.bind(this),this.onLoadError.bind(this)),this.p2pSeter_&&this.rid_):(this.loadModeStep_+="p",this.loadClient_=new t.P2PClient(this.chunkWidthKB_,this.tsUrl_,this.p2pSeter_,this.rid_,this.did_,this.sn_,this.tsLength_,this.tsTask_,this.onLoadFinish.bind(this),this.onFilesize.bind(this),this.onLoadError.bind(this)))),this.loadClient_?(o&&(this.loadClient_.setUseEdge(!0),this.loadModeStep_+="e"),this.loadClient_.load()):ft.recordP2pDataError(57),this.loadState_=P.LOADING,0==this.timestamp_&&(this.timestamp_=dt.nowMs()),S.log("[ts]load,end,sn:",this.sn_,",mode:",I.toStr(this.loadMode_))},t.prototype.getBufferFromDB=function(e){t.CacheManager.readTsData(this.rid_,this.sn_,0,-1,!1,(function(t,r){e(t.buffer)}))},t.prototype.getFullBuffer=function(){return this.loadState_!=P.COMPLETE?null:this.tsTask_.isInited?new Uint8Array(this.tsTask_.getAllBuffer()):null},t.prototype.destory=function(){this.isDestroyed_=!0,this.stopTimeout(),this.tsTask_.destory(),this.loadClient_&&this.loadClient_.destory(),this.onLoadFinish_=null,this.onLoadFailed_=null,this.onLoadStart_=null},Object.defineProperty(t.prototype,"sn",{get:function(){return this.sn_},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"loadState",{get:function(){return this.loadState_},set:function(t){this.loadState_=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"loadMode",{get:function(){return this.loadMode_},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"length",{get:function(){return this.tsLength_},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"loadModeStep",{get:function(){return this.loadModeStep_},enumerable:!1,configurable:!0}),t.prototype.getChunkArray=function(){return this.tsTask_.getChunkArray()},t.prototype.getChunkBuffer=function(t,e){return this.tsTask_.chunkWidthKB!==e?(S.log("[p2p]getChunkBuffer,","chunk.chunkWidthKB !== chunkWidthKB"),null):this.tsTask_.isChunkFinished(t)?this.tsTask_.getBuffer(t):(S.log("[p2p]getChunkBuffer, chunk not finished, mn:",t),null)},t.prototype.onLoadFinish=function(t){this.loadState_!=P.COMPLETE&&(this.loadState_=P.COMPLETE,this.loadClient_&&this.loadClient_.destory(),this.loadClient_=null,this.timeConsuming_ms_=dt.nowMs()-this.timestamp_,this.onLoadFinish_?this.onLoadFinish_(this.sn_,this.tsLength_,t,this.timeConsuming_ms_):S.is_debug()&&S.log("[ts][xplayer]fin,did:",this.did_,",sn:",this.sn_,",fsize[",this.tsLength_.toLocaleString(),"],mode:",t?"p2p":"cdn",",use_time:",this.timeConsuming_ms_.toFixed(1)))},t.prototype.onLoadError=function(){this.loadState_!=P.FAILED&&(this.loadState_=P.FAILED,this.timeConsuming_ms_=dt.nowMs()-this.timestamp_,this.onLoadFailed_&&this.onLoadFailed_(this.sn_),S.log("[ts]onLoadError,did:",this.did_,",sn:",this.sn_))},t.prototype.onFilesize=function(t){this.tsLength_=t,ft.loadMode=this.loadMode_,ft.tsSn=this.sn,ft.loadSize=0,ft.totalSize=this.tsLength_,this.onLoadStart_&&this.onLoadStart_(),S.log("[ts]onFilesize,did:",this.did_,",sn:",this.sn_,",fz:",t)},t.prototype.onDBTimeout=function(){S.log("[TsLoader][DbTimeout] onDBTimeout()"," sn:",this.sn_),this.isDBLoadTimeout_=!0,ft.recordP2pDataError(97),this.onDBFail()},t.prototype.onDBFail=function(){S.log("[TsLoader][DbFail]sn:",this.sn_,",  create new download"),this.loadState_=P.NEW,this.loadMode_=I.CDN,this.refreshRequest("f"),this.updateBitmap()},t.prototype.stopTimeout=function(){-1!=this.timeDBCleanId_&&(S.log("[TsLoader][stopTimeout]sn:",this.sn_,", timeDBCleanId:",this.timeDBCleanId_),window.clearTimeout(this.timeDBCleanId_),this.timeDBCleanId_=-1)},t.prototype.saveCache=function(e,r,n){if(this.rid_=e,0==this.isSaved_&&this.loadState_==P.COMPLETE){this.isSaved_=!0;var i=t.CacheManager.m3u8Bitmap.get(this.rid_);null==i&&(t.CacheManager.createBuffer(this.rid_,r,n),i=t.CacheManager.m3u8Bitmap.get(this.rid_));var o=void 0,s=void 0;try{o=this.tsTask_.getAllBuffer(),s=t.CacheManager.saveTsData(this.rid_,this.sn_,o,0,o.byteLength,o.byteLength)}catch(ae){return void ft.recordP2pDataError(66)}1==s&&(S.log("[ts]saveCache, sn:",this.sn_,", former:",this.sn_>0&&i.tsList[this.sn_-1]),i.tsList[this.sn_]=!0,t.CacheManager.indexDB_.updateBitmap(i,this.rid_))}},t.prototype.refreshRequest=function(t){this.loadModeStep_+=t,this.isRead_=!1,this.timestamp_=0,this.p2pExpire_=!1},t.prototype.usedTime=function(){return dt.nowMs()-this.timestamp_},t}(),Et={};Et.SIZEOF_SHORT=2,Et.SIZEOF_INT=4,Et.FILE_IDENTIFIER_LENGTH=4,Et.SIZE_PREFIX_LENGTH=4,Et.Encoding={UTF8_BYTES:1,UTF16_STRING:2},Et.int32=new Int32Array(2),Et.float32=new Float32Array(Et.int32.buffer),Et.float64=new Float64Array(Et.int32.buffer),Et.isLittleEndian=1===new Uint16Array(new Uint8Array([1,0]).buffer)[0],Et.Long=function(t,e){this.low=0|t,this.high=0|e},Et.Long.create=function(t,e){return 0==t&&0==e?Et.Long.ZERO:new Et.Long(t,e)},Et.Long.prototype.toFloat64=function(){return(this.low>>>0)+4294967296*this.high},Et.Long.prototype.equals=function(t){return this.low==t.low&&this.high==t.high},Et.Long.ZERO=new Et.Long(0,0),Et.Builder=function(t){if(t)e=t;else var e=1024;this.bb=Et.ByteBuffer.allocate(e),this.space=e,this.minalign=1,this.vtable=null,this.vtable_in_use=0,this.isNested=!1,this.object_start=0,this.vtables=[],this.vector_num_elems=0,this.force_defaults=!1},Et.Builder.prototype.clear=function(){this.bb.clear(),this.space=this.bb.capacity(),this.minalign=1,this.vtable=null,this.vtable_in_use=0,this.isNested=!1,this.object_start=0,this.vtables=[],this.vector_num_elems=0,this.force_defaults=!1},Et.Builder.prototype.forceDefaults=function(t){this.force_defaults=t},Et.Builder.prototype.dataBuffer=function(){return this.bb},Et.Builder.prototype.asUint8Array=function(){return this.bb.bytes().subarray(this.bb.position(),this.bb.position()+this.offset())},Et.Builder.prototype.prep=function(t,e){t>this.minalign&&(this.minalign=t);for(var r=1+~(this.bb.capacity()-this.space+e)&t-1;this.space<r+t+e;){var n=this.bb.capacity();this.bb=Et.Builder.growByteBuffer(this.bb),this.space+=this.bb.capacity()-n}this.pad(r)},Et.Builder.prototype.pad=function(t){for(var e=0;e<t;e++)this.bb.writeInt8(--this.space,0)},Et.Builder.prototype.writeInt8=function(t){this.bb.writeInt8(this.space-=1,t)},Et.Builder.prototype.writeInt16=function(t){this.bb.writeInt16(this.space-=2,t)},Et.Builder.prototype.writeInt32=function(t){this.bb.writeInt32(this.space-=4,t)},Et.Builder.prototype.writeInt64=function(t){this.bb.writeInt64(this.space-=8,t)},Et.Builder.prototype.writeFloat32=function(t){this.bb.writeFloat32(this.space-=4,t)},Et.Builder.prototype.writeFloat64=function(t){this.bb.writeFloat64(this.space-=8,t)},Et.Builder.prototype.addInt8=function(t){this.prep(1,0),this.writeInt8(t)},Et.Builder.prototype.addInt16=function(t){this.prep(2,0),this.writeInt16(t)},Et.Builder.prototype.addInt32=function(t){this.prep(4,0),this.writeInt32(t)},Et.Builder.prototype.addInt64=function(t){this.prep(8,0),this.writeInt64(t)},Et.Builder.prototype.addFloat32=function(t){this.prep(4,0),this.writeFloat32(t)},Et.Builder.prototype.addFloat64=function(t){this.prep(8,0),this.writeFloat64(t)},Et.Builder.prototype.addFieldInt8=function(t,e,r){(this.force_defaults||e!=r)&&(this.addInt8(e),this.slot(t))},Et.Builder.prototype.addFieldInt16=function(t,e,r){(this.force_defaults||e!=r)&&(this.addInt16(e),this.slot(t))},Et.Builder.prototype.addFieldInt32=function(t,e,r){(this.force_defaults||e!=r)&&(this.addInt32(e),this.slot(t))},Et.Builder.prototype.addFieldInt64=function(t,e,r){!this.force_defaults&&e.equals(r)||(this.addInt64(e),this.slot(t))},Et.Builder.prototype.addFieldFloat32=function(t,e,r){(this.force_defaults||e!=r)&&(this.addFloat32(e),this.slot(t))},Et.Builder.prototype.addFieldFloat64=function(t,e,r){(this.force_defaults||e!=r)&&(this.addFloat64(e),this.slot(t))},Et.Builder.prototype.addFieldOffset=function(t,e,r){(this.force_defaults||e!=r)&&(this.addOffset(e),this.slot(t))},Et.Builder.prototype.addFieldStruct=function(t,e,r){e!=r&&(this.nested(e),this.slot(t))},Et.Builder.prototype.nested=function(t){if(t!=this.offset())throw new Error("FlatBuffers: struct must be serialized inline.")},Et.Builder.prototype.notNested=function(){if(this.isNested)throw new Error("FlatBuffers: object serialization must not be nested.")},Et.Builder.prototype.slot=function(t){this.vtable[t]=this.offset()},Et.Builder.prototype.offset=function(){return this.bb.capacity()-this.space},Et.Builder.growByteBuffer=function(t){var e=t.capacity();if(3221225472&e)throw new Error("FlatBuffers: cannot grow buffer beyond 2 gigabytes.");var r=e<<1,n=Et.ByteBuffer.allocate(r);return n.setPosition(r-e),n.bytes().set(t.bytes(),r-e),n},Et.Builder.prototype.addOffset=function(t){this.prep(Et.SIZEOF_INT,0),this.writeInt32(this.offset()-t+Et.SIZEOF_INT)},Et.Builder.prototype.startObject=function(t){this.notNested(),null==this.vtable&&(this.vtable=[]),this.vtable_in_use=t;for(var e=0;e<t;e++)this.vtable[e]=0;this.isNested=!0,this.object_start=this.offset()},Et.Builder.prototype.endObject=function(){if(null==this.vtable||!this.isNested)throw new Error("FlatBuffers: endObject called without startObject");this.addInt32(0);for(var t=this.offset(),e=this.vtable_in_use-1;e>=0&&0==this.vtable[e];e--);for(var r=e+1;e>=0;e--)this.addInt16(0!=this.vtable[e]?t-this.vtable[e]:0);this.addInt16(t-this.object_start);var n=(r+2)*Et.SIZEOF_SHORT;this.addInt16(n);var i=0,o=this.space;t:for(e=0;e<this.vtables.length;e++){var s=this.bb.capacity()-this.vtables[e];if(n==this.bb.readInt16(s)){for(var a=Et.SIZEOF_SHORT;a<n;a+=Et.SIZEOF_SHORT)if(this.bb.readInt16(o+a)!=this.bb.readInt16(s+a))continue t;i=this.vtables[e];break}}return i?(this.space=this.bb.capacity()-t,this.bb.writeInt32(this.space,i-t)):(this.vtables.push(this.offset()),this.bb.writeInt32(this.bb.capacity()-t,this.offset()-t)),this.isNested=!1,t},Et.Builder.prototype.finish=function(t,e,r){var n=r?Et.SIZE_PREFIX_LENGTH:0;if(e){var i=e;if(this.prep(this.minalign,Et.SIZEOF_INT+Et.FILE_IDENTIFIER_LENGTH+n),i.length!=Et.FILE_IDENTIFIER_LENGTH)throw new Error("FlatBuffers: file identifier must be length "+Et.FILE_IDENTIFIER_LENGTH);for(var o=Et.FILE_IDENTIFIER_LENGTH-1;o>=0;o--)this.writeInt8(i.charCodeAt(o))}this.prep(this.minalign,Et.SIZEOF_INT+n),this.addOffset(t),n&&this.addInt32(this.bb.capacity()-this.space),this.bb.setPosition(this.space)},Et.Builder.prototype.finishSizePrefixed=function(t,e){this.finish(t,e,!0)},Et.Builder.prototype.requiredField=function(t,e){var r=this.bb.capacity()-t,n=r-this.bb.readInt32(r);if(!(0!=this.bb.readInt16(n+e)))throw new Error("FlatBuffers: field "+e+" must be set")},Et.Builder.prototype.startVector=function(t,e,r){this.notNested(),this.vector_num_elems=e,this.prep(Et.SIZEOF_INT,t*e),this.prep(r,t*e)},Et.Builder.prototype.endVector=function(){return this.writeInt32(this.vector_num_elems),this.offset()},Et.Builder.prototype.createString=function(t){if(t instanceof Uint8Array)var e=t;else{e=[];for(var r=0;r<t.length;){var n,i=t.charCodeAt(r++);if(i<55296||i>=56320)n=i;else n=(i<<10)+t.charCodeAt(r++)+-56613888;n<128?e.push(n):(n<2048?e.push(n>>6&31|192):(n<65536?e.push(n>>12&15|224):e.push(n>>18&7|240,n>>12&63|128),e.push(n>>6&63|128)),e.push(63&n|128))}}this.addInt8(0),this.startVector(1,e.length,1),this.bb.setPosition(this.space-=e.length);r=0;for(var o=this.space,s=this.bb.bytes();r<e.length;r++)s[o++]=e[r];return this.endVector()},Et.Builder.prototype.createLong=function(t,e){return Et.Long.create(t,e)},Et.ByteBuffer=function(t){this.bytes_=t,this.position_=0},Et.ByteBuffer.allocate=function(t){return new Et.ByteBuffer(new Uint8Array(t))},Et.ByteBuffer.prototype.clear=function(){this.position_=0},Et.ByteBuffer.prototype.bytes=function(){return this.bytes_},Et.ByteBuffer.prototype.position=function(){return this.position_},Et.ByteBuffer.prototype.setPosition=function(t){this.position_=t},Et.ByteBuffer.prototype.capacity=function(){return this.bytes_.length},Et.ByteBuffer.prototype.readInt8=function(t){return this.readUint8(t)<<24>>24},Et.ByteBuffer.prototype.readUint8=function(t){return this.bytes_[t]},Et.ByteBuffer.prototype.readInt16=function(t){return this.readUint16(t)<<16>>16},Et.ByteBuffer.prototype.readUint16=function(t){return this.bytes_[t]|this.bytes_[t+1]<<8},Et.ByteBuffer.prototype.readInt32=function(t){return this.bytes_[t]|this.bytes_[t+1]<<8|this.bytes_[t+2]<<16|this.bytes_[t+3]<<24},Et.ByteBuffer.prototype.readUint32=function(t){return this.readInt32(t)>>>0},Et.ByteBuffer.prototype.readInt64=function(t){return new Et.Long(this.readInt32(t),this.readInt32(t+4))},Et.ByteBuffer.prototype.readUint64=function(t){return new Et.Long(this.readUint32(t),this.readUint32(t+4))},Et.ByteBuffer.prototype.readFloat32=function(t){return Et.int32[0]=this.readInt32(t),Et.float32[0]},Et.ByteBuffer.prototype.readFloat64=function(t){return Et.int32[Et.isLittleEndian?0:1]=this.readInt32(t),Et.int32[Et.isLittleEndian?1:0]=this.readInt32(t+4),Et.float64[0]},Et.ByteBuffer.prototype.writeInt8=function(t,e){this.bytes_[t]=e},Et.ByteBuffer.prototype.writeUint8=function(t,e){this.bytes_[t]=e},Et.ByteBuffer.prototype.writeInt16=function(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8},Et.ByteBuffer.prototype.writeUint16=function(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8},Et.ByteBuffer.prototype.writeInt32=function(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8,this.bytes_[t+2]=e>>16,this.bytes_[t+3]=e>>24},Et.ByteBuffer.prototype.writeUint32=function(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8,this.bytes_[t+2]=e>>16,this.bytes_[t+3]=e>>24},Et.ByteBuffer.prototype.writeInt64=function(t,e){this.writeInt32(t,e.low),this.writeInt32(t+4,e.high)},Et.ByteBuffer.prototype.writeUint64=function(t,e){this.writeUint32(t,e.low),this.writeUint32(t+4,e.high)},Et.ByteBuffer.prototype.writeFloat32=function(t,e){Et.float32[0]=e,this.writeInt32(t,Et.int32[0])},Et.ByteBuffer.prototype.writeFloat64=function(t,e){Et.float64[0]=e,this.writeInt32(t,Et.int32[Et.isLittleEndian?0:1]),this.writeInt32(t+4,Et.int32[Et.isLittleEndian?1:0])},Et.ByteBuffer.prototype.getBufferIdentifier=function(){if(this.bytes_.length<this.position_+Et.SIZEOF_INT+Et.FILE_IDENTIFIER_LENGTH)throw new Error("FlatBuffers: ByteBuffer is too short to contain an identifier.");for(var t="",e=0;e<Et.FILE_IDENTIFIER_LENGTH;e++)t+=String.fromCharCode(this.readInt8(this.position_+Et.SIZEOF_INT+e));return t},Et.ByteBuffer.prototype.__offset=function(t,e){var r=t-this.readInt32(t);return e<this.readInt16(r)?this.readInt16(r+e):0},Et.ByteBuffer.prototype.__union=function(t,e){return t.bb_pos=e+this.readInt32(e),t.bb=this,t},Et.ByteBuffer.prototype.__string=function(t,e){t+=this.readInt32(t);var r=this.readInt32(t),n="",i=0;if(t+=Et.SIZEOF_INT,e===Et.Encoding.UTF8_BYTES)return this.bytes_.subarray(t,t+r);for(;i<r;){var o,s=this.readUint8(t+i++);if(s<192)o=s;else{var a=this.readUint8(t+i++);if(s<224)o=(31&s)<<6|63&a;else{var c=this.readUint8(t+i++);if(s<240)o=(15&s)<<12|(63&a)<<6|63&c;else o=(7&s)<<18|(63&a)<<12|(63&c)<<6|63&this.readUint8(t+i++)}}o<65536?n+=String.fromCharCode(o):(o-=65536,n+=String.fromCharCode(55296+(o>>10),56320+(1023&o)))}return n},Et.ByteBuffer.prototype.__indirect=function(t){return t+this.readInt32(t)},Et.ByteBuffer.prototype.__vector=function(t){return t+this.readInt32(t)+Et.SIZEOF_INT},Et.ByteBuffer.prototype.__vector_len=function(t){return this.readInt32(t+this.readInt32(t))},Et.ByteBuffer.prototype.__has_identifier=function(t){if(t.length!=Et.FILE_IDENTIFIER_LENGTH)throw new Error("FlatBuffers: file identifier must be length "+Et.FILE_IDENTIFIER_LENGTH);for(var e=0;e<Et.FILE_IDENTIFIER_LENGTH;e++)if(t.charCodeAt(e)!=this.readInt8(this.position_+Et.SIZEOF_INT+e))return!1;return!0},Et.ByteBuffer.prototype.createLong=function(t,e){return Et.Long.create(t,e)},function(t){var e=function(){function t(){this.bb=null,this.bb_pos=0}return t.prototype.__init=function(t,e){return this.bb_pos=t,this.bb=e,this},t.prototype.v1=function(){return this.bb.readUint32(this.bb_pos)},t.prototype.v2=function(){return this.bb.readUint64(this.bb_pos+8)},t.prototype.v3=function(){return this.bb.readUint64(this.bb_pos+16)},t.prototype.v4=function(){return this.bb.readUint32(this.bb_pos+24)},t.createRid=function(t,e,r,n,i){return t.prep(8,32),t.pad(4),t.writeInt32(i),t.writeInt64(n),t.writeInt64(r),t.pad(4),t.writeInt32(e),t.offset()},t}();t.Rid=e}(St||(St={})),function(t){var e=function(){function t(){this.bb=null,this.bb_pos=0}return t.prototype.__init=function(t,e){return this.bb_pos=t,this.bb=e,this},t.prototype.v1=function(){return this.bb.readUint32(this.bb_pos)},t.prototype.v2=function(){return this.bb.readUint64(this.bb_pos+8)},t.prototype.v3=function(){return this.bb.readUint64(this.bb_pos+16)},t.createPeerId=function(t,e,r,n){return t.prep(8,24),t.writeInt64(n),t.writeInt64(r),t.pad(4),t.writeInt32(e),t.offset()},t}();t.PeerId=e}(St||(St={})),function(t){var e=function(){function t(){this.bb=null,this.bb_pos=0}return t.prototype.__init=function(t,e){return this.bb_pos=t,this.bb=e,this},t.prototype.v1=function(){return this.bb.readUint32(this.bb_pos)},t.prototype.v2=function(){return this.bb.readUint64(this.bb_pos+8)},t.prototype.v3=function(){return this.bb.readUint64(this.bb_pos+16)},t.createMd5=function(t,e,r,n){return t.prep(8,24),t.writeInt64(n),t.writeInt64(r),t.pad(4),t.writeInt32(e),t.offset()},t}();t.Md5=e}(St||(St={})),function(t){var e=function(){function e(){this.bb=null,this.bb_pos=0}return e.prototype.__init=function(t,e){return this.bb_pos=t,this.bb=e,this},e.getRootAsMeta=function(t,r){return(r||new e).__init(t.readInt32(t.position())+t.position(),t)},e.getSizePrefixedRootAsMeta=function(t,r){return t.setPosition(t.position()+Et.SIZE_PREFIX_LENGTH),(r||new e).__init(t.readInt32(t.position())+t.position(),t)},e.prototype.rid=function(e){var r=this.bb.__offset(this.bb_pos,4);return r?(e||new t.Rid).__init(this.bb_pos+r,this.bb):null},e.prototype.metaV=function(t){var e=this.bb.__offset(this.bb_pos,6);return e?this.bb.__string(this.bb_pos+e,t):null},e.startMeta=function(t){t.startObject(2)},e.addRid=function(t,e){t.addFieldStruct(0,e,0)},e.addMetaV=function(t,e){t.addFieldOffset(1,e,0)},e.endMeta=function(t){return t.endObject()},e.createMeta=function(t,r,n){return e.startMeta(t),e.addRid(t,r),e.addMetaV(t,n),e.endMeta(t)},e}();t.Meta=e}(St||(St={})),function(t){var e=function(){function e(){this.bb=null,this.bb_pos=0}return e.prototype.__init=function(t,e){return this.bb_pos=t,this.bb=e,this},e.getRootAsMetaVec=function(t,r){return(r||new e).__init(t.readInt32(t.position())+t.position(),t)},e.getSizePrefixedRootAsMetaVec=function(t,r){return t.setPosition(t.position()+Et.SIZE_PREFIX_LENGTH),(r||new e).__init(t.readInt32(t.position())+t.position(),t)},e.prototype.peer=function(e){var r=this.bb.__offset(this.bb_pos,4);return r?(e||new t.Peer).__init(this.bb.__indirect(this.bb_pos+r),this.bb):null},e.prototype.metas=function(e,r){var n=this.bb.__offset(this.bb_pos,6);return n?(r||new t.Meta).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+n)+4*e),this.bb):null},e.prototype.metasLength=function(){var t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__vector_len(this.bb_pos+t):0},e.startMetaVec=function(t){t.startObject(2)},e.addPeer=function(t,e){t.addFieldOffset(0,e,0)},e.addMetas=function(t,e){t.addFieldOffset(1,e,0)},e.createMetasVector=function(t,e){t.startVector(4,e.length,4);for(var r=e.length-1;r>=0;r--)t.addOffset(e[r]);return t.endVector()},e.startMetasVector=function(t,e){t.startVector(4,e,4)},e.endMetaVec=function(t){return t.endObject()},e.createMetaVec=function(t,r,n){return e.startMetaVec(t),e.addPeer(t,r),e.addMetas(t,n),e.endMetaVec(t)},e}();t.MetaVec=e}(St||(St={})),function(t){var e=function(){function e(){this.bb=null,this.bb_pos=0}return e.prototype.__init=function(t,e){return this.bb_pos=t,this.bb=e,this},e.getRootAsResourceMd5=function(t,r){return(r||new e).__init(t.readInt32(t.position())+t.position(),t)},e.getSizePrefixedRootAsResourceMd5=function(t,r){return t.setPosition(t.position()+Et.SIZE_PREFIX_LENGTH),(r||new e).__init(t.readInt32(t.position())+t.position(),t)},e.prototype.rid=function(e){var r=this.bb.__offset(this.bb_pos,4);return r?(e||new t.Rid).__init(this.bb_pos+r,this.bb):null},e.prototype.md5=function(e){var r=this.bb.__offset(this.bb_pos,6);return r?(e||new t.Md5).__init(this.bb_pos+r,this.bb):null},e.prototype.voted=function(){var t=this.bb.__offset(this.bb_pos,8);return!!t&&!!this.bb.readInt8(this.bb_pos+t)},e.startResourceMd5=function(t){t.startObject(3)},e.addRid=function(t,e){t.addFieldStruct(0,e,0)},e.addMd5=function(t,e){t.addFieldStruct(1,e,0)},e.addVoted=function(t,e){t.addFieldInt8(2,+e,0)},e.endResourceMd5=function(t){return t.endObject()},e}();t.ResourceMd5=e}(St||(St={})),function(t){var e=function(){function e(){this.bb=null,this.bb_pos=0}return e.prototype.__init=function(t,e){return this.bb_pos=t,this.bb=e,this},e.getRootAsMd5Vec=function(t,r){return(r||new e).__init(t.readInt32(t.position())+t.position(),t)},e.getSizePrefixedRootAsMd5Vec=function(t,r){return t.setPosition(t.position()+Et.SIZE_PREFIX_LENGTH),(r||new e).__init(t.readInt32(t.position())+t.position(),t)},e.prototype.peer=function(e){var r=this.bb.__offset(this.bb_pos,4);return r?(e||new t.Peer).__init(this.bb.__indirect(this.bb_pos+r),this.bb):null},e.prototype.md5s=function(e,r){var n=this.bb.__offset(this.bb_pos,6);return n?(r||new t.ResourceMd5).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+n)+4*e),this.bb):null},e.prototype.md5sLength=function(){var t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__vector_len(this.bb_pos+t):0},e.startMd5Vec=function(t){t.startObject(2)},e.addPeer=function(t,e){t.addFieldOffset(0,e,0)},e.addMd5s=function(t,e){t.addFieldOffset(1,e,0)},e.createMd5sVector=function(t,e){t.startVector(4,e.length,4);for(var r=e.length-1;r>=0;r--)t.addOffset(e[r]);return t.endVector()},e.startMd5sVector=function(t,e){t.startVector(4,e,4)},e.endMd5Vec=function(t){return t.endObject()},e.createMd5Vec=function(t,r,n){return e.startMd5Vec(t),e.addPeer(t,r),e.addMd5s(t,n),e.endMd5Vec(t)},e}();t.Md5Vec=e}(St||(St={})),function(t){var e=function(){function e(){this.bb=null,this.bb_pos=0}return e.prototype.__init=function(t,e){return this.bb_pos=t,this.bb=e,this},e.getRootAsControlRequest=function(t,r){return(r||new e).__init(t.readInt32(t.position())+t.position(),t)},e.getSizePrefixedRootAsControlRequest=function(t,r){return t.setPosition(t.position()+Et.SIZE_PREFIX_LENGTH),(r||new e).__init(t.readInt32(t.position())+t.position(),t)},e.prototype.peer=function(e){var r=this.bb.__offset(this.bb_pos,4);return r?(e||new t.Peer).__init(this.bb.__indirect(this.bb_pos+r),this.bb):null},e.prototype.res=function(e){var r=this.bb.__offset(this.bb_pos,6);return r?(e||new t.Resource).__init(this.bb.__indirect(this.bb_pos+r),this.bb):null},e.prototype.oid=function(t){var e=this.bb.__offset(this.bb_pos,8);return e?this.bb.__string(this.bb_pos+e,t):null},e.prototype.uuid=function(){var t=this.bb.__offset(this.bb_pos,10);return t?this.bb.readUint64(this.bb_pos+t):this.bb.createLong(0,0)},e.startControlRequest=function(t){t.startObject(4)},e.addPeer=function(t,e){t.addFieldOffset(0,e,0)},e.addRes=function(t,e){t.addFieldOffset(1,e,0)},e.addOid=function(t,e){t.addFieldOffset(2,e,0)},e.addUuid=function(t,e){t.addFieldInt64(3,e,t.createLong(0,0))},e.endControlRequest=function(t){return t.endObject()},e}();t.ControlRequest=e}(St||(St={})),function(t){var e=function(){function e(){this.bb=null,this.bb_pos=0}return e.prototype.__init=function(t,e){return this.bb_pos=t,this.bb=e,this},e.getRootAsControlResponse=function(t,r){return(r||new e).__init(t.readInt32(t.position())+t.position(),t)},e.getSizePrefixedRootAsControlResponse=function(t,r){return t.setPosition(t.position()+Et.SIZE_PREFIX_LENGTH),(r||new e).__init(t.readInt32(t.position())+t.position(),t)},e.prototype.rid=function(e){var r=this.bb.__offset(this.bb_pos,4);return r?(e||new t.Rid).__init(this.bb_pos+r,this.bb):null},e.prototype.uuid=function(){var t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readUint64(this.bb_pos+t):this.bb.createLong(0,0)},e.prototype.resourceP2pOperation=function(){var t=this.bb.__offset(this.bb_pos,8);return t?this.bb.readUint8(this.bb_pos+t):0},e.prototype.meta=function(t){var e=this.bb.__offset(this.bb_pos,10);return e?this.bb.__string(this.bb_pos+e,t):null},e.prototype.url=function(t){var e=this.bb.__offset(this.bb_pos,12);return e?this.bb.__string(this.bb_pos+e,t):null},e.prototype.md5s=function(e,r){var n=this.bb.__offset(this.bb_pos,14);return n?(r||new t.ResourceMd5).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+n)+4*e),this.bb):null},e.prototype.md5sLength=function(){var t=this.bb.__offset(this.bb_pos,14);return t?this.bb.__vector_len(this.bb_pos+t):0},e.startControlResponse=function(t){t.startObject(6)},e.addRid=function(t,e){t.addFieldStruct(0,e,0)},e.addUuid=function(t,e){t.addFieldInt64(1,e,t.createLong(0,0))},e.addResourceP2pOperation=function(t,e){t.addFieldInt8(2,e,0)},e.addMeta=function(t,e){t.addFieldOffset(3,e,0)},e.addUrl=function(t,e){t.addFieldOffset(4,e,0)},e.addMd5s=function(t,e){t.addFieldOffset(5,e,0)},e.createMd5sVector=function(t,e){t.startVector(4,e.length,4);for(var r=e.length-1;r>=0;r--)t.addOffset(e[r]);return t.endVector()},e.startMd5sVector=function(t,e){t.startVector(4,e,4)},e.endControlResponse=function(t){return t.endObject()},e.createControlResponse=function(t,r,n,i,o,s,a){return e.startControlResponse(t),e.addRid(t,r),e.addUuid(t,n),e.addResourceP2pOperation(t,i),e.addMeta(t,o),e.addUrl(t,s),e.addMd5s(t,a),e.endControlResponse(t)},e}();t.ControlResponse=e}(St||(St={})),function(t){var e=function(){function e(){this.bb=null,this.bb_pos=0}return e.prototype.__init=function(t,e){return this.bb_pos=t,this.bb=e,this},e.getRootAsPeer=function(t,r){return(r||new e).__init(t.readInt32(t.position())+t.position(),t)},e.getSizePrefixedRootAsPeer=function(t,r){return t.setPosition(t.position()+Et.SIZE_PREFIX_LENGTH),(r||new e).__init(t.readInt32(t.position())+t.position(),t)},e.prototype.pid=function(e){var r=this.bb.__offset(this.bb_pos,4);return r?(e||new t.PeerId).__init(this.bb_pos+r,this.bb):null},e.prototype.version=function(){var t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readUint64(this.bb_pos+t):this.bb.createLong(0,0)},e.prototype.asn=function(){var t=this.bb.__offset(this.bb_pos,8);return t?this.bb.readUint16(this.bb_pos+t):0},e.prototype.loc=function(){var t=this.bb.__offset(this.bb_pos,10);return t?this.bb.readUint64(this.bb_pos+t):this.bb.createLong(0,0)},e.prototype.peerLevel=function(){var t=this.bb.__offset(this.bb_pos,12);return t?this.bb.readUint8(this.bb_pos+t):0},e.startPeer=function(t){t.startObject(5)},e.addPid=function(t,e){t.addFieldStruct(0,e,0)},e.addVersion=function(t,e){t.addFieldInt64(1,e,t.createLong(0,0))},e.addAsn=function(t,e){t.addFieldInt16(2,e,0)},e.addLoc=function(t,e){t.addFieldInt64(3,e,t.createLong(0,0))},e.addPeerLevel=function(t,e){t.addFieldInt8(4,e,0)},e.endPeer=function(t){return t.endObject()},e.createPeer=function(t,r,n,i,o,s){return e.startPeer(t),e.addPid(t,r),e.addVersion(t,n),e.addAsn(t,i),e.addLoc(t,o),e.addPeerLevel(t,s),e.endPeer(t)},e}();t.Peer=e}(St||(St={})),function(t){var e=function(){function e(){this.bb=null,this.bb_pos=0}return e.prototype.__init=function(t,e){return this.bb_pos=t,this.bb=e,this},e.getRootAsResource=function(t,r){return(r||new e).__init(t.readInt32(t.position())+t.position(),t)},e.getSizePrefixedRootAsResource=function(t,r){return t.setPosition(t.position()+Et.SIZE_PREFIX_LENGTH),(r||new e).__init(t.readInt32(t.position())+t.position(),t)},e.prototype.rid=function(e){var r=this.bb.__offset(this.bb_pos,4);return r?(e||new t.Rid).__init(this.bb_pos+r,this.bb):null},e.prototype.url=function(t){var e=this.bb.__offset(this.bb_pos,6);return e?this.bb.__string(this.bb_pos+e,t):null},e.prototype.rsize=function(){var t=this.bb.__offset(this.bb_pos,8);return t?this.bb.readUint8(this.bb_pos+t):0},e.prototype.blkMd5=function(e){var r=this.bb.__offset(this.bb_pos,10);return r?(e||new t.Md5).__init(this.bb_pos+r,this.bb):null},e.prototype.resSize=function(t){var e=this.bb.__offset(this.bb_pos,12);return e?this.bb.__string(this.bb_pos+e,t):null},e.startResource=function(t){t.startObject(5)},e.addRid=function(t,e){t.addFieldStruct(0,e,0)},e.addUrl=function(t,e){t.addFieldOffset(1,e,0)},e.addRsize=function(t,e){t.addFieldInt8(2,e,0)},e.addBlkMd5=function(t,e){t.addFieldStruct(3,e,0)},e.addResSize=function(t,e){t.addFieldOffset(4,e,0)},e.endResource=function(t){return t.endObject()},e}();t.Resource=e}(St||(St={})),function(t){var e=function(){function e(){this.bb=null,this.bb_pos=0}return e.prototype.__init=function(t,e){return this.bb_pos=t,this.bb=e,this},e.getRootAsPropertyRequest=function(t,r){return(r||new e).__init(t.readInt32(t.position())+t.position(),t)},e.getSizePrefixedRootAsPropertyRequest=function(t,r){return t.setPosition(t.position()+Et.SIZE_PREFIX_LENGTH),(r||new e).__init(t.readInt32(t.position())+t.position(),t)},e.prototype.uuid=function(){var t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readUint64(this.bb_pos+t):this.bb.createLong(0,0)},e.prototype.peer=function(e){var r=this.bb.__offset(this.bb_pos,6);return r?(e||new t.Peer).__init(this.bb.__indirect(this.bb_pos+r),this.bb):null},e.prototype.rid=function(e){var r=this.bb.__offset(this.bb_pos,8);return r?(e||new t.Rid).__init(this.bb_pos+r,this.bb):null},e.startPropertyRequest=function(t){t.startObject(3)},e.addUuid=function(t,e){t.addFieldInt64(0,e,t.createLong(0,0))},e.addPeer=function(t,e){t.addFieldOffset(1,e,0)},e.addRid=function(t,e){t.addFieldStruct(2,e,0)},e.endPropertyRequest=function(t){return t.endObject()},e}();t.PropertyRequest=e}(St||(St={})),function(t){var e=function(){function e(){this.bb=null,this.bb_pos=0}return e.prototype.__init=function(t,e){return this.bb_pos=t,this.bb=e,this},e.getRootAsPropertyResponse=function(t,r){return(r||new e).__init(t.readInt32(t.position())+t.position(),t)},e.getSizePrefixedRootAsPropertyResponse=function(t,r){return t.setPosition(t.position()+Et.SIZE_PREFIX_LENGTH),(r||new e).__init(t.readInt32(t.position())+t.position(),t)},e.prototype.uuid=function(){var t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readUint64(this.bb_pos+t):this.bb.createLong(0,0)},e.prototype.md5=function(e){var r=this.bb.__offset(this.bb_pos,6);return r?(e||new t.ResourceMd5).__init(this.bb.__indirect(this.bb_pos+r),this.bb):null},e.startPropertyResponse=function(t){t.startObject(2)},e.addUuid=function(t,e){t.addFieldInt64(0,e,t.createLong(0,0))},e.addMd5=function(t,e){t.addFieldOffset(1,e,0)},e.endPropertyResponse=function(t){return t.endObject()},e.finishPropertyResponseBuffer=function(t,e){t.finish(e)},e.finishSizePrefixedPropertyResponseBuffer=function(t,e){t.finish(e,void 0,!0)},e}();t.PropertyResponse=e}(St||(St={}));var Pt,xt=function(){function t(t,e){this.url_="",this.resourceId_=void 0,this.http_request_=new vt(this.callback.bind(this)),this.realtime_logmonitor_=new Tt,this.url_=e,this.resourceId_=t,this.retry_cn_=0}return t.prototype.request=function(){var t=this.getRequestData();if(t){var r=Rt.cpsURL+"/control1";S.log("[control1][request]mUrl:",this.url_),this.http_request_.post(r,e.protocal_net_timeout_ms_,t,"fb")}},t.prototype.getRequestData=function(){var t=new Et.Builder(1024);try{St.Peer.startPeer(t),St.Peer.addPid(t,St.PeerId.createPeerId(t,wt.get_peerid_v1(e.pcdn_peer_id_),wt.get_peerid_v2(e.pcdn_peer_id_),wt.get_peerid_v3(e.pcdn_peer_id_))),St.Peer.addVersion(t,wt.GetVersionULong()),St.Peer.addAsn(t,e.asn_code_),St.Peer.addLoc(t,wt.getLocationULong()),St.Peer.addPeerLevel(t,e.peer_level_);var r=St.Peer.endPeer(t),n=t.createString(this.url_),i=e.change_resize_?"":"0",o=t.createString(i);St.Resource.startResource(t),null!=this.resourceId_&&St.Resource.addRid(t,St.Rid.createRid(t,wt.get_rid_v1(this.resourceId_),wt.get_rid_v2(this.resourceId_),wt.get_rid_v3(this.resourceId_),wt.get_rid_v4(this.resourceId_))),St.Resource.addUrl(t,n),St.Resource.addRsize(t,2),St.Resource.addBlkMd5(t,St.Md5.createMd5(t,0,q.fromString("0",!0,16),q.fromString("0",!0,16))),St.Resource.addResSize(t,o);var s=St.Resource.endResource(t),a=t.createString(e.oid_);St.ControlRequest.startControlRequest(t),St.ControlRequest.addPeer(t,r),St.ControlRequest.addRes(t,s),St.ControlRequest.addOid(t,a);var c=St.ControlRequest.endControlRequest(t);t.finish(c)}catch(ae){S.warn("[control1][request]exception:",this.url_);var u={logtype:_t.ERROR,subtype:pt.DEFAULT,errcode:lt.CONTROL1_ARG_ERR,ext:ae};return this.realtime_logmonitor_.request(u),null}return t.asUint8Array()},t.prototype.tryControl1=function(){return this.retry_cn_<1?(++this.retry_cn_,S.warn("[control1]timeout retry...",this.retry_cn_),this.request(),0):-1},t.prototype.callback=function(r,n){if(null==r)try{var i=new Uint8Array(n),o=new Et.ByteBuffer(i),s=St.ControlResponse.getRootAsControlResponse(o);if(null!=s){var a=s.rid();if(!a||wt.is_rid_zero(a))return S.error("[control1][callback]no rid. url:",this.url_),void(e.is_use_p2p_=!1);var c={rid:wt.get_rid_to_string(s.rid()),did:ht.ULongToNumber(s.uuid()),m3u8url:this.url_};S.log("[control1][callback]rid:",c.rid);try{t.P2PManager.instance().emit(T.CONTROL1,c)}catch(ae){S.error("[control1][callback]emit e.",ae)}}else S.error("[control1][callback]null.")}catch(ae){S.log("[control1][callback]fb error:",ae)}else{var u={logtype:_t.ERROR,subtype:pt.DEFAULT,errcode:lt.CONTROL1_STATUS_ERR,ext:r};this.realtime_logmonitor_.request(u),"timeout"===r||S.error("[control1][callback]net error,status:",r),void 0!==this.url_&&this.tryControl1()}},t.prototype.getResourceMd5=function(t){return{rid:wt.get_rid_to_string(t.rid()),md5:t.md5(),voted:t.voted()}},t}();!function(t){var e=function(){function t(){this.bb=null,this.bb_pos=0}return t.prototype.__init=function(t,e){return this.bb_pos=t,this.bb=e,this},t.prototype.v1=function(){return this.bb.readUint32(this.bb_pos)},t.prototype.v2=function(){return this.bb.readUint64(this.bb_pos+8)},t.prototype.v3=function(){return this.bb.readUint64(this.bb_pos+16)},t.prototype.v4=function(){return this.bb.readUint32(this.bb_pos+24)},t.createRid=function(t,e,r,n,i){return t.prep(8,32),t.pad(4),t.writeInt32(i),t.writeInt64(n),t.writeInt64(r),t.pad(4),t.writeInt32(e),t.offset()},t}();t.Rid=e}(Pt||(Pt={})),function(t){var e=function(){function t(){this.bb=null,this.bb_pos=0}return t.prototype.__init=function(t,e){return this.bb_pos=t,this.bb=e,this},t.prototype.v1=function(){return this.bb.readUint32(this.bb_pos)},t.prototype.v2=function(){return this.bb.readUint64(this.bb_pos+8)},t.prototype.v3=function(){return this.bb.readUint64(this.bb_pos+16)},t.createPeerId=function(t,e,r,n){return t.prep(8,24),t.writeInt64(n),t.writeInt64(r),t.pad(4),t.writeInt32(e),t.offset()},t}();t.PeerId=e}(Pt||(Pt={})),function(t){var e=function(){function t(){this.bb=null,this.bb_pos=0}return t.prototype.__init=function(t,e){return this.bb_pos=t,this.bb=e,this},t.prototype.v1=function(){return this.bb.readUint32(this.bb_pos)},t.prototype.v2=function(){return this.bb.readUint64(this.bb_pos+8)},t.prototype.v3=function(){return this.bb.readUint64(this.bb_pos+16)},t.createMd5=function(t,e,r,n){return t.prep(8,24),t.writeInt64(n),t.writeInt64(r),t.pad(4),t.writeInt32(e),t.offset()},t}();t.Md5=e}(Pt||(Pt={})),function(t){var e=function(){function e(){this.bb=null,this.bb_pos=0}return e.prototype.__init=function(t,e){return this.bb_pos=t,this.bb=e,this},e.getRootAsPeer=function(t,r){return(r||new e).__init(t.readInt32(t.position())+t.position(),t)},e.getSizePrefixedRootAsPeer=function(t,r){return t.setPosition(t.position()+Et.SIZE_PREFIX_LENGTH),(r||new e).__init(t.readInt32(t.position())+t.position(),t)},e.prototype.pid=function(e){var r=this.bb.__offset(this.bb_pos,4);return r?(e||new t.PeerId).__init(this.bb_pos+r,this.bb):null},e.prototype.peerAbility=function(){var t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readUint32(this.bb_pos+t):0},e.prototype.netAbility=function(){var t=this.bb.__offset(this.bb_pos,8);return t?this.bb.readUint8(this.bb_pos+t):0},e.prototype.version=function(){var t=this.bb.__offset(this.bb_pos,10);return t?this.bb.readUint64(this.bb_pos+t):this.bb.createLong(0,0)},e.prototype.asn=function(){var t=this.bb.__offset(this.bb_pos,12);return t?this.bb.readUint16(this.bb_pos+t):0},e.prototype.loc=function(){var t=this.bb.__offset(this.bb_pos,14);return t?this.bb.readUint64(this.bb_pos+t):this.bb.createLong(0,0)},e.prototype.peerLevel=function(){var t=this.bb.__offset(this.bb_pos,16);return t?this.bb.readUint8(this.bb_pos+t):0},e.prototype.quality=function(){var t=this.bb.__offset(this.bb_pos,18);return t?this.bb.readUint16(this.bb_pos+t):0},e.prototype.addressInfo=function(t){var e=this.bb.__offset(this.bb_pos,20);return e?this.bb.__string(this.bb_pos+e,t):null},e.prototype.published=function(){var t=this.bb.__offset(this.bb_pos,22);return!!t&&!!this.bb.readInt8(this.bb_pos+t)},e.startPeer=function(t){t.startObject(10)},e.addPid=function(t,e){t.addFieldStruct(0,e,0)},e.addPeerAbility=function(t,e){t.addFieldInt32(1,e,0)},e.addNetAbility=function(t,e){t.addFieldInt8(2,e,0)},e.addVersion=function(t,e){t.addFieldInt64(3,e,t.createLong(0,0))},e.addAsn=function(t,e){t.addFieldInt16(4,e,0)},e.addLoc=function(t,e){t.addFieldInt64(5,e,t.createLong(0,0))},e.addPeerLevel=function(t,e){t.addFieldInt8(6,e,0)},e.addQuality=function(t,e){t.addFieldInt16(7,e,0)},e.addAddressInfo=function(t,e){t.addFieldOffset(8,e,0)},e.addPublished=function(t,e){t.addFieldInt8(9,+e,0)},e.endPeer=function(t){return t.endObject()},e.createPeer=function(t,r,n,i,o,s,a,c,u,h,d){return e.startPeer(t),e.addPid(t,r),e.addPeerAbility(t,n),e.addNetAbility(t,i),e.addVersion(t,o),e.addAsn(t,s),e.addLoc(t,a),e.addPeerLevel(t,c),e.addQuality(t,u),e.addAddressInfo(t,h),e.addPublished(t,d),e.endPeer(t)},e}();t.Peer=e}(Pt||(Pt={})),function(t){var e=function(){function e(){this.bb=null,this.bb_pos=0}return e.prototype.__init=function(t,e){return this.bb_pos=t,this.bb=e,this},e.getRootAsResource=function(t,r){return(r||new e).__init(t.readInt32(t.position())+t.position(),t)},e.getSizePrefixedRootAsResource=function(t,r){return t.setPosition(t.position()+Et.SIZE_PREFIX_LENGTH),(r||new e).__init(t.readInt32(t.position())+t.position(),t)},e.prototype.rid=function(e){var r=this.bb.__offset(this.bb_pos,4);return r?(e||new t.Rid).__init(this.bb_pos+r,this.bb):null},e.prototype.domain=function(t){var e=this.bb.__offset(this.bb_pos,6);return e?this.bb.__string(this.bb_pos+e,t):null},e.prototype.serviceType=function(){var t=this.bb.__offset(this.bb_pos,8);return t?this.bb.readUint8(this.bb_pos+t):0},e.startResource=function(t){t.startObject(3)},e.addRid=function(t,e){t.addFieldStruct(0,e,0)},e.addDomain=function(t,e){t.addFieldOffset(1,e,0)},e.addServiceType=function(t,e){t.addFieldInt8(2,e,0)},e.endResource=function(t){return t.endObject()},e.createResource=function(t,r,n,i){return e.startResource(t),e.addRid(t,r),e.addDomain(t,n),e.addServiceType(t,i),e.endResource(t)},e}();t.Resource=e}(Pt||(Pt={})),function(t){var e=function(){function e(){this.bb=null,this.bb_pos=0}return e.prototype.__init=function(t,e){return this.bb_pos=t,this.bb=e,this},e.getRootAsResPublish=function(t,r){return(r||new e).__init(t.readInt32(t.position())+t.position(),t)},e.getSizePrefixedRootAsResPublish=function(t,r){return t.setPosition(t.position()+Et.SIZE_PREFIX_LENGTH),(r||new e).__init(t.readInt32(t.position())+t.position(),t)},e.prototype.rid=function(e){var r=this.bb.__offset(this.bb_pos,4);return r?(e||new t.Rid).__init(this.bb_pos+r,this.bb):null},e.prototype.scarcity=function(){var t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readInt32(this.bb_pos+t):0},e.startResPublish=function(t){t.startObject(2)},e.addRid=function(t,e){t.addFieldStruct(0,e,0)},e.addScarcity=function(t,e){t.addFieldInt32(1,e,0)},e.endResPublish=function(t){return t.endObject()},e.createResPublish=function(t,r,n){return e.startResPublish(t),e.addRid(t,r),e.addScarcity(t,n),e.endResPublish(t)},e}();t.ResPublish=e}(Pt||(Pt={})),function(t){var e=function(){function t(){this.bb=null,this.bb_pos=0}return t.prototype.__init=function(t,e){return this.bb_pos=t,this.bb=e,this},t.getRootAsResUnPublish=function(e,r){return(r||new t).__init(e.readInt32(e.position())+e.position(),e)},t.getSizePrefixedRootAsResUnPublish=function(e,r){return e.setPosition(e.position()+Et.SIZE_PREFIX_LENGTH),(r||new t).__init(e.readInt32(e.position())+e.position(),e)},t.prototype.rid=function(t){var e=this.bb.__offset(this.bb_pos,4);return e?this.bb.__string(this.bb_pos+e,t):null},t.prototype.status=function(){var t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readInt32(this.bb_pos+t):0},t.prototype.msg=function(t){var e=this.bb.__offset(this.bb_pos,8);return e?this.bb.__string(this.bb_pos+e,t):null},t.startResUnPublish=function(t){t.startObject(3)},t.addRid=function(t,e){t.addFieldOffset(0,e,0)},t.addStatus=function(t,e){t.addFieldInt32(1,e,0)},t.addMsg=function(t,e){t.addFieldOffset(2,e,0)},t.endResUnPublish=function(t){return t.endObject()},t.createResUnPublish=function(e,r,n,i){return t.startResUnPublish(e),t.addRid(e,r),t.addStatus(e,n),t.addMsg(e,i),t.endResUnPublish(e)},t}();t.ResUnPublish=e}(Pt||(Pt={})),function(t){var e=function(){function e(){this.bb=null,this.bb_pos=0}return e.prototype.__init=function(t,e){return this.bb_pos=t,this.bb=e,this},e.getRootAsAddressRequest=function(t,r){return(r||new e).__init(t.readInt32(t.position())+t.position(),t)},e.getSizePrefixedRootAsAddressRequest=function(t,r){return t.setPosition(t.position()+Et.SIZE_PREFIX_LENGTH),(r||new e).__init(t.readInt32(t.position())+t.position(),t)},e.prototype.uuid=function(){var t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readUint64(this.bb_pos+t):this.bb.createLong(0,0)},e.prototype.peer=function(e){var r=this.bb.__offset(this.bb_pos,6);return r?(e||new t.Peer).__init(this.bb.__indirect(this.bb_pos+r),this.bb):null},e.prototype.res=function(e){var r=this.bb.__offset(this.bb_pos,8);return r?(e||new t.Resource).__init(this.bb.__indirect(this.bb_pos+r),this.bb):null},e.prototype.oid=function(t){var e=this.bb.__offset(this.bb_pos,10);return e?this.bb.__string(this.bb_pos+e,t):null},e.prototype.bakMaxCnt=function(){var t=this.bb.__offset(this.bb_pos,12);return t?this.bb.readUint16(this.bb_pos+t):0},e.prototype.firstAddr=function(){var t=this.bb.__offset(this.bb_pos,14);return!!t&&!!this.bb.readInt8(this.bb_pos+t)},e.prototype.vid=function(t){var e=this.bb.__offset(this.bb_pos,16);return e?this.bb.__string(this.bb_pos+e,t):null},e.prototype.streamtype=function(t){var e=this.bb.__offset(this.bb_pos,18);return e?this.bb.__string(this.bb_pos+e,t):null},e.startAddressRequest=function(t){t.startObject(8)},e.addUuid=function(t,e){t.addFieldInt64(0,e,t.createLong(0,0))},e.addPeer=function(t,e){t.addFieldOffset(1,e,0)},e.addRes=function(t,e){t.addFieldOffset(2,e,0)},e.addOid=function(t,e){t.addFieldOffset(3,e,0)},e.addBakMaxCnt=function(t,e){t.addFieldInt16(4,e,0)},e.addFirstAddr=function(t,e){t.addFieldInt8(5,+e,0)},e.addVid=function(t,e){t.addFieldOffset(6,e,0)},e.addStreamtype=function(t,e){t.addFieldOffset(7,e,0)},e.endAddressRequest=function(t){return t.endObject()},e}();t.AddressRequest=e}(Pt||(Pt={})),function(t){var e=function(){function e(){this.bb=null,this.bb_pos=0}return e.prototype.__init=function(t,e){return this.bb_pos=t,this.bb=e,this},e.getRootAsAddressResponse=function(t,r){return(r||new e).__init(t.readInt32(t.position())+t.position(),t)},e.getSizePrefixedRootAsAddressResponse=function(t,r){return t.setPosition(t.position()+Et.SIZE_PREFIX_LENGTH),(r||new e).__init(t.readInt32(t.position())+t.position(),t)},e.prototype.uuid=function(){var t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readUint64(this.bb_pos+t):this.bb.createLong(0,0)},e.prototype.rid=function(e){var r=this.bb.__offset(this.bb_pos,6);return r?(e||new t.Rid).__init(this.bb_pos+r,this.bb):null},e.prototype.md5=function(e){var r=this.bb.__offset(this.bb_pos,8);return r?(e||new t.Md5).__init(this.bb_pos+r,this.bb):null},e.prototype.voted=function(){var t=this.bb.__offset(this.bb_pos,10);return!!t&&!!this.bb.readInt8(this.bb_pos+t)},e.prototype.peers=function(e,r){var n=this.bb.__offset(this.bb_pos,12);return n?(r||new t.Peer).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+n)+4*e),this.bb):null},e.prototype.peersLength=function(){var t=this.bb.__offset(this.bb_pos,12);return t?this.bb.__vector_len(this.bb_pos+t):0},e.prototype.isCache=function(){var t=this.bb.__offset(this.bb_pos,14);return t?this.bb.readUint8(this.bb_pos+t):0},e.prototype.scarcity=function(){var t=this.bb.__offset(this.bb_pos,16);return t?this.bb.readInt32(this.bb_pos+t):0},e.prototype.crc=function(t){var e=this.bb.__offset(this.bb_pos,18);return e?this.bb.readUint8(this.bb.__vector(this.bb_pos+e)+t):0},e.prototype.crcLength=function(){var t=this.bb.__offset(this.bb_pos,18);return t?this.bb.__vector_len(this.bb_pos+t):0},e.prototype.crcArray=function(){var t=this.bb.__offset(this.bb_pos,18);return t?new Uint8Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null},e.prototype.crcVoted=function(){var t=this.bb.__offset(this.bb_pos,20);return!!t&&!!this.bb.readInt8(this.bb_pos+t)},e.prototype.peakmode=function(){var t=this.bb.__offset(this.bb_pos,22);return t?this.bb.readUint8(this.bb_pos+t):0},e.startAddressResponse=function(t){t.startObject(10)},e.addUuid=function(t,e){t.addFieldInt64(0,e,t.createLong(0,0))},e.addRid=function(t,e){t.addFieldStruct(1,e,0)},e.addMd5=function(t,e){t.addFieldStruct(2,e,0)},e.addVoted=function(t,e){t.addFieldInt8(3,+e,0)},e.addPeers=function(t,e){t.addFieldOffset(4,e,0)},e.createPeersVector=function(t,e){t.startVector(4,e.length,4);for(var r=e.length-1;r>=0;r--)t.addOffset(e[r]);return t.endVector()},e.startPeersVector=function(t,e){t.startVector(4,e,4)},e.addIsCache=function(t,e){t.addFieldInt8(5,e,0)},e.addScarcity=function(t,e){t.addFieldInt32(6,e,0)},e.addCrc=function(t,e){t.addFieldOffset(7,e,0)},e.createCrcVector=function(t,e){t.startVector(1,e.length,1);for(var r=e.length-1;r>=0;r--)t.addInt8(e[r]);return t.endVector()},e.startCrcVector=function(t,e){t.startVector(1,e,1)},e.addCrcVoted=function(t,e){t.addFieldInt8(8,+e,0)},e.addPeakmode=function(t,e){t.addFieldInt8(9,e,0)},e.endAddressResponse=function(t){return t.endObject()},e}();t.AddressResponse=e}(Pt||(Pt={})),function(t){var e=function(){function e(){this.bb=null,this.bb_pos=0}return e.prototype.__init=function(t,e){return this.bb_pos=t,this.bb=e,this},e.getRootAsControlRequest=function(t,r){return(r||new e).__init(t.readInt32(t.position())+t.position(),t)},e.getSizePrefixedRootAsControlRequest=function(t,r){return t.setPosition(t.position()+Et.SIZE_PREFIX_LENGTH),(r||new e).__init(t.readInt32(t.position())+t.position(),t)},e.prototype.peer=function(e){var r=this.bb.__offset(this.bb_pos,4);return r?(e||new t.Peer).__init(this.bb.__indirect(this.bb_pos+r),this.bb):null},e.prototype.res=function(e){var r=this.bb.__offset(this.bb_pos,6);return r?(e||new t.Resource).__init(this.bb.__indirect(this.bb_pos+r),this.bb):null},e.prototype.oid=function(t){var e=this.bb.__offset(this.bb_pos,8);return e?this.bb.__string(this.bb_pos+e,t):null},e.prototype.uuid=function(){var t=this.bb.__offset(this.bb_pos,10);return t?this.bb.readUint64(this.bb_pos+t):this.bb.createLong(0,0)},e.startControlRequest=function(t){t.startObject(4)},e.addPeer=function(t,e){t.addFieldOffset(0,e,0)},e.addRes=function(t,e){t.addFieldOffset(1,e,0)},e.addOid=function(t,e){t.addFieldOffset(2,e,0)},e.addUuid=function(t,e){t.addFieldInt64(3,e,t.createLong(0,0))},e.endControlRequest=function(t){return t.endObject()},e}();t.ControlRequest=e}(Pt||(Pt={})),function(t){var e=function(){function e(){this.bb=null,this.bb_pos=0}return e.prototype.__init=function(t,e){return this.bb_pos=t,this.bb=e,this},e.getRootAsControlResponse=function(t,r){return(r||new e).__init(t.readInt32(t.position())+t.position(),t)},e.getSizePrefixedRootAsControlResponse=function(t,r){return t.setPosition(t.position()+Et.SIZE_PREFIX_LENGTH),(r||new e).__init(t.readInt32(t.position())+t.position(),t)},e.prototype.uuid=function(){var t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readUint64(this.bb_pos+t):this.bb.createLong(0,0)},e.prototype.rid=function(e){var r=this.bb.__offset(this.bb_pos,6);return r?(e||new t.Rid).__init(this.bb_pos+r,this.bb):null},e.prototype.isCache=function(){var t=this.bb.__offset(this.bb_pos,8);return t?this.bb.readUint8(this.bb_pos+t):0},e.prototype.scarcity=function(){var t=this.bb.__offset(this.bb_pos,10);return t?this.bb.readInt32(this.bb_pos+t):0},e.prototype.md5=function(e){var r=this.bb.__offset(this.bb_pos,12);return r?(e||new t.Md5).__init(this.bb_pos+r,this.bb):null},e.prototype.voted=function(){var t=this.bb.__offset(this.bb_pos,14);return!!t&&!!this.bb.readInt8(this.bb_pos+t)},e.prototype.peers=function(e,r){var n=this.bb.__offset(this.bb_pos,16);return n?(r||new t.Peer).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+n)+4*e),this.bb):null},e.prototype.peersLength=function(){var t=this.bb.__offset(this.bb_pos,16);return t?this.bb.__vector_len(this.bb_pos+t):0},e.startControlResponse=function(t){t.startObject(7)},e.addUuid=function(t,e){t.addFieldInt64(0,e,t.createLong(0,0))},e.addRid=function(t,e){t.addFieldStruct(1,e,0)},e.addIsCache=function(t,e){t.addFieldInt8(2,e,0)},e.addScarcity=function(t,e){t.addFieldInt32(3,e,0)},e.addMd5=function(t,e){t.addFieldStruct(4,e,0)},e.addVoted=function(t,e){t.addFieldInt8(5,+e,0)},e.addPeers=function(t,e){t.addFieldOffset(6,e,0)},e.createPeersVector=function(t,e){t.startVector(4,e.length,4);for(var r=e.length-1;r>=0;r--)t.addOffset(e[r]);return t.endVector()},e.startPeersVector=function(t,e){t.startVector(4,e,4)},e.endControlResponse=function(t){return t.endObject()},e}();t.ControlResponse=e}(Pt||(Pt={})),function(t){var e=function(){function e(){this.bb=null,this.bb_pos=0}return e.prototype.__init=function(t,e){return this.bb_pos=t,this.bb=e,this},e.getRootAsPublishRequest=function(t,r){return(r||new e).__init(t.readInt32(t.position())+t.position(),t)},e.getSizePrefixedRootAsPublishRequest=function(t,r){return t.setPosition(t.position()+Et.SIZE_PREFIX_LENGTH),(r||new e).__init(t.readInt32(t.position())+t.position(),t)},e.prototype.peer=function(e){var r=this.bb.__offset(this.bb_pos,4);return r?(e||new t.Peer).__init(this.bb.__indirect(this.bb_pos+r),this.bb):null},e.prototype.ress=function(e,r){var n=this.bb.__offset(this.bb_pos,6);return n?(r||new t.Resource).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+n)+4*e),this.bb):null},e.prototype.ressLength=function(){var t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__vector_len(this.bb_pos+t):0},e.startPublishRequest=function(t){t.startObject(2)},e.addPeer=function(t,e){t.addFieldOffset(0,e,0)},e.addRess=function(t,e){t.addFieldOffset(1,e,0)},e.createRessVector=function(t,e){t.startVector(4,e.length,4);for(var r=e.length-1;r>=0;r--)t.addOffset(e[r]);return t.endVector()},e.startRessVector=function(t,e){t.startVector(4,e,4)},e.endPublishRequest=function(t){return t.endObject()},e.createPublishRequest=function(t,r,n){return e.startPublishRequest(t),e.addPeer(t,r),e.addRess(t,n),e.endPublishRequest(t)},e}();t.PublishRequest=e}(Pt||(Pt={})),function(t){var e=function(){function e(){this.bb=null,this.bb_pos=0}return e.prototype.__init=function(t,e){return this.bb_pos=t,this.bb=e,this},e.getRootAsUnPublishRequest=function(t,r){return(r||new e).__init(t.readInt32(t.position())+t.position(),t)},e.getSizePrefixedRootAsUnPublishRequest=function(t,r){return t.setPosition(t.position()+Et.SIZE_PREFIX_LENGTH),(r||new e).__init(t.readInt32(t.position())+t.position(),t)},e.prototype.peer=function(e){var r=this.bb.__offset(this.bb_pos,4);return r?(e||new t.Peer).__init(this.bb.__indirect(this.bb_pos+r),this.bb):null},e.prototype.ress=function(e,r){var n=this.bb.__offset(this.bb_pos,6);return n?(r||new t.Resource).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+n)+4*e),this.bb):null},e.prototype.ressLength=function(){var t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__vector_len(this.bb_pos+t):0},e.startUnPublishRequest=function(t){t.startObject(2)},e.addPeer=function(t,e){t.addFieldOffset(0,e,0)},e.addRess=function(t,e){t.addFieldOffset(1,e,0)},e.createRessVector=function(t,e){t.startVector(4,e.length,4);for(var r=e.length-1;r>=0;r--)t.addOffset(e[r]);return t.endVector()},e.startRessVector=function(t,e){t.startVector(4,e,4)},e.endUnPublishRequest=function(t){return t.endObject()},e.createUnPublishRequest=function(t,r,n){return e.startUnPublishRequest(t),e.addPeer(t,r),e.addRess(t,n),e.endUnPublishRequest(t)},e}();t.UnPublishRequest=e}(Pt||(Pt={})),function(t){var e=function(){function e(){this.bb=null,this.bb_pos=0}return e.prototype.__init=function(t,e){return this.bb_pos=t,this.bb=e,this},e.getRootAsPublishResponse=function(t,r){return(r||new e).__init(t.readInt32(t.position())+t.position(),t)},e.getSizePrefixedRootAsPublishResponse=function(t,r){return t.setPosition(t.position()+Et.SIZE_PREFIX_LENGTH),(r||new e).__init(t.readInt32(t.position())+t.position(),t)},e.prototype.ress=function(e,r){var n=this.bb.__offset(this.bb_pos,4);return n?(r||new t.ResPublish).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+n)+4*e),this.bb):null},e.prototype.ressLength=function(){var t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__vector_len(this.bb_pos+t):0},e.startPublishResponse=function(t){t.startObject(1)},e.addRess=function(t,e){t.addFieldOffset(0,e,0)},e.createRessVector=function(t,e){t.startVector(4,e.length,4);for(var r=e.length-1;r>=0;r--)t.addOffset(e[r]);return t.endVector()},e.startRessVector=function(t,e){t.startVector(4,e,4)},e.endPublishResponse=function(t){return t.endObject()},e.createPublishResponse=function(t,r){return e.startPublishResponse(t),e.addRess(t,r),e.endPublishResponse(t)},e}();t.PublishResponse=e}(Pt||(Pt={})),function(t){var e=function(){function e(){this.bb=null,this.bb_pos=0}return e.prototype.__init=function(t,e){return this.bb_pos=t,this.bb=e,this},e.getRootAsUnPublishResponse=function(t,r){return(r||new e).__init(t.readInt32(t.position())+t.position(),t)},e.getSizePrefixedRootAsUnPublishResponse=function(t,r){return t.setPosition(t.position()+Et.SIZE_PREFIX_LENGTH),(r||new e).__init(t.readInt32(t.position())+t.position(),t)},e.prototype.msg=function(t){var e=this.bb.__offset(this.bb_pos,4);return e?this.bb.__string(this.bb_pos+e,t):null},e.prototype.status=function(){var t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readInt32(this.bb_pos+t):0},e.prototype.ress=function(e,r){var n=this.bb.__offset(this.bb_pos,8);return n?(r||new t.ResUnPublish).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+n)+4*e),this.bb):null},e.prototype.ressLength=function(){var t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__vector_len(this.bb_pos+t):0},e.startUnPublishResponse=function(t){t.startObject(3)},e.addMsg=function(t,e){t.addFieldOffset(0,e,0)},e.addStatus=function(t,e){t.addFieldInt32(1,e,0)},e.addRess=function(t,e){t.addFieldOffset(2,e,0)},e.createRessVector=function(t,e){t.startVector(4,e.length,4);for(var r=e.length-1;r>=0;r--)t.addOffset(e[r]);return t.endVector()},e.startRessVector=function(t,e){t.startVector(4,e,4)},e.endUnPublishResponse=function(t){return t.endObject()},e.createUnPublishResponse=function(t,r,n,i){return e.startUnPublishResponse(t),e.addMsg(t,r),e.addStatus(t,n),e.addRess(t,i),e.endUnPublishResponse(t)},e}();t.UnPublishResponse=e}(Pt||(Pt={})),function(t){var e=function(){function e(){this.bb=null,this.bb_pos=0}return e.prototype.__init=function(t,e){return this.bb_pos=t,this.bb=e,this},e.getRootAsKeepRequest=function(t,r){return(r||new e).__init(t.readInt32(t.position())+t.position(),t)},e.getSizePrefixedRootAsKeepRequest=function(t,r){return t.setPosition(t.position()+Et.SIZE_PREFIX_LENGTH),(r||new e).__init(t.readInt32(t.position())+t.position(),t)},e.prototype.peer=function(e){var r=this.bb.__offset(this.bb_pos,4);return r?(e||new t.Peer).__init(this.bb.__indirect(this.bb_pos+r),this.bb):null},e.prototype.ress=function(e,r){var n=this.bb.__offset(this.bb_pos,6);return n?(r||new t.Resource).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+n)+4*e),this.bb):null},e.prototype.ressLength=function(){var t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__vector_len(this.bb_pos+t):0},e.startKeepRequest=function(t){t.startObject(2)},e.addPeer=function(t,e){t.addFieldOffset(0,e,0)},e.addRess=function(t,e){t.addFieldOffset(1,e,0)},e.createRessVector=function(t,e){t.startVector(4,e.length,4);for(var r=e.length-1;r>=0;r--)t.addOffset(e[r]);return t.endVector()},e.startRessVector=function(t,e){t.startVector(4,e,4)},e.endKeepRequest=function(t){return t.endObject()},e.finishKeepRequestBuffer=function(t,e){t.finish(e)},e.finishSizePrefixedKeepRequestBuffer=function(t,e){t.finish(e,void 0,!0)},e.createKeepRequest=function(t,r,n){return e.startKeepRequest(t),e.addPeer(t,r),e.addRess(t,n),e.endKeepRequest(t)},e}();t.KeepRequest=e}(Pt||(Pt={}));var It,Lt=function(){function t(t,e){this.rid_="",this.m3u8url_="",this.http_request_=new vt(this.callback.bind(this)),this.rid_=t,this.m3u8url_=e,this.retry_cn_=0,this.is_first_address_=!0,this.realtime_logmonitor_=new Tt,this.databuffer_=null}return t.prototype.request=function(){S.log("[address][request]rid:",this.rid_);var t=e.protocal_net_timeout_ms_;if(this.databuffer_||(this.databuffer_=this.getRequestData()),this.databuffer_){var r=Rt.csnURL+"/address?rid="+this.rid_;this.http_request_.post(r,t,this.databuffer_,"fb")}},t.prototype.getRequestData=function(){if(wt.isEmpty(this.rid_)||wt.isEmpty(this.m3u8url_))return S.error("[address][req]arg error, rid:",this.rid_," m3u8url:",this.m3u8url_),null;var t=new Et.Builder(1024);try{var r=t.createString("0");Pt.Peer.startPeer(t),Pt.Peer.addPid(t,Pt.PeerId.createPeerId(t,wt.get_peerid_v1(e.pcdn_peer_id_),wt.get_peerid_v2(e.pcdn_peer_id_),wt.get_peerid_v3(e.pcdn_peer_id_))),Pt.Peer.addPeerAbility(t,e.ability_val_hls_vod_),Pt.Peer.addNetAbility(t,e.live_net_ability_),Pt.Peer.addVersion(t,wt.GetVersionULong()),Pt.Peer.addAsn(t,e.asn_code_),Pt.Peer.addLoc(t,wt.getLocationULong()),Pt.Peer.addPeerLevel(t,e.peer_level_),Pt.Peer.addQuality(t,e.live_peer_quality_),Pt.Peer.addAddressInfo(t,r),Pt.Peer.addPublished(t,!1);var n=Pt.Peer.endPeer(t),i=wt.getDomin(this.m3u8url_),o=t.createString(i);Pt.Resource.startResource(t),Pt.Resource.addRid(t,Pt.Rid.createRid(t,wt.get_rid_v1(this.rid_),wt.get_rid_v2(this.rid_),wt.get_rid_v3(this.rid_),wt.get_rid_v4(this.rid_))),Pt.Resource.addDomain(t,o),Pt.Resource.addServiceType(t,e.vod_server_type_);var s=Pt.Resource.endResource(t),a=t.createString("0"),c=t.createString("0"),u=t.createString(e.oid_);Pt.AddressRequest.startAddressRequest(t),Pt.AddressRequest.addUuid(t,ht.NumberToULong(0)),Pt.AddressRequest.addPeer(t,n),Pt.AddressRequest.addRes(t,s),Pt.AddressRequest.addOid(t,u),Pt.AddressRequest.addBakMaxCnt(t,e.live_bak_max_cnt_),Pt.AddressRequest.addFirstAddr(t,this.is_first_address_),Pt.AddressRequest.addVid(t,a),Pt.AddressRequest.addStreamtype(t,c);var h=Pt.AddressRequest.endAddressRequest(t);return t.finish(h),t.asUint8Array()}catch(ae){var d={logtype:_t.ERROR,subtype:pt.DEFAULT,errcode:lt.ADDRESS_ARG_ERR,ext:ae};this.realtime_logmonitor_.request(d)}return null},t.prototype.tryAddress=function(){return this.retry_cn_<1?(++this.retry_cn_,S.log("[address]retry...",this.retry_cn_),this.request(),0):-1},t.prototype.callback=function(r,n){var i=-1;if(null==r){this.is_first_address_=!1;try{var o=new Uint8Array(n),s=new Et.ByteBuffer(o),a=Pt.AddressResponse.getRootAsAddressResponse(s);if(null!=a){for(var c=new Set,u=e.can_use_edge(),h=0;h<a.peersLength();h++){var d=this.getPeers(a.peers(h)).pid;e.pcdn_peer_id_!=d&&("E00"===d.substr(0,3)||u&&dt.isEdgePeer(d))&&c.add(d)}i=c.size,1==a.peakmode()||e.force_peakmode_||Rt.MAIN_DOMAIN==Rt.INTER_DOMAIN?e.peakmode_=1:e.peakmode_=0,S.log("[address]callback,rid:",this.rid_,",peerCn:",i,",peakmode:",e.peakmode_);try{t.P2PManager.instance().emit(T.ADDRESS,this.rid_,c)}catch(ae){S.error("[address][callback]emit e.",ae)}}else S.error("[address][callback]null.")}catch(ae){S.log("[address][callback]fb error:",ae,"body:",n)}}else{var l={logtype:_t.ERROR,subtype:pt.DEFAULT,errcode:lt.ADDRESS_STATUS_ERR,ext:r};this.realtime_logmonitor_.request(l),"timeout"==r?S.error("[address][callback]timeout"):S.log("[address][callback]net error, status: ",r),null!=this.rid_&&this.tryAddress()}-1!=i&&Tt.reportAdress(this.rid_,i)},t.prototype.getPeers=function(t){return{pid:wt.get_peerid_to_string(t.pid()),peerAbility:t.peerAbility(),netAbility:t.netAbility(),version:t.version(),asn:t.asn(),loc:t.loc(),peerLevel:t.peerLevel(),quality:t.quality(),addressInfo:t.addressInfo(),published:t.published()}},t}(),Mt=function(){function t(t){this.isPublish_=t,this.http_request_=new vt(this.callback.bind(this)),this.realtime_logmonitor_=new Tt}return t.prototype.request=function(t){var r=e.protocal_net_timeout_ms_,n=this.getRequestData(t),i=Rt.csnURL+(this.isPublish_?"/publish":"/unPublish");S.is_debug()&&S.log(this.isPublish_?"[publish]..":"[unpublish]",", peerid:",e.pcdn_peer_id_,", rids:",t),this.http_request_.post(i,r,n,"fb")},t.prototype.getRequestData=function(t){var r=new Et.Builder(1024);try{var n=r.createString("");Pt.Peer.startPeer(r),Pt.Peer.addPid(r,Pt.PeerId.createPeerId(r,wt.get_peerid_v1(e.pcdn_peer_id_),wt.get_peerid_v2(e.pcdn_peer_id_),wt.get_peerid_v3(e.pcdn_peer_id_)));var i=Pt.Peer;i.addPeerAbility(r,e.ability_val_hls_vod_),i.addNetAbility(r,e.live_net_ability_),i.addVersion(r,wt.GetVersionULong()),i.addAsn(r,e.asn_code_),i.addLoc(r,wt.getLocationULong()),i.addPeerLevel(r,e.peer_level_),i.addQuality(r,e.live_peer_quality_),i.addAddressInfo(r,n),i.addPublished(r,!1);var o=i.endPeer(r),s=[];if(t.forEach((function(t,n,i){var o=r.createString(""),a=Pt.Resource;a.startResource(r),a.addRid(r,Pt.Rid.createRid(r,wt.get_rid_v1(t),wt.get_rid_v2(t),wt.get_rid_v3(t),wt.get_rid_v4(t))),a.addDomain(r,o),a.addServiceType(r,e.vod_server_type_);var c=a.endResource(r);s.push(c)})),this.isPublish_){var a=Pt.PublishRequest.createRessVector(r,s);Pt.PublishRequest.startPublishRequest(r),Pt.PublishRequest.addPeer(r,o),Pt.PublishRequest.addRess(r,a);var c=Pt.PublishRequest.endPublishRequest(r);r.finish(c)}else{a=Pt.UnPublishRequest.createRessVector(r,s);Pt.UnPublishRequest.startUnPublishRequest(r),Pt.UnPublishRequest.addPeer(r,o),Pt.UnPublishRequest.addRess(r,a);c=Pt.UnPublishRequest.endUnPublishRequest(r);r.finish(c)}}catch(ae){var u={logtype:_t.ERROR,subtype:pt.DEFAULT,errcode:lt.PUBLISH_ARG_ERR,ext:ae};S.error("[publish] report PUBLISH_ARG_ERR."),this.realtime_logmonitor_.request(u)}return r.asUint8Array()},t.prototype.callback=function(t,e){if(null==t)if(this.isPublish_)try{var r=new Uint8Array(e),n=new Et.ByteBuffer(r),i=Pt.PublishResponse.getRootAsPublishResponse(n);if(null!=i){var o=i.ressLength();S.log("[publish][callback]n=",o)}else S.error("[publish][callback]empty.")}catch(ae){S.log("[publish][callback]fb error:",ae)}else try{r=new Uint8Array(e),n=new Et.ByteBuffer(r);var s=Pt.UnPublishResponse.getRootAsUnPublishResponse(n);if(null!=s){o=s.ressLength();S.log("[unpublish][callback]n=",o)}else S.error("[unpublish][callback]empty.")}catch(ae){S.log("[unpublish][callback]fb error:",ae)}else{var a={logtype:_t.ERROR,subtype:pt.DEFAULT,errcode:this.isPublish_?lt.PUBLISH_STATUS_ERR:lt.UNPUBLISH_STATUS_ERR,ext:t};this.realtime_logmonitor_.request(a),"timeout"==t?S.warn("[publish][callback]timeout, isUnpublish:",!this.isPublish_):S.warn("[publish][callback]net error, isUnpublish:",!this.isPublish_)}},t}(),kt=k(A((function(t,e){t.exports=function(){function t(e,r,n){function i(s,a){if(!r[s]){if(!e[s]){if(!a&&B)return B();if(o)return o(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var u=r[s]={exports:{}};e[s][0].call(u.exports,(function(t){return i(e[s][1][t]||t)}),u,u.exports,t,e,r,n)}return r[s].exports}for(var o=B,s=0;s<n.length;s++)i(n[s]);return i}return t}()({1:[function(t,e,r){var n=(0,t("./adapter_factory.js").adapterFactory)({window:"undefined"==typeof window?void 0:window});e.exports=n},{"./adapter_factory.js":2}],2:[function(t,e,r){Object.defineProperty(r,"__esModule",{value:!0}),r.adapterFactory=h;var n=u(t("./utils")),i=u(t("./chrome/chrome_shim")),o=u(t("./edge/edge_shim")),s=u(t("./firefox/firefox_shim")),a=u(t("./safari/safari_shim")),c=u(t("./common_shim"));function u(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}function h(){var t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).window,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0},r=n.log,u=n.detectBrowser(t),h={browserDetails:u,commonShim:c,extractVersion:n.extractVersion,disableLog:n.disableLog,disableWarnings:n.disableWarnings};switch(u.browser){case"chrome":if(!i||!i.shimPeerConnection||!e.shimChrome)return r("Chrome shim is not included in this adapter release."),h;if(null===u.version)return r("Chrome shim can not determine version, not shimming."),h;r("adapter.js shimming chrome."),h.browserShim=i,c.shimAddIceCandidateNullOrEmpty(t,u),i.shimGetUserMedia(t,u),i.shimMediaStream(t,u),i.shimPeerConnection(t,u),i.shimOnTrack(t,u),i.shimAddTrackRemoveTrack(t,u),i.shimGetSendersWithDtmf(t,u),i.shimGetStats(t,u),i.shimSenderReceiverGetStats(t,u),i.fixNegotiationNeeded(t,u),c.shimRTCIceCandidate(t,u),c.shimConnectionState(t,u),c.shimMaxMessageSize(t,u),c.shimSendThrowTypeError(t,u),c.removeExtmapAllowMixed(t,u);break;case"firefox":if(!s||!s.shimPeerConnection||!e.shimFirefox)return r("Firefox shim is not included in this adapter release."),h;r("adapter.js shimming firefox."),h.browserShim=s,c.shimAddIceCandidateNullOrEmpty(t,u),s.shimGetUserMedia(t,u),s.shimPeerConnection(t,u),s.shimOnTrack(t,u),s.shimRemoveStream(t,u),s.shimSenderGetStats(t,u),s.shimReceiverGetStats(t,u),s.shimRTCDataChannel(t,u),s.shimAddTransceiver(t,u),s.shimGetParameters(t,u),s.shimCreateOffer(t,u),s.shimCreateAnswer(t,u),c.shimRTCIceCandidate(t,u),c.shimConnectionState(t,u),c.shimMaxMessageSize(t,u),c.shimSendThrowTypeError(t,u);break;case"edge":if(!o||!o.shimPeerConnection||!e.shimEdge)return r("MS edge shim is not included in this adapter release."),h;r("adapter.js shimming edge."),h.browserShim=o,o.shimGetUserMedia(t,u),o.shimGetDisplayMedia(t,u),o.shimPeerConnection(t,u),o.shimReplaceTrack(t,u),c.shimMaxMessageSize(t,u),c.shimSendThrowTypeError(t,u);break;case"safari":if(!a||!e.shimSafari)return r("Safari shim is not included in this adapter release."),h;r("adapter.js shimming safari."),h.browserShim=a,c.shimAddIceCandidateNullOrEmpty(t,u),a.shimRTCIceServerUrls(t,u),a.shimCreateOfferLegacy(t,u),a.shimCallbacksAPI(t,u),a.shimLocalStreamsAPI(t,u),a.shimRemoteStreamsAPI(t,u),a.shimTrackEventTransceiver(t,u),a.shimGetUserMedia(t,u),a.shimAudioContext(t,u),c.shimRTCIceCandidate(t,u),c.shimMaxMessageSize(t,u),c.shimSendThrowTypeError(t,u),c.removeExtmapAllowMixed(t,u);break;default:r("Unsupported browser!")}return h}},{"./chrome/chrome_shim":3,"./common_shim":6,"./edge/edge_shim":12,"./firefox/firefox_shim":7,"./safari/safari_shim":10,"./utils":11}],3:[function(t,e,r){Object.defineProperty(r,"__esModule",{value:!0}),r.shimGetDisplayMedia=r.shimGetUserMedia=void 0;var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i=t("./getusermedia");Object.defineProperty(r,"shimGetUserMedia",{enumerable:!0,get:function(){return i.shimGetUserMedia}});var o=t("./getdisplaymedia");Object.defineProperty(r,"shimGetDisplayMedia",{enumerable:!0,get:function(){return o.shimGetDisplayMedia}}),r.shimMediaStream=u,r.shimOnTrack=h,r.shimGetSendersWithDtmf=d,r.shimGetStats=l,r.shimSenderReceiverGetStats=_,r.shimAddTrackRemoveTrackWithNative=p,r.shimAddTrackRemoveTrack=f,r.shimPeerConnection=b,r.fixNegotiationNeeded=g;var s=a(t("../utils.js"));function a(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}function c(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function u(t){t.MediaStream=t.MediaStream||t.webkitMediaStream}function h(t){if("object"===(void 0===t?"undefined":n(t))&&t.RTCPeerConnection&&!("ontrack"in t.RTCPeerConnection.prototype)){Object.defineProperty(t.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(t){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=t)},enumerable:!0,configurable:!0});var e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){var r=this;return this._ontrackpoly||(this._ontrackpoly=function(e){e.stream.addEventListener("addtrack",(function(n){var i=void 0;i=t.RTCPeerConnection.prototype.getReceivers?r.getReceivers().find((function(t){return t.track&&t.track.id===n.track.id})):{track:n.track};var o=new Event("track");o.track=n.track,o.receiver=i,o.transceiver={receiver:i},o.streams=[e.stream],r.dispatchEvent(o)})),e.stream.getTracks().forEach((function(n){var i=void 0;i=t.RTCPeerConnection.prototype.getReceivers?r.getReceivers().find((function(t){return t.track&&t.track.id===n.id})):{track:n};var o=new Event("track");o.track=n,o.receiver=i,o.transceiver={receiver:i},o.streams=[e.stream],r.dispatchEvent(o)}))},this.addEventListener("addstream",this._ontrackpoly)),e.apply(this,arguments)}}else s.wrapPeerConnectionEvent(t,"track",(function(t){return t.transceiver||Object.defineProperty(t,"transceiver",{value:{receiver:t.receiver}}),t}))}function d(t){if("object"===(void 0===t?"undefined":n(t))&&t.RTCPeerConnection&&!("getSenders"in t.RTCPeerConnection.prototype)&&"createDTMFSender"in t.RTCPeerConnection.prototype){var e=function(t,e){return{track:e,get dtmf(){return void 0===this._dtmf&&("audio"===e.kind?this._dtmf=t.createDTMFSender(e):this._dtmf=null),this._dtmf},_pc:t}};if(!t.RTCPeerConnection.prototype.getSenders){t.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};var r=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(t,n){var i=r.apply(this,arguments);return i||(i=e(this,t),this._senders.push(i)),i};var i=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(t){i.apply(this,arguments);var e=this._senders.indexOf(t);-1!==e&&this._senders.splice(e,1)}}var o=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(t){var r=this;this._senders=this._senders||[],o.apply(this,[t]),t.getTracks().forEach((function(t){r._senders.push(e(r,t))}))};var s=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(t){var e=this;this._senders=this._senders||[],s.apply(this,[t]),t.getTracks().forEach((function(t){var r=e._senders.find((function(e){return e.track===t}));r&&e._senders.splice(e._senders.indexOf(r),1)}))}}else if("object"===(void 0===t?"undefined":n(t))&&t.RTCPeerConnection&&"getSenders"in t.RTCPeerConnection.prototype&&"createDTMFSender"in t.RTCPeerConnection.prototype&&t.RTCRtpSender&&!("dtmf"in t.RTCRtpSender.prototype)){var a=t.RTCPeerConnection.prototype.getSenders;t.RTCPeerConnection.prototype.getSenders=function(){var t=this,e=a.apply(this,[]);return e.forEach((function(e){return e._pc=t})),e},Object.defineProperty(t.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function l(t){if(t.RTCPeerConnection){var e=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){var t=this,r=Array.prototype.slice.call(arguments),n=r[0],i=r[1],o=r[2];if(arguments.length>0&&"function"==typeof n)return e.apply(this,arguments);if(0===e.length&&(0===arguments.length||"function"!=typeof n))return e.apply(this,[]);var s=function(t){var e={};return t.result().forEach((function(t){var r={id:t.id,timestamp:t.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[t.type]||t.type};t.names().forEach((function(e){r[e]=t.stat(e)})),e[r.id]=r})),e},a=function(t){return new Map(Object.keys(t).map((function(e){return[e,t[e]]})))};if(arguments.length>=2){var c=function(t){i(a(s(t)))};return e.apply(this,[c,n])}return new Promise((function(r,n){e.apply(t,[function(t){r(a(s(t)))},n])})).then(i,o)}}}function _(t){if("object"===(void 0===t?"undefined":n(t))&&t.RTCPeerConnection&&t.RTCRtpSender&&t.RTCRtpReceiver){if(!("getStats"in t.RTCRtpSender.prototype)){var e=t.RTCPeerConnection.prototype.getSenders;e&&(t.RTCPeerConnection.prototype.getSenders=function(){var t=this,r=e.apply(this,[]);return r.forEach((function(e){return e._pc=t})),r});var r=t.RTCPeerConnection.prototype.addTrack;r&&(t.RTCPeerConnection.prototype.addTrack=function(){var t=r.apply(this,arguments);return t._pc=this,t}),t.RTCRtpSender.prototype.getStats=function(){var t=this;return this._pc.getStats().then((function(e){return s.filterStats(e,t.track,!0)}))}}if(!("getStats"in t.RTCRtpReceiver.prototype)){var i=t.RTCPeerConnection.prototype.getReceivers;i&&(t.RTCPeerConnection.prototype.getReceivers=function(){var t=this,e=i.apply(this,[]);return e.forEach((function(e){return e._pc=t})),e}),s.wrapPeerConnectionEvent(t,"track",(function(t){return t.receiver._pc=t.srcElement,t})),t.RTCRtpReceiver.prototype.getStats=function(){var t=this;return this._pc.getStats().then((function(e){return s.filterStats(e,t.track,!1)}))}}if("getStats"in t.RTCRtpSender.prototype&&"getStats"in t.RTCRtpReceiver.prototype){var o=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof t.MediaStreamTrack){var e=arguments[0],r=void 0,n=void 0,i=void 0;return this.getSenders().forEach((function(t){t.track===e&&(r?i=!0:r=t)})),this.getReceivers().forEach((function(t){return t.track===e&&(n?i=!0:n=t),t.track===e})),i||r&&n?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):r?r.getStats():n?n.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return o.apply(this,arguments)}}}}function p(t){t.RTCPeerConnection.prototype.getLocalStreams=function(){var t=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map((function(e){return t._shimmedLocalStreams[e][0]}))};var e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(t,r){if(!r)return e.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};var n=e.apply(this,arguments);return this._shimmedLocalStreams[r.id]?-1===this._shimmedLocalStreams[r.id].indexOf(n)&&this._shimmedLocalStreams[r.id].push(n):this._shimmedLocalStreams[r.id]=[r,n],n};var r=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(t){var e=this;this._shimmedLocalStreams=this._shimmedLocalStreams||{},t.getTracks().forEach((function(t){if(e.getSenders().find((function(e){return e.track===t})))throw new DOMException("Track already exists.","InvalidAccessError")}));var n=this.getSenders();r.apply(this,arguments);var i=this.getSenders().filter((function(t){return-1===n.indexOf(t)}));this._shimmedLocalStreams[t.id]=[t].concat(i)};var n=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(t){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[t.id],n.apply(this,arguments)};var i=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(t){var e=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},t&&Object.keys(this._shimmedLocalStreams).forEach((function(r){var n=e._shimmedLocalStreams[r].indexOf(t);-1!==n&&e._shimmedLocalStreams[r].splice(n,1),1===e._shimmedLocalStreams[r].length&&delete e._shimmedLocalStreams[r]})),i.apply(this,arguments)}}function f(t,e){if(t.RTCPeerConnection){if(t.RTCPeerConnection.prototype.addTrack&&e.version>=65)return p(t);var r=t.RTCPeerConnection.prototype.getLocalStreams;t.RTCPeerConnection.prototype.getLocalStreams=function(){var t=this,e=r.apply(this);return this._reverseStreams=this._reverseStreams||{},e.map((function(e){return t._reverseStreams[e.id]}))};var n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(e){var r=this;if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},e.getTracks().forEach((function(t){if(r.getSenders().find((function(e){return e.track===t})))throw new DOMException("Track already exists.","InvalidAccessError")})),!this._reverseStreams[e.id]){var i=new t.MediaStream(e.getTracks());this._streams[e.id]=i,this._reverseStreams[i.id]=e,e=i}n.apply(this,[e])};var i=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(t){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},i.apply(this,[this._streams[t.id]||t]),delete this._reverseStreams[this._streams[t.id]?this._streams[t.id].id:t.id],delete this._streams[t.id]},t.RTCPeerConnection.prototype.addTrack=function(e,r){var n=this;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var i=[].slice.call(arguments,1);if(1!==i.length||!i[0].getTracks().find((function(t){return t===e})))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find((function(t){return t.track===e})))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};var o=this._streams[r.id];if(o)o.addTrack(e),Promise.resolve().then((function(){n.dispatchEvent(new Event("negotiationneeded"))}));else{var s=new t.MediaStream([e]);this._streams[r.id]=s,this._reverseStreams[s.id]=r,this.addStream(s)}return this.getSenders().find((function(t){return t.track===e}))},["createOffer","createAnswer"].forEach((function(e){var r=t.RTCPeerConnection.prototype[e],n=c({},e,(function(){var t=this,e=arguments;return arguments.length&&"function"==typeof arguments[0]?r.apply(this,[function(r){var n=a(t,r);e[0].apply(null,[n])},function(t){e[1]&&e[1].apply(null,t)},arguments[2]]):r.apply(this,arguments).then((function(e){return a(t,e)}))}));t.RTCPeerConnection.prototype[e]=n[e]}));var o=t.RTCPeerConnection.prototype.setLocalDescription;t.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=u(this,arguments[0]),o.apply(this,arguments)):o.apply(this,arguments)};var s=Object.getOwnPropertyDescriptor(t.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(t.RTCPeerConnection.prototype,"localDescription",{get:function(){var t=s.get.apply(this);return""===t.type?t:a(this,t)}}),t.RTCPeerConnection.prototype.removeTrack=function(t){var e=this;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!t._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(t._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};var r=void 0;Object.keys(this._streams).forEach((function(n){e._streams[n].getTracks().find((function(e){return t.track===e}))&&(r=e._streams[n])})),r&&(1===r.getTracks().length?this.removeStream(this._reverseStreams[r.id]):r.removeTrack(t.track),this.dispatchEvent(new Event("negotiationneeded")))}}function a(t,e){var r=e.sdp;return Object.keys(t._reverseStreams||[]).forEach((function(e){var n=t._reverseStreams[e],i=t._streams[n.id];r=r.replace(new RegExp(i.id,"g"),n.id)})),new RTCSessionDescription({type:e.type,sdp:r})}function u(t,e){var r=e.sdp;return Object.keys(t._reverseStreams||[]).forEach((function(e){var n=t._reverseStreams[e],i=t._streams[n.id];r=r.replace(new RegExp(n.id,"g"),i.id)})),new RTCSessionDescription({type:e.type,sdp:r})}}function b(t,e){!t.RTCPeerConnection&&t.webkitRTCPeerConnection&&(t.RTCPeerConnection=t.webkitRTCPeerConnection),t.RTCPeerConnection&&e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(e){var r=t.RTCPeerConnection.prototype[e],n=c({},e,(function(){return arguments[0]=new("addIceCandidate"===e?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}));t.RTCPeerConnection.prototype[e]=n[e]}))}function g(t,e){s.wrapPeerConnectionEvent(t,"negotiationneeded",(function(t){var r=t.target;if(!(e.version<72||r.getConfiguration&&"plan-b"===r.getConfiguration().sdpSemantics)||"stable"===r.signalingState)return t}))}},{"../utils.js":11,"./getdisplaymedia":4,"./getusermedia":5}],4:[function(t,e,r){function n(t,e){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&("function"==typeof e?t.navigator.mediaDevices.getDisplayMedia=function(r){return e(r).then((function(e){var n=r.video&&r.video.width,i=r.video&&r.video.height,o=r.video&&r.video.frameRate;return r.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxFrameRate:o||3}},n&&(r.video.mandatory.maxWidth=n),i&&(r.video.mandatory.maxHeight=i),t.navigator.mediaDevices.getUserMedia(r)}))}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))}Object.defineProperty(r,"__esModule",{value:!0}),r.shimGetDisplayMedia=n},{}],5:[function(t,e,r){Object.defineProperty(r,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};function i(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}r.shimGetUserMedia=s;var o=i(t("../utils.js")).log;function s(t,e){var r=t&&t.navigator;if(r.mediaDevices){var i=function(t){if("object"!==(void 0===t?"undefined":n(t))||t.mandatory||t.optional)return t;var e={};return Object.keys(t).forEach((function(r){if("require"!==r&&"advanced"!==r&&"mediaSource"!==r){var i="object"===n(t[r])?t[r]:{ideal:t[r]};void 0!==i.exact&&"number"==typeof i.exact&&(i.min=i.max=i.exact);var o=function(t,e){return t?t+e.charAt(0).toUpperCase()+e.slice(1):"deviceId"===e?"sourceId":e};if(void 0!==i.ideal){e.optional=e.optional||[];var s={};"number"==typeof i.ideal?(s[o("min",r)]=i.ideal,e.optional.push(s),(s={})[o("max",r)]=i.ideal,e.optional.push(s)):(s[o("",r)]=i.ideal,e.optional.push(s))}void 0!==i.exact&&"number"!=typeof i.exact?(e.mandatory=e.mandatory||{},e.mandatory[o("",r)]=i.exact):["min","max"].forEach((function(t){void 0!==i[t]&&(e.mandatory=e.mandatory||{},e.mandatory[o(t,r)]=i[t])}))}})),t.advanced&&(e.optional=(e.optional||[]).concat(t.advanced)),e},s=function(t,s){if(e.version>=61)return s(t);if((t=JSON.parse(JSON.stringify(t)))&&"object"===n(t.audio)){var a=function(t,e,r){e in t&&!(r in t)&&(t[r]=t[e],delete t[e])};a((t=JSON.parse(JSON.stringify(t))).audio,"autoGainControl","googAutoGainControl"),a(t.audio,"noiseSuppression","googNoiseSuppression"),t.audio=i(t.audio)}if(t&&"object"===n(t.video)){var c=t.video.facingMode;c=c&&("object"===(void 0===c?"undefined":n(c))?c:{ideal:c});var u=e.version<66;if(c&&("user"===c.exact||"environment"===c.exact||"user"===c.ideal||"environment"===c.ideal)&&(!r.mediaDevices.getSupportedConstraints||!r.mediaDevices.getSupportedConstraints().facingMode||u)){delete t.video.facingMode;var h=void 0;if("environment"===c.exact||"environment"===c.ideal?h=["back","rear"]:"user"!==c.exact&&"user"!==c.ideal||(h=["front"]),h)return r.mediaDevices.enumerateDevices().then((function(e){var r=(e=e.filter((function(t){return"videoinput"===t.kind}))).find((function(t){return h.some((function(e){return t.label.toLowerCase().includes(e)}))}));return!r&&e.length&&h.includes("back")&&(r=e[e.length-1]),r&&(t.video.deviceId=c.exact?{exact:r.deviceId}:{ideal:r.deviceId}),t.video=i(t.video),o("chrome: "+JSON.stringify(t)),s(t)}))}t.video=i(t.video)}return o("chrome: "+JSON.stringify(t)),s(t)},a=function(t){return e.version>=64?t:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[t.name]||t.name,message:t.message,constraint:t.constraint||t.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}},c=function(t,e,n){s(t,(function(t){r.webkitGetUserMedia(t,e,(function(t){n&&n(a(t))}))}))};if(r.getUserMedia=c.bind(r),r.mediaDevices.getUserMedia){var u=r.mediaDevices.getUserMedia.bind(r.mediaDevices);r.mediaDevices.getUserMedia=function(t){return s(t,(function(t){return u(t).then((function(e){if(t.audio&&!e.getAudioTracks().length||t.video&&!e.getVideoTracks().length)throw e.getTracks().forEach((function(t){t.stop()})),new DOMException("","NotFoundError");return e}),(function(t){return Promise.reject(a(t))}))}))}}}}},{"../utils.js":11}],6:[function(t,e,r){Object.defineProperty(r,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};r.shimRTCIceCandidate=c,r.shimMaxMessageSize=u,r.shimSendThrowTypeError=h,r.shimConnectionState=d,r.removeExtmapAllowMixed=l,r.shimAddIceCandidateNullOrEmpty=_;var i=a(t("sdp")),o=s(t("./utils"));function s(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}function a(t){return t&&t.__esModule?t:{default:t}}function c(t){if(!(!t.RTCIceCandidate||t.RTCIceCandidate&&"foundation"in t.RTCIceCandidate.prototype)){var e=t.RTCIceCandidate;t.RTCIceCandidate=function(t){if("object"===(void 0===t?"undefined":n(t))&&t.candidate&&0===t.candidate.indexOf("a=")&&((t=JSON.parse(JSON.stringify(t))).candidate=t.candidate.substr(2)),t.candidate&&t.candidate.length){var r=new e(t),o=i.default.parseCandidate(t.candidate),s=Object.assign(r,o);return s.toJSON=function(){return{candidate:s.candidate,sdpMid:s.sdpMid,sdpMLineIndex:s.sdpMLineIndex,usernameFragment:s.usernameFragment}},s}return new e(t)},t.RTCIceCandidate.prototype=e.prototype,o.wrapPeerConnectionEvent(t,"icecandidate",(function(e){return e.candidate&&Object.defineProperty(e,"candidate",{value:new t.RTCIceCandidate(e.candidate),writable:"false"}),e}))}}function u(t,e){if(t.RTCPeerConnection){"sctp"in t.RTCPeerConnection.prototype||Object.defineProperty(t.RTCPeerConnection.prototype,"sctp",{get:function(){return void 0===this._sctp?null:this._sctp}});var r=function(t){if(!t||!t.sdp)return!1;var e=i.default.splitSections(t.sdp);return e.shift(),e.some((function(t){var e=i.default.parseMLine(t);return e&&"application"===e.kind&&-1!==e.protocol.indexOf("SCTP")}))},n=function(t){var e=t.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===e||e.length<2)return-1;var r=parseInt(e[1],10);return r!=r?-1:r},o=function(t){var r=65536;return"firefox"===e.browser&&(r=e.version<57?-1===t?16384:2147483637:e.version<60?57===e.version?65535:65536:2147483637),r},s=function(t,r){var n=65536;"firefox"===e.browser&&57===e.version&&(n=65535);var o=i.default.matchPrefix(t.sdp,"a=max-message-size:");return o.length>0?n=parseInt(o[0].substr(19),10):"firefox"===e.browser&&-1!==r&&(n=2147483637),n},a=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,"chrome"===e.browser&&e.version>=76&&"plan-b"===this.getConfiguration().sdpSemantics&&Object.defineProperty(this,"sctp",{get:function(){return void 0===this._sctp?null:this._sctp},enumerable:!0,configurable:!0}),r(arguments[0])){var t=n(arguments[0]),i=o(t),c=s(arguments[0],t),u=void 0;u=0===i&&0===c?Number.POSITIVE_INFINITY:0===i||0===c?Math.max(i,c):Math.min(i,c);var h={};Object.defineProperty(h,"maxMessageSize",{get:function(){return u}}),this._sctp=h}return a.apply(this,arguments)}}}function h(t){if(t.RTCPeerConnection&&"createDataChannel"in t.RTCPeerConnection.prototype){var e=t.RTCPeerConnection.prototype.createDataChannel;t.RTCPeerConnection.prototype.createDataChannel=function(){var t=e.apply(this,arguments);return r(t,this),t},o.wrapPeerConnectionEvent(t,"datachannel",(function(t){return r(t.channel,t.target),t}))}function r(t,e){var r=t.send;t.send=function(){var n=arguments[0],i=n.length||n.size||n.byteLength;if("open"===t.readyState&&e.sctp&&i>e.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+e.sctp.maxMessageSize+" bytes)");return r.apply(t,arguments)}}}function d(t){if(t.RTCPeerConnection&&!("connectionState"in t.RTCPeerConnection.prototype)){var e=t.RTCPeerConnection.prototype;Object.defineProperty(e,"connectionState",{get:function(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(e,"onconnectionstatechange",{get:function(){return this._onconnectionstatechange||null},set:function(t){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),t&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=t)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach((function(t){var r=e[t];e[t]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=function(t){var e=t.target;if(e._lastConnectionState!==e.connectionState){e._lastConnectionState=e.connectionState;var r=new Event("connectionstatechange",t);e.dispatchEvent(r)}return t},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),r.apply(this,arguments)}}))}}function l(t,e){if(t.RTCPeerConnection&&!("chrome"===e.browser&&e.version>=71||"safari"===e.browser&&e.version>=605)){var r=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(e){if(e&&e.sdp&&-1!==e.sdp.indexOf("\na=extmap-allow-mixed")){var n=e.sdp.split("\n").filter((function(t){return"a=extmap-allow-mixed"!==t.trim()})).join("\n");t.RTCSessionDescription&&e instanceof t.RTCSessionDescription?arguments[0]=new t.RTCSessionDescription({type:e.type,sdp:n}):e.sdp=n}return r.apply(this,arguments)}}}function _(t,e){if(t.RTCPeerConnection&&t.RTCPeerConnection.prototype){var r=t.RTCPeerConnection.prototype.addIceCandidate;r&&0!==r.length&&(t.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?("chrome"===e.browser&&e.version<78||"firefox"===e.browser&&e.version<68||"safari"===e.browser)&&arguments[0]&&""===arguments[0].candidate?Promise.resolve():r.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}}},{"./utils":11,sdp:13}],7:[function(t,e,r){Object.defineProperty(r,"__esModule",{value:!0}),r.shimGetDisplayMedia=r.shimGetUserMedia=void 0;var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i=t("./getusermedia");Object.defineProperty(r,"shimGetUserMedia",{enumerable:!0,get:function(){return i.shimGetUserMedia}});var o=t("./getdisplaymedia");Object.defineProperty(r,"shimGetDisplayMedia",{enumerable:!0,get:function(){return o.shimGetDisplayMedia}}),r.shimOnTrack=u,r.shimPeerConnection=h,r.shimSenderGetStats=d,r.shimReceiverGetStats=l,r.shimRemoveStream=_,r.shimRTCDataChannel=p,r.shimAddTransceiver=f,r.shimGetParameters=b,r.shimCreateOffer=g,r.shimCreateAnswer=m;var s=a(t("../utils"));function a(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}function c(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function u(t){"object"===(void 0===t?"undefined":n(t))&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})}function h(t,e){if("object"===(void 0===t?"undefined":n(t))&&(t.RTCPeerConnection||t.mozRTCPeerConnection)){!t.RTCPeerConnection&&t.mozRTCPeerConnection&&(t.RTCPeerConnection=t.mozRTCPeerConnection),e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(e){var r=t.RTCPeerConnection.prototype[e],n=c({},e,(function(){return arguments[0]=new("addIceCandidate"===e?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}));t.RTCPeerConnection.prototype[e]=n[e]}));var r={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},i=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){var t=Array.prototype.slice.call(arguments),n=t[0],o=t[1],s=t[2];return i.apply(this,[n||null]).then((function(t){if(e.version<53&&!o)try{t.forEach((function(t){t.type=r[t.type]||t.type}))}catch(ae){if("TypeError"!==ae.name)throw ae;t.forEach((function(e,n){t.set(n,Object.assign({},e,{type:r[e.type]||e.type}))}))}return t})).then(o,s)}}}function d(t){if("object"===(void 0===t?"undefined":n(t))&&t.RTCPeerConnection&&t.RTCRtpSender&&(!t.RTCRtpSender||!("getStats"in t.RTCRtpSender.prototype))){var e=t.RTCPeerConnection.prototype.getSenders;e&&(t.RTCPeerConnection.prototype.getSenders=function(){var t=this,r=e.apply(this,[]);return r.forEach((function(e){return e._pc=t})),r});var r=t.RTCPeerConnection.prototype.addTrack;r&&(t.RTCPeerConnection.prototype.addTrack=function(){var t=r.apply(this,arguments);return t._pc=this,t}),t.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}}function l(t){if("object"===(void 0===t?"undefined":n(t))&&t.RTCPeerConnection&&t.RTCRtpSender&&(!t.RTCRtpSender||!("getStats"in t.RTCRtpReceiver.prototype))){var e=t.RTCPeerConnection.prototype.getReceivers;e&&(t.RTCPeerConnection.prototype.getReceivers=function(){var t=this,r=e.apply(this,[]);return r.forEach((function(e){return e._pc=t})),r}),s.wrapPeerConnectionEvent(t,"track",(function(t){return t.receiver._pc=t.srcElement,t})),t.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}}function _(t){t.RTCPeerConnection&&!("removeStream"in t.RTCPeerConnection.prototype)&&(t.RTCPeerConnection.prototype.removeStream=function(t){var e=this;s.deprecated("removeStream","removeTrack"),this.getSenders().forEach((function(r){r.track&&t.getTracks().includes(r.track)&&e.removeTrack(r)}))})}function p(t){t.DataChannel&&!t.RTCDataChannel&&(t.RTCDataChannel=t.DataChannel)}function f(t){if("object"===(void 0===t?"undefined":n(t))&&t.RTCPeerConnection){var e=t.RTCPeerConnection.prototype.addTransceiver;e&&(t.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];var t=arguments[1],r=t&&"sendEncodings"in t;r&&t.sendEncodings.forEach((function(t){if("rid"in t&&!/^[a-z0-9]{0,16}$/i.test(t.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in t&&!(parseFloat(t.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in t&&!(parseFloat(t.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")}));var n=e.apply(this,arguments);if(r){var i=n.sender,o=i.getParameters();(!("encodings"in o)||1===o.encodings.length&&0===Object.keys(o.encodings[0]).length)&&(o.encodings=t.sendEncodings,i.sendEncodings=t.sendEncodings,this.setParametersPromises.push(i.setParameters(o).then((function(){delete i.sendEncodings})).catch((function(){delete i.sendEncodings}))))}return n})}}function b(t){if("object"===(void 0===t?"undefined":n(t))&&t.RTCRtpSender){var e=t.RTCRtpSender.prototype.getParameters;e&&(t.RTCRtpSender.prototype.getParameters=function(){var t=e.apply(this,arguments);return"encodings"in t||(t.encodings=[].concat(this.sendEncodings||[{}])),t})}}function g(t){if("object"===(void 0===t?"undefined":n(t))&&t.RTCPeerConnection){var e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(){var t=this,r=arguments;return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((function(){return e.apply(t,r)})).finally((function(){t.setParametersPromises=[]})):e.apply(this,arguments)}}}function m(t){if("object"===(void 0===t?"undefined":n(t))&&t.RTCPeerConnection){var e=t.RTCPeerConnection.prototype.createAnswer;t.RTCPeerConnection.prototype.createAnswer=function(){var t=this,r=arguments;return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((function(){return e.apply(t,r)})).finally((function(){t.setParametersPromises=[]})):e.apply(this,arguments)}}}},{"../utils":11,"./getdisplaymedia":8,"./getusermedia":9}],8:[function(t,e,r){function n(t,e){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(t.navigator.mediaDevices.getDisplayMedia=function(r){if(!r||!r.video){var n=new DOMException("getDisplayMedia without video constraints is undefined");return n.name="NotFoundError",n.code=8,Promise.reject(n)}return!0===r.video?r.video={mediaSource:e}:r.video.mediaSource=e,t.navigator.mediaDevices.getUserMedia(r)})}Object.defineProperty(r,"__esModule",{value:!0}),r.shimGetDisplayMedia=n},{}],9:[function(t,e,r){Object.defineProperty(r,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};r.shimGetUserMedia=s;var i=o(t("../utils"));function o(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}function s(t,e){var r=t&&t.navigator,o=t&&t.MediaStreamTrack;if(r.getUserMedia=function(t,e,n){i.deprecated("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),r.mediaDevices.getUserMedia(t).then(e,n)},!(e.version>55&&"autoGainControl"in r.mediaDevices.getSupportedConstraints())){var s=function(t,e,r){e in t&&!(r in t)&&(t[r]=t[e],delete t[e])},a=r.mediaDevices.getUserMedia.bind(r.mediaDevices);if(r.mediaDevices.getUserMedia=function(t){return"object"===(void 0===t?"undefined":n(t))&&"object"===n(t.audio)&&(t=JSON.parse(JSON.stringify(t)),s(t.audio,"autoGainControl","mozAutoGainControl"),s(t.audio,"noiseSuppression","mozNoiseSuppression")),a(t)},o&&o.prototype.getSettings){var c=o.prototype.getSettings;o.prototype.getSettings=function(){var t=c.apply(this,arguments);return s(t,"mozAutoGainControl","autoGainControl"),s(t,"mozNoiseSuppression","noiseSuppression"),t}}if(o&&o.prototype.applyConstraints){var u=o.prototype.applyConstraints;o.prototype.applyConstraints=function(t){return"audio"===this.kind&&"object"===(void 0===t?"undefined":n(t))&&(t=JSON.parse(JSON.stringify(t)),s(t,"autoGainControl","mozAutoGainControl"),s(t,"noiseSuppression","mozNoiseSuppression")),u.apply(this,[t])}}}}},{"../utils":11}],10:[function(t,e,r){Object.defineProperty(r,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};r.shimLocalStreamsAPI=s,r.shimRemoteStreamsAPI=a,r.shimCallbacksAPI=c,r.shimGetUserMedia=u,r.shimConstraints=h,r.shimRTCIceServerUrls=d,r.shimTrackEventTransceiver=l,r.shimCreateOfferLegacy=_,r.shimAudioContext=p;var i=o(t("../utils"));function o(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}function s(t){if("object"===(void 0===t?"undefined":n(t))&&t.RTCPeerConnection){if("getLocalStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in t.RTCPeerConnection.prototype)){var e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addStream=function(t){var r=this;this._localStreams||(this._localStreams=[]),this._localStreams.includes(t)||this._localStreams.push(t),t.getAudioTracks().forEach((function(n){return e.call(r,n,t)})),t.getVideoTracks().forEach((function(n){return e.call(r,n,t)}))},t.RTCPeerConnection.prototype.addTrack=function(t){for(var r=this,n=arguments.length,i=Array(n>1?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];return i&&i.forEach((function(t){r._localStreams?r._localStreams.includes(t)||r._localStreams.push(t):r._localStreams=[t]})),e.apply(this,arguments)}}"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(t){var e=this;this._localStreams||(this._localStreams=[]);var r=this._localStreams.indexOf(t);if(-1!==r){this._localStreams.splice(r,1);var n=t.getTracks();this.getSenders().forEach((function(t){n.includes(t.track)&&e.removeTrack(t)}))}})}}function a(t){if("object"===(void 0===t?"undefined":n(t))&&t.RTCPeerConnection&&("getRemoteStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in t.RTCPeerConnection.prototype))){Object.defineProperty(t.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(t){var e=this;this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=t),this.addEventListener("track",this._onaddstreampoly=function(t){t.streams.forEach((function(t){if(e._remoteStreams||(e._remoteStreams=[]),!e._remoteStreams.includes(t)){e._remoteStreams.push(t);var r=new Event("addstream");r.stream=t,e.dispatchEvent(r)}}))})}});var e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){var t=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(e){e.streams.forEach((function(e){if(t._remoteStreams||(t._remoteStreams=[]),!(t._remoteStreams.indexOf(e)>=0)){t._remoteStreams.push(e);var r=new Event("addstream");r.stream=e,t.dispatchEvent(r)}}))}),e.apply(t,arguments)}}}function c(t){if("object"===(void 0===t?"undefined":n(t))&&t.RTCPeerConnection){var e=t.RTCPeerConnection.prototype,r=e.createOffer,i=e.createAnswer,o=e.setLocalDescription,s=e.setRemoteDescription,a=e.addIceCandidate;e.createOffer=function(t,e){var n=arguments.length>=2?arguments[2]:arguments[0],i=r.apply(this,[n]);return e?(i.then(t,e),Promise.resolve()):i},e.createAnswer=function(t,e){var r=arguments.length>=2?arguments[2]:arguments[0],n=i.apply(this,[r]);return e?(n.then(t,e),Promise.resolve()):n};var c=function(t,e,r){var n=o.apply(this,[t]);return r?(n.then(e,r),Promise.resolve()):n};e.setLocalDescription=c,c=function(t,e,r){var n=s.apply(this,[t]);return r?(n.then(e,r),Promise.resolve()):n},e.setRemoteDescription=c,c=function(t,e,r){var n=a.apply(this,[t]);return r?(n.then(e,r),Promise.resolve()):n},e.addIceCandidate=c}}function u(t){var e=t&&t.navigator;if(e.mediaDevices&&e.mediaDevices.getUserMedia){var r=e.mediaDevices,n=r.getUserMedia.bind(r);e.mediaDevices.getUserMedia=function(t){return n(h(t))}}!e.getUserMedia&&e.mediaDevices&&e.mediaDevices.getUserMedia&&(e.getUserMedia=function(t,r,n){e.mediaDevices.getUserMedia(t).then(r,n)}.bind(e))}function h(t){return t&&void 0!==t.video?Object.assign({},t,{video:i.compactObject(t.video)}):t}function d(t){if(t.RTCPeerConnection){var e=t.RTCPeerConnection;t.RTCPeerConnection=function(t,r){if(t&&t.iceServers){for(var n=[],o=0;o<t.iceServers.length;o++){var s=t.iceServers[o];!s.hasOwnProperty("urls")&&s.hasOwnProperty("url")?(i.deprecated("RTCIceServer.url","RTCIceServer.urls"),(s=JSON.parse(JSON.stringify(s))).urls=s.url,delete s.url,n.push(s)):n.push(t.iceServers[o])}t.iceServers=n}return new e(t,r)},t.RTCPeerConnection.prototype=e.prototype,"generateCertificate"in e&&Object.defineProperty(t.RTCPeerConnection,"generateCertificate",{get:function(){return e.generateCertificate}})}}function l(t){"object"===(void 0===t?"undefined":n(t))&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})}function _(t){var e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(t){if(t){void 0!==t.offerToReceiveAudio&&(t.offerToReceiveAudio=!!t.offerToReceiveAudio);var r=this.getTransceivers().find((function(t){return"audio"===t.receiver.track.kind}));!1===t.offerToReceiveAudio&&r?"sendrecv"===r.direction?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":"recvonly"===r.direction&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):!0!==t.offerToReceiveAudio||r||this.addTransceiver("audio"),void 0!==t.offerToReceiveVideo&&(t.offerToReceiveVideo=!!t.offerToReceiveVideo);var n=this.getTransceivers().find((function(t){return"video"===t.receiver.track.kind}));!1===t.offerToReceiveVideo&&n?"sendrecv"===n.direction?n.setDirection?n.setDirection("sendonly"):n.direction="sendonly":"recvonly"===n.direction&&(n.setDirection?n.setDirection("inactive"):n.direction="inactive"):!0!==t.offerToReceiveVideo||n||this.addTransceiver("video")}return e.apply(this,arguments)}}function p(t){"object"!==(void 0===t?"undefined":n(t))||t.AudioContext||(t.AudioContext=t.webkitAudioContext)}},{"../utils":11}],11:[function(t,e,r){Object.defineProperty(r,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};function i(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}r.extractVersion=a,r.wrapPeerConnectionEvent=c,r.disableLog=u,r.disableWarnings=h,r.log=d,r.deprecated=l,r.detectBrowser=_,r.compactObject=f,r.walkStats=b,r.filterStats=g;var o=!0,s=!0;function a(t,e,r){var n=t.match(e);return n&&n.length>=r&&parseInt(n[r],10)}function c(t,e,r){if(t.RTCPeerConnection){var n=t.RTCPeerConnection.prototype,i=n.addEventListener;n.addEventListener=function(t,n){if(t!==e)return i.apply(this,arguments);var o=function(t){var e=r(t);e&&(n.handleEvent?n.handleEvent(e):n(e))};return this._eventMap=this._eventMap||{},this._eventMap[e]||(this._eventMap[e]=new Map),this._eventMap[e].set(n,o),i.apply(this,[t,o])};var o=n.removeEventListener;n.removeEventListener=function(t,r){if(t!==e||!this._eventMap||!this._eventMap[e])return o.apply(this,arguments);if(!this._eventMap[e].has(r))return o.apply(this,arguments);var n=this._eventMap[e].get(r);return this._eventMap[e].delete(r),0===this._eventMap[e].size&&delete this._eventMap[e],0===Object.keys(this._eventMap).length&&delete this._eventMap,o.apply(this,[t,n])},Object.defineProperty(n,"on"+e,{get:function(){return this["_on"+e]},set:function(t){this["_on"+e]&&(this.removeEventListener(e,this["_on"+e]),delete this["_on"+e]),t&&this.addEventListener(e,this["_on"+e]=t)},enumerable:!0,configurable:!0})}}function u(t){return"boolean"!=typeof t?new Error("Argument type: "+(void 0===t?"undefined":n(t))+". Please use a boolean."):(o=t,t?"adapter.js logging disabled":"adapter.js logging enabled")}function h(t){return"boolean"!=typeof t?new Error("Argument type: "+(void 0===t?"undefined":n(t))+". Please use a boolean."):(s=!t,"adapter.js deprecation warnings "+(t?"disabled":"enabled"))}function d(){if("object"===("undefined"==typeof window?"undefined":n(window))){if(o)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}}function l(t,e){s&&console.warn(t+" is deprecated, please use "+e+" instead.")}function _(t){var e={browser:null,version:null};if(void 0===t||!t.navigator)return e.browser="Not a browser.",e;var r=t.navigator;if(r.mozGetUserMedia)e.browser="firefox",e.version=a(r.userAgent,/Firefox\/(\d+)\./,1);else if(r.webkitGetUserMedia||!1===t.isSecureContext&&t.webkitRTCPeerConnection&&!t.RTCIceGatherer)e.browser="chrome",e.version=a(r.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(r.mediaDevices&&r.userAgent.match(/Edge\/(\d+).(\d+)$/))e.browser="edge",e.version=a(r.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!t.RTCPeerConnection||!r.userAgent.match(/AppleWebKit\/(\d+)\./))return e.browser="Not a supported browser.",e;e.browser="safari",e.version=a(r.userAgent,/AppleWebKit\/(\d+)\./,1),e.supportsUnifiedPlan=t.RTCRtpTransceiver&&"currentDirection"in t.RTCRtpTransceiver.prototype}return e}function p(t){return"[object Object]"===Object.prototype.toString.call(t)}function f(t){return p(t)?Object.keys(t).reduce((function(e,r){var n=p(t[r]),o=n?f(t[r]):t[r],s=n&&!Object.keys(o).length;return void 0===o||s?e:Object.assign(e,i({},r,o))}),{}):t}function b(t,e,r){e&&!r.has(e.id)&&(r.set(e.id,e),Object.keys(e).forEach((function(n){n.endsWith("Id")?b(t,t.get(e[n]),r):n.endsWith("Ids")&&e[n].forEach((function(e){b(t,t.get(e),r)}))})))}function g(t,e,r){var n=r?"outbound-rtp":"inbound-rtp",i=new Map;if(null===e)return i;var o=[];return t.forEach((function(t){"track"===t.type&&t.trackIdentifier===e.id&&o.push(t)})),o.forEach((function(e){t.forEach((function(r){r.type===n&&r.trackId===e.id&&b(t,r,i)}))})),i}},{}],12:[function(t,e,r){},{}],13:[function(t,e,r){var n={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};n.localCName=n.generateIdentifier(),n.splitLines=function(t){return t.trim().split("\n").map((function(t){return t.trim()}))},n.splitSections=function(t){return t.split("\nm=").map((function(t,e){return(e>0?"m="+t:t).trim()+"\r\n"}))},n.getDescription=function(t){var e=n.splitSections(t);return e&&e[0]},n.getMediaSections=function(t){var e=n.splitSections(t);return e.shift(),e},n.matchPrefix=function(t,e){return n.splitLines(t).filter((function(t){return 0===t.indexOf(e)}))},n.parseCandidate=function(t){for(var e,r={foundation:(e=0===t.indexOf("a=candidate:")?t.substring(12).split(" "):t.substring(10).split(" "))[0],component:parseInt(e[1],10),protocol:e[2].toLowerCase(),priority:parseInt(e[3],10),ip:e[4],address:e[4],port:parseInt(e[5],10),type:e[7]},n=8;n<e.length;n+=2)switch(e[n]){case"raddr":r.relatedAddress=e[n+1];break;case"rport":r.relatedPort=parseInt(e[n+1],10);break;case"tcptype":r.tcpType=e[n+1];break;case"ufrag":r.ufrag=e[n+1],r.usernameFragment=e[n+1];break;default:r[e[n]]=e[n+1]}return r},n.writeCandidate=function(t){var e=[];e.push(t.foundation),e.push(t.component),e.push(t.protocol.toUpperCase()),e.push(t.priority),e.push(t.address||t.ip),e.push(t.port);var r=t.type;return e.push("typ"),e.push(r),"host"!==r&&t.relatedAddress&&t.relatedPort&&(e.push("raddr"),e.push(t.relatedAddress),e.push("rport"),e.push(t.relatedPort)),t.tcpType&&"tcp"===t.protocol.toLowerCase()&&(e.push("tcptype"),e.push(t.tcpType)),(t.usernameFragment||t.ufrag)&&(e.push("ufrag"),e.push(t.usernameFragment||t.ufrag)),"candidate:"+e.join(" ")},n.parseIceOptions=function(t){return t.substr(14).split(" ")},n.parseRtpMap=function(t){var e=t.substr(9).split(" "),r={payloadType:parseInt(e.shift(),10)};return e=e[0].split("/"),r.name=e[0],r.clockRate=parseInt(e[1],10),r.channels=3===e.length?parseInt(e[2],10):1,r.numChannels=r.channels,r},n.writeRtpMap=function(t){var e=t.payloadType;void 0!==t.preferredPayloadType&&(e=t.preferredPayloadType);var r=t.channels||t.numChannels||1;return"a=rtpmap:"+e+" "+t.name+"/"+t.clockRate+(1!==r?"/"+r:"")+"\r\n"},n.parseExtmap=function(t){var e=t.substr(9).split(" ");return{id:parseInt(e[0],10),direction:e[0].indexOf("/")>0?e[0].split("/")[1]:"sendrecv",uri:e[1]}},n.writeExtmap=function(t){return"a=extmap:"+(t.id||t.preferredId)+(t.direction&&"sendrecv"!==t.direction?"/"+t.direction:"")+" "+t.uri+"\r\n"},n.parseFmtp=function(t){for(var e,r={},n=t.substr(t.indexOf(" ")+1).split(";"),i=0;i<n.length;i++)r[(e=n[i].trim().split("="))[0].trim()]=e[1];return r},n.writeFmtp=function(t){var e="",r=t.payloadType;if(void 0!==t.preferredPayloadType&&(r=t.preferredPayloadType),t.parameters&&Object.keys(t.parameters).length){var n=[];Object.keys(t.parameters).forEach((function(e){t.parameters[e]?n.push(e+"="+t.parameters[e]):n.push(e)})),e+="a=fmtp:"+r+" "+n.join(";")+"\r\n"}return e},n.parseRtcpFb=function(t){var e=t.substr(t.indexOf(" ")+1).split(" ");return{type:e.shift(),parameter:e.join(" ")}},n.writeRtcpFb=function(t){var e="",r=t.payloadType;return void 0!==t.preferredPayloadType&&(r=t.preferredPayloadType),t.rtcpFeedback&&t.rtcpFeedback.length&&t.rtcpFeedback.forEach((function(t){e+="a=rtcp-fb:"+r+" "+t.type+(t.parameter&&t.parameter.length?" "+t.parameter:"")+"\r\n"})),e},n.parseSsrcMedia=function(t){var e=t.indexOf(" "),r={ssrc:parseInt(t.substr(7,e-7),10)},n=t.indexOf(":",e);return n>-1?(r.attribute=t.substr(e+1,n-e-1),r.value=t.substr(n+1)):r.attribute=t.substr(e+1),r},n.parseSsrcGroup=function(t){var e=t.substr(13).split(" ");return{semantics:e.shift(),ssrcs:e.map((function(t){return parseInt(t,10)}))}},n.getMid=function(t){var e=n.matchPrefix(t,"a=mid:")[0];if(e)return e.substr(6)},n.parseFingerprint=function(t){var e=t.substr(14).split(" ");return{algorithm:e[0].toLowerCase(),value:e[1]}},n.getDtlsParameters=function(t,e){return{role:"auto",fingerprints:n.matchPrefix(t+e,"a=fingerprint:").map(n.parseFingerprint)}},n.writeDtlsParameters=function(t,e){var r="a=setup:"+e+"\r\n";return t.fingerprints.forEach((function(t){r+="a=fingerprint:"+t.algorithm+" "+t.value+"\r\n"})),r},n.parseCryptoLine=function(t){var e=t.substr(9).split(" ");return{tag:parseInt(e[0],10),cryptoSuite:e[1],keyParams:e[2],sessionParams:e.slice(3)}},n.writeCryptoLine=function(t){return"a=crypto:"+t.tag+" "+t.cryptoSuite+" "+("object"==typeof t.keyParams?n.writeCryptoKeyParams(t.keyParams):t.keyParams)+(t.sessionParams?" "+t.sessionParams.join(" "):"")+"\r\n"},n.parseCryptoKeyParams=function(t){if(0!==t.indexOf("inline:"))return null;var e=t.substr(7).split("|");return{keyMethod:"inline",keySalt:e[0],lifeTime:e[1],mkiValue:e[2]?e[2].split(":")[0]:void 0,mkiLength:e[2]?e[2].split(":")[1]:void 0}},n.writeCryptoKeyParams=function(t){return t.keyMethod+":"+t.keySalt+(t.lifeTime?"|"+t.lifeTime:"")+(t.mkiValue&&t.mkiLength?"|"+t.mkiValue+":"+t.mkiLength:"")},n.getCryptoParameters=function(t,e){return n.matchPrefix(t+e,"a=crypto:").map(n.parseCryptoLine)},n.getIceParameters=function(t,e){var r=n.matchPrefix(t+e,"a=ice-ufrag:")[0],i=n.matchPrefix(t+e,"a=ice-pwd:")[0];return r&&i?{usernameFragment:r.substr(12),password:i.substr(10)}:null},n.writeIceParameters=function(t){return"a=ice-ufrag:"+t.usernameFragment+"\r\na=ice-pwd:"+t.password+"\r\n"},n.parseRtpParameters=function(t){for(var e={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},r=n.splitLines(t)[0].split(" "),i=3;i<r.length;i++){var o=r[i],s=n.matchPrefix(t,"a=rtpmap:"+o+" ")[0];if(s){var a=n.parseRtpMap(s),c=n.matchPrefix(t,"a=fmtp:"+o+" ");switch(a.parameters=c.length?n.parseFmtp(c[0]):{},a.rtcpFeedback=n.matchPrefix(t,"a=rtcp-fb:"+o+" ").map(n.parseRtcpFb),e.codecs.push(a),a.name.toUpperCase()){case"RED":case"ULPFEC":e.fecMechanisms.push(a.name.toUpperCase())}}}return n.matchPrefix(t,"a=extmap:").forEach((function(t){e.headerExtensions.push(n.parseExtmap(t))})),e},n.writeRtpDescription=function(t,e){var r="";r+="m="+t+" ",r+=e.codecs.length>0?"9":"0",r+=" UDP/TLS/RTP/SAVPF ",r+=e.codecs.map((function(t){return void 0!==t.preferredPayloadType?t.preferredPayloadType:t.payloadType})).join(" ")+"\r\n",r+="c=IN IP4 0.0.0.0\r\n",r+="a=rtcp:9 IN IP4 0.0.0.0\r\n",e.codecs.forEach((function(t){r+=n.writeRtpMap(t),r+=n.writeFmtp(t),r+=n.writeRtcpFb(t)}));var i=0;return e.codecs.forEach((function(t){t.maxptime>i&&(i=t.maxptime)})),i>0&&(r+="a=maxptime:"+i+"\r\n"),r+="a=rtcp-mux\r\n",e.headerExtensions&&e.headerExtensions.forEach((function(t){r+=n.writeExtmap(t)})),r},n.parseRtpEncodingParameters=function(t){var e,r=[],i=n.parseRtpParameters(t),o=-1!==i.fecMechanisms.indexOf("RED"),s=-1!==i.fecMechanisms.indexOf("ULPFEC"),a=n.matchPrefix(t,"a=ssrc:").map((function(t){return n.parseSsrcMedia(t)})).filter((function(t){return"cname"===t.attribute})),c=a.length>0&&a[0].ssrc,u=n.matchPrefix(t,"a=ssrc-group:FID").map((function(t){return t.substr(17).split(" ").map((function(t){return parseInt(t,10)}))}));u.length>0&&u[0].length>1&&u[0][0]===c&&(e=u[0][1]),i.codecs.forEach((function(t){if("RTX"===t.name.toUpperCase()&&t.parameters.apt){var n={ssrc:c,codecPayloadType:parseInt(t.parameters.apt,10)};c&&e&&(n.rtx={ssrc:e}),r.push(n),o&&((n=JSON.parse(JSON.stringify(n))).fec={ssrc:c,mechanism:s?"red+ulpfec":"red"},r.push(n))}})),0===r.length&&c&&r.push({ssrc:c});var h=n.matchPrefix(t,"b=");return h.length&&(h=0===h[0].indexOf("b=TIAS:")?parseInt(h[0].substr(7),10):0===h[0].indexOf("b=AS:")?1e3*parseInt(h[0].substr(5),10)*.95-16e3:void 0,r.forEach((function(t){t.maxBitrate=h}))),r},n.parseRtcpParameters=function(t){var e={},r=n.matchPrefix(t,"a=ssrc:").map((function(t){return n.parseSsrcMedia(t)})).filter((function(t){return"cname"===t.attribute}))[0];r&&(e.cname=r.value,e.ssrc=r.ssrc);var i=n.matchPrefix(t,"a=rtcp-rsize");e.reducedSize=i.length>0,e.compound=0===i.length;var o=n.matchPrefix(t,"a=rtcp-mux");return e.mux=o.length>0,e},n.parseMsid=function(t){var e,r=n.matchPrefix(t,"a=msid:");if(1===r.length)return{stream:(e=r[0].substr(7).split(" "))[0],track:e[1]};var i=n.matchPrefix(t,"a=ssrc:").map((function(t){return n.parseSsrcMedia(t)})).filter((function(t){return"msid"===t.attribute}));return i.length>0?{stream:(e=i[0].value.split(" "))[0],track:e[1]}:void 0},n.parseSctpDescription=function(t){var e,r=n.parseMLine(t),i=n.matchPrefix(t,"a=max-message-size:");i.length>0&&(e=parseInt(i[0].substr(19),10)),isNaN(e)&&(e=65536);var o=n.matchPrefix(t,"a=sctp-port:");if(o.length>0)return{port:parseInt(o[0].substr(12),10),protocol:r.fmt,maxMessageSize:e};if(n.matchPrefix(t,"a=sctpmap:").length>0){var s=n.matchPrefix(t,"a=sctpmap:")[0].substr(10).split(" ");return{port:parseInt(s[0],10),protocol:s[1],maxMessageSize:e}}},n.writeSctpDescription=function(t,e){var r=[];return r="DTLS/SCTP"!==t.protocol?["m="+t.kind+" 9 "+t.protocol+" "+e.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+e.port+"\r\n"]:["m="+t.kind+" 9 "+t.protocol+" "+e.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+e.port+" "+e.protocol+" 65535\r\n"],void 0!==e.maxMessageSize&&r.push("a=max-message-size:"+e.maxMessageSize+"\r\n"),r.join("")},n.generateSessionId=function(){return Math.random().toString().substr(2,21)},n.writeSessionBoilerplate=function(t,e,r){var i=void 0!==e?e:2;return"v=0\r\no="+(r||"thisisadapterortc")+" "+(t||n.generateSessionId())+" "+i+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},n.writeMediaSection=function(t,e,r,i){var o=n.writeRtpDescription(t.kind,e);if(o+=n.writeIceParameters(t.iceGatherer.getLocalParameters()),o+=n.writeDtlsParameters(t.dtlsTransport.getLocalParameters(),"offer"===r?"actpass":"active"),o+="a=mid:"+t.mid+"\r\n",t.direction?o+="a="+t.direction+"\r\n":t.rtpSender&&t.rtpReceiver?o+="a=sendrecv\r\n":t.rtpSender?o+="a=sendonly\r\n":t.rtpReceiver?o+="a=recvonly\r\n":o+="a=inactive\r\n",t.rtpSender){var s="msid:"+i.id+" "+t.rtpSender.track.id+"\r\n";o+="a="+s,o+="a=ssrc:"+t.sendEncodingParameters[0].ssrc+" "+s,t.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+t.sendEncodingParameters[0].rtx.ssrc+" "+s,o+="a=ssrc-group:FID "+t.sendEncodingParameters[0].ssrc+" "+t.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return o+="a=ssrc:"+t.sendEncodingParameters[0].ssrc+" cname:"+n.localCName+"\r\n",t.rtpSender&&t.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+t.sendEncodingParameters[0].rtx.ssrc+" cname:"+n.localCName+"\r\n"),o},n.getDirection=function(t,e){for(var r=n.splitLines(t),i=0;i<r.length;i++)switch(r[i]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return r[i].substr(2)}return e?n.getDirection(e):"sendrecv"},n.getKind=function(t){return n.splitLines(t)[0].split(" ")[0].substr(2)},n.isRejected=function(t){return"0"===t.split(" ",2)[1]},n.parseMLine=function(t){var e=n.splitLines(t)[0].substr(2).split(" ");return{kind:e[0],port:parseInt(e[1],10),protocol:e[2],fmt:e.slice(3).join(" ")}},n.parseOLine=function(t){var e=n.matchPrefix(t,"o=")[0].substr(2).split(" ");return{username:e[0],sessionId:e[1],sessionVersion:parseInt(e[2],10),netType:e[3],addressType:e[4],address:e[5]}},n.isValidSDP=function(t){if("string"!=typeof t||0===t.length)return!1;for(var e=n.splitLines(t),r=0;r<e.length;r++)if(e[r].length<2||"="!==e[r].charAt(1))return!1;return!0},"object"==typeof e&&(e.exports=n)},{}]},{},[1])(1)})));!function(t){var e;(e=t.xMqttRtcCmd||(t.xMqttRtcCmd={}))[e.none=0]="none",e[e.offer=1]="offer",e[e.answer=2]="answer",e[e.candidate=3]="candidate",e[e.close=4]="close",e[e.exist=5]="exist"}(It||(It={})),function(t){var e;(e=t.xMqttHead||(t.xMqttHead={}))[e.none=0]="none",e[e.xMqttWebRtc=1]="xMqttWebRtc"}(It||(It={})),function(t){var e;(e=t.xMqttBody||(t.xMqttBody={}))[e.NONE=0]="NONE",e[e.xMqttWebRtc=1]="xMqttWebRtc",t.unionToxMqttBody=function(e,r){switch(t.xMqttBody[e]){case"NONE":return null;case"xMqttWebRtc":return r(new t.xMqttWebRtc);default:return null}},t.unionListToxMqttBody=function(e,r,n){switch(t.xMqttBody[e]){case"NONE":return null;case"xMqttWebRtc":return r(n,new t.xMqttWebRtc);default:return null}}}(It||(It={})),function(t){var e;(e=t.xRtcLiveNotifyTsCode||(t.xRtcLiveNotifyTsCode={}))[e.complete=0]="complete",e[e.loading=1]="loading"}(It||(It={})),function(t){var e;(e=t.xRtcVodChunkResCode||(t.xRtcVodChunkResCode={}))[e.success=0]="success",e[e.unknow=1]="unknow",e[e.noRid=2]="noRid",e[e.noSN=3]="noSN",e[e.noMN=4]="noMN",e[e.noSize=5]="noSize",e[e.SizeDif=6]="SizeDif",e[e.noData=7]="noData",e[e.noDid=8]="noDid"}(It||(It={})),function(t){var e;(e=t.xRtcHead||(t.xRtcHead={}))[e.none=0]="none",e[e.xRtcVodPublishRid=5]="xRtcVodPublishRid",e[e.xRtcVodNotifyTs=6]="xRtcVodNotifyTs",e[e.xRtcVodChunkReq=7]="xRtcVodChunkReq",e[e.xRtcVodChunkRes=8]="xRtcVodChunkRes",e[e.xRtcClientInfo=9]="xRtcClientInfo"}(It||(It={})),function(t){var e;(e=t.xRtcBody||(t.xRtcBody={}))[e.NONE=0]="NONE",e[e.xRtcVodPublishRid=1]="xRtcVodPublishRid",e[e.xRtcVodNotifyTs=2]="xRtcVodNotifyTs",e[e.xRtcVodChunkReq=3]="xRtcVodChunkReq",e[e.xRtcVodChunkRes=4]="xRtcVodChunkRes",e[e.xRtcClientInfo=5]="xRtcClientInfo",t.unionToxRtcBody=function(e,r){switch(t.xRtcBody[e]){case"NONE":return null;case"xRtcVodPublishRid":return r(new t.xRtcVodPublishRid);case"xRtcVodNotifyTs":return r(new t.xRtcVodNotifyTs);case"xRtcVodChunkReq":return r(new t.xRtcVodChunkReq);case"xRtcVodChunkRes":return r(new t.xRtcVodChunkRes);case"xRtcClientInfo":return r(new t.xRtcClientInfo);default:return null}},t.unionListToxRtcBody=function(e,r,n){switch(t.xRtcBody[e]){case"NONE":return null;case"xRtcVodPublishRid":return r(n,new t.xRtcVodPublishRid);case"xRtcVodNotifyTs":return r(n,new t.xRtcVodNotifyTs);case"xRtcVodChunkReq":return r(n,new t.xRtcVodChunkReq);case"xRtcVodChunkRes":return r(n,new t.xRtcVodChunkRes);case"xRtcClientInfo":return r(n,new t.xRtcClientInfo);default:return null}}}(It||(It={})),function(t){var e=function(){function e(){this.bb=null,this.bb_pos=0}return e.prototype.__init=function(t,e){return this.bb_pos=t,this.bb=e,this},e.getRootAsxMqttWebRtc=function(t,r){return(r||new e).__init(t.readInt32(t.position())+t.position(),t)},e.getSizePrefixedRootAsxMqttWebRtc=function(t,r){return t.setPosition(t.position()+Et.SIZE_PREFIX_LENGTH),(r||new e).__init(t.readInt32(t.position())+t.position(),t)},e.prototype.cmd=function(){var e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readUint16(this.bb_pos+e):t.xMqttRtcCmd.none},e.prototype.sid=function(t){var e=this.bb.__offset(this.bb_pos,6);return e?this.bb.__string(this.bb_pos+e,t):null},e.prototype.from=function(t){var e=this.bb.__offset(this.bb_pos,8);return e?this.bb.__string(this.bb_pos+e,t):null},e.prototype.to=function(t){var e=this.bb.__offset(this.bb_pos,10);return e?this.bb.__string(this.bb_pos+e,t):null},e.prototype.data=function(t){var e=this.bb.__offset(this.bb_pos,12);return e?this.bb.__string(this.bb_pos+e,t):null},e.startxMqttWebRtc=function(t){t.startObject(5)},e.addCmd=function(e,r){e.addFieldInt16(0,r,t.xMqttRtcCmd.none)},e.addSid=function(t,e){t.addFieldOffset(1,e,0)},e.addFrom=function(t,e){t.addFieldOffset(2,e,0)},e.addTo=function(t,e){t.addFieldOffset(3,e,0)},e.addData=function(t,e){t.addFieldOffset(4,e,0)},e.endxMqttWebRtc=function(t){return t.endObject()},e.createxMqttWebRtc=function(t,r,n,i,o,s){return e.startxMqttWebRtc(t),e.addCmd(t,r),e.addSid(t,n),e.addFrom(t,i),e.addTo(t,o),e.addData(t,s),e.endxMqttWebRtc(t)},e}();t.xMqttWebRtc=e}(It||(It={})),function(t){var e=function(){function e(){this.bb=null,this.bb_pos=0}return e.prototype.__init=function(t,e){return this.bb_pos=t,this.bb=e,this},e.getRootAsxMqtt=function(t,r){return(r||new e).__init(t.readInt32(t.position())+t.position(),t)},e.getSizePrefixedRootAsxMqtt=function(t,r){return t.setPosition(t.position()+Et.SIZE_PREFIX_LENGTH),(r||new e).__init(t.readInt32(t.position())+t.position(),t)},e.prototype.xHead=function(){var e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readUint8(this.bb_pos+e):t.xMqttHead.none},e.prototype.xBodyType=function(){var e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readUint8(this.bb_pos+e):t.xMqttBody.NONE},e.prototype.xBody=function(t){var e=this.bb.__offset(this.bb_pos,8);return e?this.bb.__union(t,this.bb_pos+e):null},e.startxMqtt=function(t){t.startObject(3)},e.addXHead=function(e,r){e.addFieldInt8(0,r,t.xMqttHead.none)},e.addXBodyType=function(e,r){e.addFieldInt8(1,r,t.xMqttBody.NONE)},e.addXBody=function(t,e){t.addFieldOffset(2,e,0)},e.endxMqtt=function(t){return t.endObject()},e.createxMqtt=function(t,r,n,i){return e.startxMqtt(t),e.addXHead(t,r),e.addXBodyType(t,n),e.addXBody(t,i),e.endxMqtt(t)},e}();t.xMqtt=e}(It||(It={})),function(t){var e=function(){function t(){this.bb=null,this.bb_pos=0}return t.prototype.__init=function(t,e){return this.bb_pos=t,this.bb=e,this},t.getRootAsxRtcVodPublishRid=function(e,r){return(r||new t).__init(e.readInt32(e.position())+e.position(),e)},t.getSizePrefixedRootAsxRtcVodPublishRid=function(e,r){return e.setPosition(e.position()+Et.SIZE_PREFIX_LENGTH),(r||new t).__init(e.readInt32(e.position())+e.position(),e)},t.prototype.chunkWidthKB=function(){var t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readUint16(this.bb_pos+t):0},t.prototype.rid=function(t){var e=this.bb.__offset(this.bb_pos,6);return e?this.bb.__string(this.bb_pos+e,t):null},t.startxRtcVodPublishRid=function(t){t.startObject(2)},t.addChunkWidthKB=function(t,e){t.addFieldInt16(0,e,0)},t.addRid=function(t,e){t.addFieldOffset(1,e,0)},t.endxRtcVodPublishRid=function(t){return t.endObject()},t.createxRtcVodPublishRid=function(e,r,n){return t.startxRtcVodPublishRid(e),t.addChunkWidthKB(e,r),t.addRid(e,n),t.endxRtcVodPublishRid(e)},t}();t.xRtcVodPublishRid=e}(It||(It={})),function(t){var e=function(){function e(){this.bb=null,this.bb_pos=0}return e.prototype.__init=function(t,e){return this.bb_pos=t,this.bb=e,this},e.getRootAsxRtcLiveNotifyTs=function(t,r){return(r||new e).__init(t.readInt32(t.position())+t.position(),t)},e.getSizePrefixedRootAsxRtcLiveNotifyTs=function(t,r){return t.setPosition(t.position()+Et.SIZE_PREFIX_LENGTH),(r||new e).__init(t.readInt32(t.position())+t.position(),t)},e.prototype.did=function(){var t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readUint16(this.bb_pos+t):0},e.prototype.sn=function(){var t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readUint64(this.bb_pos+t):this.bb.createLong(0,0)},e.prototype.code=function(){var e=this.bb.__offset(this.bb_pos,8);return e?this.bb.readUint8(this.bb_pos+e):t.xRtcLiveNotifyTsCode.complete},e.startxRtcLiveNotifyTs=function(t){t.startObject(3)},e.addDid=function(t,e){t.addFieldInt16(0,e,0)},e.addSn=function(t,e){t.addFieldInt64(1,e,t.createLong(0,0))},e.addCode=function(e,r){e.addFieldInt8(2,r,t.xRtcLiveNotifyTsCode.complete)},e.endxRtcLiveNotifyTs=function(t){return t.endObject()},e.createxRtcLiveNotifyTs=function(t,r,n,i){return e.startxRtcLiveNotifyTs(t),e.addDid(t,r),e.addSn(t,n),e.addCode(t,i),e.endxRtcLiveNotifyTs(t)},e}();t.xRtcLiveNotifyTs=e}(It||(It={})),function(t){var e=function(){function t(){this.bb=null,this.bb_pos=0}return t.prototype.__init=function(t,e){return this.bb_pos=t,this.bb=e,this},t.getRootAsxRtcVodNotifyTs=function(e,r){return(r||new t).__init(e.readInt32(e.position())+e.position(),e)},t.getSizePrefixedRootAsxRtcVodNotifyTs=function(e,r){return e.setPosition(e.position()+Et.SIZE_PREFIX_LENGTH),(r||new t).__init(e.readInt32(e.position())+e.position(),e)},t.prototype.rid=function(t){var e=this.bb.__offset(this.bb_pos,4);return e?this.bb.__string(this.bb_pos+e,t):null},t.prototype.size=function(){var t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readUint16(this.bb_pos+t):0},t.prototype.sn=function(t){var e=this.bb.__offset(this.bb_pos,8);return!!e&&!!this.bb.readInt8(this.bb.__vector(this.bb_pos+e)+t)},t.prototype.snLength=function(){var t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__vector_len(this.bb_pos+t):0},t.prototype.snArray=function(){var t=this.bb.__offset(this.bb_pos,8);return t?new Int8Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null},t.startxRtcVodNotifyTs=function(t){t.startObject(3)},t.addRid=function(t,e){t.addFieldOffset(0,e,0)},t.addSize=function(t,e){t.addFieldInt16(1,e,0)},t.addSn=function(t,e){t.addFieldOffset(2,e,0)},t.createSnVector=function(t,e){t.startVector(1,e.length,1);for(var r=e.length-1;r>=0;r--)t.addInt8(+e[r]);return t.endVector()},t.startSnVector=function(t,e){t.startVector(1,e,1)},t.endxRtcVodNotifyTs=function(t){return t.endObject()},t.createxRtcVodNotifyTs=function(e,r,n,i){return t.startxRtcVodNotifyTs(e),t.addRid(e,r),t.addSize(e,n),t.addSn(e,i),t.endxRtcVodNotifyTs(e)},t}();t.xRtcVodNotifyTs=e}(It||(It={})),function(t){var e=function(){function t(){this.bb=null,this.bb_pos=0}return t.prototype.__init=function(t,e){return this.bb_pos=t,this.bb=e,this},t.getRootAsxRtcVodChunkReq=function(e,r){return(r||new t).__init(e.readInt32(e.position())+e.position(),e)},t.getSizePrefixedRootAsxRtcVodChunkReq=function(e,r){return e.setPosition(e.position()+Et.SIZE_PREFIX_LENGTH),(r||new t).__init(e.readInt32(e.position())+e.position(),e)},t.prototype.rid=function(t){var e=this.bb.__offset(this.bb_pos,4);return e?this.bb.__string(this.bb_pos+e,t):null},t.prototype.sn=function(){var t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readUint64(this.bb_pos+t):this.bb.createLong(0,0)},t.prototype.mns=function(t){var e=this.bb.__offset(this.bb_pos,8);return e?this.bb.readUint32(this.bb.__vector(this.bb_pos+e)+4*t):0},t.prototype.mnsLength=function(){var t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__vector_len(this.bb_pos+t):0},t.prototype.mnsArray=function(){var t=this.bb.__offset(this.bb_pos,8);return t?new Uint32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null},t.startxRtcVodChunkReq=function(t){t.startObject(3)},t.addRid=function(t,e){t.addFieldOffset(0,e,0)},t.addSn=function(t,e){t.addFieldInt64(1,e,t.createLong(0,0))},t.addMns=function(t,e){t.addFieldOffset(2,e,0)},t.createMnsVector=function(t,e){t.startVector(4,e.length,4);for(var r=e.length-1;r>=0;r--)t.addInt32(e[r]);return t.endVector()},t.startMnsVector=function(t,e){t.startVector(4,e,4)},t.endxRtcVodChunkReq=function(t){return t.endObject()},t.createxRtcVodChunkReq=function(e,r,n,i){return t.startxRtcVodChunkReq(e),t.addRid(e,r),t.addSn(e,n),t.addMns(e,i),t.endxRtcVodChunkReq(e)},t}();t.xRtcVodChunkReq=e}(It||(It={})),function(t){var e=function(){function t(){this.bb=null,this.bb_pos=0}return t.prototype.__init=function(t,e){return this.bb_pos=t,this.bb=e,this},t.getRootAsxRtcClientInfo=function(e,r){return(r||new t).__init(e.readInt32(e.position())+e.position(),e)},t.getSizePrefixedRootAsxRtcClientInfo=function(e,r){return e.setPosition(e.position()+Et.SIZE_PREFIX_LENGTH),(r||new t).__init(e.readInt32(e.position())+e.position(),e)},t.prototype.clientType=function(){var t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readUint8(this.bb_pos+t):0},t.prototype.version=function(t){var e=this.bb.__offset(this.bb_pos,6);return e?this.bb.__string(this.bb_pos+e,t):null},t.startxRtcClientInfo=function(t){t.startObject(2)},t.addClientType=function(t,e){t.addFieldInt8(0,e,0)},t.addVersion=function(t,e){t.addFieldOffset(1,e,0)},t.endxRtcClientInfo=function(t){return t.endObject()},t.createxRtcClientInfo=function(e,r,n){return t.startxRtcClientInfo(e),t.addClientType(e,r),t.addVersion(e,n),t.endxRtcClientInfo(e)},t}();t.xRtcClientInfo=e}(It||(It={})),function(t){var e=function(){function t(){this.bb=null,this.bb_pos=0}return t.prototype.__init=function(t,e){return this.bb_pos=t,this.bb=e,this},t.getRootAsxRtcVodChunkRes=function(e,r){return(r||new t).__init(e.readInt32(e.position())+e.position(),e)},t.getSizePrefixedRootAsxRtcVodChunkRes=function(e,r){return e.setPosition(e.position()+Et.SIZE_PREFIX_LENGTH),(r||new t).__init(e.readInt32(e.position())+e.position(),e)},t.prototype.rid=function(t){var e=this.bb.__offset(this.bb_pos,4);return e?this.bb.__string(this.bb_pos+e,t):null},t.prototype.sn=function(){var t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readUint64(this.bb_pos+t):this.bb.createLong(0,0)},t.prototype.mn=function(){var t=this.bb.__offset(this.bb_pos,8);return t?this.bb.readUint32(this.bb_pos+t):0},t.prototype.chunkMem=function(t){var e=this.bb.__offset(this.bb_pos,10);return e?this.bb.readUint8(this.bb.__vector(this.bb_pos+e)+t):0},t.prototype.chunkMemLength=function(){var t=this.bb.__offset(this.bb_pos,10);return t?this.bb.__vector_len(this.bb_pos+t):0},t.prototype.chunkMemArray=function(){var t=this.bb.__offset(this.bb_pos,10);return t?new Uint8Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null},t.prototype.fileSizeCode=function(){var t=this.bb.__offset(this.bb_pos,12);return t?this.bb.readInt64(this.bb_pos+t):this.bb.createLong(0,0)},t.startxRtcVodChunkRes=function(t){t.startObject(5)},t.addRid=function(t,e){t.addFieldOffset(0,e,0)},t.addSn=function(t,e){t.addFieldInt64(1,e,t.createLong(0,0))},t.addMn=function(t,e){t.addFieldInt32(2,e,0)},t.addChunkMem=function(t,e){t.addFieldOffset(3,e,0)},t.createChunkMemVector=function(t,e){t.startVector(1,e.length,1);for(var r=e.length-1;r>=0;r--)t.addInt8(e[r]);return t.endVector()},t.startChunkMemVector=function(t,e){t.startVector(1,e,1)},t.addFileSizeCode=function(t,e){t.addFieldInt64(4,e,t.createLong(0,0))},t.endxRtcVodChunkRes=function(t){return t.endObject()},t.createxRtcVodChunkRes=function(e,r,n,i,o,s){return t.startxRtcVodChunkRes(e),t.addRid(e,r),t.addSn(e,n),t.addMn(e,i),t.addChunkMem(e,o),t.addFileSizeCode(e,s),t.endxRtcVodChunkRes(e)},t}();t.xRtcVodChunkRes=e}(It||(It={})),function(t){var e=function(){function e(){this.bb=null,this.bb_pos=0}return e.prototype.__init=function(t,e){return this.bb_pos=t,this.bb=e,this},e.getRootAsxRtc=function(t,r){return(r||new e).__init(t.readInt32(t.position())+t.position(),t)},e.getSizePrefixedRootAsxRtc=function(t,r){return t.setPosition(t.position()+Et.SIZE_PREFIX_LENGTH),(r||new e).__init(t.readInt32(t.position())+t.position(),t)},e.prototype.xHead=function(){var e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readUint8(this.bb_pos+e):t.xRtcHead.none},e.prototype.xBodyType=function(){var e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readUint8(this.bb_pos+e):t.xRtcBody.NONE},e.prototype.xBody=function(t){var e=this.bb.__offset(this.bb_pos,8);return e?this.bb.__union(t,this.bb_pos+e):null},e.startxRtc=function(t){t.startObject(3)},e.addXHead=function(e,r){e.addFieldInt8(0,r,t.xRtcHead.none)},e.addXBodyType=function(e,r){e.addFieldInt8(1,r,t.xRtcBody.NONE)},e.addXBody=function(t,e){t.addFieldOffset(2,e,0)},e.endxRtc=function(t){return t.endObject()},e.finishxRtcBuffer=function(t,e){t.finish(e)},e.finishSizePrefixedxRtcBuffer=function(t,e){t.finish(e,void 0,!0)},e.createxRtc=function(t,r,n,i){return e.startxRtc(t),e.addXHead(t,r),e.addXBodyType(t,n),e.addXBody(t,i),e.endxRtc(t)},e}();t.xRtc=e}(It||(It={}));var At,Ot,Bt,Dt=function(){function t(){}return t.generate_sid=function(){return ht.getUUid(40,16)},t.isSupportWebRTC=function(){return 0!=t.check_web_rtc()&&(t.RealtimeLogMonitor&&wt.checkInternational(),t.RealtimeLogMonitor.reportWebRtcSupport(t.support_webrtc_result)),t.support_webrtc_result>0},t.check_web_rtc=function(){return 0!==t.support_webrtc_result?0:(S.log("pcdn version:",L.version),void 0!==kt&&kt.browserDetails.browser&&(e.browerName=kt.browserDetails.browser,kt.browserDetails.version&&(e.browerVersion=kt.browserDetails.version),S.log("[rtc]browser:",e.browerName,",version:",e.browerVersion)),t.RTCPeerConnection?S.log("[rtc][browser]RTCPeerConnection ok"):t.RTCPeerConnection=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection,t.RTCSessionDescription?S.log("[rtc][browser]RTCSessionDescription ok"):t.RTCSessionDescription=window.RTCSessionDescription||window.mozRTCSessionDescription||window.webkitRTCSessionDescription,t.RTCIceCandidate?S.log("[rtc][browser]RTCIceCandidate ok"):t.RTCIceCandidate=window.RTCIceCandidate||window.mozRTCIceCandidate,t.RTCPeerConnection?t.RTCPeerConnection.prototype.hasOwnProperty("createDataChannel")?t.RTCIceCandidate?t.RTCSessionDescription?(S.log("[rtc][browser]support webrtc"),t.support_webrtc_result=1,t.support_webrtc_result):(S.error("[rtc][browser]no support RTCSessionDescription"),t.support_webrtc_result=-4,t.support_webrtc_result):(S.error("[rtc][browser]no support RTCIceCandidate"),t.support_webrtc_result=-3,t.support_webrtc_result):(S.error("[rtc][browser]no support createDataChannel"),t.support_webrtc_result=-2,t.support_webrtc_result):(S.error("[rtc][browser]no support RTCPeerConnection"),t.support_webrtc_result=-1,t.support_webrtc_result))},t.xMqttRtcCmd2string=function(t){return It.xMqttRtcCmd[t]},t.makePublishRidPack=function(t,e,r){try{var n=new Et.Builder(128),i=It.xRtcVodPublishRid,o=t?n.createString(t):void 0;i.startxRtcVodPublishRid(n),i.addChunkWidthKB(n,r),null!=o&&i.addRid(n,o);var s=i.endxRtcVodPublishRid(n),a=It.xRtc;a.startxRtc(n),a.addXHead(n,It.xRtcHead.xRtcVodPublishRid),a.addXBodyType(n,It.xRtcBody.xRtcVodPublishRid),a.addXBody(n,s),n.finish(a.endxRtc(n));var c=n.asUint8Array();return c.byteLength>128&&S.log("[rtc][makePublishRidPack]need big buffer:",c.byteLength),c}catch(ae){S.error("[rtc][makePublishRidPack]except:",ae.toString())}return null},t.makexRtcClientInfoPack=function(){if(t.ClientInfoFB_)return t.ClientInfoFB_;try{var r=new Et.Builder(128),n=r.createString(L.version),i=It.xRtcClientInfo;i.startxRtcClientInfo(r),i.addClientType(r,e.client_type_),i.addVersion(r,n);var o=i.endxRtcClientInfo(r),s=It.xRtc;s.startxRtc(r),s.addXHead(r,It.xRtcHead.xRtcClientInfo),s.addXBodyType(r,It.xRtcBody.xRtcClientInfo),s.addXBody(r,o),r.finish(s.endxRtc(r));var a=r.asUint8Array();return a.byteLength>128&&S.log("[rtc][makexRtcClientInfoPack]need big buffer:",a.byteLength),t.ClientInfoFB_=a,a}catch(ae){S.error("[rtc][makexRtcClientInfoPack]except:",ae.toString())}return null},t.makexRtcVodNotifyTsPack=function(t,e,r){try{var n=new Et.Builder(512),i=It.xRtcVodNotifyTs,o=t?n.createString(t):void 0,s=i.createSnVector(n,r);i.startxRtcVodNotifyTs(n),null!=o&&i.addRid(n,o),i.addSize(n,e),i.addSn(n,s);var a=i.endxRtcVodNotifyTs(n),c=It.xRtc;c.startxRtc(n),c.addXHead(n,It.xRtcHead.xRtcVodNotifyTs),c.addXBodyType(n,It.xRtcBody.xRtcVodNotifyTs),c.addXBody(n,a),n.finish(c.endxRtc(n));var u=n.asUint8Array();return u.byteLength>512&&S.log("[rtc][makexRtcVodNotifyTsPack]need big buffer:",u.byteLength),u}catch(ae){S.error("[rtc][makexRtcVodNotifyTsPack]except:",ae.toString())}return null},t.support_webrtc_result=0,t.RTCPeerConnection=window.RTCPeerConnection,t.RTCIceCandidate=window.RTCIceCandidate,t.RTCSessionDescription=window.RTCSessionDescription,t.ClientInfoFB_=null,t}(),Ut=function(){function t(r,n,i,o,s){this.rid=void 0,this.sub_rid=void 0,this.sub_rid_addressed_=!1,this.m3u8Url_="",this.fullM3u8Url_="",this.isPause_=!1,this.requestSN_=-1,this.requestLastSN_=-1,this.preLoadSN_=-1,this.lastWdcSn_=-1,this.playerBufferDuration_=0,this.p2pSeter_=null,this.needSendChanged_=!1,this.upload_qps_=0,this.publishRidPack_=null,this.publishDidPack_=null,this.pause_tm_=-1,this.tsInfoList_=[],this.updateTsCount=0,this.control1Success_=!1,this.getRidFromUrlSuccess_=!1,this.curTsRequestTime_=0,this.curTsStep_=0,this.isUpsM3u8_=!1,this.did_=r,this.chunkWidthKB_=e.chunk_width_KB_,this.m3u8Url_=n,this.fullM3u8Url_=i,this.onTsReadyForRequest_=s,this.tsLoaderMap_=new Map,this.last_roi_tm_ms_=0,this.lastRoiIsCdn_=!1,this.isRequested_=!1,this.isUpsM3u8_=o;var a=e.is_dyt_=wt.isDytM3U8(i);a||(this.rid=wt.getRidFromUrl(i),this.rid&&S.log("[m3u8loader][getRidFromUrl]fullm3u8Url:",this.fullM3u8Url_," rid=",this.rid)),this.p2pMgr_=t.P2PManager.instance(),this.p2pMgr_.on(T.CONTROL1,this.onControl1Response.bind(this)),this.did_>=65535&&S.error("[rtc]M3u8Loader,bad did:",this.did_),e.rid_no_control_&&void 0!==this.rid&&this.onGetRidFromUrl(),S.log("[m3u8loader][create]did:",this.did_,",m3u8Url:",this.m3u8Url_," rid=",this.rid?this.rid:"empty",", dyt:",a)}return t.prototype.isFullConnected=function(){return!!this.p2pSeter_&&this.p2pSeter_.size()>e.max_peer_count_},t.prototype.isFullConnected4Offer=function(){return!!this.p2pSeter_&&this.p2pSeter_.size()>e.disconnect_max_peer_count_},t.prototype.needMoreEdgeCnt=function(){return this.p2pSeter_?e.max_edge_count_-this.p2pSeter_.edge_size():e.max_edge_count_},t.prototype.setSubridAddressed=function(){this.sub_rid_addressed_=!0},t.prototype.getTsLoaderMap=function(){return this.tsLoaderMap_},t.prototype.updateTsList=function(e,r){if(0!=e.length){if(this.tsInfoList_=e,!this.rid)if(this.rid=wt.getRidFromUrl(e[0].url),this.rid)S.log("ups m3u8, get rid from first ts"),this.onGetRidFromUrl();else if(!this.isUpsM3u8_&&this.p2pMgr_.isP2PReady()){new xt(this.rid,this.fullM3u8Url_).request()}this.rid&&t.CacheManager.createBuffer(this.rid,this.tsInfoList_.length,this.m3u8Url_)}},t.prototype.requestTSData=function(t){this.curTsRequestTime_=dt.nowMs(),this.curTsStep_=1;var e=t.sn;S.log("[M3u8Loader]requestTSData,sn:",e);var r=this.getLoaderWithSN(e,!0);if(null==r){S.log("[xplayer]req,no loader,m3u8Url:",this.m3u8Url_,",sn:",e);var n={msg:"request_id_error",m3u8Url:this.m3u8Url_,tsUrl:t.url,sn:e,errCode:1003};return this.p2pMgr_.engine_.SendErrorToPlayer(n),this.curTsStep_=-1,void Tt.reportWDC(this.buildWDC1003Log(t),this.p2pMgr_.isLogined(),1003)}this.memoryControl(),r.setRequest(),this.curTsStep_=2,this.requestLastSN_=this.requestSN_,this.requestSN_=e,e!=this.requestLastSN_+1&&(S.log("[xplayer][seek]",e,",last:",this.requestLastSN_),this.updateSubrid(e),this.checkTsDisabled()),this.isRequested_||(this.isRequested_=!0,this.updateSubrid(e),this.checkROI(!0)),this.curTsStep_=3;var i=null;try{i=r.getFullBuffer()}catch(ae){return void this.setTsLoadFail(r,e,-2)}if(this.curTsStep_=4,i)return S.log("[M3u8Loader]requestTSData,sn:",e,", is pre downloaded, call onTsReadyForRequest_, ","bufferLength: ",i.byteLength),this.onTsReadyForRequest_(this,e,i),this.addNext(),r.setRead(),void(this.curTsStep_=-3);this.curTsStep_=5,r.loadState==P.COMPLETE?this.curTsStep_=6:this.checkTsLoadFail(r)||(null==r.loadClient_&&r.refreshRequest("r"),r.load(this.isUseCDN()||!r.hasGoodPeer()?I.CDN:I.P2P,this.playerBufferDuration_),this.curTsStep_=-4)},t.prototype.abortTSData=function(t){S.log("[M3u8Loader]abortTSData,sn:",t);var r=dt.nowMs()-this.curTsRequestTime_;this.lastWdcSn_!=t&&this.playerBufferDuration_<e.report_wdc_time_sec_&&r>e.core_req_timeout_ms_&&(this.lastWdcSn_=t,Tt.reportWDC(this.buildWDClog(t,r),this.p2pMgr_.isLogined(),0)),this.setTsDisabled(t)},t.prototype.start=function(){this.isPause_=!1,this.loadNext()},t.prototype.pause=function(){this.pause_tm_=this.p2pMgr_.now(),this.isPause_=!0},t.prototype.closeAllRtc=function(t){this.p2pSeter_&&0!=this.p2pSeter_.size()&&this.p2pSeter_.closeAll(t)},Object.defineProperty(t.prototype,"m3u8Url",{get:function(){return this.m3u8Url_},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fullM3u8Url",{get:function(){return this.fullM3u8Url_},enumerable:!1,configurable:!0}),t.prototype.setPlayerBufferDuration=function(t){this.playerBufferDuration_=t,ft.duration=t,this.isRequested_&&this.checkROI(!1)},t.prototype.getLoaderWithSN=function(t,e){var r=this.tsLoaderMap_.get(t);if(!r&&e){var n=this.tsInfoList_[t];if(!n)return;r=new Ct(this.chunkWidthKB_,this.p2pSeter_,this.rid,this.did_,n.sn,n.url,n.filesize,!0,this.onTsLoadFinished.bind(this),this.onTsLoadFailed.bind(this),this.onTsLoadStart.bind(this)),this.tsLoaderMap_.set(r.sn,r)}return r},t.prototype.needSendStreamChanged=function(){this.needSendChanged_=!0,this.last_roi_tm_ms_=0,this.sendStreamChangeIfNeed()},t.prototype.sendStreamChangeIfNeed=function(){var e,r;if(this.needSendChanged_&&null!=this.rid){if(this.p2pSeter_){var n=this.p2pSeter_.get_cliets(),i=this.getPublishRidPack(!1);if(i)try{for(var o=y(n),s=o.next();!s.done;s=o.next()){s.value.sendRtcVodPublishRid(this.rid,i)}}catch(a){e={error:a}}finally{try{s&&!s.done&&(r=o.return)&&r.call(o)}finally{if(e)throw e.error}}}t.P2PManager.instance().emit(T.STREAM_CHANGED,this.rid),this.needSendChanged_=!1}},t.prototype.loadNext=function(){var t,e;if(!this.isPause_)try{for(var r=y(this.tsLoaderMap_),n=r.next();!n.done;n=r.next()){var i=v(n.value,2),o=i[0],s=i[1];if(s.loadState<P.FAILED){S.log("[loadNext]loader. sn:",o),s.isRequested()?s.load(this.isUseCDN()||!s.hasGoodPeer()?I.CDN:I.P2P,this.playerBufferDuration_):!this.isUseCDN()&&s.hasGoodPeer()?s.load(I.P2P,this.playerBufferDuration_):S.log("[loadNext]not current req sn, forbid cdn, just wait. sn:",o,"current req sn:",this.requestSN_);break}}}catch(a){t={error:a}}finally{try{n&&!n.done&&(e=r.return)&&e.call(r)}finally{if(t)throw t.error}}},t.prototype.onTsLoadFinished=function(t,e,r,n){S.is_debug()&&S.log("[ts][xplayer]fin[",t,"]P2P%[",ft.get_L_t1_t8(),"]waste%[",ft.wastePer().toFixed(2),"]T5/T8%[",ft.get_t5_t8(),"]T1[",ft.T1_total,"]T2[",ft.T2_total,"]T3[",ft.T3_total,"]T5[",ft.T5_total,"]T8[",ft.T8_total,"]buf[",this.playerBufferDuration_.toFixed(2),"]pn[",this.p2pSeter_?this.p2pSeter_.size():0,"]fz[",e,"]md[",r?"P2P":"CDN","]did[",this.did_,"]utm:",n.toFixed(1)),this.p2pMgr_.getDownloadManager().checkProgressData();var i=this.getLoaderWithSN(t,!1);if(i){if(i.isP2pMode()&&this.p2pSeter_&&this.p2pSeter_.sort_clients(),this.requestSN_==t){var o=null;try{o=i.getFullBuffer()}catch(ae){return void this.setTsLoadFail(i,t,-5)}if(!o)return S.error("[M3u8Loader][onTsLoadFinished] buffer is null sn:",t),void this.setTsLoadFail(i,t,-6);this.onTsReadyForRequest_(this,t,o),this.addNext(),i.setRead()}else S.log("[M3u8Loader] onTsLoadFinished() not current request tsNo"," down:",t," request:",this.requestSN_),this.addNext();if(!i.isDbMode()){if(this.rid&&(S.log("[onTsLoadFinished]save cache, rid=",this.rid),i.saveCache(this.rid,this.tsInfoList_.length,this.m3u8Url_),this.updateTsCount++),0==this.getRidFromUrlSuccess_&&0==this.control1Success_&&this.p2pMgr_.isP2PReady())new xt(this.rid,this.fullM3u8Url_).request(),S.log("[M3u8Loader][onTsLoadFinished], send control1");this.updateTsCount>=10&&this.rid&&(this.updateTsListToPeers(this.rid),this.updateTsCount=0)}}else if(S.log("[M3u8Loader] onTsLoadFinished() loader not exist, sn:",t),this.requestSN_==t){ft.recordP2pDataError(58);var s={msg:"TS_LOAD_FAILED",m3u8Url:this.m3u8Url_,tsUrl:"",sn:t,errCode:1004};this.p2pMgr_.engine_.SendErrorToPlayer(s)}},t.prototype.addNext=function(){var t,r;for(S.log("[addNext]try to add nextSn:",this.preLoadSN_,"now loader map size:",this.tsLoaderMap_.size);this.preLoadSN_<=this.requestSN_||this.tsLoaderMap_.has(this.preLoadSN_);)if(S.log("[addNext]nextSn already exist, sn:",this.preLoadSN_,"now loader map size:",this.tsLoaderMap_.size),++this.preLoadSN_,this.preLoadSN_>=this.tsInfoList_.length)return void S.log("[addNext]preLoadSN exceed last sn, finish, now preLoadSN is:",this.preLoadSN_);if(this.updateSubrid(this.preLoadSN_),this.tsLoaderMap_.size>=e.max_ts_count_){var n=this.tsLoaderMap_;try{for(var i=y(this.tsLoaderMap_),o=i.next();!o.done;o=i.next()){var s=v(o.value,2),a=s[0],c=s[1];if(c.isUsed()&&(c.destory(),n.delete(a),S.log("[addNext]remove sn:",a,", because is used, now loader map size:",this.tsLoaderMap_.size),this.tsLoaderMap_.size<e.max_ts_count_))break}}catch(d){t={error:d}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}if(this.tsLoaderMap_.size>=e.max_ts_count_)return void S.log("[addNext]no sn to remove for nextSn:",this.preLoadSN_)}S.log("[addNext]add nextSn:",this.preLoadSN_,"now loader map size:",this.tsLoaderMap_.size);var u=this.tsInfoList_[this.preLoadSN_];if(u){var h=new Ct(this.chunkWidthKB_,this.p2pSeter_,this.rid,this.did_,u.sn,u.url,u.filesize,!1,this.onTsLoadFinished.bind(this),this.onTsLoadFailed.bind(this),this.onTsLoadStart.bind(this));this.tsLoaderMap_.set(h.sn,h),this.loadNext()}else S.log("[addNext]add nextSn empty, sn:",this.preLoadSN_,"list length:",this.tsInfoList_.length)},t.prototype.onTsLoadFailed=function(t){if(this.requestSN_==t){var e=this.getLoaderWithSN(t,!1);e&&this.checkTsLoadFail(e)}},t.prototype.onTsLoadStart=function(t){this.p2pMgr_.getDownloadManager().checkProgressData()},t.prototype.checkTsLoadFail=function(t){if(t.loadState==P.FAILED){S.log("[M3u8Loader] checkTsLoadFail()TS_LOAD_FAILED"," m3u8Url:",this.m3u8Url_,", sn:",t.sn,", url:",t.tsUrl());var e={msg:"TS_LOAD_FAILED",m3u8Url:this.m3u8Url_,tsUrl:t.tsUrl(),sn:t.sn,errCode:1004};return this.p2pMgr_.engine_.SendErrorToPlayer(e),!0}return!1},t.prototype.checkTsDisabled=function(){var t,e,r=!1,n=this.tsLoaderMap_;try{for(var i=y(this.tsLoaderMap_),o=i.next();!o.done;o=i.next()){var s=v(o.value,2),a=s[0],c=s[1];a!=this.requestSN_&&(c.destory(),n.delete(a),S.log("[xplayer]overdue delete,sn:",a),r=!0)}}catch(u){t={error:u}}finally{try{o&&!o.done&&(e=i.return)&&e.call(i)}finally{if(t)throw t.error}}r&&this.loadNext(),this.preLoadSN_=this.requestSN_+1},t.prototype.setTsDisabled=function(t){var e=this.tsLoaderMap_.get(t);e&&(e.destory(),this.tsLoaderMap_.delete(t),S.log("[xplayer]overdue delete,sn:",t))},t.prototype.onControl1Response=function(e){var r,n;if(e&&e.rid&&e.rid.length>0){var i=wt.modifyRid(e.rid),o=!1;if(this.rid&&(o=!0),this.control1Success_=!0,this.rid&&this.rid!=i?S.log("[control1] error! urlRid(modified): ",this.rid," cpsRid(modeified): ",i):this.rid=i,S.log("[control1][updateRid]rid:",this.rid),this.p2pMgr_.getDownloadManager().updateRid(this.rid,this),t.CacheManager.loadingRids.add(this.rid),t.CacheManager.createBuffer(this.rid,this.tsInfoList_.length,this.m3u8Url_),this.p2pSeter_=this.p2pMgr_.getP2pSet(this.rid),!o)try{for(var s=y(this.tsLoaderMap_),a=s.next();!a.done;a=s.next()){var c=v(a.value,2);c[0];c[1].saveCache(this.rid,this.tsInfoList_.length,this.m3u8Url_)}}catch(u){r={error:u}}finally{try{a&&!a.done&&(n=s.return)&&n.call(s)}finally{if(r)throw r.error}}}},t.prototype.onGetRidFromUrl=function(){!this.rid||(this.getRidFromUrlSuccess_=!0,S.log("[control1][onGetRidFromUrl]rid:",this.rid),this.p2pMgr_.getDownloadManager().updateRid(this.rid,this),t.CacheManager.loadingRids.add(this.rid),this.p2pSeter_=this.p2pMgr_.getP2pSet(this.rid),this.p2pMgr_.isP2PReady())},t.prototype.getP2PSeter=function(){return this.p2pSeter_},t.prototype.isUseCDN=function(){return 0==e.peakmode_||!this.rid||!this.sub_rid||this.playerBufferDuration_<e.cdn_limit_duration_seconds_},t.prototype.checkROI=function(t){var r,n,i=this.isUseCDN();if(e.download_roi_min_dx_ms_>0){var o=dt.nowMs(),s=o-this.last_roi_tm_ms_;if(!t&&this.last_roi_tm_ms_>0&&i==this.lastRoiIsCdn_&&s<e.download_roi_min_dx_ms_)return void S.log("[xplayer]roi,ignore,dx_ms:",s.toFixed(2));this.lastRoiIsCdn_=i,this.last_roi_tm_ms_=o}try{for(var a=y(this.tsLoaderMap_),c=a.next();!c.done;c=a.next()){var u=v(c.value,2),h=u[0],d=u[1];if(d.loadState<P.FAILED){S.log("[checkROI]loader. sn:",h),d.isRequested()?d.load(i||!d.hasGoodPeer()?I.CDN:I.P2P,this.playerBufferDuration_):!i&&d.hasGoodPeer()?d.load(I.P2P,this.playerBufferDuration_):S.log("[loadNext]not current req sn, forbid cdn, just wait. sn:",h,"current req sn:",this.requestSN_);break}}}catch(l){r={error:l}}finally{try{c&&!c.done&&(n=a.return)&&n.call(a)}finally{if(r)throw r.error}}},t.prototype.memoryControl=function(){var t,r,n=this.tsLoaderMap_,i=n.size-e.max_ts_count_;if(!(i<=0))try{for(var o=y(n),s=o.next();!s.done;s=o.next()){var a=v(s.value,2),c=a[0],u=a[1];if(--i<0)break;u.destory(),n.delete(c)}}catch(h){t={error:h}}finally{try{s&&!s.done&&(r=o.return)&&r.call(o)}finally{if(t)throw t.error}}},t.prototype.getPublishRidPack=function(t){if(!this.rid||0==this.rid.length)return null;var e=t?this.publishDidPack_:this.publishRidPack_;return e||(t?this.publishDidPack_=Dt.makePublishRidPack(null,this.did_,this.chunkWidthKB_):this.publishRidPack_=Dt.makePublishRidPack(this.rid,this.did_,this.chunkWidthKB_),t?this.publishDidPack_:this.publishRidPack_)},t.prototype.updateTsListToPeers=function(t){var e,r;if(this.p2pSeter_){var n=this.p2pSeter_.get_cliets();try{for(var i=y(n),o=i.next();!o.done;o=i.next()){var s=o.value;s.is_edge_||s.sendRtcVodNotifyTs(t)}}catch(a){e={error:a}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(e)throw e.error}}}},t.prototype.updateSubrid=function(r){if(this.rid){var n=wt.getSubRid(this.rid,r);if(this.sub_rid!==n){if(S.log("[updateSubrid]change, sn:",r,", last:",this.sub_rid?this.sub_rid:" empty",", cur:",n),this.sub_rid){var i=wt.getSubBeginSn(this.sub_rid),o=t.CacheManager.getM3u8Bitmap(this.rid);if(o){var s=i+e.subrid_batch_size_,a=e.publish_sub_have_ts_per_;s>o.length?(s=o.length,a/=2):0==i&&(a/=2);var c=0;if(s!=i)for(var u=i;u<s;++u)o[u]&&c++;if(c>0&&c/(s-i)>=a)if(this.p2pMgr_.isP2PReady())new Mt(!0).request([this.sub_rid]);S.log("[updateSubrid]lastSubRid:",this.sub_rid,", begin_sn:",i,", hit_count:",c,", length:",s-i,", hit_limit:",a)}}if(this.sub_rid=n,this.sub_rid_addressed_=!1,this.p2pMgr_.isP2PReady())new Lt(n,this.m3u8Url_).request(),this.p2pMgr_.check_address(!0)}}else S.log("[updateSubrid]rid is empty")},t.prototype.close=function(){var e,r;S.log("[M3u8Loader][close]"),this.rid&&t.CacheManager.loadingRids.delete(this.rid);var n=this.tsLoaderMap_;try{for(var i=y(n),o=i.next();!o.done;o=i.next()){var s=v(o.value,2),a=s[0];s[1].destory(),n.delete(a)}}catch(c){e={error:c}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(e)throw e.error}}},t.prototype.setTsLoadFail=function(t,e,r){t.loadState=P.FAILED,this.checkTsLoadFail(t),t.destory(),this.tsLoaderMap_.delete(e),this.curTsStep_=r,ft.recordP2pDataError(40+r)},t.prototype.buildWDClog=function(t,r){var n,i,o="";o+="m3u8="+this.fullM3u8Url_,o+="&sn="+t.toString(),o+="&rsn="+this.requestSN_.toString(),o+="&lsn="+this.requestLastSN_.toString(),o+="&tm="+r.toFixed(2),o+="&buf="+this.playerBufferDuration_.toFixed(2),o+="&step="+this.curTsStep_.toString(),o+="&ext="+e.web_cna_;var s=this.getLoaderWithSN(t,!1);s&&(o+="&ts="+s.tsUrl(),o+="&state="+s.loadState.toString(),o+="&mode="+s.loadMode.toString(),o+="&tcm1="+s.timeConsuming_ms_.toFixed(2),o+="&tcm2="+s.usedTime().toFixed(2),o+="&stp="+s.loadModeStep);var a=this.tsLoaderMap_;try{for(var c=y(a),u=c.next();!u.done;u=c.next()){var h=v(u.value,2),d=h[0],l=h[1];o+="&msn="+d.toString(),o+="&mst="+l.loadState.toString(),o+="&mstp="+l.loadModeStep,o+="&mtcm="+l.timeConsuming_ms_.toFixed(2)}}catch(_){n={error:_}}finally{try{u&&!u.done&&(i=c.return)&&i.call(c)}finally{if(n)throw n.error}}return o},t.prototype.buildWDC1003Log=function(t){var r,n,i="";i+="m3u8="+this.fullM3u8Url_,i+="&sn="+t.sn.toString(),i+="&rsn="+this.requestSN_.toString(),i+="&lsn="+this.requestLastSN_.toString(),i+="&buf="+this.playerBufferDuration_.toFixed(2),i+="&step="+this.curTsStep_.toString(),i+="&ext="+e.web_cna_;var o=this.getLoaderWithSN(t.sn,!1);o&&(i+="&ts="+o.tsUrl(),i+="&state="+o.loadState.toString(),i+="&mode="+o.loadMode.toString(),i+="&tcm1="+o.timeConsuming_ms_.toFixed(2),i+="&tcm2="+o.usedTime().toFixed(2),i+="&stp="+o.loadModeStep),i+="&frgurl="+t.url,i+="&tsll="+this.tsInfoList_.length;var s=this.tsLoaderMap_;try{for(var a=y(s),c=a.next();!c.done;c=a.next()){var u=v(c.value,2),h=u[0],d=u[1];i+="&msn="+h.toString(),i+="&mst="+d.loadState.toString(),i+="&mstp="+d.loadModeStep,i+="&mtcm="+d.timeConsuming_ms_.toFixed(2)}}catch(l){r={error:l}}finally{try{c&&!c.done&&(n=a.return)&&n.call(a)}finally{if(r)throw r.error}}return i},t}(),Nt=A((function(t,e){t.exports=function(){function t(e,r,n){function i(s,a){if(!r[s]){if(!e[s]){if(!a&&B)return B();if(o)return o(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var u=r[s]={exports:{}};e[s][0].call(u.exports,(function(t){return i(e[s][1][t]||t)}),u,u.exports,t,e,r,n)}return r[s].exports}for(var o=B,s=0;s<n.length;s++)i(n[s]);return i}return t}()({1:[function(t,e,r){(function(r,n){var i=t("events"),o=t("./store"),s=t("mqtt-packet"),a=t("readable-stream").Writable,c=t("inherits"),u=t("reinterval"),h=t("./validations"),d=t("xtend"),l=n.setImmediate||function(t){r.nextTick(t)},_={keepalive:60,reschedulePings:!0,protocolId:"MQTT",protocolVersion:4,reconnectPeriod:1e3,connectTimeout:3e4,clean:!0,resubscribe:!0},p={0:"",1:"Unacceptable protocol version",2:"Identifier rejected",3:"Server unavailable",4:"Bad username or password",5:"Not authorized",16:"No matching subscribers",17:"No subscription existed",128:"Unspecified error",129:"Malformed Packet",130:"Protocol Error",131:"Implementation specific error",132:"Unsupported Protocol Version",133:"Client Identifier not valid",134:"Bad User Name or Password",135:"Not authorized",136:"Server unavailable",137:"Server busy",138:"Banned",139:"Server shutting down",140:"Bad authentication method",141:"Keep Alive timeout",142:"Session taken over",143:"Topic Filter invalid",144:"Topic Name invalid",145:"Packet identifier in use",146:"Packet Identifier not found",147:"Receive Maximum exceeded",148:"Topic Alias invalid",149:"Packet too large",150:"Message rate too high",151:"Quota exceeded",152:"Administrative action",153:"Payload format invalid",154:"Retain not supported",155:"QoS not supported",156:"Use another server",157:"Server moved",158:"Shared Subscriptions not supported",159:"Connection rate exceeded",160:"Maximum connect time",161:"Subscription Identifiers not supported",162:"Wildcard Subscriptions not supported"};function f(){return"mqttjs_"+Math.random().toString(16).substr(2,8)}function b(t,e,r){t.emit("packetsend",e),!s.writeToStream(e,t.stream,t.options)&&r?t.stream.once("drain",r):r&&r()}function g(t){t&&Object.keys(t).forEach((function(e){"function"==typeof t[e].cb&&(t[e].cb(new Error("Connection closed")),delete t[e])}))}function m(t){t&&Object.keys(t).forEach((function(e){t[e].volatile&&"function"==typeof t[e].cb&&(t[e].cb(new Error("Connection closed")),delete t[e])}))}function y(t,e,r,n){t.outgoingStore.put(e,(function(i){if(i)return r&&r(i);n(),b(t,e,r)}))}function v(){}function R(t,e){var r,n=this;if(!(this instanceof R))return new R(t,e);for(r in this.options=e||{},_)void 0===this.options[r]?this.options[r]=_[r]:this.options[r]=e[r];this.options.clientId="string"==typeof e.clientId?e.clientId:f(),this.options.customHandleAcks=5===e.protocolVersion&&e.customHandleAcks?e.customHandleAcks:function(){arguments[3](0)},this.streamBuilder=t,this.outgoingStore=e.outgoingStore||new o,this.incomingStore=e.incomingStore||new o,this.queueQoSZero=void 0===e.queueQoSZero||e.queueQoSZero,this._resubscribeTopics={},this.messageIdToTopic={},this.pingTimer=null,this.connected=!1,this.disconnecting=!1,this.queue=[],this.connackTimer=null,this.reconnectTimer=null,this._storeProcessing=!1,this._packetIdsDuringStoreProcessing={},this.nextId=Math.max(1,Math.floor(65535*Math.random())),this.outgoing={},this._firstConnection=!0,this.on("close",(function(){this.connected=!1,clearTimeout(this.connackTimer)})),this.on("connect",(function(){var t=this.queue;function e(){var r=t.shift(),i=null;r&&(i=r.packet,n._sendPacket(i,(function(t){r.cb&&r.cb(t),e()})))}e()})),this.on("close",(function(){null!==n.pingTimer&&(n.pingTimer.clear(),n.pingTimer=null)})),this.on("close",this._setupReconnect),i.EventEmitter.call(this),this._setupStream()}c(R,i.EventEmitter),R.prototype._setupStream=function(){var t,e=this,n=new a,i=s.parser(this.options),o=null,c=[];function u(){if(c.length)r.nextTick(h);else{var t=o;o=null,t()}}function h(){var t=c.shift();if(t)e._handlePacket(t,u);else{var r=o;o=null,r&&r()}}if(this._clearReconnect(),this.stream=this.streamBuilder(this),i.on("packet",(function(t){c.push(t)})),n._write=function(t,e,r){o=r,i.parse(t),h()},this.stream.pipe(n),this.stream.on("error",v),this.stream.on("close",(function(){m(e.outgoing),e.emit("close")})),(t=Object.create(this.options)).cmd="connect",b(this,t),i.on("error",this.emit.bind(this,"error")),this.options.properties){if(!this.options.properties.authenticationMethod&&this.options.properties.authenticationData)return this.emit("error",new Error("Packet has no Authentication Method")),this;this.options.properties.authenticationMethod&&this.options.authPacket&&"object"==typeof this.options.authPacket&&b(this,d({cmd:"auth",reasonCode:0},this.options.authPacket))}this.stream.setMaxListeners(1e3),clearTimeout(this.connackTimer),this.connackTimer=setTimeout((function(){e._cleanUp(!0)}),this.options.connectTimeout)},R.prototype._handlePacket=function(t,e){var r=this.options;if(5===r.protocolVersion&&r.properties&&r.properties.maximumPacketSize&&r.properties.maximumPacketSize<t.length)return this.emit("error",new Error("exceeding packets size "+t.cmd)),this.end({reasonCode:149,properties:{reasonString:"Maximum packet size was exceeded"}}),this;switch(this.emit("packetreceive",t),t.cmd){case"publish":this._handlePublish(t,e);break;case"puback":case"pubrec":case"pubcomp":case"suback":case"unsuback":this._handleAck(t),e();break;case"pubrel":this._handlePubrel(t,e);break;case"connack":this._handleConnack(t),e();break;case"pingresp":this._handlePingresp(t),e();break;case"disconnect":this._handleDisconnect(t),e()}},R.prototype._checkDisconnecting=function(t){return this.disconnecting&&(t?t(new Error("client disconnecting")):this.emit("error",new Error("client disconnecting"))),this.disconnecting},R.prototype.publish=function(t,e,r,n){var i,o=this.options;if("function"==typeof r&&(n=r,r=null),r=d({qos:0,retain:!1,dup:!1},r),this._checkDisconnecting(n))return this;switch(i={cmd:"publish",topic:t,payload:e,qos:r.qos,retain:r.retain,messageId:this._nextId(),dup:r.dup},5===o.protocolVersion&&(i.properties=r.properties,(!o.properties&&i.properties&&i.properties.topicAlias||r.properties&&o.properties&&(r.properties.topicAlias&&o.properties.topicAliasMaximum&&r.properties.topicAlias>o.properties.topicAliasMaximum||!o.properties.topicAliasMaximum&&r.properties.topicAlias))&&delete i.properties.topicAlias),r.qos){case 1:case 2:this.outgoing[i.messageId]={volatile:!1,cb:n||v},this._storeProcessing?(this._packetIdsDuringStoreProcessing[i.messageId]=!1,this._storePacket(i,void 0,r.cbStorePut)):this._sendPacket(i,void 0,r.cbStorePut);break;default:this._storeProcessing?this._storePacket(i,n,r.cbStorePut):this._sendPacket(i,n,r.cbStorePut)}return this},R.prototype.subscribe=function(){for(var t,e=new Array(arguments.length),r=0;r<arguments.length;r++)e[r]=arguments[r];var n,i=[],o=e.shift(),s=o.resubscribe,a=e.pop()||v,c=e.pop(),u=this,_=this.options.protocolVersion;if(delete o.resubscribe,"string"==typeof o&&(o=[o]),"function"!=typeof a&&(c=a,a=v),null!==(n=h.validateTopics(o)))return l(a,new Error("Invalid topic "+n)),this;if(this._checkDisconnecting(a))return this;var p={qos:0};if(5===_&&(p.nl=!1,p.rap=!1,p.rh=0),c=d(p,c),Array.isArray(o)?o.forEach((function(t){if(!u._resubscribeTopics.hasOwnProperty(t)||u._resubscribeTopics[t].qos<c.qos||s){var e={topic:t,qos:c.qos};5===_&&(e.nl=c.nl,e.rap=c.rap,e.rh=c.rh,e.properties=c.properties),i.push(e)}})):Object.keys(o).forEach((function(t){if(!u._resubscribeTopics.hasOwnProperty(t)||u._resubscribeTopics[t].qos<o[t].qos||s){var e={topic:t,qos:o[t].qos};5===_&&(e.nl=o[t].nl,e.rap=o[t].rap,e.rh=o[t].rh,e.properties=c.properties),i.push(e)}})),t={cmd:"subscribe",subscriptions:i,qos:1,retain:!1,dup:!1,messageId:this._nextId()},c.properties&&(t.properties=c.properties),i.length){if(this.options.resubscribe){var f=[];i.forEach((function(t){if(u.options.reconnectPeriod>0){var e={qos:t.qos};5===_&&(e.nl=t.nl||!1,e.rap=t.rap||!1,e.rh=t.rh||0,e.properties=t.properties),u._resubscribeTopics[t.topic]=e,f.push(t.topic)}})),u.messageIdToTopic[t.messageId]=f}return this.outgoing[t.messageId]={volatile:!0,cb:function(t,e){if(!t)for(var r=e.granted,n=0;n<r.length;n+=1)i[n].qos=r[n];a(t,i)}},this._sendPacket(t),this}a(null,[])},R.prototype.unsubscribe=function(){for(var t={cmd:"unsubscribe",qos:1,messageId:this._nextId()},e=this,r=new Array(arguments.length),n=0;n<arguments.length;n++)r[n]=arguments[n];var i=r.shift(),o=r.pop()||v,s=r.pop();return"string"==typeof i&&(i=[i]),"function"!=typeof o&&(s=o,o=v),this._checkDisconnecting(o)||("string"==typeof i?t.unsubscriptions=[i]:"object"==typeof i&&i.length&&(t.unsubscriptions=i),this.options.resubscribe&&t.unsubscriptions.forEach((function(t){delete e._resubscribeTopics[t]})),"object"==typeof s&&s.properties&&(t.properties=s.properties),this.outgoing[t.messageId]={volatile:!0,cb:o},this._sendPacket(t)),this},R.prototype.end=function(){var t=this,e=arguments[0],r=arguments[1],n=arguments[2];function i(){t.disconnected=!0,t.incomingStore.close((function(){t.outgoingStore.close((function(){n&&n.apply(null,arguments),t.emit("end")}))})),t._deferredReconnect&&t._deferredReconnect()}function o(){t._cleanUp(e,l.bind(null,i),r)}return null!=e&&"boolean"==typeof e||(n=r||v,r=e,e=!1,"object"!=typeof r&&(n=r,r=null,"function"!=typeof n&&(n=v))),"object"!=typeof r&&(n=r,r=null),n=n||v,this.disconnecting||(this._clearReconnect(),this.disconnecting=!0,!e&&Object.keys(this.outgoing).length>0?this.once("outgoingEmpty",setTimeout.bind(null,o,10)):o()),this},R.prototype.removeOutgoingMessage=function(t){var e=this.outgoing[t]?this.outgoing[t].cb:null;return delete this.outgoing[t],this.outgoingStore.del({messageId:t},(function(){e(new Error("Message removed"))})),this},R.prototype.reconnect=function(t){var e=this,r=function(){t?(e.options.incomingStore=t.incomingStore,e.options.outgoingStore=t.outgoingStore):(e.options.incomingStore=null,e.options.outgoingStore=null),e.incomingStore=e.options.incomingStore||new o,e.outgoingStore=e.options.outgoingStore||new o,e.disconnecting=!1,e.disconnected=!1,e._deferredReconnect=null,e._reconnect()};return this.disconnecting&&!this.disconnected?this._deferredReconnect=r:r(),this},R.prototype._reconnect=function(){this.emit("reconnect"),this._setupStream()},R.prototype._setupReconnect=function(){var t=this;!t.disconnecting&&!t.reconnectTimer&&t.options.reconnectPeriod>0&&(this.reconnecting||(this.emit("offline"),this.reconnecting=!0),t.reconnectTimer=setInterval((function(){t._reconnect()}),t.options.reconnectPeriod))},R.prototype._clearReconnect=function(){this.reconnectTimer&&(clearInterval(this.reconnectTimer),this.reconnectTimer=null)},R.prototype._cleanUp=function(t,e){var r=arguments[2];if(e&&this.stream.on("close",e),t)0===this.options.reconnectPeriod&&this.options.clean&&g(this.outgoing),this.stream.destroy();else{var n=d({cmd:"disconnect"},r);this._sendPacket(n,l.bind(null,this.stream.end.bind(this.stream)))}this.disconnecting||(this._clearReconnect(),this._setupReconnect()),null!==this.pingTimer&&(this.pingTimer.clear(),this.pingTimer=null),e&&!this.connected&&(this.stream.removeListener("close",e),e())},R.prototype._sendPacket=function(t,e,r){if(r=r||v,this.connected){switch(this._shiftPingInterval(),t.cmd){case"publish":break;case"pubrel":return void y(this,t,e,r);default:return void b(this,t,e)}switch(t.qos){case 2:case 1:y(this,t,e,r);break;case 0:default:b(this,t,e)}}else this._storePacket(t,e,r)},R.prototype._storePacket=function(t,e,r){r=r||v,0===(t.qos||0)&&this.queueQoSZero||"publish"!==t.cmd?this.queue.push({packet:t,cb:e}):t.qos>0?(e=this.outgoing[t.messageId]?this.outgoing[t.messageId].cb:null,this.outgoingStore.put(t,(function(t){if(t)return e&&e(t);r()}))):e&&e(new Error("No connection to broker"))},R.prototype._setupPingTimer=function(){var t=this;!this.pingTimer&&this.options.keepalive&&(this.pingResp=!0,this.pingTimer=u((function(){t._checkPing()}),1e3*this.options.keepalive))},R.prototype._shiftPingInterval=function(){this.pingTimer&&this.options.keepalive&&this.options.reschedulePings&&this.pingTimer.reschedule(1e3*this.options.keepalive)},R.prototype._checkPing=function(){this.pingResp?(this.pingResp=!1,this._sendPacket({cmd:"pingreq"})):this._cleanUp(!0)},R.prototype._handlePingresp=function(){this.pingResp=!0},R.prototype._handleConnack=function(t){var e=this.options,r=5===e.protocolVersion?t.reasonCode:t.returnCode;if(clearTimeout(this.connackTimer),t.properties&&(t.properties.topicAliasMaximum&&(e.properties||(e.properties={}),e.properties.topicAliasMaximum=t.properties.topicAliasMaximum),t.properties.serverKeepAlive&&e.keepalive&&(e.keepalive=t.properties.serverKeepAlive,this._shiftPingInterval()),t.properties.maximumPacketSize&&(e.properties||(e.properties={}),e.properties.maximumPacketSize=t.properties.maximumPacketSize)),0===r)this.reconnecting=!1,this._onConnect(t);else if(r>0){var n=new Error("Connection refused: "+p[r]);n.code=r,this.emit("error",n)}},R.prototype._handlePublish=function(t,e){e=void 0!==e?e:v;var r=t.topic.toString(),n=t.payload,i=t.qos,o=t.messageId,s=this,a=this.options,c=[0,16,128,131,135,144,145,151,153];switch(i){case 2:a.customHandleAcks(r,n,t,(function(r,n){return r instanceof Error||(n=r,r=null),r?s.emit("error",r):-1===c.indexOf(n)?s.emit("error",new Error("Wrong reason code for pubrec")):void(n?s._sendPacket({cmd:"pubrec",messageId:o,reasonCode:n},e):s.incomingStore.put(t,(function(){s._sendPacket({cmd:"pubrec",messageId:o},e)})))}));break;case 1:a.customHandleAcks(r,n,t,(function(i,a){return i instanceof Error||(a=i,i=null),i?s.emit("error",i):-1===c.indexOf(a)?s.emit("error",new Error("Wrong reason code for puback")):(a||s.emit("message",r,n,t),void s.handleMessage(t,(function(t){if(t)return e&&e(t);s._sendPacket({cmd:"puback",messageId:o,reasonCode:a},e)})))}));break;case 0:this.emit("message",r,n,t),this.handleMessage(t,e)}},R.prototype.handleMessage=function(t,e){e()},R.prototype._handleAck=function(t){var e,r=t.messageId,n=t.cmd,i=null,o=this.outgoing[r]?this.outgoing[r].cb:null,s=this;if(o){switch(n){case"pubcomp":case"puback":var a=t.reasonCode;a&&a>0&&16!==a&&((e=new Error("Publish error: "+p[a])).code=a,o(e,t)),delete this.outgoing[r],this.outgoingStore.del(t,o);break;case"pubrec":i={cmd:"pubrel",qos:2,messageId:r};var c=t.reasonCode;c&&c>0&&16!==c?((e=new Error("Publish error: "+p[c])).code=c,o(e,t)):this._sendPacket(i);break;case"suback":delete this.outgoing[r];for(var u=0;u<t.granted.length;u++)if(0!=(128&t.granted[u])){var h=this.messageIdToTopic[r];h&&h.forEach((function(t){delete s._resubscribeTopics[t]}))}o(null,t);break;case"unsuback":delete this.outgoing[r],o(null);break;default:s.emit("error",new Error("unrecognized packet type"))}this.disconnecting&&0===Object.keys(this.outgoing).length&&this.emit("outgoingEmpty")}},R.prototype._handlePubrel=function(t,e){e=void 0!==e?e:v;var r=t.messageId,n=this,i={cmd:"pubcomp",messageId:r};n.incomingStore.get(t,(function(t,r){t?n._sendPacket(i,e):(n.emit("message",r.topic,r.payload,r),n.handleMessage(r,(function(t){if(t)return e(t);n.incomingStore.del(r,v),n._sendPacket(i,e)})))}))},R.prototype._handleDisconnect=function(t){this.emit("disconnect",t)},R.prototype._nextId=function(){var t=this.nextId++;return 65536===this.nextId&&(this.nextId=1),t},R.prototype.getLastMessageId=function(){return 1===this.nextId?65535:this.nextId-1},R.prototype._resubscribe=function(t){var e=Object.keys(this._resubscribeTopics);if(!this._firstConnection&&(this.options.clean||5===this.options.protocolVersion&&!t.sessionPresent)&&e.length>0)if(this.options.resubscribe)if(5===this.options.protocolVersion)for(var r=0;r<e.length;r++){var n={};n[e[r]]=this._resubscribeTopics[e[r]],n.resubscribe=!0,this.subscribe(n,{properties:n[e[r]].properties})}else this._resubscribeTopics.resubscribe=!0,this.subscribe(this._resubscribeTopics);else this._resubscribeTopics={};this._firstConnection=!1},R.prototype._onConnect=function(t){if(this.disconnected)this.emit("connect",t);else{var e=this;this._setupPingTimer(),this._resubscribe(t),this.connected=!0,r()}function r(){var n=e.outgoingStore.createStream();function i(){e._storeProcessing=!1,e._packetIdsDuringStoreProcessing={}}function o(){n.destroy(),n=null,i()}function s(){if(n){e._storeProcessing=!0;var t,r=n.read(1);r?e._packetIdsDuringStoreProcessing[r.messageId]?s():e.disconnecting||e.reconnectTimer?n.destroy&&n.destroy():(t=e.outgoing[r.messageId]?e.outgoing[r.messageId].cb:null,e.outgoing[r.messageId]={volatile:!1,cb:function(e,r){t&&t(e,r),s()}},e._packetIdsDuringStoreProcessing[r.messageId]=!0,e._sendPacket(r)):n.once("readable",s)}}e.once("close",o),n.on("error",(function(t){i(),e.removeListener("close",o),e.emit("error",t)})),n.on("end",(function(){var n=!0;for(var s in e._packetIdsDuringStoreProcessing)if(!e._packetIdsDuringStoreProcessing[s]){n=!1;break}n?(i(),e.removeListener("close",o),e.emit("connect",t)):r()})),s()}},e.exports=R}).call(this,t("_process"),void 0!==M?M:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./store":7,"./validations":8,_process:92,events:13,inherits:80,"mqtt-packet":84,"readable-stream":108,reinterval:109,xtend:121}],2:[function(t,e,r){(function(r){var n,i,o,s=t("readable-stream").Transform,a=t("duplexify"),c=t("base64-js"),u=!1;function h(){var t=new s;return t._write=function(t,e,r){n.sendSocketMessage({data:t.buffer,success:function(){r()},fail:function(){r(new Error)}})},t._flush=function(t){n.closeSocket({success:function(){t()}})},t}function d(t){t.hostname||(t.hostname="localhost"),t.path||(t.path="/"),t.wsOptions||(t.wsOptions={})}function l(t,e){var r="alis"===t.protocol?"wss":"ws",n=r+"://"+t.hostname+t.path;return t.port&&80!==t.port&&443!==t.port&&(n=r+"://"+t.hostname+":"+t.port+t.path),"function"==typeof t.transformWsUrl&&(n=t.transformWsUrl(n,t,e)),n}function _(){u||(u=!0,n.onSocketOpen((function(){o.setReadable(i),o.setWritable(i),o.emit("connect")})),n.onSocketMessage((function(t){if("string"==typeof t.data){var e=c.toByteArray(t.data),n=r.from(e);i.push(n)}else{var o=new FileReader;o.addEventListener("load",(function(){var t=o.result;t=t instanceof ArrayBuffer?r.from(t):r.from(t,"utf8"),i.push(t)})),o.readAsArrayBuffer(t.data)}})),n.onSocketClose((function(){o.end(),o.destroy()})),n.onSocketError((function(t){o.destroy(t)})))}function p(t,e){if(e.hostname=e.hostname||e.host,!e.hostname)throw new Error("Could not determine host. Specify host manually.");var r="MQIsdp"===e.protocolId&&3===e.protocolVersion?"mqttv3.1":"mqtt";d(e);var s=l(e,t);return(n=e.my).connectSocket({url:s,protocols:r}),i=h(),o=a.obj(),_(),o}e.exports=p}).call(this,t("buffer").Buffer)},{"base64-js":10,buffer:12,duplexify:17,"readable-stream":108}],3:[function(t,e,r){var n=t("net");function i(t,e){var r,i;return e.port=e.port||1883,e.hostname=e.hostname||e.host||"localhost",r=e.port,i=e.hostname,n.createConnection(r,i)}e.exports=i},{net:11}],4:[function(t,e,r){var n=t("tls");function i(t,e){var r;function i(n){e.rejectUnauthorized&&t.emit("error",n),r.end()}return e.port=e.port||8883,e.host=e.hostname||e.host||"localhost",e.rejectUnauthorized=!1!==e.rejectUnauthorized,delete e.path,(r=n.connect(e)).on("secureConnect",(function(){e.rejectUnauthorized&&!r.authorized?r.emit("error",new Error("TLS not authorized")):r.removeListener("error",i)})),r.on("error",i),r}e.exports=i},{tls:11}],5:[function(t,e,r){(function(r){var n=t("websocket-stream"),i=t("url"),o=["rejectUnauthorized","ca","cert","key","pfx","passphrase"],s="browser"===r.title;function a(t,e){var r=t.protocol+"://"+t.hostname+":"+t.port+t.path;return"function"==typeof t.transformWsUrl&&(r=t.transformWsUrl(r,t,e)),r}function c(t){t.hostname||(t.hostname="localhost"),t.port||("wss"===t.protocol?t.port=443:t.port=80),t.path||(t.path="/"),t.wsOptions||(t.wsOptions={}),s||"wss"!==t.protocol||o.forEach((function(e){t.hasOwnProperty(e)&&!t.wsOptions.hasOwnProperty(e)&&(t.wsOptions[e]=t[e])}))}function u(t,e){var r="MQIsdp"===e.protocolId&&3===e.protocolVersion?"mqttv3.1":"mqtt";c(e);var i=a(e,t);return n(i,[r],e.wsOptions)}function h(t,e){return u(t,e)}function d(t,e){if(e.hostname||(e.hostname=e.host),!e.hostname){if("undefined"==typeof document)throw new Error("Could not determine host. Specify host manually.");var r=i.parse(document.URL);e.hostname=r.hostname,e.port||(e.port=r.port)}return u(t,e)}e.exports=s?d:h}).call(this,t("_process"))},{_process:92,url:113,"websocket-stream":118}],6:[function(t,e,r){(function(r,n){var i,o,s,a=t("readable-stream").Transform,c=t("duplexify");function u(){var t=new a;return t._write=function(t,e,r){i.send({data:t.buffer,success:function(){r()},fail:function(t){r(new Error(t))}})},t._flush=function(t){i.close({success:function(){t()}})},t}function h(t){t.hostname||(t.hostname="localhost"),t.path||(t.path="/"),t.wsOptions||(t.wsOptions={})}function d(t,e){var r="wxs"===t.protocol?"wss":"ws",n=r+"://"+t.hostname+t.path;return t.port&&80!==t.port&&443!==t.port&&(n=r+"://"+t.hostname+":"+t.port+t.path),"function"==typeof t.transformWsUrl&&(n=t.transformWsUrl(n,t,e)),n}function l(){i.onOpen((function(){s.setReadable(o),s.setWritable(o),s.emit("connect")})),i.onMessage((function(t){var e=t.data;e=e instanceof ArrayBuffer?n.from(e):n.from(e,"utf8"),o.push(e)})),i.onClose((function(){s.end(),s.destroy()})),i.onError((function(t){s.destroy(new Error(t.errMsg))}))}function _(t,e){if(e.hostname=e.hostname||e.host,!e.hostname)throw new Error("Could not determine host. Specify host manually.");var n="MQIsdp"===e.protocolId&&3===e.protocolVersion?"mqttv3.1":"mqtt";h(e);var a=d(e,t);i=wx.connectSocket({url:a,protocols:n}),o=u(),(s=c.obj())._destroy=function(t,e){i.close({success:function(){e&&e(t)}})};var _=s.destroy;return s.destroy=function(){s.destroy=_;var t=this;r.nextTick((function(){i.close({fail:function(){t._destroy(new Error)}})}))}.bind(s),l(),s}e.exports=_}).call(this,t("_process"),t("buffer").Buffer)},{_process:92,buffer:12,duplexify:17,"readable-stream":108}],7:[function(t,e,r){(function(r){var n=t("xtend"),i=t("readable-stream").Readable,o={objectMode:!0},s={clean:!0},a=t("es6-map");function c(t){if(!(this instanceof c))return new c(t);this.options=t||{},this.options=n(s,t),this._inflights=new a}c.prototype.put=function(t,e){return this._inflights.set(t.messageId,t),e&&e(),this},c.prototype.createStream=function(){var t=new i(o),e=!1,n=[],s=0;return this._inflights.forEach((function(t,e){n.push(t)})),t._read=function(){!e&&s<n.length?this.push(n[s++]):this.push(null)},t.destroy=function(){if(!e){var t=this;e=!0,r.nextTick((function(){t.emit("close")}))}},t},c.prototype.del=function(t,e){return(t=this._inflights.get(t.messageId))?(this._inflights.delete(t.messageId),e(null,t)):e&&e(new Error("missing packet")),this},c.prototype.get=function(t,e){return(t=this._inflights.get(t.messageId))?e(null,t):e&&e(new Error("missing packet")),this},c.prototype.close=function(t){this.options.clean&&(this._inflights=null),t&&t()},e.exports=c}).call(this,t("_process"))},{_process:92,"es6-map":67,"readable-stream":108,xtend:121}],8:[function(t,e,r){function n(t){for(var e=t.split("/"),r=0;r<e.length;r++)if("+"!==e[r]){if("#"===e[r])return r===e.length-1;if(-1!==e[r].indexOf("+")||-1!==e[r].indexOf("#"))return!1}return!0}function i(t){if(0===t.length)return"empty_topic_list";for(var e=0;e<t.length;e++)if(!n(t[e]))return t[e];return null}e.exports={validateTopics:i}},{}],9:[function(t,e,r){(function(r){var n=t("../client"),i=t("../store"),o=t("url"),s=t("xtend"),a={};function c(t){var e;t.auth&&((e=t.auth.match(/^(.+):(.+)$/))?(t.username=e[1],t.password=e[2]):t.username=t.auth)}function u(t,e){if("object"!=typeof t||e||(e=t,t=null),e=e||{},t){var r=o.parse(t,!0);if(null!=r.port&&(r.port=Number(r.port)),null===(e=s(r,e)).protocol)throw new Error("Missing protocol");e.protocol=e.protocol.replace(/:$/,"")}if(c(e),e.query&&"string"==typeof e.query.clientId&&(e.clientId=e.query.clientId),e.cert&&e.key){if(!e.protocol)throw new Error("Missing secure protocol key");if(-1===["mqtts","wss","wxs","alis"].indexOf(e.protocol))switch(e.protocol){case"mqtt":e.protocol="mqtts";break;case"ws":e.protocol="wss";break;case"wx":e.protocol="wxs";break;case"ali":e.protocol="alis";break;default:throw new Error('Unknown protocol for secure connection: "'+e.protocol+'"!')}}if(!a[e.protocol]){var i=-1!==["mqtts","wss"].indexOf(e.protocol);e.protocol=["mqtt","mqtts","ws","wss","wx","wxs","ali","alis"].filter((function(t,e){return(!i||e%2!=0)&&"function"==typeof a[t]}))[0]}if(!1===e.clean&&!e.clientId)throw new Error("Missing clientId for unclean clients");function u(t){return e.servers&&(t._reconnectCount&&t._reconnectCount!==e.servers.length||(t._reconnectCount=0),e.host=e.servers[t._reconnectCount].host,e.port=e.servers[t._reconnectCount].port,e.protocol=e.servers[t._reconnectCount].protocol?e.servers[t._reconnectCount].protocol:e.defaultProtocol,e.hostname=e.host,t._reconnectCount++),a[e.protocol](t,e)}return e.protocol&&(e.defaultProtocol=e.protocol),new n(u,e)}"browser"!==r.title?(a.mqtt=t("./tcp"),a.tcp=t("./tcp"),a.ssl=t("./tls"),a.tls=t("./tls"),a.mqtts=t("./tls")):(a.wx=t("./wx"),a.wxs=t("./wx"),a.ali=t("./ali"),a.alis=t("./ali")),a.ws=t("./ws"),a.wss=t("./ws"),e.exports=u,e.exports.connect=u,e.exports.MqttClient=n,e.exports.Store=i}).call(this,t("_process"))},{"../client":1,"../store":7,"./ali":2,"./tcp":3,"./tls":4,"./ws":5,"./wx":6,_process:92,url:113,xtend:121}],10:[function(t,e,r){r.byteLength=h,r.toByteArray=l,r.fromByteArray=f;for(var n=[],i=[],o="undefined"!=typeof Uint8Array?Uint8Array:Array,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0,c=s.length;a<c;++a)n[a]=s[a],i[s.charCodeAt(a)]=a;function u(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=t.indexOf("=");return-1===r&&(r=e),[r,r===e?0:4-r%4]}function h(t){var e=u(t),r=e[0],n=e[1];return 3*(r+n)/4-n}function d(t,e,r){return 3*(e+r)/4-r}function l(t){for(var e,r=u(t),n=r[0],s=r[1],a=new o(d(t,n,s)),c=0,h=s>0?n-4:n,l=0;l<h;l+=4)e=i[t.charCodeAt(l)]<<18|i[t.charCodeAt(l+1)]<<12|i[t.charCodeAt(l+2)]<<6|i[t.charCodeAt(l+3)],a[c++]=e>>16&255,a[c++]=e>>8&255,a[c++]=255&e;return 2===s&&(e=i[t.charCodeAt(l)]<<2|i[t.charCodeAt(l+1)]>>4,a[c++]=255&e),1===s&&(e=i[t.charCodeAt(l)]<<10|i[t.charCodeAt(l+1)]<<4|i[t.charCodeAt(l+2)]>>2,a[c++]=e>>8&255,a[c++]=255&e),a}function _(t){return n[t>>18&63]+n[t>>12&63]+n[t>>6&63]+n[63&t]}function p(t,e,r){for(var n,i=[],o=e;o<r;o+=3)n=(t[o]<<16&16711680)+(t[o+1]<<8&65280)+(255&t[o+2]),i.push(_(n));return i.join("")}function f(t){for(var e,r=t.length,i=r%3,o=[],s=16383,a=0,c=r-i;a<c;a+=s)o.push(p(t,a,a+s>c?c:a+s));return 1===i?(e=t[r-1],o.push(n[e>>2]+n[e<<4&63]+"==")):2===i&&(e=(t[r-2]<<8)+t[r-1],o.push(n[e>>10]+n[e>>4&63]+n[e<<2&63]+"=")),o.join("")}i["-".charCodeAt(0)]=62,i["_".charCodeAt(0)]=63},{}],11:[function(t,e,r){},{}],12:[function(t,e,r){var n=t("base64-js"),i=t("ieee754");r.Buffer=c,r.SlowBuffer=m,r.INSPECT_MAX_BYTES=50;var o=2147483647;function s(){try{var t=new Uint8Array(1);return t.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===t.foo()}catch(ae){return!1}}function a(t){if(t>o)throw new RangeError('The value "'+t+'" is invalid for option "size"');var e=new Uint8Array(t);return e.__proto__=c.prototype,e}function c(t,e,r){if("number"==typeof t){if("string"==typeof e)throw new TypeError('The "string" argument must be of type string. Received type number');return l(t)}return u(t,e,r)}function u(t,e,r){if("string"==typeof t)return _(t,e);if(ArrayBuffer.isView(t))return p(t);if(null==t)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof t);if(Y(t,ArrayBuffer)||t&&Y(t.buffer,ArrayBuffer))return f(t,e,r);if("number"==typeof t)throw new TypeError('The "value" argument must not be of type number. Received type number');var n=t.valueOf&&t.valueOf();if(null!=n&&n!==t)return c.from(n,e,r);var i=b(t);if(i)return i;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof t[Symbol.toPrimitive])return c.from(t[Symbol.toPrimitive]("string"),e,r);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof t)}function h(t){if("number"!=typeof t)throw new TypeError('"size" argument must be of type number');if(t<0)throw new RangeError('The value "'+t+'" is invalid for option "size"')}function d(t,e,r){return h(t),t<=0?a(t):void 0!==e?"string"==typeof r?a(t).fill(e,r):a(t).fill(e):a(t)}function l(t){return h(t),a(t<0?0:0|g(t))}function _(t,e){if("string"==typeof e&&""!==e||(e="utf8"),!c.isEncoding(e))throw new TypeError("Unknown encoding: "+e);var r=0|y(t,e),n=a(r),i=n.write(t,e);return i!==r&&(n=n.slice(0,i)),n}function p(t){for(var e=t.length<0?0:0|g(t.length),r=a(e),n=0;n<e;n+=1)r[n]=255&t[n];return r}function f(t,e,r){if(e<0||t.byteLength<e)throw new RangeError('"offset" is outside of buffer bounds');if(t.byteLength<e+(r||0))throw new RangeError('"length" is outside of buffer bounds');var n;return(n=void 0===e&&void 0===r?new Uint8Array(t):void 0===r?new Uint8Array(t,e):new Uint8Array(t,e,r)).__proto__=c.prototype,n}function b(t){if(c.isBuffer(t)){var e=0|g(t.length),r=a(e);return 0===r.length||t.copy(r,0,0,e),r}return void 0!==t.length?"number"!=typeof t.length||J(t.length)?a(0):p(t):"Buffer"===t.type&&Array.isArray(t.data)?p(t.data):void 0}function g(t){if(t>=o)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+o.toString(16)+" bytes");return 0|t}function m(t){return+t!=t&&(t=0),c.alloc(+t)}function y(t,e){if(c.isBuffer(t))return t.length;if(ArrayBuffer.isView(t)||Y(t,ArrayBuffer))return t.byteLength;if("string"!=typeof t)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof t);var r=t.length,n=arguments.length>2&&!0===arguments[2];if(!n&&0===r)return 0;for(var i=!1;;)switch(e){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":return W(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return Z(t).length;default:if(i)return n?-1:W(t).length;e=(""+e).toLowerCase(),i=!0}}function v(t,e,r){var n=!1;if((void 0===e||e<0)&&(e=0),e>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(e>>>=0))return"";for(t||(t="utf8");;)switch(t){case"hex":return D(this,e,r);case"utf8":case"utf-8":return M(this,e,r);case"ascii":return O(this,e,r);case"latin1":case"binary":return B(this,e,r);case"base64":return L(this,e,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return U(this,e,r);default:if(n)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),n=!0}}function R(t,e,r){var n=t[e];t[e]=t[r],t[r]=n}function w(t,e,r,n,i){if(0===t.length)return-1;if("string"==typeof r?(n=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),J(r=+r)&&(r=i?0:t.length-1),r<0&&(r=t.length+r),r>=t.length){if(i)return-1;r=t.length-1}else if(r<0){if(!i)return-1;r=0}if("string"==typeof e&&(e=c.from(e,n)),c.isBuffer(e))return 0===e.length?-1:S(t,e,r,n,i);if("number"==typeof e)return e&=255,"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(t,e,r):Uint8Array.prototype.lastIndexOf.call(t,e,r):S(t,[e],r,n,i);throw new TypeError("val must be string, number or Buffer")}function S(t,e,r,n,i){var o,s=1,a=t.length,c=e.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(t.length<2||e.length<2)return-1;s=2,a/=2,c/=2,r/=2}function u(t,e){return 1===s?t[e]:t.readUInt16BE(e*s)}if(i){var h=-1;for(o=r;o<a;o++)if(u(t,o)===u(e,-1===h?0:o-h)){if(-1===h&&(h=o),o-h+1===c)return h*s}else-1!==h&&(o-=o-h),h=-1}else for(r+c>a&&(r=a-c),o=r;o>=0;o--){for(var d=!0,l=0;l<c;l++)if(u(t,o+l)!==u(e,l)){d=!1;break}if(d)return o}return-1}function T(t,e,r,n){r=Number(r)||0;var i=t.length-r;n?(n=Number(n))>i&&(n=i):n=i;var o=e.length;n>o/2&&(n=o/2);for(var s=0;s<n;++s){var a=parseInt(e.substr(2*s,2),16);if(J(a))return s;t[r+s]=a}return s}function C(t,e,r,n){return Q(W(e,t.length-r),t,r,n)}function E(t,e,r,n){return Q(K(e),t,r,n)}function P(t,e,r,n){return E(t,e,r,n)}function x(t,e,r,n){return Q(Z(e),t,r,n)}function I(t,e,r,n){return Q(X(e,t.length-r),t,r,n)}function L(t,e,r){return 0===e&&r===t.length?n.fromByteArray(t):n.fromByteArray(t.slice(e,r))}function M(t,e,r){r=Math.min(t.length,r);for(var n=[],i=e;i<r;){var o,s,a,c,u=t[i],h=null,d=u>239?4:u>223?3:u>191?2:1;if(i+d<=r)switch(d){case 1:u<128&&(h=u);break;case 2:128==(192&(o=t[i+1]))&&(c=(31&u)<<6|63&o)>127&&(h=c);break;case 3:o=t[i+1],s=t[i+2],128==(192&o)&&128==(192&s)&&(c=(15&u)<<12|(63&o)<<6|63&s)>2047&&(c<55296||c>57343)&&(h=c);break;case 4:o=t[i+1],s=t[i+2],a=t[i+3],128==(192&o)&&128==(192&s)&&128==(192&a)&&(c=(15&u)<<18|(63&o)<<12|(63&s)<<6|63&a)>65535&&c<1114112&&(h=c)}null===h?(h=65533,d=1):h>65535&&(h-=65536,n.push(h>>>10&1023|55296),h=56320|1023&h),n.push(h),i+=d}return A(n)}r.kMaxLength=o,c.TYPED_ARRAY_SUPPORT=s(),c.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(c.prototype,"parent",{enumerable:!0,get:function(){if(c.isBuffer(this))return this.buffer}}),Object.defineProperty(c.prototype,"offset",{enumerable:!0,get:function(){if(c.isBuffer(this))return this.byteOffset}}),"undefined"!=typeof Symbol&&null!=Symbol.species&&c[Symbol.species]===c&&Object.defineProperty(c,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),c.poolSize=8192,c.from=function(t,e,r){return u(t,e,r)},c.prototype.__proto__=Uint8Array.prototype,c.__proto__=Uint8Array,c.alloc=function(t,e,r){return d(t,e,r)},c.allocUnsafe=function(t){return l(t)},c.allocUnsafeSlow=function(t){return l(t)},c.isBuffer=function(t){return null!=t&&!0===t._isBuffer&&t!==c.prototype},c.compare=function(t,e){if(Y(t,Uint8Array)&&(t=c.from(t,t.offset,t.byteLength)),Y(e,Uint8Array)&&(e=c.from(e,e.offset,e.byteLength)),!c.isBuffer(t)||!c.isBuffer(e))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(t===e)return 0;for(var r=t.length,n=e.length,i=0,o=Math.min(r,n);i<o;++i)if(t[i]!==e[i]){r=t[i],n=e[i];break}return r<n?-1:n<r?1:0},c.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},c.concat=function(t,e){if(!Array.isArray(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return c.alloc(0);var r;if(void 0===e)for(e=0,r=0;r<t.length;++r)e+=t[r].length;var n=c.allocUnsafe(e),i=0;for(r=0;r<t.length;++r){var o=t[r];if(Y(o,Uint8Array)&&(o=c.from(o)),!c.isBuffer(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(n,i),i+=o.length}return n},c.byteLength=y,c.prototype._isBuffer=!0,c.prototype.swap16=function(){var t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var e=0;e<t;e+=2)R(this,e,e+1);return this},c.prototype.swap32=function(){var t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var e=0;e<t;e+=4)R(this,e,e+3),R(this,e+1,e+2);return this},c.prototype.swap64=function(){var t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var e=0;e<t;e+=8)R(this,e,e+7),R(this,e+1,e+6),R(this,e+2,e+5),R(this,e+3,e+4);return this},c.prototype.toString=function(){var t=this.length;return 0===t?"":0===arguments.length?M(this,0,t):v.apply(this,arguments)},c.prototype.toLocaleString=c.prototype.toString,c.prototype.equals=function(t){if(!c.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t||0===c.compare(this,t)},c.prototype.inspect=function(){var t="",e=r.INSPECT_MAX_BYTES;return t=this.toString("hex",0,e).replace(/(.{2})/g,"$1 ").trim(),this.length>e&&(t+=" ... "),"<Buffer "+t+">"},c.prototype.compare=function(t,e,r,n,i){if(Y(t,Uint8Array)&&(t=c.from(t,t.offset,t.byteLength)),!c.isBuffer(t))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof t);if(void 0===e&&(e=0),void 0===r&&(r=t?t.length:0),void 0===n&&(n=0),void 0===i&&(i=this.length),e<0||r>t.length||n<0||i>this.length)throw new RangeError("out of range index");if(n>=i&&e>=r)return 0;if(n>=i)return-1;if(e>=r)return 1;if(this===t)return 0;for(var o=(i>>>=0)-(n>>>=0),s=(r>>>=0)-(e>>>=0),a=Math.min(o,s),u=this.slice(n,i),h=t.slice(e,r),d=0;d<a;++d)if(u[d]!==h[d]){o=u[d],s=h[d];break}return o<s?-1:s<o?1:0},c.prototype.includes=function(t,e,r){return-1!==this.indexOf(t,e,r)},c.prototype.indexOf=function(t,e,r){return w(this,t,e,r,!0)},c.prototype.lastIndexOf=function(t,e,r){return w(this,t,e,r,!1)},c.prototype.write=function(t,e,r,n){if(void 0===e)n="utf8",r=this.length,e=0;else if(void 0===r&&"string"==typeof e)n=e,r=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e>>>=0,isFinite(r)?(r>>>=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}var i=this.length-e;if((void 0===r||r>i)&&(r=i),t.length>0&&(r<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var o=!1;;)switch(n){case"hex":return T(this,t,e,r);case"utf8":case"utf-8":return C(this,t,e,r);case"ascii":return E(this,t,e,r);case"latin1":case"binary":return P(this,t,e,r);case"base64":return x(this,t,e,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return I(this,t,e,r);default:if(o)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),o=!0}},c.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var k=4096;function A(t){var e=t.length;if(e<=k)return String.fromCharCode.apply(String,t);for(var r="",n=0;n<e;)r+=String.fromCharCode.apply(String,t.slice(n,n+=k));return r}function O(t,e,r){var n="";r=Math.min(t.length,r);for(var i=e;i<r;++i)n+=String.fromCharCode(127&t[i]);return n}function B(t,e,r){var n="";r=Math.min(t.length,r);for(var i=e;i<r;++i)n+=String.fromCharCode(t[i]);return n}function D(t,e,r){var n=t.length;(!e||e<0)&&(e=0),(!r||r<0||r>n)&&(r=n);for(var i="",o=e;o<r;++o)i+=G(t[o]);return i}function U(t,e,r){for(var n=t.slice(e,r),i="",o=0;o<n.length;o+=2)i+=String.fromCharCode(n[o]+256*n[o+1]);return i}function N(t,e,r){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(t+e>r)throw new RangeError("Trying to access beyond buffer length")}function q(t,e,r,n,i,o){if(!c.isBuffer(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>i||e<o)throw new RangeError('"value" argument is out of bounds');if(r+n>t.length)throw new RangeError("Index out of range")}function F(t,e,r,n,i,o){if(r+n>t.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function j(t,e,r,n,o){return e=+e,r>>>=0,o||F(t,e,r,4),i.write(t,e,r,n,23,4),r+4}function V(t,e,r,n,o){return e=+e,r>>>=0,o||F(t,e,r,8),i.write(t,e,r,n,52,8),r+8}c.prototype.slice=function(t,e){var r=this.length;(t=~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),(e=void 0===e?r:~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),e<t&&(e=t);var n=this.subarray(t,e);return n.__proto__=c.prototype,n},c.prototype.readUIntLE=function(t,e,r){t>>>=0,e>>>=0,r||N(t,e,this.length);for(var n=this[t],i=1,o=0;++o<e&&(i*=256);)n+=this[t+o]*i;return n},c.prototype.readUIntBE=function(t,e,r){t>>>=0,e>>>=0,r||N(t,e,this.length);for(var n=this[t+--e],i=1;e>0&&(i*=256);)n+=this[t+--e]*i;return n},c.prototype.readUInt8=function(t,e){return t>>>=0,e||N(t,1,this.length),this[t]},c.prototype.readUInt16LE=function(t,e){return t>>>=0,e||N(t,2,this.length),this[t]|this[t+1]<<8},c.prototype.readUInt16BE=function(t,e){return t>>>=0,e||N(t,2,this.length),this[t]<<8|this[t+1]},c.prototype.readUInt32LE=function(t,e){return t>>>=0,e||N(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},c.prototype.readUInt32BE=function(t,e){return t>>>=0,e||N(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},c.prototype.readIntLE=function(t,e,r){t>>>=0,e>>>=0,r||N(t,e,this.length);for(var n=this[t],i=1,o=0;++o<e&&(i*=256);)n+=this[t+o]*i;return n>=(i*=128)&&(n-=Math.pow(2,8*e)),n},c.prototype.readIntBE=function(t,e,r){t>>>=0,e>>>=0,r||N(t,e,this.length);for(var n=e,i=1,o=this[t+--n];n>0&&(i*=256);)o+=this[t+--n]*i;return o>=(i*=128)&&(o-=Math.pow(2,8*e)),o},c.prototype.readInt8=function(t,e){return t>>>=0,e||N(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},c.prototype.readInt16LE=function(t,e){t>>>=0,e||N(t,2,this.length);var r=this[t]|this[t+1]<<8;return 32768&r?4294901760|r:r},c.prototype.readInt16BE=function(t,e){t>>>=0,e||N(t,2,this.length);var r=this[t+1]|this[t]<<8;return 32768&r?4294901760|r:r},c.prototype.readInt32LE=function(t,e){return t>>>=0,e||N(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},c.prototype.readInt32BE=function(t,e){return t>>>=0,e||N(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},c.prototype.readFloatLE=function(t,e){return t>>>=0,e||N(t,4,this.length),i.read(this,t,!0,23,4)},c.prototype.readFloatBE=function(t,e){return t>>>=0,e||N(t,4,this.length),i.read(this,t,!1,23,4)},c.prototype.readDoubleLE=function(t,e){return t>>>=0,e||N(t,8,this.length),i.read(this,t,!0,52,8)},c.prototype.readDoubleBE=function(t,e){return t>>>=0,e||N(t,8,this.length),i.read(this,t,!1,52,8)},c.prototype.writeUIntLE=function(t,e,r,n){t=+t,e>>>=0,r>>>=0,n||q(this,t,e,r,Math.pow(2,8*r)-1,0);var i=1,o=0;for(this[e]=255&t;++o<r&&(i*=256);)this[e+o]=t/i&255;return e+r},c.prototype.writeUIntBE=function(t,e,r,n){t=+t,e>>>=0,r>>>=0,n||q(this,t,e,r,Math.pow(2,8*r)-1,0);var i=r-1,o=1;for(this[e+i]=255&t;--i>=0&&(o*=256);)this[e+i]=t/o&255;return e+r},c.prototype.writeUInt8=function(t,e,r){return t=+t,e>>>=0,r||q(this,t,e,1,255,0),this[e]=255&t,e+1},c.prototype.writeUInt16LE=function(t,e,r){return t=+t,e>>>=0,r||q(this,t,e,2,65535,0),this[e]=255&t,this[e+1]=t>>>8,e+2},c.prototype.writeUInt16BE=function(t,e,r){return t=+t,e>>>=0,r||q(this,t,e,2,65535,0),this[e]=t>>>8,this[e+1]=255&t,e+2},c.prototype.writeUInt32LE=function(t,e,r){return t=+t,e>>>=0,r||q(this,t,e,4,4294967295,0),this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t,e+4},c.prototype.writeUInt32BE=function(t,e,r){return t=+t,e>>>=0,r||q(this,t,e,4,4294967295,0),this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t,e+4},c.prototype.writeIntLE=function(t,e,r,n){if(t=+t,e>>>=0,!n){var i=Math.pow(2,8*r-1);q(this,t,e,r,i-1,-i)}var o=0,s=1,a=0;for(this[e]=255&t;++o<r&&(s*=256);)t<0&&0===a&&0!==this[e+o-1]&&(a=1),this[e+o]=(t/s>>0)-a&255;return e+r},c.prototype.writeIntBE=function(t,e,r,n){if(t=+t,e>>>=0,!n){var i=Math.pow(2,8*r-1);q(this,t,e,r,i-1,-i)}var o=r-1,s=1,a=0;for(this[e+o]=255&t;--o>=0&&(s*=256);)t<0&&0===a&&0!==this[e+o+1]&&(a=1),this[e+o]=(t/s>>0)-a&255;return e+r},c.prototype.writeInt8=function(t,e,r){return t=+t,e>>>=0,r||q(this,t,e,1,127,-128),t<0&&(t=255+t+1),this[e]=255&t,e+1},c.prototype.writeInt16LE=function(t,e,r){return t=+t,e>>>=0,r||q(this,t,e,2,32767,-32768),this[e]=255&t,this[e+1]=t>>>8,e+2},c.prototype.writeInt16BE=function(t,e,r){return t=+t,e>>>=0,r||q(this,t,e,2,32767,-32768),this[e]=t>>>8,this[e+1]=255&t,e+2},c.prototype.writeInt32LE=function(t,e,r){return t=+t,e>>>=0,r||q(this,t,e,4,2147483647,-2147483648),this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24,e+4},c.prototype.writeInt32BE=function(t,e,r){return t=+t,e>>>=0,r||q(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t,e+4},c.prototype.writeFloatLE=function(t,e,r){return j(this,t,e,!0,r)},c.prototype.writeFloatBE=function(t,e,r){return j(this,t,e,!1,r)},c.prototype.writeDoubleLE=function(t,e,r){return V(this,t,e,!0,r)},c.prototype.writeDoubleBE=function(t,e,r){return V(this,t,e,!1,r)},c.prototype.copy=function(t,e,r,n){if(!c.isBuffer(t))throw new TypeError("argument should be a Buffer");if(r||(r=0),n||0===n||(n=this.length),e>=t.length&&(e=t.length),e||(e=0),n>0&&n<r&&(n=r),n===r)return 0;if(0===t.length||0===this.length)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),t.length-e<n-r&&(n=t.length-e+r);var i=n-r;if(this===t&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(e,r,n);else if(this===t&&r<e&&e<n)for(var o=i-1;o>=0;--o)t[o+e]=this[o+r];else Uint8Array.prototype.set.call(t,this.subarray(r,n),e);return i},c.prototype.fill=function(t,e,r,n){if("string"==typeof t){if("string"==typeof e?(n=e,e=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!c.isEncoding(n))throw new TypeError("Unknown encoding: "+n);if(1===t.length){var i=t.charCodeAt(0);("utf8"===n&&i<128||"latin1"===n)&&(t=i)}}else"number"==typeof t&&(t&=255);if(e<0||this.length<e||this.length<r)throw new RangeError("Out of range index");if(r<=e)return this;var o;if(e>>>=0,r=void 0===r?this.length:r>>>0,t||(t=0),"number"==typeof t)for(o=e;o<r;++o)this[o]=t;else{var s=c.isBuffer(t)?t:c.from(t,n),a=s.length;if(0===a)throw new TypeError('The value "'+t+'" is invalid for argument "value"');for(o=0;o<r-e;++o)this[o+e]=s[o%a]}return this};var z=/[^+/0-9A-Za-z-_]/g;function H(t){if((t=(t=t.split("=")[0]).trim().replace(z,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}function G(t){return t<16?"0"+t.toString(16):t.toString(16)}function W(t,e){var r;e=e||1/0;for(var n=t.length,i=null,o=[],s=0;s<n;++s){if((r=t.charCodeAt(s))>55295&&r<57344){if(!i){if(r>56319){(e-=3)>-1&&o.push(239,191,189);continue}if(s+1===n){(e-=3)>-1&&o.push(239,191,189);continue}i=r;continue}if(r<56320){(e-=3)>-1&&o.push(239,191,189),i=r;continue}r=65536+(i-55296<<10|r-56320)}else i&&(e-=3)>-1&&o.push(239,191,189);if(i=null,r<128){if((e-=1)<0)break;o.push(r)}else if(r<2048){if((e-=2)<0)break;o.push(r>>6|192,63&r|128)}else if(r<65536){if((e-=3)<0)break;o.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;o.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return o}function K(t){for(var e=[],r=0;r<t.length;++r)e.push(255&t.charCodeAt(r));return e}function X(t,e){for(var r,n,i,o=[],s=0;s<t.length&&!((e-=2)<0);++s)n=(r=t.charCodeAt(s))>>8,i=r%256,o.push(i),o.push(n);return o}function Z(t){return n.toByteArray(H(t))}function Q(t,e,r,n){for(var i=0;i<n&&!(i+r>=e.length||i>=t.length);++i)e[i+r]=t[i];return i}function Y(t,e){return t instanceof e||null!=t&&null!=t.constructor&&null!=t.constructor.name&&t.constructor.name===e.name}function J(t){return t!=t}},{"base64-js":10,ieee754:79}],13:[function(t,e,r){var n=Object.create||T,i=Object.keys||C,o=Function.prototype.bind||E;function s(){this._events&&Object.prototype.hasOwnProperty.call(this,"_events")||(this._events=n(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0}e.exports=s,s.EventEmitter=s,s.prototype._events=void 0,s.prototype._maxListeners=void 0;var a,c=10;try{var u={};Object.defineProperty&&Object.defineProperty(u,"x",{value:0}),a=0===u.x}catch(P){a=!1}function h(t){return void 0===t._maxListeners?s.defaultMaxListeners:t._maxListeners}function d(t,e,r){if(e)t.call(r);else for(var n=t.length,i=w(t,n),o=0;o<n;++o)i[o].call(r)}function l(t,e,r,n){if(e)t.call(r,n);else for(var i=t.length,o=w(t,i),s=0;s<i;++s)o[s].call(r,n)}function _(t,e,r,n,i){if(e)t.call(r,n,i);else for(var o=t.length,s=w(t,o),a=0;a<o;++a)s[a].call(r,n,i)}function p(t,e,r,n,i,o){if(e)t.call(r,n,i,o);else for(var s=t.length,a=w(t,s),c=0;c<s;++c)a[c].call(r,n,i,o)}function f(t,e,r,n){if(e)t.apply(r,n);else for(var i=t.length,o=w(t,i),s=0;s<i;++s)o[s].apply(r,n)}function b(t,e,r,i){var o,s,a;if("function"!=typeof r)throw new TypeError('"listener" argument must be a function');if((s=t._events)?(s.newListener&&(t.emit("newListener",e,r.listener?r.listener:r),s=t._events),a=s[e]):(s=t._events=n(null),t._eventsCount=0),a){if("function"==typeof a?a=s[e]=i?[r,a]:[a,r]:i?a.unshift(r):a.push(r),!a.warned&&(o=h(t))&&o>0&&a.length>o){a.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+a.length+' "'+String(e)+'" listeners added. Use emitter.setMaxListeners() to increase limit.');c.name="MaxListenersExceededWarning",c.emitter=t,c.type=e,c.count=a.length,"object"==typeof console&&console.warn&&console.warn("%s: %s",c.name,c.message)}}else a=s[e]=r,++t._eventsCount;return t}function g(){if(!this.fired)switch(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length){case 0:return this.listener.call(this.target);case 1:return this.listener.call(this.target,arguments[0]);case 2:return this.listener.call(this.target,arguments[0],arguments[1]);case 3:return this.listener.call(this.target,arguments[0],arguments[1],arguments[2]);default:for(var t=new Array(arguments.length),e=0;e<t.length;++e)t[e]=arguments[e];this.listener.apply(this.target,t)}}function m(t,e,r){var n={fired:!1,wrapFn:void 0,target:t,type:e,listener:r},i=o.call(g,n);return i.listener=r,n.wrapFn=i,i}function y(t,e,r){var n=t._events;if(!n)return[];var i=n[e];return i?"function"==typeof i?r?[i.listener||i]:[i]:r?S(i):w(i,i.length):[]}function v(t){var e=this._events;if(e){var r=e[t];if("function"==typeof r)return 1;if(r)return r.length}return 0}function R(t,e){for(var r=e,n=r+1,i=t.length;n<i;r+=1,n+=1)t[r]=t[n];t.pop()}function w(t,e){for(var r=new Array(e),n=0;n<e;++n)r[n]=t[n];return r}function S(t){for(var e=new Array(t.length),r=0;r<e.length;++r)e[r]=t[r].listener||t[r];return e}function T(t){var e=function(){};return e.prototype=t,new e}function C(t){for(var e in t)Object.prototype.hasOwnProperty.call(t,e);return e}function E(t){var e=this;return function(){return e.apply(t,arguments)}}a?Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return c},set:function(t){if("number"!=typeof t||t<0||t!=t)throw new TypeError('"defaultMaxListeners" must be a positive number');c=t}}):s.defaultMaxListeners=c,s.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||isNaN(t))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=t,this},s.prototype.getMaxListeners=function(){return h(this)},s.prototype.emit=function(t){var e,r,n,i,o,s,a="error"===t;if(s=this._events)a=a&&null==s.error;else if(!a)return!1;if(a){if(arguments.length>1&&(e=arguments[1]),e instanceof Error)throw e;var c=new Error('Unhandled "error" event. ('+e+")");throw c.context=e,c}if(!(r=s[t]))return!1;var u="function"==typeof r;switch(n=arguments.length){case 1:d(r,u,this);break;case 2:l(r,u,this,arguments[1]);break;case 3:_(r,u,this,arguments[1],arguments[2]);break;case 4:p(r,u,this,arguments[1],arguments[2],arguments[3]);break;default:for(i=new Array(n-1),o=1;o<n;o++)i[o-1]=arguments[o];f(r,u,this,i)}return!0},s.prototype.addListener=function(t,e){return b(this,t,e,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(t,e){return b(this,t,e,!0)},s.prototype.once=function(t,e){if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');return this.on(t,m(this,t,e)),this},s.prototype.prependOnceListener=function(t,e){if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');return this.prependListener(t,m(this,t,e)),this},s.prototype.removeListener=function(t,e){var r,i,o,s,a;if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');if(!(i=this._events))return this;if(!(r=i[t]))return this;if(r===e||r.listener===e)0==--this._eventsCount?this._events=n(null):(delete i[t],i.removeListener&&this.emit("removeListener",t,r.listener||e));else if("function"!=typeof r){for(o=-1,s=r.length-1;s>=0;s--)if(r[s]===e||r[s].listener===e){a=r[s].listener,o=s;break}if(o<0)return this;0===o?r.shift():R(r,o),1===r.length&&(i[t]=r[0]),i.removeListener&&this.emit("removeListener",t,a||e)}return this},s.prototype.removeAllListeners=function(t){var e,r,o;if(!(r=this._events))return this;if(!r.removeListener)return 0===arguments.length?(this._events=n(null),this._eventsCount=0):r[t]&&(0==--this._eventsCount?this._events=n(null):delete r[t]),this;if(0===arguments.length){var s,a=i(r);for(o=0;o<a.length;++o)"removeListener"!==(s=a[o])&&this.removeAllListeners(s);return this.removeAllListeners("removeListener"),this._events=n(null),this._eventsCount=0,this}if("function"==typeof(e=r[t]))this.removeListener(t,e);else if(e)for(o=e.length-1;o>=0;o--)this.removeListener(t,e[o]);return this},s.prototype.listeners=function(t){return y(this,t,!0)},s.prototype.rawListeners=function(t){return y(this,t,!1)},s.listenerCount=function(t,e){return"function"==typeof t.listenerCount?t.listenerCount(e):v.call(t,e)},s.prototype.listenerCount=v,s.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]}},{}],14:[function(t,e,r){(function(t){function e(t){return Array.isArray?Array.isArray(t):"[object Array]"===b(t)}function n(t){return"boolean"==typeof t}function i(t){return null===t}function o(t){return null==t}function s(t){return"number"==typeof t}function a(t){return"string"==typeof t}function c(t){return"symbol"==typeof t}function u(t){return void 0===t}function h(t){return"[object RegExp]"===b(t)}function d(t){return"object"==typeof t&&null!==t}function l(t){return"[object Date]"===b(t)}function _(t){return"[object Error]"===b(t)||t instanceof Error}function p(t){return"function"==typeof t}function f(t){return null===t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||"symbol"==typeof t||void 0===t}function b(t){return Object.prototype.toString.call(t)}r.isArray=e,r.isBoolean=n,r.isNull=i,r.isNullOrUndefined=o,r.isNumber=s,r.isString=a,r.isSymbol=c,r.isUndefined=u,r.isRegExp=h,r.isObject=d,r.isDate=l,r.isError=_,r.isFunction=p,r.isPrimitive=f,r.isBuffer=t.isBuffer}).call(this,{isBuffer:t("../../is-buffer/index.js")})},{"../../is-buffer/index.js":81}],15:[function(t,e,r){var n,i=t("es5-ext/object/copy"),o=t("es5-ext/object/normalize-options"),s=t("es5-ext/object/valid-callable"),a=t("es5-ext/object/map"),c=t("es5-ext/object/valid-callable"),u=t("es5-ext/object/valid-value"),h=Function.prototype.bind,d=Object.defineProperty,l=Object.prototype.hasOwnProperty;n=function(t,e,r){var n,o=u(e)&&c(e.value);return delete(n=i(e)).writable,delete n.value,n.get=function(){return!r.overwriteDefinition&&l.call(this,t)?o:(e.value=h.call(o,r.resolveContext?r.resolveContext(this):this),d(this,t,e),this[t])},n},e.exports=function(t){var e=o(arguments[1]);return null!=e.resolveContext&&s(e.resolveContext),a(t,(function(t,r){return n(r,t,e)}))}},{"es5-ext/object/copy":39,"es5-ext/object/map":48,"es5-ext/object/normalize-options":49,"es5-ext/object/valid-callable":54,"es5-ext/object/valid-value":55}],16:[function(t,e,r){var n=t("es5-ext/object/assign"),i=t("es5-ext/object/normalize-options"),o=t("es5-ext/object/is-callable"),s=t("es5-ext/string/#/contains");(e.exports=function(t,e){var r,o,a,c,u;return arguments.length<2||"string"!=typeof t?(c=e,e=t,t=null):c=arguments[2],null==t?(r=a=!0,o=!1):(r=s.call(t,"c"),o=s.call(t,"e"),a=s.call(t,"w")),u={value:e,configurable:r,enumerable:o,writable:a},c?n(i(c),u):u}).gs=function(t,e,r){var a,c,u,h;return"string"!=typeof t?(u=r,r=e,e=t,t=null):u=arguments[3],null==e?e=void 0:o(e)?null==r?r=void 0:o(r)||(u=r,r=void 0):(u=e,e=r=void 0),null==t?(a=!0,c=!1):(a=s.call(t,"c"),c=s.call(t,"e")),h={get:e,set:r,configurable:a,enumerable:c},u?n(i(u),h):h}},{"es5-ext/object/assign":36,"es5-ext/object/is-callable":42,"es5-ext/object/normalize-options":49,"es5-ext/string/#/contains":56}],17:[function(t,e,r){(function(r,n){var i=t("readable-stream"),o=t("end-of-stream"),s=t("inherits"),a=t("stream-shift"),c=n.from&&n.from!==Uint8Array.from?n.from([0]):new n([0]),u=function(t,e){t._corked?t.once("uncork",e):e()},h=function(t,e){t._autoDestroy&&t.destroy(e)},d=function(t,e){return function(r){r?h(t,"premature close"===r.message?null:r):e&&!t._ended&&t.end()}},l=function(t,e){return t?t._writableState&&t._writableState.finished?e():t._writableState?t.end(e):(t.end(),void e()):e()},_=function(t){return new i.Readable({objectMode:!0,highWaterMark:16}).wrap(t)},p=function(t,e,r){if(!(this instanceof p))return new p(t,e,r);i.Duplex.call(this,r),this._writable=null,this._readable=null,this._readable2=null,this._autoDestroy=!r||!1!==r.autoDestroy,this._forwardDestroy=!r||!1!==r.destroy,this._forwardEnd=!r||!1!==r.end,this._corked=1,this._ondrain=null,this._drained=!1,this._forwarding=!1,this._unwrite=null,this._unread=null,this._ended=!1,this.destroyed=!1,t&&this.setWritable(t),e&&this.setReadable(e)};s(p,i.Duplex),p.obj=function(t,e,r){return r||(r={}),r.objectMode=!0,r.highWaterMark=16,new p(t,e,r)},p.prototype.cork=function(){1==++this._corked&&this.emit("cork")},p.prototype.uncork=function(){this._corked&&0==--this._corked&&this.emit("uncork")},p.prototype.setWritable=function(t){if(this._unwrite&&this._unwrite(),this.destroyed)t&&t.destroy&&t.destroy();else if(null!==t&&!1!==t){var e=this,n=o(t,{writable:!0,readable:!1},d(this,this._forwardEnd)),i=function(){var t=e._ondrain;e._ondrain=null,t&&t()},s=function(){e._writable.removeListener("drain",i),n()};this._unwrite&&r.nextTick(i),this._writable=t,this._writable.on("drain",i),this._unwrite=s,this.uncork()}else this.end()},p.prototype.setReadable=function(t){if(this._unread&&this._unread(),this.destroyed)t&&t.destroy&&t.destroy();else{if(null===t||!1===t)return this.push(null),void this.resume();var e=this,r=o(t,{writable:!1,readable:!0},d(this)),n=function(){e._forward()},i=function(){e.push(null)},s=function(){e._readable2.removeListener("readable",n),e._readable2.removeListener("end",i),r()};this._drained=!0,this._readable=t,this._readable2=t._readableState?t:_(t),this._readable2.on("readable",n),this._readable2.on("end",i),this._unread=s,this._forward()}},p.prototype._read=function(){this._drained=!0,this._forward()},p.prototype._forward=function(){if(!this._forwarding&&this._readable2&&this._drained){var t;for(this._forwarding=!0;this._drained&&null!==(t=a(this._readable2));)this.destroyed||(this._drained=this.push(t));this._forwarding=!1}},p.prototype.destroy=function(t){if(!this.destroyed){this.destroyed=!0;var e=this;r.nextTick((function(){e._destroy(t)}))}},p.prototype._destroy=function(t){if(t){var e=this._ondrain;this._ondrain=null,e?e(t):this.emit("error",t)}this._forwardDestroy&&(this._readable&&this._readable.destroy&&this._readable.destroy(),this._writable&&this._writable.destroy&&this._writable.destroy()),this.emit("close")},p.prototype._write=function(t,e,r){return this.destroyed?r():this._corked?u(this,this._write.bind(this,t,e,r)):t===c?this._finish(r):this._writable?void(!1===this._writable.write(t)?this._ondrain=r:r()):r()},p.prototype._finish=function(t){var e=this;this.emit("preend"),u(this,(function(){l(e._forwardEnd&&e._writable,(function(){!1===e._writableState.prefinished&&(e._writableState.prefinished=!0),e.emit("prefinish"),u(e,t)}))}))},p.prototype.end=function(t,e,r){return"function"==typeof t?this.end(null,null,t):"function"==typeof e?this.end(t,null,e):(this._ended=!0,t&&this.write(t),this._writableState.ending||this.write(c),i.Writable.prototype.end.call(this,r))},e.exports=p}).call(this,t("_process"),t("buffer").Buffer)},{_process:92,buffer:12,"end-of-stream":18,inherits:80,"readable-stream":108,"stream-shift":111}],18:[function(t,e,r){var n=t("once"),i=function(){},o=function(t){return t.setHeader&&"function"==typeof t.abort},s=function(t){return t.stdio&&Array.isArray(t.stdio)&&3===t.stdio.length},a=function(t,e,r){if("function"==typeof e)return a(t,null,e);e||(e={}),r=n(r||i);var c=t._writableState,u=t._readableState,h=e.readable||!1!==e.readable&&t.readable,d=e.writable||!1!==e.writable&&t.writable,l=function(){t.writable||_()},_=function(){d=!1,h||r.call(t)},p=function(){h=!1,d||r.call(t)},f=function(e){r.call(t,e?new Error("exited with error code: "+e):null)},b=function(e){r.call(t,e)},g=function(){return(!h||u&&u.ended)&&(!d||c&&c.ended)?void 0:r.call(t,new Error("premature close"))},m=function(){t.req.on("finish",_)};return o(t)?(t.on("complete",_),t.on("abort",g),t.req?m():t.on("request",m)):d&&!c&&(t.on("end",l),t.on("close",l)),s(t)&&t.on("exit",f),t.on("end",p),t.on("finish",_),!1!==e.error&&t.on("error",b),t.on("close",g),function(){t.removeListener("complete",_),t.removeListener("abort",g),t.removeListener("request",m),t.req&&t.req.removeListener("finish",_),t.removeListener("end",l),t.removeListener("close",l),t.removeListener("finish",_),t.removeListener("exit",f),t.removeListener("end",p),t.removeListener("error",b),t.removeListener("close",g)}};e.exports=a},{once:90}],19:[function(t,e,r){var n=t("../../object/valid-value");e.exports=function(){return n(this).length=0,this}},{"../../object/valid-value":55}],20:[function(t,e,r){var n=t("../../number/is-nan"),i=t("../../number/to-pos-integer"),o=t("../../object/valid-value"),s=Array.prototype.indexOf,a=Object.prototype.hasOwnProperty,c=Math.abs,u=Math.floor;e.exports=function(t){var e,r,h,d;if(!n(t))return s.apply(this,arguments);for(r=i(o(this).length),h=arguments[1],e=h=isNaN(h)?0:h>=0?u(h):i(this.length)-u(c(h));e<r;++e)if(a.call(this,e)&&(d=this[e],n(d)))return e;return-1}},{"../../number/is-nan":30,"../../number/to-pos-integer":34,"../../object/valid-value":55}],21:[function(t,e,r){e.exports=t("./is-implemented")()?Array.from:t("./shim")},{"./is-implemented":22,"./shim":23}],22:[function(t,e,r){e.exports=function(){var t,e,r=Array.from;return"function"==typeof r&&(e=r(t=["raz","dwa"]),Boolean(e&&e!==t&&"dwa"===e[1]))}},{}],23:[function(t,e,r){var n=t("es6-symbol").iterator,i=t("../../function/is-arguments"),o=t("../../function/is-function"),s=t("../../number/to-pos-integer"),a=t("../../object/valid-callable"),c=t("../../object/valid-value"),u=t("../../object/is-value"),h=t("../../string/is-string"),d=Array.isArray,l=Function.prototype.call,_={configurable:!0,enumerable:!0,writable:!0,value:null},p=Object.defineProperty;e.exports=function(t){var e,r,f,b,g,m,y,v,R,w,S=arguments[1],T=arguments[2];if(t=Object(c(t)),u(S)&&a(S),this&&this!==Array&&o(this))e=this;else{if(!S){if(i(t))return 1!==(g=t.length)?Array.apply(null,t):((b=new Array(1))[0]=t[0],b);if(d(t)){for(b=new Array(g=t.length),r=0;r<g;++r)b[r]=t[r];return b}}b=[]}if(!d(t))if(void 0!==(R=t[n])){for(y=a(R).call(t),e&&(b=new e),v=y.next(),r=0;!v.done;)w=S?l.call(S,T,v.value,r):v.value,e?(_.value=w,p(b,r,_)):b[r]=w,v=y.next(),++r;g=r}else if(h(t)){for(g=t.length,e&&(b=new e),r=0,f=0;r<g;++r)w=t[r],r+1<g&&(m=w.charCodeAt(0))>=55296&&m<=56319&&(w+=t[++r]),w=S?l.call(S,T,w,f):w,e?(_.value=w,p(b,f,_)):b[f]=w,++f;g=f}if(void 0===g)for(g=s(t.length),e&&(b=new e(g)),r=0;r<g;++r)w=S?l.call(S,T,t[r],r):t[r],e?(_.value=w,p(b,r,_)):b[r]=w;return e&&(_.value=null,b.length=g),b}},{"../../function/is-arguments":24,"../../function/is-function":25,"../../number/to-pos-integer":34,"../../object/is-value":44,"../../object/valid-callable":54,"../../object/valid-value":55,"../../string/is-string":59,"es6-symbol":73}],24:[function(t,e,r){var n=Object.prototype.toString,i=n.call(function(){return arguments}());e.exports=function(t){return n.call(t)===i}},{}],25:[function(t,e,r){var n=Object.prototype.toString,i=n.call(t("./noop"));e.exports=function(t){return"function"==typeof t&&n.call(t)===i}},{"./noop":26}],26:[function(t,e,r){e.exports=function(){}},{}],27:[function(t,e,r){e.exports=t("./is-implemented")()?Math.sign:t("./shim")},{"./is-implemented":28,"./shim":29}],28:[function(t,e,r){e.exports=function(){var t=Math.sign;return"function"==typeof t&&1===t(10)&&-1===t(-20)}},{}],29:[function(t,e,r){e.exports=function(t){return t=Number(t),isNaN(t)||0===t?t:t>0?1:-1}},{}],30:[function(t,e,r){e.exports=t("./is-implemented")()?Number.isNaN:t("./shim")},{"./is-implemented":31,"./shim":32}],31:[function(t,e,r){e.exports=function(){var t=Number.isNaN;return"function"==typeof t&&!t({})&&t(NaN)&&!t(34)}},{}],32:[function(t,e,r){e.exports=function(t){return t!=t}},{}],33:[function(t,e,r){var n=t("../math/sign"),i=Math.abs,o=Math.floor;e.exports=function(t){return isNaN(t)?0:0!==(t=Number(t))&&isFinite(t)?n(t)*o(i(t)):t}},{"../math/sign":27}],34:[function(t,e,r){var n=t("./to-integer"),i=Math.max;e.exports=function(t){return i(0,n(t))}},{"./to-integer":33}],35:[function(t,e,r){var n=t("./valid-callable"),i=t("./valid-value"),o=Function.prototype.bind,s=Function.prototype.call,a=Object.keys,c=Object.prototype.propertyIsEnumerable;e.exports=function(t,e){return function(r,u){var h,d=arguments[2],l=arguments[3];return r=Object(i(r)),n(u),h=a(r),l&&h.sort("function"==typeof l?o.call(l,r):void 0),"function"!=typeof t&&(t=h[t]),s.call(t,h,(function(t,n){return c.call(r,t)?s.call(u,d,r[t],t,r,n):e}))}}},{"./valid-callable":54,"./valid-value":55}],36:[function(t,e,r){e.exports=t("./is-implemented")()?Object.assign:t("./shim")},{"./is-implemented":37,"./shim":38}],37:[function(t,e,r){e.exports=function(){var t,e=Object.assign;return"function"==typeof e&&(e(t={foo:"raz"},{bar:"dwa"},{trzy:"trzy"}),t.foo+t.bar+t.trzy==="razdwatrzy")}},{}],38:[function(t,e,r){var n=t("../keys"),i=t("../valid-value"),o=Math.max;e.exports=function(t,e){var r,s,a,c=o(arguments.length,2);for(t=Object(i(t)),a=function(n){try{t[n]=e[n]}catch(ae){r||(r=ae)}},s=1;s<c;++s)n(e=arguments[s]).forEach(a);if(void 0!==r)throw r;return t}},{"../keys":45,"../valid-value":55}],39:[function(t,e,r){var n=t("../array/from"),i=t("./assign"),o=t("./valid-value");e.exports=function(t){var e=Object(o(t)),r=arguments[1],s=Object(arguments[2]);if(e!==t&&!r)return e;var a={};return r?n(r,(function(e){(s.ensure||e in t)&&(a[e]=t[e])})):i(a,t),a}},{"../array/from":21,"./assign":36,"./valid-value":55}],40:[function(t,e,r){var n,i,o,s,a=Object.create;t("./set-prototype-of/is-implemented")()||(n=t("./set-prototype-of/shim")),e.exports=n?1!==n.level?a:(i={},o={},s={configurable:!1,enumerable:!1,writable:!0,value:void 0},Object.getOwnPropertyNames(Object.prototype).forEach((function(t){o[t]="__proto__"!==t?s:{configurable:!0,enumerable:!1,writable:!0,value:void 0}})),Object.defineProperties(i,o),Object.defineProperty(n,"nullPolyfill",{configurable:!1,enumerable:!1,writable:!1,value:i}),function(t,e){return a(null===t?i:t,e)}):a},{"./set-prototype-of/is-implemented":52,"./set-prototype-of/shim":53}],41:[function(t,e,r){e.exports=t("./_iterate")("forEach")},{"./_iterate":35}],42:[function(t,e,r){e.exports=function(t){return"function"==typeof t}},{}],43:[function(t,e,r){var n=t("./is-value"),i={function:!0,object:!0};e.exports=function(t){return n(t)&&i[typeof t]||!1}},{"./is-value":44}],44:[function(t,e,r){var n=t("../function/noop")();e.exports=function(t){return t!==n&&null!==t}},{"../function/noop":26}],45:[function(t,e,r){e.exports=t("./is-implemented")()?Object.keys:t("./shim")},{"./is-implemented":46,"./shim":47}],46:[function(t,e,r){e.exports=function(){try{return Object.keys("primitive"),!0}catch(ae){return!1}}},{}],47:[function(t,e,r){var n=t("../is-value"),i=Object.keys;e.exports=function(t){return i(n(t)?Object(t):t)}},{"../is-value":44}],48:[function(t,e,r){var n=t("./valid-callable"),i=t("./for-each"),o=Function.prototype.call;e.exports=function(t,e){var r={},s=arguments[2];return n(e),i(t,(function(t,n,i,a){r[n]=o.call(e,s,t,n,i,a)})),r}},{"./for-each":41,"./valid-callable":54}],49:[function(t,e,r){var n=t("./is-value"),i=Array.prototype.forEach,o=Object.create,s=function(t,e){var r;for(r in t)e[r]=t[r]};e.exports=function(t){var e=o(null);return i.call(arguments,(function(t){n(t)&&s(Object(t),e)})),e}},{"./is-value":44}],50:[function(t,e,r){var n=Array.prototype.forEach,i=Object.create;e.exports=function(t){var e=i(null);return n.call(arguments,(function(t){e[t]=!0})),e}},{}],51:[function(t,e,r){e.exports=t("./is-implemented")()?Object.setPrototypeOf:t("./shim")},{"./is-implemented":52,"./shim":53}],52:[function(t,e,r){var n=Object.create,i=Object.getPrototypeOf,o={};e.exports=function(){var t=Object.setPrototypeOf;return"function"==typeof t&&i(t((arguments[0]||n)(null),o))===o}},{}],53:[function(t,e,r){var n,i,o,s,a=t("../is-object"),c=t("../valid-value"),u=Object.prototype.isPrototypeOf,h=Object.defineProperty,d={configurable:!0,enumerable:!1,writable:!0,value:void 0};n=function(t,e){if(c(t),null===e||a(e))return t;throw new TypeError("Prototype must be null or an object")},e.exports=(i=function(){var t,e=Object.create(null),r={},n=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__");if(n){try{(t=n.set).call(e,r)}catch(i){}if(Object.getPrototypeOf(e)===r)return{set:t,level:2}}return e.__proto__=r,Object.getPrototypeOf(e)===r?{level:2}:((e={}).__proto__=r,Object.getPrototypeOf(e)===r&&{level:1})}())?(2===i.level?i.set?(s=i.set,o=function(t,e){return s.call(n(t,e),e),t}):o=function(t,e){return n(t,e).__proto__=e,t}:o=function t(e,r){var i;return n(e,r),(i=u.call(t.nullPolyfill,e))&&delete t.nullPolyfill.__proto__,null===r&&(r=t.nullPolyfill),e.__proto__=r,i&&h(t.nullPolyfill,"__proto__",d),e},Object.defineProperty(o,"level",{configurable:!1,enumerable:!1,writable:!1,value:i.level})):null,t("../create")},{"../create":40,"../is-object":43,"../valid-value":55}],54:[function(t,e,r){e.exports=function(t){if("function"!=typeof t)throw new TypeError(t+" is not a function");return t}},{}],55:[function(t,e,r){var n=t("./is-value");e.exports=function(t){if(!n(t))throw new TypeError("Cannot use null or undefined");return t}},{"./is-value":44}],56:[function(t,e,r){e.exports=t("./is-implemented")()?String.prototype.contains:t("./shim")},{"./is-implemented":57,"./shim":58}],57:[function(t,e,r){var n="razdwatrzy";e.exports=function(){return"function"==typeof n.contains&&!0===n.contains("dwa")&&!1===n.contains("foo")}},{}],58:[function(t,e,r){var n=String.prototype.indexOf;e.exports=function(t){return n.call(this,t,arguments[1])>-1}},{}],59:[function(t,e,r){var n=Object.prototype.toString,i=n.call("");e.exports=function(t){return"string"==typeof t||t&&"object"==typeof t&&(t instanceof String||n.call(t)===i)||!1}},{}],60:[function(t,e,r){var n,i=t("es5-ext/object/set-prototype-of"),o=t("es5-ext/string/#/contains"),s=t("d"),a=t("es6-symbol"),c=t("./"),u=Object.defineProperty;n=e.exports=function(t,e){if(!(this instanceof n))throw new TypeError("Constructor requires 'new'");c.call(this,t),e=e?o.call(e,"key+value")?"key+value":o.call(e,"key")?"key":"value":"value",u(this,"__kind__",s("",e))},i&&i(n,c),delete n.prototype.constructor,n.prototype=Object.create(c.prototype,{_resolve:s((function(t){return"value"===this.__kind__?this.__list__[t]:"key+value"===this.__kind__?[t,this.__list__[t]]:t}))}),u(n.prototype,a.toStringTag,s("c","Array Iterator"))},{"./":63,d:16,"es5-ext/object/set-prototype-of":51,"es5-ext/string/#/contains":56,"es6-symbol":73}],61:[function(t,e,r){var n=t("es5-ext/function/is-arguments"),i=t("es5-ext/object/valid-callable"),o=t("es5-ext/string/is-string"),s=t("./get"),a=Array.isArray,c=Function.prototype.call,u=Array.prototype.some;e.exports=function(t,e){var r,h,d,l,_,p,f,b,g=arguments[2];if(a(t)||n(t)?r="array":o(t)?r="string":t=s(t),i(e),d=function(){l=!0},"array"!==r)if("string"!==r)for(h=t.next();!h.done;){if(c.call(e,g,h.value,d),l)return;h=t.next()}else for(p=t.length,_=0;_<p&&(f=t[_],_+1<p&&(b=f.charCodeAt(0))>=55296&&b<=56319&&(f+=t[++_]),c.call(e,g,f,d),!l);++_);else u.call(t,(function(t){return c.call(e,g,t,d),l}))}},{"./get":62,"es5-ext/function/is-arguments":24,"es5-ext/object/valid-callable":54,"es5-ext/string/is-string":59}],62:[function(t,e,r){var n=t("es5-ext/function/is-arguments"),i=t("es5-ext/string/is-string"),o=t("./array"),s=t("./string"),a=t("./valid-iterable"),c=t("es6-symbol").iterator;e.exports=function(t){return"function"==typeof a(t)[c]?t[c]():n(t)?new o(t):i(t)?new s(t):new o(t)}},{"./array":60,"./string":65,"./valid-iterable":66,"es5-ext/function/is-arguments":24,"es5-ext/string/is-string":59,"es6-symbol":73}],63:[function(t,e,r){var n,i=t("es5-ext/array/#/clear"),o=t("es5-ext/object/assign"),s=t("es5-ext/object/valid-callable"),a=t("es5-ext/object/valid-value"),c=t("d"),u=t("d/auto-bind"),h=t("es6-symbol"),d=Object.defineProperty,l=Object.defineProperties;e.exports=n=function(t,e){if(!(this instanceof n))throw new TypeError("Constructor requires 'new'");l(this,{__list__:c("w",a(t)),__context__:c("w",e),__nextIndex__:c("w",0)}),e&&(s(e.on),e.on("_add",this._onAdd),e.on("_delete",this._onDelete),e.on("_clear",this._onClear))},delete n.prototype.constructor,l(n.prototype,o({_next:c((function(){var t;if(this.__list__)return this.__redo__&&void 0!==(t=this.__redo__.shift())?t:this.__nextIndex__<this.__list__.length?this.__nextIndex__++:void this._unBind()})),next:c((function(){return this._createResult(this._next())})),_createResult:c((function(t){return void 0===t?{done:!0,value:void 0}:{done:!1,value:this._resolve(t)}})),_resolve:c((function(t){return this.__list__[t]})),_unBind:c((function(){this.__list__=null,delete this.__redo__,this.__context__&&(this.__context__.off("_add",this._onAdd),this.__context__.off("_delete",this._onDelete),this.__context__.off("_clear",this._onClear),this.__context__=null)})),toString:c((function(){return"[object "+(this[h.toStringTag]||"Object")+"]"}))},u({_onAdd:c((function(t){t>=this.__nextIndex__||(++this.__nextIndex__,this.__redo__?(this.__redo__.forEach((function(e,r){e>=t&&(this.__redo__[r]=++e)}),this),this.__redo__.push(t)):d(this,"__redo__",c("c",[t])))})),_onDelete:c((function(t){var e;t>=this.__nextIndex__||(--this.__nextIndex__,this.__redo__&&(-1!==(e=this.__redo__.indexOf(t))&&this.__redo__.splice(e,1),this.__redo__.forEach((function(e,r){e>t&&(this.__redo__[r]=--e)}),this)))})),_onClear:c((function(){this.__redo__&&i.call(this.__redo__),this.__nextIndex__=0}))}))),d(n.prototype,h.iterator,c((function(){return this})))},{d:16,"d/auto-bind":15,"es5-ext/array/#/clear":19,"es5-ext/object/assign":36,"es5-ext/object/valid-callable":54,"es5-ext/object/valid-value":55,"es6-symbol":73}],64:[function(t,e,r){var n=t("es5-ext/function/is-arguments"),i=t("es5-ext/object/is-value"),o=t("es5-ext/string/is-string"),s=t("es6-symbol").iterator,a=Array.isArray;e.exports=function(t){return!(!i(t)||!a(t)&&!o(t)&&!n(t)&&"function"!=typeof t[s])}},{"es5-ext/function/is-arguments":24,"es5-ext/object/is-value":44,"es5-ext/string/is-string":59,"es6-symbol":73}],65:[function(t,e,r){var n,i=t("es5-ext/object/set-prototype-of"),o=t("d"),s=t("es6-symbol"),a=t("./"),c=Object.defineProperty;n=e.exports=function(t){if(!(this instanceof n))throw new TypeError("Constructor requires 'new'");t=String(t),a.call(this,t),c(this,"__length__",o("",t.length))},i&&i(n,a),delete n.prototype.constructor,n.prototype=Object.create(a.prototype,{_next:o((function(){if(this.__list__)return this.__nextIndex__<this.__length__?this.__nextIndex__++:void this._unBind()})),_resolve:o((function(t){var e,r=this.__list__[t];return this.__nextIndex__===this.__length__?r:(e=r.charCodeAt(0))>=55296&&e<=56319?r+this.__list__[this.__nextIndex__++]:r}))}),c(n.prototype,s.toStringTag,o("c","String Iterator"))},{"./":63,d:16,"es5-ext/object/set-prototype-of":51,"es6-symbol":73}],66:[function(t,e,r){var n=t("./is-iterable");e.exports=function(t){if(!n(t))throw new TypeError(t+" is not iterable");return t}},{"./is-iterable":64}],67:[function(t,e,r){e.exports=t("./is-implemented")()?Map:t("./polyfill")},{"./is-implemented":68,"./polyfill":72}],68:[function(t,e,r){e.exports=function(){var t,e;if("function"!=typeof Map)return!1;try{t=new Map([["raz","one"],["dwa","two"],["trzy","three"]])}catch(ae){return!1}return"[object Map]"===String(t)&&3===t.size&&"function"==typeof t.clear&&"function"==typeof t.delete&&"function"==typeof t.entries&&"function"==typeof t.forEach&&"function"==typeof t.get&&"function"==typeof t.has&&"function"==typeof t.keys&&"function"==typeof t.set&&"function"==typeof t.values&&!1===(e=t.entries().next()).done&&!!e.value&&"raz"===e.value[0]&&"one"===e.value[1]}},{}],69:[function(t,e,r){e.exports="undefined"!=typeof Map&&"[object Map]"===Object.prototype.toString.call(new Map)},{}],70:[function(t,e,r){e.exports=t("es5-ext/object/primitive-set")("key","value","key+value")},{"es5-ext/object/primitive-set":50}],71:[function(t,e,r){var n,i=t("es5-ext/object/set-prototype-of"),o=t("d"),s=t("es6-iterator"),a=t("es6-symbol").toStringTag,c=t("./iterator-kinds"),u=Object.defineProperties,h=s.prototype._unBind;n=e.exports=function(t,e){if(!(this instanceof n))return new n(t,e);s.call(this,t.__mapKeysData__,t),e&&c[e]||(e="key+value"),u(this,{__kind__:o("",e),__values__:o("w",t.__mapValuesData__)})},i&&i(n,s),n.prototype=Object.create(s.prototype,{constructor:o(n),_resolve:o((function(t){return"value"===this.__kind__?this.__values__[t]:"key"===this.__kind__?this.__list__[t]:[this.__list__[t],this.__values__[t]]})),_unBind:o((function(){this.__values__=null,h.call(this)})),toString:o((function(){return"[object Map Iterator]"}))}),Object.defineProperty(n.prototype,a,o("c","Map Iterator"))},{"./iterator-kinds":70,d:16,"es5-ext/object/set-prototype-of":51,"es6-iterator":63,"es6-symbol":73}],72:[function(t,e,r){var n,i=t("es5-ext/array/#/clear"),o=t("es5-ext/array/#/e-index-of"),s=t("es5-ext/object/set-prototype-of"),a=t("es5-ext/object/valid-callable"),c=t("es5-ext/object/valid-value"),u=t("d"),h=t("event-emitter"),d=t("es6-symbol"),l=t("es6-iterator/valid-iterable"),_=t("es6-iterator/for-of"),p=t("./lib/iterator"),f=t("./is-native-implemented"),b=Function.prototype.call,g=Object.defineProperties,m=Object.getPrototypeOf;e.exports=n=function(){var t,e,r,i=arguments[0];if(!(this instanceof n))throw new TypeError("Constructor requires 'new'");return r=f&&s&&Map!==n?s(new Map,m(this)):this,null!=i&&l(i),g(r,{__mapKeysData__:u("c",t=[]),__mapValuesData__:u("c",e=[])}),i?(_(i,(function(r){var n=c(r)[0];r=r[1],-1===o.call(t,n)&&(t.push(n),e.push(r))}),r),r):r},f&&(s&&s(n,Map),n.prototype=Object.create(Map.prototype,{constructor:u(n)})),h(g(n.prototype,{clear:u((function(){this.__mapKeysData__.length&&(i.call(this.__mapKeysData__),i.call(this.__mapValuesData__),this.emit("_clear"))})),delete:u((function(t){var e=o.call(this.__mapKeysData__,t);return-1!==e&&(this.__mapKeysData__.splice(e,1),this.__mapValuesData__.splice(e,1),this.emit("_delete",e,t),!0)})),entries:u((function(){return new p(this,"key+value")})),forEach:u((function(t){var e,r,n=arguments[1];for(a(t),r=(e=this.entries())._next();void 0!==r;)b.call(t,n,this.__mapValuesData__[r],this.__mapKeysData__[r],this),r=e._next()})),get:u((function(t){var e=o.call(this.__mapKeysData__,t);if(-1!==e)return this.__mapValuesData__[e]})),has:u((function(t){return-1!==o.call(this.__mapKeysData__,t)})),keys:u((function(){return new p(this,"key")})),set:u((function(t,e){var r,n=o.call(this.__mapKeysData__,t);return-1===n&&(n=this.__mapKeysData__.push(t)-1,r=!0),this.__mapValuesData__[n]=e,r&&this.emit("_add",n,t),this})),size:u.gs((function(){return this.__mapKeysData__.length})),values:u((function(){return new p(this,"value")})),toString:u((function(){return"[object Map]"}))})),Object.defineProperty(n.prototype,d.iterator,u((function(){return this.entries()}))),Object.defineProperty(n.prototype,d.toStringTag,u("c","Map"))},{"./is-native-implemented":69,"./lib/iterator":71,d:16,"es5-ext/array/#/clear":19,"es5-ext/array/#/e-index-of":20,"es5-ext/object/set-prototype-of":51,"es5-ext/object/valid-callable":54,"es5-ext/object/valid-value":55,"es6-iterator/for-of":61,"es6-iterator/valid-iterable":66,"es6-symbol":73,"event-emitter":78}],73:[function(t,e,r){e.exports=t("./is-implemented")()?Symbol:t("./polyfill")},{"./is-implemented":74,"./polyfill":76}],74:[function(t,e,r){var n={object:!0,symbol:!0};e.exports=function(){var t;if("function"!=typeof Symbol)return!1;t=Symbol("test symbol");try{String(t)}catch(ae){return!1}return!!n[typeof Symbol.iterator]&&!!n[typeof Symbol.toPrimitive]&&!!n[typeof Symbol.toStringTag]}},{}],75:[function(t,e,r){e.exports=function(t){return!!t&&("symbol"==typeof t||!!t.constructor&&"Symbol"===t.constructor.name&&"Symbol"===t[t.constructor.toStringTag])}},{}],76:[function(t,e,r){var n,i,o,s,a=t("d"),c=t("./validate-symbol"),u=Object.create,h=Object.defineProperties,d=Object.defineProperty,l=Object.prototype,_=u(null);if("function"==typeof Symbol){n=Symbol;try{String(n()),s=!0}catch(b){}}var p,f=(p=u(null),function(t){for(var e,r,n=0;p[t+(n||"")];)++n;return p[t+=n||""]=!0,d(l,e="@@"+t,a.gs(null,(function(t){r||(r=!0,d(this,e,a(t)),r=!1)}))),e});o=function(t){if(this instanceof o)throw new TypeError("Symbol is not a constructor");return i(t)},e.exports=i=function t(e){var r;if(this instanceof t)throw new TypeError("Symbol is not a constructor");return s?n(e):(r=u(o.prototype),e=void 0===e?"":String(e),h(r,{__description__:a("",e),__name__:a("",f(e))}))},h(i,{for:a((function(t){return _[t]?_[t]:_[t]=i(String(t))})),keyFor:a((function(t){var e;for(e in c(t),_)if(_[e]===t)return e})),hasInstance:a("",n&&n.hasInstance||i("hasInstance")),isConcatSpreadable:a("",n&&n.isConcatSpreadable||i("isConcatSpreadable")),iterator:a("",n&&n.iterator||i("iterator")),match:a("",n&&n.match||i("match")),replace:a("",n&&n.replace||i("replace")),search:a("",n&&n.search||i("search")),species:a("",n&&n.species||i("species")),split:a("",n&&n.split||i("split")),toPrimitive:a("",n&&n.toPrimitive||i("toPrimitive")),toStringTag:a("",n&&n.toStringTag||i("toStringTag")),unscopables:a("",n&&n.unscopables||i("unscopables"))}),h(o.prototype,{constructor:a(i),toString:a("",(function(){return this.__name__}))}),h(i.prototype,{toString:a((function(){return"Symbol ("+c(this).__description__+")"})),valueOf:a((function(){return c(this)}))}),d(i.prototype,i.toPrimitive,a("",(function(){var t=c(this);return"symbol"==typeof t?t:t.toString()}))),d(i.prototype,i.toStringTag,a("c","Symbol")),d(o.prototype,i.toStringTag,a("c",i.prototype[i.toStringTag])),d(o.prototype,i.toPrimitive,a("c",i.prototype[i.toPrimitive]))},{"./validate-symbol":77,d:16}],77:[function(t,e,r){var n=t("./is-symbol");e.exports=function(t){if(!n(t))throw new TypeError(t+" is not a symbol");return t}},{"./is-symbol":75}],78:[function(t,e,r){var n,i,o,s,a,c,u,h=t("d"),d=t("es5-ext/object/valid-callable"),l=Function.prototype.apply,_=Function.prototype.call,p=Object.create,f=Object.defineProperty,b=Object.defineProperties,g=Object.prototype.hasOwnProperty,m={configurable:!0,enumerable:!1,writable:!0};i=function(t,e){var r,i;return d(e),i=this,n.call(this,t,r=function(){o.call(i,t,r),l.call(e,this,arguments)}),r.__eeOnceListener__=e,this},a={on:n=function(t,e){var r;return d(e),g.call(this,"__ee__")?r=this.__ee__:(r=m.value=p(null),f(this,"__ee__",m),m.value=null),r[t]?"object"==typeof r[t]?r[t].push(e):r[t]=[r[t],e]:r[t]=e,this},once:i,off:o=function(t,e){var r,n,i,o;if(d(e),!g.call(this,"__ee__"))return this;if(!(r=this.__ee__)[t])return this;if("object"==typeof(n=r[t]))for(o=0;i=n[o];++o)i!==e&&i.__eeOnceListener__!==e||(2===n.length?r[t]=n[o?0:1]:n.splice(o,1));else n!==e&&n.__eeOnceListener__!==e||delete r[t];return this},emit:s=function(t){var e,r,n,i,o;if(g.call(this,"__ee__")&&(i=this.__ee__[t]))if("object"==typeof i){for(r=arguments.length,o=new Array(r-1),e=1;e<r;++e)o[e-1]=arguments[e];for(i=i.slice(),e=0;n=i[e];++e)l.call(n,this,o)}else switch(arguments.length){case 1:_.call(i,this);break;case 2:_.call(i,this,arguments[1]);break;case 3:_.call(i,this,arguments[1],arguments[2]);break;default:for(r=arguments.length,o=new Array(r-1),e=1;e<r;++e)o[e-1]=arguments[e];l.call(i,this,o)}}},c={on:h(n),once:h(i),off:h(o),emit:h(s)},u=b({},c),e.exports=r=function(t){return null==t?p(u):b(Object(t),c)},r.methods=a},{d:16,"es5-ext/object/valid-callable":54}],79:[function(t,e,r){r.read=function(t,e,r,n,i){var o,s,a=8*i-n-1,c=(1<<a)-1,u=c>>1,h=-7,d=r?i-1:0,l=r?-1:1,_=t[e+d];for(d+=l,o=_&(1<<-h)-1,_>>=-h,h+=a;h>0;o=256*o+t[e+d],d+=l,h-=8);for(s=o&(1<<-h)-1,o>>=-h,h+=n;h>0;s=256*s+t[e+d],d+=l,h-=8);if(0===o)o=1-u;else{if(o===c)return s?NaN:1/0*(_?-1:1);s+=Math.pow(2,n),o-=u}return(_?-1:1)*s*Math.pow(2,o-n)},r.write=function(t,e,r,n,i,o){var s,a,c,u=8*o-i-1,h=(1<<u)-1,d=h>>1,l=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,_=n?0:o-1,p=n?1:-1,f=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,s=h):(s=Math.floor(Math.log(e)/Math.LN2),e*(c=Math.pow(2,-s))<1&&(s--,c*=2),(e+=s+d>=1?l/c:l*Math.pow(2,1-d))*c>=2&&(s++,c/=2),s+d>=h?(a=0,s=h):s+d>=1?(a=(e*c-1)*Math.pow(2,i),s+=d):(a=e*Math.pow(2,d-1)*Math.pow(2,i),s=0));i>=8;t[r+_]=255&a,_+=p,a/=256,i-=8);for(s=s<<i|a,u+=i;u>0;t[r+_]=255&s,_+=p,s/=256,u-=8);t[r+_-p]|=128*f}},{}],80:[function(t,e,r){"function"==typeof Object.create?e.exports=function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:e.exports=function(t,e){t.super_=e;var r=function(){};r.prototype=e.prototype,t.prototype=new r,t.prototype.constructor=t}},{}],81:[function(t,e,r){function n(t){return!!t.constructor&&"function"==typeof t.constructor.isBuffer&&t.constructor.isBuffer(t)}function i(t){return"function"==typeof t.readFloatLE&&"function"==typeof t.slice&&n(t.slice(0,0))}e.exports=function(t){return null!=t&&(n(t)||i(t)||!!t._isBuffer)}},{}],82:[function(t,e,r){var n=t("safe-buffer").Buffer,i=e.exports;for(var o in i.types={0:"reserved",1:"connect",2:"connack",3:"publish",4:"puback",5:"pubrec",6:"pubrel",7:"pubcomp",8:"subscribe",9:"suback",10:"unsubscribe",11:"unsuback",12:"pingreq",13:"pingresp",14:"disconnect",15:"auth"},i.codes={},i.types){var s=i.types[o];i.codes[s]=o}for(var a in i.CMD_SHIFT=4,i.CMD_MASK=240,i.DUP_MASK=8,i.QOS_MASK=3,i.QOS_SHIFT=1,i.RETAIN_MASK=1,i.LENGTH_MASK=127,i.LENGTH_FIN_MASK=128,i.SESSIONPRESENT_MASK=1,i.SESSIONPRESENT_HEADER=n.from([i.SESSIONPRESENT_MASK]),i.CONNACK_HEADER=n.from([i.codes.connack<<i.CMD_SHIFT]),i.USERNAME_MASK=128,i.PASSWORD_MASK=64,i.WILL_RETAIN_MASK=32,i.WILL_QOS_MASK=24,i.WILL_QOS_SHIFT=3,i.WILL_FLAG_MASK=4,i.CLEAN_SESSION_MASK=2,i.CONNECT_HEADER=n.from([i.codes.connect<<i.CMD_SHIFT]),i.properties={sessionExpiryInterval:17,willDelayInterval:24,receiveMaximum:33,maximumPacketSize:39,topicAliasMaximum:34,requestResponseInformation:25,requestProblemInformation:23,userProperties:38,authenticationMethod:21,authenticationData:22,payloadFormatIndicator:1,messageExpiryInterval:2,contentType:3,responseTopic:8,correlationData:9,maximumQoS:36,retainAvailable:37,assignedClientIdentifier:18,reasonString:31,wildcardSubscriptionAvailable:40,subscriptionIdentifiersAvailable:41,sharedSubscriptionAvailable:42,serverKeepAlive:19,responseInformation:26,serverReference:28,topicAlias:35,subscriptionIdentifier:11},i.propertiesCodes={},i.properties){var c=i.properties[a];i.propertiesCodes[c]=a}function u(t){return[0,1,2].map((function(e){return[0,1].map((function(r){return[0,1].map((function(o){var s=new n(1);return s.writeUInt8(i.codes[t]<<i.CMD_SHIFT|(r?i.DUP_MASK:0)|e<<i.QOS_SHIFT|o,0,!0),s}))}))}))}i.propertiesTypes={sessionExpiryInterval:"int32",willDelayInterval:"int32",receiveMaximum:"int16",maximumPacketSize:"int32",topicAliasMaximum:"int16",requestResponseInformation:"byte",requestProblemInformation:"byte",userProperties:"pair",authenticationMethod:"string",authenticationData:"binary",payloadFormatIndicator:"byte",messageExpiryInterval:"int32",contentType:"string",responseTopic:"string",correlationData:"binary",maximumQoS:"int8",retainAvailable:"byte",assignedClientIdentifier:"string",reasonString:"string",wildcardSubscriptionAvailable:"byte",subscriptionIdentifiersAvailable:"byte",sharedSubscriptionAvailable:"byte",serverKeepAlive:"int32",responseInformation:"string",serverReference:"string",topicAlias:"int16",subscriptionIdentifier:"var"},i.PUBLISH_HEADER=u("publish"),i.SUBSCRIBE_HEADER=u("subscribe"),i.SUBSCRIBE_OPTIONS_QOS_MASK=3,i.SUBSCRIBE_OPTIONS_NL_MASK=1,i.SUBSCRIBE_OPTIONS_NL_SHIFT=2,i.SUBSCRIBE_OPTIONS_RAP_MASK=1,i.SUBSCRIBE_OPTIONS_RAP_SHIFT=3,i.SUBSCRIBE_OPTIONS_RH_MASK=3,i.SUBSCRIBE_OPTIONS_RH_SHIFT=4,i.SUBSCRIBE_OPTIONS_RH=[0,16,32],i.SUBSCRIBE_OPTIONS_NL=4,i.SUBSCRIBE_OPTIONS_RAP=8,i.SUBSCRIBE_OPTIONS_QOS=[0,1,2],i.UNSUBSCRIBE_HEADER=u("unsubscribe"),i.ACKS={unsuback:u("unsuback"),puback:u("puback"),pubcomp:u("pubcomp"),pubrel:u("pubrel"),pubrec:u("pubrec")},i.SUBACK_HEADER=n.from([i.codes.suback<<i.CMD_SHIFT]),i.VERSION3=n.from([3]),i.VERSION4=n.from([4]),i.VERSION5=n.from([5]),i.QOS=[0,1,2].map((function(t){return n.from([t])})),i.EMPTY={pingreq:n.from([i.codes.pingreq<<4,0]),pingresp:n.from([i.codes.pingresp<<4,0]),disconnect:n.from([i.codes.disconnect<<4,0])}},{"safe-buffer":110}],83:[function(t,e,r){var n=t("safe-buffer").Buffer,i=t("./writeToStream"),o=t("events").EventEmitter;function s(t,e){var r=new a;return i(t,r,e),r.concat()}function a(){this._array=new Array(20),this._i=0}t("inherits")(a,o),a.prototype.write=function(t){return this._array[this._i++]=t,!0},a.prototype.concat=function(){var t,e,r=0,i=new Array(this._array.length),o=this._array,s=0;for(t=0;t<o.length&&void 0!==o[t];t++)"string"!=typeof o[t]?i[t]=o[t].length:i[t]=n.byteLength(o[t]),r+=i[t];for(e=n.allocUnsafe(r),t=0;t<o.length&&void 0!==o[t];t++)"string"!=typeof o[t]?(o[t].copy(e,s),s+=i[t]):(e.write(o[t],s),s+=i[t]);return e},e.exports=s},{"./writeToStream":89,events:13,inherits:80,"safe-buffer":110}],84:[function(t,e,r){r.parser=t("./parser"),r.generate=t("./generate"),r.writeToStream=t("./writeToStream")},{"./generate":83,"./parser":88,"./writeToStream":89}],85:[function(t,e,r){var n=t("readable-stream/duplex"),i=t("util"),o=t("safe-buffer").Buffer;function s(t){if(!(this instanceof s))return new s(t);if(this._bufs=[],this.length=0,"function"==typeof t){this._callback=t;var e=function(t){this._callback&&(this._callback(t),this._callback=null)}.bind(this);this.on("pipe",(function(t){t.on("error",e)})),this.on("unpipe",(function(t){t.removeListener("error",e)}))}else this.append(t);n.call(this)}i.inherits(s,n),s.prototype._offset=function(t){var e,r=0,n=0;if(0===t)return[0,0];for(;n<this._bufs.length;n++){if(t<(e=r+this._bufs[n].length)||n==this._bufs.length-1)return[n,t-r];r=e}},s.prototype.append=function(t){var e=0;if(o.isBuffer(t))this._appendBuffer(t);else if(Array.isArray(t))for(;e<t.length;e++)this.append(t[e]);else if(t instanceof s)for(;e<t._bufs.length;e++)this.append(t._bufs[e]);else null!=t&&("number"==typeof t&&(t=t.toString()),this._appendBuffer(o.from(t)));return this},s.prototype._appendBuffer=function(t){this._bufs.push(t),this.length+=t.length},s.prototype._write=function(t,e,r){this._appendBuffer(t),"function"==typeof r&&r()},s.prototype._read=function(t){if(!this.length)return this.push(null);t=Math.min(t,this.length),this.push(this.slice(0,t)),this.consume(t)},s.prototype.end=function(t){n.prototype.end.call(this,t),this._callback&&(this._callback(null,this.slice()),this._callback=null)},s.prototype.get=function(t){return this.slice(t,t+1)[0]},s.prototype.slice=function(t,e){return"number"==typeof t&&t<0&&(t+=this.length),"number"==typeof e&&e<0&&(e+=this.length),this.copy(null,0,t,e)},s.prototype.copy=function(t,e,r,n){if(("number"!=typeof r||r<0)&&(r=0),("number"!=typeof n||n>this.length)&&(n=this.length),r>=this.length)return t||o.alloc(0);if(n<=0)return t||o.alloc(0);var i,s,a=!!t,c=this._offset(r),u=n-r,h=u,d=a&&e||0,l=c[1];if(0===r&&n==this.length){if(!a)return 1===this._bufs.length?this._bufs[0]:o.concat(this._bufs,this.length);for(s=0;s<this._bufs.length;s++)this._bufs[s].copy(t,d),d+=this._bufs[s].length;return t}if(h<=this._bufs[c[0]].length-l)return a?this._bufs[c[0]].copy(t,e,l,l+h):this._bufs[c[0]].slice(l,l+h);for(a||(t=o.allocUnsafe(u)),s=c[0];s<this._bufs.length;s++){if(!(h>(i=this._bufs[s].length-l))){this._bufs[s].copy(t,d,l,l+h);break}this._bufs[s].copy(t,d,l),d+=i,h-=i,l&&(l=0)}return t},s.prototype.shallowSlice=function(t,e){t=t||0,e=e||this.length,t<0&&(t+=this.length),e<0&&(e+=this.length);var r=this._offset(t),n=this._offset(e),i=this._bufs.slice(r[0],n[0]+1);return 0==n[1]?i.pop():i[i.length-1]=i[i.length-1].slice(0,n[1]),0!=r[1]&&(i[0]=i[0].slice(r[1])),new s(i)},s.prototype.toString=function(t,e,r){return this.slice(e,r).toString(t)},s.prototype.consume=function(t){for(;this._bufs.length;){if(!(t>=this._bufs[0].length)){this._bufs[0]=this._bufs[0].slice(t),this.length-=t;break}t-=this._bufs[0].length,this.length-=this._bufs[0].length,this._bufs.shift()}return this},s.prototype.duplicate=function(){for(var t=0,e=new s;t<this._bufs.length;t++)e.append(this._bufs[t]);return e},s.prototype.destroy=function(){this._bufs.length=0,this.length=0,this.push(null)},function(){var t={readDoubleBE:8,readDoubleLE:8,readFloatBE:4,readFloatLE:4,readInt32BE:4,readInt32LE:4,readUInt32BE:4,readUInt32LE:4,readInt16BE:2,readInt16LE:2,readUInt16BE:2,readUInt16LE:2,readInt8:1,readUInt8:1};for(var e in t)!function(e){s.prototype[e]=function(r){return this.slice(r,r+t[e])[e](0)}}(e)}(),e.exports=s},{"readable-stream/duplex":97,"safe-buffer":110,util:117}],86:[function(t,e,r){var n=t("safe-buffer").Buffer,i=65536,o={};function s(t){var e=n.allocUnsafe(2);return e.writeUInt8(t>>8,0),e.writeUInt8(255&t,1),e}function a(){for(var t=0;t<i;t++)o[t]=s(t)}function c(t){return t>=0&&t<128?1:t>=128&&t<16384?2:t>=16384&&t<2097152?3:t>=2097152&&t<268435456?4:0}function u(t){var e=0,r=0,i=c(t),o=n.allocUnsafe(i);do{e=t%128|0,(t=t/128|0)>0&&(e|=128),o.writeUInt8(e,r++)}while(t>0);return{data:o,length:i}}function h(t){var e=n.allocUnsafe(4);return e.writeUInt32BE(t,0),e}e.exports={cache:o,generateCache:a,generateNumber:s,genBufVariableByteInt:u,generate4ByteBuffer:h}},{"safe-buffer":110}],87:[function(t,e,r){function n(){this.cmd=null,this.retain=!1,this.qos=0,this.dup=!1,this.length=-1,this.topic=null,this.payload=null}e.exports=n},{}],88:[function(t,e,r){var n=t("bl"),i=t("inherits"),o=t("events").EventEmitter,s=t("./packet"),a=t("./constants");function c(t){if(!(this instanceof c))return new c(t);this.settings=t||{},this._states=["_parseHeader","_parseLength","_parsePayload","_newPacket"],this._resetState()}i(c,o),c.prototype._resetState=function(){this.packet=new s,this.error=null,this._list=n(),this._stateCounter=0},c.prototype.parse=function(t){for(this.error&&this._resetState(),this._list.append(t);(-1!==this.packet.length||this._list.length>0)&&this[this._states[this._stateCounter]]()&&!this.error;)this._stateCounter++,this._stateCounter>=this._states.length&&(this._stateCounter=0);return this._list.length},c.prototype._parseHeader=function(){var t=this._list.readUInt8(0);return this.packet.cmd=a.types[t>>a.CMD_SHIFT],this.packet.retain=0!=(t&a.RETAIN_MASK),this.packet.qos=t>>a.QOS_SHIFT&a.QOS_MASK,this.packet.dup=0!=(t&a.DUP_MASK),this._list.consume(1),!0},c.prototype._parseLength=function(){var t=this._parseVarByteNum(!0);return t&&(this.packet.length=t.value,this._list.consume(t.bytes)),!!t},c.prototype._parsePayload=function(){var t=!1;if(0===this.packet.length||this._list.length>=this.packet.length){switch(this._pos=0,this.packet.cmd){case"connect":this._parseConnect();break;case"connack":this._parseConnack();break;case"publish":this._parsePublish();break;case"puback":case"pubrec":case"pubrel":case"pubcomp":this._parseConfirmation();break;case"subscribe":this._parseSubscribe();break;case"suback":this._parseSuback();break;case"unsubscribe":this._parseUnsubscribe();break;case"unsuback":this._parseUnsuback();break;case"pingreq":case"pingresp":break;case"disconnect":this._parseDisconnect();break;case"auth":this._parseAuth();break;default:this._emitError(new Error("Not supported"))}t=!0}return t},c.prototype._parseConnect=function(){var t,e,r,n,i,o,s={},c=this.packet;if(null===(t=this._parseString()))return this._emitError(new Error("Cannot parse protocolId"));if("MQTT"!==t&&"MQIsdp"!==t)return this._emitError(new Error("Invalid protocolId"));if(c.protocolId=t,this._pos>=this._list.length)return this._emitError(new Error("Packet too short"));if(c.protocolVersion=this._list.readUInt8(this._pos),3!==c.protocolVersion&&4!==c.protocolVersion&&5!==c.protocolVersion)return this._emitError(new Error("Invalid protocol version"));if(this._pos++,this._pos>=this._list.length)return this._emitError(new Error("Packet too short"));if(s.username=this._list.readUInt8(this._pos)&a.USERNAME_MASK,s.password=this._list.readUInt8(this._pos)&a.PASSWORD_MASK,s.will=this._list.readUInt8(this._pos)&a.WILL_FLAG_MASK,s.will&&(c.will={},c.will.retain=0!=(this._list.readUInt8(this._pos)&a.WILL_RETAIN_MASK),c.will.qos=(this._list.readUInt8(this._pos)&a.WILL_QOS_MASK)>>a.WILL_QOS_SHIFT),c.clean=0!=(this._list.readUInt8(this._pos)&a.CLEAN_SESSION_MASK),this._pos++,c.keepalive=this._parseNum(),-1===c.keepalive)return this._emitError(new Error("Packet too short"));if(5===c.protocolVersion){var u=this._parseProperties();Object.getOwnPropertyNames(u).length&&(c.properties=u)}if(null===(e=this._parseString()))return this._emitError(new Error("Packet too short"));if(c.clientId=e,s.will){if(5===c.protocolVersion){var h=this._parseProperties();Object.getOwnPropertyNames(h).length&&(c.will.properties=h)}if(null===(r=this._parseString()))return this._emitError(new Error("Cannot parse will topic"));if(c.will.topic=r,null===(n=this._parseBuffer()))return this._emitError(new Error("Cannot parse will payload"));c.will.payload=n}if(s.username){if(null===(o=this._parseString()))return this._emitError(new Error("Cannot parse username"));c.username=o}if(s.password){if(null===(i=this._parseBuffer()))return this._emitError(new Error("Cannot parse password"));c.password=i}return this.settings=c,c},c.prototype._parseConnack=function(){var t=this.packet;if(this._list.length<2)return null;if(t.sessionPresent=!!(this._list.readUInt8(this._pos++)&a.SESSIONPRESENT_MASK),5===this.settings.protocolVersion?t.reasonCode=this._list.readUInt8(this._pos++):t.returnCode=this._list.readUInt8(this._pos++),-1===t.returnCode||-1===t.reasonCode)return this._emitError(new Error("Cannot parse return code"));if(5===this.settings.protocolVersion){var e=this._parseProperties();Object.getOwnPropertyNames(e).length&&(t.properties=e)}},c.prototype._parsePublish=function(){var t=this.packet;if(t.topic=this._parseString(),null===t.topic)return this._emitError(new Error("Cannot parse topic"));if(!(t.qos>0)||this._parseMessageId()){if(5===this.settings.protocolVersion){var e=this._parseProperties();Object.getOwnPropertyNames(e).length&&(t.properties=e)}t.payload=this._list.slice(this._pos,t.length)}},c.prototype._parseSubscribe=function(){var t,e,r,n,i,o,s,c=this.packet;if(1!==c.qos)return this._emitError(new Error("Wrong subscribe header"));if(c.subscriptions=[],this._parseMessageId()){if(5===this.settings.protocolVersion){var u=this._parseProperties();Object.getOwnPropertyNames(u).length&&(c.properties=u)}for(;this._pos<c.length;){if(null===(t=this._parseString()))return this._emitError(new Error("Cannot parse topic"));r=(e=this._parseByte())&a.SUBSCRIBE_OPTIONS_QOS_MASK,o=0!=(e>>a.SUBSCRIBE_OPTIONS_NL_SHIFT&a.SUBSCRIBE_OPTIONS_NL_MASK),i=0!=(e>>a.SUBSCRIBE_OPTIONS_RAP_SHIFT&a.SUBSCRIBE_OPTIONS_RAP_MASK),n=e>>a.SUBSCRIBE_OPTIONS_RH_SHIFT&a.SUBSCRIBE_OPTIONS_RH_MASK,s={topic:t,qos:r},5===this.settings.protocolVersion&&(s.nl=o,s.rap=i,s.rh=n),c.subscriptions.push(s)}}},c.prototype._parseSuback=function(){var t=this.packet;if(this.packet.granted=[],this._parseMessageId()){if(5===this.settings.protocolVersion){var e=this._parseProperties();Object.getOwnPropertyNames(e).length&&(t.properties=e)}for(;this._pos<this.packet.length;)this.packet.granted.push(this._list.readUInt8(this._pos++))}},c.prototype._parseUnsubscribe=function(){var t=this.packet;if(t.unsubscriptions=[],this._parseMessageId()){if(5===this.settings.protocolVersion){var e=this._parseProperties();Object.getOwnPropertyNames(e).length&&(t.properties=e)}for(;this._pos<t.length;){var r;if(null===(r=this._parseString()))return this._emitError(new Error("Cannot parse topic"));t.unsubscriptions.push(r)}}},c.prototype._parseUnsuback=function(){var t=this.packet;if(!this._parseMessageId())return this._emitError(new Error("Cannot parse messageId"));if(5===this.settings.protocolVersion){var e=this._parseProperties();for(Object.getOwnPropertyNames(e).length&&(t.properties=e),t.granted=[];this._pos<this.packet.length;)this.packet.granted.push(this._list.readUInt8(this._pos++))}},c.prototype._parseConfirmation=function(){var t=this.packet;if(this._parseMessageId(),5===this.settings.protocolVersion&&t.length>2){t.reasonCode=this._parseByte();var e=this._parseProperties();Object.getOwnPropertyNames(e).length&&(t.properties=e)}return!0},c.prototype._parseDisconnect=function(){var t=this.packet;if(5===this.settings.protocolVersion){t.reasonCode=this._parseByte();var e=this._parseProperties();Object.getOwnPropertyNames(e).length&&(t.properties=e)}return!0},c.prototype._parseAuth=function(){var t=this.packet;if(5!==this.settings.protocolVersion)return this._emitError(new Error("Not supported auth packet for this version MQTT"));t.reasonCode=this._parseByte();var e=this._parseProperties();return Object.getOwnPropertyNames(e).length&&(t.properties=e),!0},c.prototype._parseMessageId=function(){var t=this.packet;return t.messageId=this._parseNum(),null!==t.messageId||(this._emitError(new Error("Cannot parse messageId")),!1)},c.prototype._parseString=function(t){var e,r=this._parseNum(),n=r+this._pos;return-1===r||n>this._list.length||n>this.packet.length?null:(e=this._list.toString("utf8",this._pos,n),this._pos+=r,e)},c.prototype._parseStringPair=function(){return{name:this._parseString(),value:this._parseString()}},c.prototype._parseBuffer=function(){var t,e=this._parseNum(),r=e+this._pos;return-1===e||r>this._list.length||r>this.packet.length?null:(t=this._list.slice(this._pos,r),this._pos+=e,t)},c.prototype._parseNum=function(){if(this._list.length-this._pos<2)return-1;var t=this._list.readUInt16BE(this._pos);return this._pos+=2,t},c.prototype._parse4ByteNum=function(){if(this._list.length-this._pos<4)return-1;var t=this._list.readUInt32BE(this._pos);return this._pos+=4,t},c.prototype._parseVarByteNum=function(t){for(var e,r=0,n=1,i=0,o=!0,s=this._pos?this._pos:0;r<5&&(i+=n*((e=this._list.readUInt8(s+r++))&a.LENGTH_MASK),n*=128,0!=(e&a.LENGTH_FIN_MASK));)if(this._list.length<=r){o=!1;break}return s&&(this._pos+=r),o=!!o&&(t?{bytes:r,value:i}:i)},c.prototype._parseByte=function(){var t=this._list.readUInt8(this._pos);return this._pos++,t},c.prototype._parseByType=function(t){switch(t){case"byte":return 0!==this._parseByte();case"int8":return this._parseByte();case"int16":return this._parseNum();case"int32":return this._parse4ByteNum();case"var":return this._parseVarByteNum();case"string":return this._parseString();case"pair":return this._parseStringPair();case"binary":return this._parseBuffer()}},c.prototype._parseProperties=function(){for(var t=this._parseVarByteNum(),e=this._pos+t,r={};this._pos<e;){var n=this._parseByte(),i=a.propertiesCodes[n];if(!i)return this._emitError(new Error("Unknown property")),!1;if("userProperties"!==i)r[i]=this._parseByType(a.propertiesTypes[i]);else{r[i]||(r[i]={});var o=this._parseByType(a.propertiesTypes[i]);r[i][o.name]=o.value}}return r},c.prototype._newPacket=function(){return this.packet&&(this._list.consume(this.packet.length),this.emit("packet",this.packet)),this.packet=new s,this._pos=0,!0},c.prototype._emitError=function(t){this.error=t,this.emit("error",t)},e.exports=c},{"./constants":82,"./packet":87,bl:85,events:13,inherits:80}],89:[function(t,e,r){var n=t("./constants"),i=t("safe-buffer").Buffer,o=i.allocUnsafe(0),s=i.from([0]),a=t("./numbers"),c=t("process-nextick-args").nextTick,u=a.cache,h=a.generateNumber,d=a.generateCache,l=a.genBufVariableByteInt,_=a.generate4ByteBuffer,p=A,f=!0;function b(t,e,r){switch(e.cork&&(e.cork(),c(g,e)),f&&(f=!1,d()),t.cmd){case"connect":return m(t,e);case"connack":return y(t,e,r);case"publish":return v(t,e,r);case"puback":case"pubrec":case"pubrel":case"pubcomp":return R(t,e,r);case"subscribe":return w(t,e,r);case"suback":return S(t,e,r);case"unsubscribe":return T(t,e,r);case"unsuback":return C(t,e,r);case"pingreq":case"pingresp":return E(t,e);case"disconnect":return P(t,e,r);case"auth":return x(t,e,r);default:return e.emit("error",new Error("Unknown command")),!1}}function g(t){t.uncork()}function m(t,e,r){var o=t||{},s=o.protocolId||"MQTT",a=o.protocolVersion||4,c=o.will,u=o.clean,h=o.keepalive||0,d=o.clientId||"",l=o.username,_=o.password,f=o.properties;void 0===u&&(u=!0);var b=0;if(!s||"string"!=typeof s&&!i.isBuffer(s))return e.emit("error",new Error("Invalid protocolId")),!1;if(b+=s.length+2,3!==a&&4!==a&&5!==a)return e.emit("error",new Error("Invalid protocol version")),!1;if(b+=1,"string"!=typeof d&&!i.isBuffer(d)||!d&&4!==a||!d&&!u){if(a<4)return e.emit("error",new Error("clientId must be supplied before 3.1.1")),!1;if(1*u==0)return e.emit("error",new Error("clientId must be given if cleanSession set to 0")),!1}else b+=d.length+2;if("number"!=typeof h||h<0||h>65535||h%1!=0)return e.emit("error",new Error("Invalid keepalive")),!1;if(b+=2,b+=1,5===a){var g=U(e,f);b+=g.length}if(c){if("object"!=typeof c)return e.emit("error",new Error("Invalid will")),!1;if(!c.topic||"string"!=typeof c.topic)return e.emit("error",new Error("Invalid will topic")),!1;if(b+=i.byteLength(c.topic)+2,c.payload){if(!(c.payload.length>=0))return e.emit("error",new Error("Invalid will payload")),!1;"string"==typeof c.payload?b+=i.byteLength(c.payload)+2:b+=c.payload.length+2;var m={};5===a&&(b+=(m=U(e,c.properties)).length)}}var y=!1;if(null!=l){if(!j(l))return e.emit("error",new Error("Invalid username")),!1;y=!0,b+=i.byteLength(l)+2}if(null!=_){if(!y)return e.emit("error",new Error("Username is required to use password")),!1;if(!j(_))return e.emit("error",new Error("Invalid password")),!1;b+=F(_)+2}e.write(n.CONNECT_HEADER),L(e,b),D(e,s),e.write(4===a?n.VERSION4:5===a?n.VERSION5:n.VERSION3);var v=0;return v|=null!=l?n.USERNAME_MASK:0,v|=null!=_?n.PASSWORD_MASK:0,v|=c&&c.retain?n.WILL_RETAIN_MASK:0,v|=c&&c.qos?c.qos<<n.WILL_QOS_SHIFT:0,v|=c?n.WILL_FLAG_MASK:0,v|=u?n.CLEAN_SESSION_MASK:0,e.write(i.from([v])),p(e,h),5===a&&g.write(),D(e,d),c&&(5===a&&m.write(),M(e,c.topic),D(e,c.payload)),null!=l&&D(e,l),null!=_&&D(e,_),!0}function y(t,e,r){var o=r?r.protocolVersion:4,a=t||{},c=5===o?a.reasonCode:a.returnCode,u=a.properties,h=2;if("number"!=typeof c)return e.emit("error",new Error("Invalid return code")),!1;var d=null;return 5===o&&(h+=(d=U(e,u)).length),e.write(n.CONNACK_HEADER),L(e,h),e.write(a.sessionPresent?n.SESSIONPRESENT_HEADER:s),e.write(i.from([c])),null!=d&&d.write(),!0}function v(t,e,r){var s=r?r.protocolVersion:4,a=t||{},c=a.qos||0,u=a.retain?n.RETAIN_MASK:0,h=a.topic,d=a.payload||o,l=a.messageId,_=a.properties,f=0;if("string"==typeof h)f+=i.byteLength(h)+2;else{if(!i.isBuffer(h))return e.emit("error",new Error("Invalid topic")),!1;f+=h.length+2}if(i.isBuffer(d)?f+=d.length:f+=i.byteLength(d),c&&"number"!=typeof l)return e.emit("error",new Error("Invalid messageId")),!1;c&&(f+=2);var b=null;return 5===s&&(f+=(b=U(e,_)).length),e.write(n.PUBLISH_HEADER[c][a.dup?1:0][u?1:0]),L(e,f),p(e,F(h)),e.write(h),c>0&&p(e,l),null!=b&&b.write(),e.write(d)}function R(t,e,r){var o=r?r.protocolVersion:4,s=t||{},a=s.cmd||"puback",c=s.messageId,u=s.dup&&"pubrel"===a?n.DUP_MASK:0,h=0,d=s.reasonCode,l=s.properties,_=5===o?3:2;if("pubrel"===a&&(h=1),"number"!=typeof c)return e.emit("error",new Error("Invalid messageId")),!1;var f=null;if(5===o){if(!(f=N(e,l,r,_)))return!1;_+=f.length}return e.write(n.ACKS[a][h][u][0]),L(e,_),p(e,c),5===o&&e.write(i.from([d])),null!==f&&f.write(),!0}function w(t,e,r){var o=r?r.protocolVersion:4,s=t||{},a=s.dup?n.DUP_MASK:0,c=s.messageId,u=s.subscriptions,h=s.properties,d=0;if("number"!=typeof c)return e.emit("error",new Error("Invalid messageId")),!1;d+=2;var l=null;if(5===o&&(d+=(l=U(e,h)).length),"object"!=typeof u||!u.length)return e.emit("error",new Error("Invalid subscriptions")),!1;for(var _=0;_<u.length;_+=1){var f=u[_].topic,b=u[_].qos;if("string"!=typeof f)return e.emit("error",new Error("Invalid subscriptions - invalid topic")),!1;if("number"!=typeof b)return e.emit("error",new Error("Invalid subscriptions - invalid qos")),!1;if(5===o){if("boolean"!=typeof(u[_].nl||!1))return e.emit("error",new Error("Invalid subscriptions - invalid No Local")),!1;if("boolean"!=typeof(u[_].rap||!1))return e.emit("error",new Error("Invalid subscriptions - invalid Retain as Published")),!1;var g=u[_].rh||0;if("number"!=typeof g||g>2)return e.emit("error",new Error("Invalid subscriptions - invalid Retain Handling")),!1}d+=i.byteLength(f)+2+1}e.write(n.SUBSCRIBE_HEADER[1][a?1:0][0]),L(e,d),p(e,c),null!==l&&l.write();for(var m=!0,y=0;y<u.length;y++){var v,R=u[y],w=R.topic,S=R.qos,T=+R.nl,C=+R.rap,E=R.rh;M(e,w),v=n.SUBSCRIBE_OPTIONS_QOS[S],5===o&&(v|=T?n.SUBSCRIBE_OPTIONS_NL:0,v|=C?n.SUBSCRIBE_OPTIONS_RAP:0,v|=E?n.SUBSCRIBE_OPTIONS_RH[E]:0),m=e.write(i.from([v]))}return m}function S(t,e,r){var o=r?r.protocolVersion:4,s=t||{},a=s.messageId,c=s.granted,u=s.properties,h=0;if("number"!=typeof a)return e.emit("error",new Error("Invalid messageId")),!1;if(h+=2,"object"!=typeof c||!c.length)return e.emit("error",new Error("Invalid qos vector")),!1;for(var d=0;d<c.length;d+=1){if("number"!=typeof c[d])return e.emit("error",new Error("Invalid qos vector")),!1;h+=1}var l=null;if(5===o){if(!(l=N(e,u,r,h)))return!1;h+=l.length}return e.write(n.SUBACK_HEADER),L(e,h),p(e,a),null!==l&&l.write(),e.write(i.from(c))}function T(t,e,r){var o=r?r.protocolVersion:4,s=t||{},a=s.messageId,c=s.dup?n.DUP_MASK:0,u=s.unsubscriptions,h=s.properties,d=0;if("number"!=typeof a)return e.emit("error",new Error("Invalid messageId")),!1;if(d+=2,"object"!=typeof u||!u.length)return e.emit("error",new Error("Invalid unsubscriptions")),!1;for(var l=0;l<u.length;l+=1){if("string"!=typeof u[l])return e.emit("error",new Error("Invalid unsubscriptions")),!1;d+=i.byteLength(u[l])+2}var _=null;5===o&&(d+=(_=U(e,h)).length),e.write(n.UNSUBSCRIBE_HEADER[1][c?1:0][0]),L(e,d),p(e,a),null!==_&&_.write();for(var f=!0,b=0;b<u.length;b++)f=M(e,u[b]);return f}function C(t,e,r){var o=r?r.protocolVersion:4,s=t||{},a=s.messageId,c=s.dup?n.DUP_MASK:0,u=s.granted,h=s.properties,d=s.cmd,l=0,_=2;if("number"!=typeof a)return e.emit("error",new Error("Invalid messageId")),!1;if(5===o){if("object"!=typeof u||!u.length)return e.emit("error",new Error("Invalid qos vector")),!1;for(var f=0;f<u.length;f+=1){if("number"!=typeof u[f])return e.emit("error",new Error("Invalid qos vector")),!1;_+=1}}var b=null;if(5===o){if(!(b=N(e,h,r,_)))return!1;_+=b.length}return e.write(n.ACKS[d][l][c][0]),L(e,_),p(e,a),null!==b&&b.write(),5===o&&e.write(i.from(u)),!0}function E(t,e,r){return e.write(n.EMPTY[t.cmd])}function P(t,e,r){var o=r?r.protocolVersion:4,s=t||{},a=s.reasonCode,c=s.properties,u=5===o?1:0,h=null;if(5===o){if(!(h=N(e,c,r,u)))return!1;u+=h.length}return e.write(i.from([n.codes.disconnect<<4])),L(e,u),5===o&&e.write(i.from([a])),null!==h&&h.write(),!0}function x(t,e,r){var o=r?r.protocolVersion:4,s=t||{},a=s.reasonCode,c=s.properties,u=5===o?1:0;5!==o&&e.emit("error",new Error("Invalid mqtt version for auth packet"));var h=N(e,c,r,u);return!!h&&(u+=h.length,e.write(i.from([n.codes.auth<<4])),L(e,u),e.write(i.from([a])),null!==h&&h.write(),!0)}Object.defineProperty(b,"cacheNumbers",{get:function(){return p===A},set:function(t){t?(u&&0!==Object.keys(u).length||(f=!0),p=A):(f=!1,p=O)}});var I={};function L(t,e){var r=I[e];r||(r=l(e).data,e<16384&&(I[e]=r)),t.write(r)}function M(t,e){var r=i.byteLength(e);p(t,r),t.write(e,"utf8")}function k(t,e,r){M(t,e),M(t,r)}function A(t,e){return t.write(u[e])}function O(t,e){return t.write(h(e))}function B(t,e){return t.write(_(e))}function D(t,e){"string"==typeof e?M(t,e):e?(p(t,e.length),t.write(e)):p(t,0)}function U(t,e){if("object"!=typeof e||null!=e.length)return{length:1,write:function(){q(t,{},0)}};var r=0;function o(r){var o=n.propertiesTypes[r],s=e[r],a=0;switch(o){case"byte":if("boolean"!=typeof s)return t.emit("error",new Error("Invalid "+r)),!1;a+=2;break;case"int8":if("number"!=typeof s)return t.emit("error",new Error("Invalid "+r)),!1;a+=2;break;case"binary":if(s&&null===s)return t.emit("error",new Error("Invalid "+r)),!1;a+=1+i.byteLength(s)+2;break;case"int16":if("number"!=typeof s)return t.emit("error",new Error("Invalid "+r)),!1;a+=3;break;case"int32":if("number"!=typeof s)return t.emit("error",new Error("Invalid "+r)),!1;a+=5;break;case"var":if("number"!=typeof s)return t.emit("error",new Error("Invalid "+r)),!1;a+=1+l(s).length;break;case"string":if("string"!=typeof s)return t.emit("error",new Error("Invalid "+r)),!1;a+=3+i.byteLength(s.toString());break;case"pair":if("object"!=typeof s)return t.emit("error",new Error("Invalid "+r)),!1;a+=Object.getOwnPropertyNames(s).reduce((function(t,e){return t+=3+i.byteLength(e.toString())+2+i.byteLength(s[e].toString())}),0);break;default:return t.emit("error",new Error("Invalid property "+r)),!1}return a}if(e)for(var s in e){var a=o(s);if(!a)return!1;r+=a}return{length:l(r).length+r,write:function(){q(t,e,r)}}}function N(t,e,r,n){var i=["reasonString","userProperties"],o=r&&r.properties&&r.properties.maximumPacketSize?r.properties.maximumPacketSize:0,s=U(t,e);if(o)for(;n+s.length>o;){var a=i.shift();if(!a||!e[a])return!1;delete e[a],s=U(t,e)}return s}function q(t,e,r){for(var o in L(t,r),e)if(e.hasOwnProperty(o)&&null!==e[o]){var s=e[o];switch(n.propertiesTypes[o]){case"byte":t.write(i.from([n.properties[o]])),t.write(i.from([+s]));break;case"int8":t.write(i.from([n.properties[o]])),t.write(i.from([s]));break;case"binary":t.write(i.from([n.properties[o]])),D(t,s);break;case"int16":t.write(i.from([n.properties[o]])),p(t,s);break;case"int32":t.write(i.from([n.properties[o]])),B(t,s);break;case"var":t.write(i.from([n.properties[o]])),L(t,s);break;case"string":t.write(i.from([n.properties[o]])),M(t,s);break;case"pair":Object.getOwnPropertyNames(s).forEach((function(e){t.write(i.from([n.properties[o]])),k(t,e.toString(),s[e].toString())}));break;default:return t.emit("error",new Error("Invalid property "+o)),!1}}}function F(t){return t?t instanceof i?t.length:i.byteLength(t):0}function j(t){return"string"==typeof t||t instanceof i}e.exports=b},{"./constants":82,"./numbers":86,"process-nextick-args":91,"safe-buffer":110}],90:[function(t,e,r){var n=t("wrappy");function i(t){var e=function(){return e.called?e.value:(e.called=!0,e.value=t.apply(this,arguments))};return e.called=!1,e}function o(t){var e=function(){if(e.called)throw new Error(e.onceError);return e.called=!0,e.value=t.apply(this,arguments)},r=t.name||"Function wrapped with `once`";return e.onceError=r+" shouldn't be called more than once",e.called=!1,e}e.exports=n(i),e.exports.strict=n(o),i.proto=i((function(){Object.defineProperty(Function.prototype,"once",{value:function(){return i(this)},configurable:!0}),Object.defineProperty(Function.prototype,"onceStrict",{value:function(){return o(this)},configurable:!0})}))},{wrappy:120}],91:[function(t,e,r){(function(t){function r(e,r,n,i){if("function"!=typeof e)throw new TypeError('"callback" argument must be a function');var o,s,a=arguments.length;switch(a){case 0:case 1:return t.nextTick(e);case 2:return t.nextTick((function(){e.call(null,r)}));case 3:return t.nextTick((function(){e.call(null,r,n)}));case 4:return t.nextTick((function(){e.call(null,r,n,i)}));default:for(o=new Array(a-1),s=0;s<o.length;)o[s++]=arguments[s];return t.nextTick((function(){e.apply(null,o)}))}}!t.version||0===t.version.indexOf("v0.")||0===t.version.indexOf("v1.")&&0!==t.version.indexOf("v1.8.")?e.exports={nextTick:r}:e.exports=t}).call(this,t("_process"))},{_process:92}],92:[function(t,e,r){var n,i,o=e.exports={};function s(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function c(t){if(n===setTimeout)return setTimeout(t,0);if((n===s||!n)&&setTimeout)return n=setTimeout,setTimeout(t,0);try{return n(t,0)}catch(ae){try{return n.call(null,t,0)}catch(ae){return n.call(this,t,0)}}}function u(t){if(i===clearTimeout)return clearTimeout(t);if((i===a||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(t);try{return i(t)}catch(ae){try{return i.call(null,t)}catch(ae){return i.call(this,t)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:s}catch(ae){n=s}try{i="function"==typeof clearTimeout?clearTimeout:a}catch(ae){i=a}}();var h,d=[],l=!1,_=-1;function p(){l&&h&&(l=!1,h.length?d=h.concat(d):_=-1,d.length&&f())}function f(){if(!l){var t=c(p);l=!0;for(var e=d.length;e;){for(h=d,d=[];++_<e;)h&&h[_].run();_=-1,e=d.length}h=null,l=!1,u(t)}}function b(t,e){this.fun=t,this.array=e}function g(){}o.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)e[r-1]=arguments[r];d.push(new b(t,e)),1!==d.length||l||c(f)},b.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=g,o.addListener=g,o.once=g,o.off=g,o.removeListener=g,o.removeAllListeners=g,o.emit=g,o.prependListener=g,o.prependOnceListener=g,o.listeners=function(t){return[]},o.binding=function(t){throw new Error("process.binding is not supported")},o.cwd=function(){return"../default.htm"},o.chdir=function(t){throw new Error("process.chdir is not supported")},o.umask=function(){return 0}},{}],93:[function(t,e,r){(function(t){!function(n){var i="object"==typeof r&&r&&!r.nodeType&&r,o="object"==typeof e&&e&&!e.nodeType&&e,s="object"==typeof t&&t;s.global!==s&&s.window!==s&&s.self!==s||(n=s);var a,c,u=2147483647,h=36,d=1,l=26,_=38,p=700,f=72,b=128,g="-",m=/^xn--/,y=/[^\x20-\x7E]/,v=/[\x2E\u3002\uFF0E\uFF61]/g,R={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},w=h-d,S=Math.floor,T=String.fromCharCode;function C(t){throw new RangeError(R[t])}function E(t,e){for(var r=t.length,n=[];r--;)n[r]=e(t[r]);return n}function P(t,e){var r=t.split("@"),n="";return r.length>1&&(n=r[0]+"@",t=r[1]),n+E((t=t.replace(v,".")).split("."),e).join(".")}function x(t){for(var e,r,n=[],i=0,o=t.length;i<o;)(e=t.charCodeAt(i++))>=55296&&e<=56319&&i<o?56320==(64512&(r=t.charCodeAt(i++)))?n.push(((1023&e)<<10)+(1023&r)+65536):(n.push(e),i--):n.push(e);return n}function I(t){return E(t,(function(t){var e="";return t>65535&&(e+=T((t-=65536)>>>10&1023|55296),t=56320|1023&t),e+=T(t)})).join("")}function L(t){return t-48<10?t-22:t-65<26?t-65:t-97<26?t-97:h}function M(t,e){return t+22+75*(t<26)-((0!=e)<<5)}function k(t,e,r){var n=0;for(t=r?S(t/p):t>>1,t+=S(t/e);t>w*l>>1;n+=h)t=S(t/w);return S(n+(w+1)*t/(t+_))}function A(t){var e,r,n,i,o,s,a,c,_,p,m=[],y=t.length,v=0,R=b,w=f;for((r=t.lastIndexOf(g))<0&&(r=0),n=0;n<r;++n)t.charCodeAt(n)>=128&&C("not-basic"),m.push(t.charCodeAt(n));for(i=r>0?r+1:0;i<y;){for(o=v,s=1,a=h;i>=y&&C("invalid-input"),((c=L(t.charCodeAt(i++)))>=h||c>S((u-v)/s))&&C("overflow"),v+=c*s,!(c<(_=a<=w?d:a>=w+l?l:a-w));a+=h)s>S(u/(p=h-_))&&C("overflow"),s*=p;w=k(v-o,e=m.length+1,0==o),S(v/e)>u-R&&C("overflow"),R+=S(v/e),v%=e,m.splice(v++,0,R)}return I(m)}function O(t){var e,r,n,i,o,s,a,c,_,p,m,y,v,R,w,E=[];for(y=(t=x(t)).length,e=b,r=0,o=f,s=0;s<y;++s)(m=t[s])<128&&E.push(T(m));for(n=i=E.length,i&&E.push(g);n<y;){for(a=u,s=0;s<y;++s)(m=t[s])>=e&&m<a&&(a=m);for(a-e>S((u-r)/(v=n+1))&&C("overflow"),r+=(a-e)*v,e=a,s=0;s<y;++s)if((m=t[s])<e&&++r>u&&C("overflow"),m==e){for(c=r,_=h;!(c<(p=_<=o?d:_>=o+l?l:_-o));_+=h)w=c-p,R=h-p,E.push(T(M(p+w%R,0))),c=S(w/R);E.push(T(M(c,0))),o=k(r,v,n==i),r=0,++n}++r,++e}return E.join("")}function B(t){return P(t,(function(t){return m.test(t)?A(t.slice(4).toLowerCase()):t}))}function D(t){return P(t,(function(t){return y.test(t)?"xn--"+O(t):t}))}if(a={version:"1.4.1",ucs2:{decode:x,encode:I},decode:A,encode:O,toASCII:D,toUnicode:B},i&&o)if(e.exports==i)o.exports=a;else for(c in a)a.hasOwnProperty(c)&&(i[c]=a[c]);else n.punycode=a}(this)}).call(this,void 0!==M?M:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],94:[function(t,e,r){function n(t,e){return Object.prototype.hasOwnProperty.call(t,e)}e.exports=function(t,e,r,o){e=e||"&",r=r||"=";var s={};if("string"!=typeof t||0===t.length)return s;var a=/\+/g;t=t.split(e);var c=1e3;o&&"number"==typeof o.maxKeys&&(c=o.maxKeys);var u=t.length;c>0&&u>c&&(u=c);for(var h=0;h<u;++h){var d,l,_,p,f=t[h].replace(a,"%20"),b=f.indexOf(r);b>=0?(d=f.substr(0,b),l=f.substr(b+1)):(d=f,l=""),_=decodeURIComponent(d),p=decodeURIComponent(l),n(s,_)?i(s[_])?s[_].push(p):s[_]=[s[_],p]:s[_]=p}return s};var i=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)}},{}],95:[function(t,e,r){var n=function(t){switch(typeof t){case"string":return t;case"boolean":return t?"true":"false";case"number":return isFinite(t)?t:"";default:return""}};e.exports=function(t,e,r,a){return e=e||"&",r=r||"=",null===t&&(t=void 0),"object"==typeof t?o(s(t),(function(s){var a=encodeURIComponent(n(s))+r;return i(t[s])?o(t[s],(function(t){return a+encodeURIComponent(n(t))})).join(e):a+encodeURIComponent(n(t[s]))})).join(e):a?encodeURIComponent(n(a))+r+encodeURIComponent(n(t)):""};var i=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)};function o(t,e){if(t.map)return t.map(e);for(var r=[],n=0;n<t.length;n++)r.push(e(t[n],n));return r}var s=Object.keys||function(t){var e=[];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.push(r);return e}},{}],96:[function(t,e,r){r.decode=r.parse=t("decode"),r.encode=r.stringify=t("encode")},{"decode":94,"encode":95}],97:[function(t,e,r){e.exports=t("lib/_stream_duplex.js")},{"lib/_stream_duplex.js":98}],98:[function(t,e,r){var n=t("process-nextick-args"),i=Object.keys||function(t){var e=[];for(var r in t)e.push(r);return e};e.exports=d;var o=t("core-util-is");o.inherits=t("inherits");var s=t("_stream_readable"),a=t("_stream_writable");o.inherits(d,s);for(var c=i(a.prototype),u=0;u<c.length;u++){var h=c[u];d.prototype[h]||(d.prototype[h]=a.prototype[h])}function d(t){if(!(this instanceof d))return new d(t);s.call(this,t),a.call(this,t),t&&!1===t.readable&&(this.readable=!1),t&&!1===t.writable&&(this.writable=!1),this.allowHalfOpen=!0,t&&!1===t.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",l)}function l(){this.allowHalfOpen||this._writableState.ended||n.nextTick(_,this)}function _(t){t.end()}Object.defineProperty(d.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(d.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&this._readableState.destroyed&&this._writableState.destroyed},set:function(t){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=t,this._writableState.destroyed=t)}}),d.prototype._destroy=function(t,e){this.push(null),this.end(),n.nextTick(e,t)}},{"_stream_readable":100,"_stream_writable":102,"core-util-is":14,inherits:80,"process-nextick-args":91}],99:[function(t,e,r){e.exports=o;var n=t("_stream_transform"),i=t("core-util-is");function o(t){if(!(this instanceof o))return new o(t);n.call(this,t)}i.inherits=t("inherits"),i.inherits(o,n),o.prototype._transform=function(t,e,r){r(null,t)}},{"_stream_transform":101,"core-util-is":14,inherits:80}],100:[function(t,e,r){(function(r,n){var i=t("process-nextick-args");e.exports=w;var o,s=t("isarray");w.ReadableState=R,t("events").EventEmitter;var a=function(t,e){return t.listeners(e).length},c=t("internal/streams/stream"),u=t("safe-buffer").Buffer,h=n.Uint8Array||function(){};function d(t){return u.from(t)}function l(t){return u.isBuffer(t)||t instanceof h}var _=t("core-util-is");_.inherits=t("inherits");var p=t("util"),f=void 0;f=p&&p.debuglog?p.debuglog("stream"):function(){};var b,g=t("internal/streams/BufferList"),m=t("internal/streams/destroy");_.inherits(w,c);var y=["error","close","destroy","pause","resume"];function v(t,e,r){if("function"==typeof t.prependListener)return t.prependListener(e,r);t._events&&t._events[e]?s(t._events[e])?t._events[e].unshift(r):t._events[e]=[r,t._events[e]]:t.on(e,r)}function R(e,r){e=e||{};var n=r instanceof(o=o||t("_stream_duplex"));this.objectMode=!!e.objectMode,n&&(this.objectMode=this.objectMode||!!e.readableObjectMode);var i=e.highWaterMark,s=e.readableHighWaterMark,a=this.objectMode?16:16384;this.highWaterMark=i||0===i?i:n&&(s||0===s)?s:a,this.highWaterMark=Math.floor(this.highWaterMark),this.buffer=new g,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.destroyed=!1,this.defaultEncoding=e.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(b||(b=t("string_decoder/").StringDecoder),this.decoder=new b(e.encoding),this.encoding=e.encoding)}function w(e){if(o=o||t("_stream_duplex"),!(this instanceof w))return new w(e);this._readableState=new R(e,this),this.readable=!0,e&&("function"==typeof e.read&&(this._read=e.read),"function"==typeof e.destroy&&(this._destroy=e.destroy)),c.call(this)}function S(t,e,r,n,i){var o,s=t._readableState;return null===e?(s.reading=!1,L(t,s)):(i||(o=C(s,e)),o?t.emit("error",o):s.objectMode||e&&e.length>0?("string"==typeof e||s.objectMode||Object.getPrototypeOf(e)===u.prototype||(e=d(e)),n?s.endEmitted?t.emit("error",new Error("stream.unshift() after end event")):T(t,s,e,!0):s.ended?t.emit("error",new Error("stream.push() after EOF")):(s.reading=!1,s.decoder&&!r?(e=s.decoder.write(e),s.objectMode||0!==e.length?T(t,s,e,!1):A(t,s)):T(t,s,e,!1))):n||(s.reading=!1)),E(s)}function T(t,e,r,n){e.flowing&&0===e.length&&!e.sync?(t.emit("data",r),t.read(0)):(e.length+=e.objectMode?1:r.length,n?e.buffer.unshift(r):e.buffer.push(r),e.needReadable&&M(t)),A(t,e)}function C(t,e){var r;return l(e)||"string"==typeof e||void 0===e||t.objectMode||(r=new TypeError("Invalid non-string/buffer chunk")),r}function E(t){return!t.ended&&(t.needReadable||t.length<t.highWaterMark||0===t.length)}Object.defineProperty(w.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(t){this._readableState&&(this._readableState.destroyed=t)}}),w.prototype.destroy=m.destroy,w.prototype._undestroy=m.undestroy,w.prototype._destroy=function(t,e){this.push(null),e(t)},w.prototype.push=function(t,e){var r,n=this._readableState;return n.objectMode?r=!0:"string"==typeof t&&((e=e||n.defaultEncoding)!==n.encoding&&(t=u.from(t,e),e=""),r=!0),S(this,t,e,!1,r)},w.prototype.unshift=function(t){return S(this,t,null,!0,!1)},w.prototype.isPaused=function(){return!1===this._readableState.flowing},w.prototype.setEncoding=function(e){return b||(b=t("string_decoder/").StringDecoder),this._readableState.decoder=new b(e),this._readableState.encoding=e,this};var P=8388608;function x(t){return t>=P?t=P:(t--,t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,t|=t>>>16,t++),t}function I(t,e){return t<=0||0===e.length&&e.ended?0:e.objectMode?1:t!=t?e.flowing&&e.length?e.buffer.head.data.length:e.length:(t>e.highWaterMark&&(e.highWaterMark=x(t)),t<=e.length?t:e.ended?e.length:(e.needReadable=!0,0))}function L(t,e){if(!e.ended){if(e.decoder){var r=e.decoder.end();r&&r.length&&(e.buffer.push(r),e.length+=e.objectMode?1:r.length)}e.ended=!0,M(t)}}function M(t){var e=t._readableState;e.needReadable=!1,e.emittedReadable||(f("emitReadable",e.flowing),e.emittedReadable=!0,e.sync?i.nextTick(k,t):k(t))}function k(t){f("emit readable"),t.emit("readable"),q(t)}function A(t,e){e.readingMore||(e.readingMore=!0,i.nextTick(O,t,e))}function O(t,e){for(var r=e.length;!e.reading&&!e.flowing&&!e.ended&&e.length<e.highWaterMark&&(f("maybeReadMore read 0"),t.read(0),r!==e.length);)r=e.length;e.readingMore=!1}function B(t){return function(){var e=t._readableState;f("pipeOnDrain",e.awaitDrain),e.awaitDrain&&e.awaitDrain--,0===e.awaitDrain&&a(t,"data")&&(e.flowing=!0,q(t))}}function D(t){f("readable nexttick read 0"),t.read(0)}function U(t,e){e.resumeScheduled||(e.resumeScheduled=!0,i.nextTick(N,t,e))}function N(t,e){e.reading||(f("resume read 0"),t.read(0)),e.resumeScheduled=!1,e.awaitDrain=0,t.emit("resume"),q(t),e.flowing&&!e.reading&&t.read(0)}function q(t){var e=t._readableState;for(f("flow",e.flowing);e.flowing&&null!==t.read(););}function F(t,e){return 0===e.length?null:(e.objectMode?r=e.buffer.shift():!t||t>=e.length?(r=e.decoder?e.buffer.join(""):1===e.buffer.length?e.buffer.head.data:e.buffer.concat(e.length),e.buffer.clear()):r=j(t,e.buffer,e.decoder),r);var r}function j(t,e,r){var n;return t<e.head.data.length?(n=e.head.data.slice(0,t),e.head.data=e.head.data.slice(t)):n=t===e.head.data.length?e.shift():r?V(t,e):z(t,e),n}function V(t,e){var r=e.head,n=1,i=r.data;for(t-=i.length;r=r.next;){var o=r.data,s=t>o.length?o.length:t;if(s===o.length?i+=o:i+=o.slice(0,t),0==(t-=s)){s===o.length?(++n,r.next?e.head=r.next:e.head=e.tail=null):(e.head=r,r.data=o.slice(s));break}++n}return e.length-=n,i}function z(t,e){var r=u.allocUnsafe(t),n=e.head,i=1;for(n.data.copy(r),t-=n.data.length;n=n.next;){var o=n.data,s=t>o.length?o.length:t;if(o.copy(r,r.length-t,0,s),0==(t-=s)){s===o.length?(++i,n.next?e.head=n.next:e.head=e.tail=null):(e.head=n,n.data=o.slice(s));break}++i}return e.length-=i,r}function H(t){var e=t._readableState;if(e.length>0)throw new Error('"endReadable()" called on non-empty stream');e.endEmitted||(e.ended=!0,i.nextTick(G,e,t))}function G(t,e){t.endEmitted||0!==t.length||(t.endEmitted=!0,e.readable=!1,e.emit("end"))}function W(t,e){for(var r=0,n=t.length;r<n;r++)if(t[r]===e)return r;return-1}w.prototype.read=function(t){f("read",t),t=parseInt(t,10);var e=this._readableState,r=t;if(0!==t&&(e.emittedReadable=!1),0===t&&e.needReadable&&(e.length>=e.highWaterMark||e.ended))return f("read: emitReadable",e.length,e.ended),0===e.length&&e.ended?H(this):M(this),null;if(0===(t=I(t,e))&&e.ended)return 0===e.length&&H(this),null;var n,i=e.needReadable;return f("need readable",i),(0===e.length||e.length-t<e.highWaterMark)&&f("length less than watermark",i=!0),e.ended||e.reading?f("reading or ended",i=!1):i&&(f("do read"),e.reading=!0,e.sync=!0,0===e.length&&(e.needReadable=!0),this._read(e.highWaterMark),e.sync=!1,e.reading||(t=I(r,e))),null===(n=t>0?F(t,e):null)?(e.needReadable=!0,t=0):e.length-=t,0===e.length&&(e.ended||(e.needReadable=!0),r!==t&&e.ended&&H(this)),null!==n&&this.emit("data",n),n},w.prototype._read=function(t){this.emit("error",new Error("_read() is not implemented"))},w.prototype.pipe=function(t,e){var n=this,o=this._readableState;switch(o.pipesCount){case 0:o.pipes=t;break;case 1:o.pipes=[o.pipes,t];break;default:o.pipes.push(t)}o.pipesCount+=1,f("pipe count=%d opts=%j",o.pipesCount,e);var s=e&&!1===e.end||t===r.stdout||t===r.stderr?y:u;function c(t,e){f("onunpipe"),t===n&&e&&!1===e.hasUnpiped&&(e.hasUnpiped=!0,l())}function u(){f("onend"),t.end()}o.endEmitted?i.nextTick(s):n.once("end",s),t.on("unpipe",c);var h=B(n);t.on("drain",h);var d=!1;function l(){f("cleanup"),t.removeListener("close",g),t.removeListener("finish",m),t.removeListener("drain",h),t.removeListener("error",b),t.removeListener("unpipe",c),n.removeListener("end",u),n.removeListener("end",y),n.removeListener("data",p),d=!0,!o.awaitDrain||t._writableState&&!t._writableState.needDrain||h()}var _=!1;function p(e){f("ondata"),_=!1,!1!==t.write(e)||_||((1===o.pipesCount&&o.pipes===t||o.pipesCount>1&&-1!==W(o.pipes,t))&&!d&&(f("false write response, pause",n._readableState.awaitDrain),n._readableState.awaitDrain++,_=!0),n.pause())}function b(e){f("onerror",e),y(),t.removeListener("error",b),0===a(t,"error")&&t.emit("error",e)}function g(){t.removeListener("finish",m),y()}function m(){f("onfinish"),t.removeListener("close",g),y()}function y(){f("unpipe"),n.unpipe(t)}return n.on("data",p),v(t,"error",b),t.once("close",g),t.once("finish",m),t.emit("pipe",n),o.flowing||(f("pipe resume"),n.resume()),t},w.prototype.unpipe=function(t){var e=this._readableState,r={hasUnpiped:!1};if(0===e.pipesCount)return this;if(1===e.pipesCount)return t&&t!==e.pipes||(t||(t=e.pipes),e.pipes=null,e.pipesCount=0,e.flowing=!1,t&&t.emit("unpipe",this,r)),this;if(!t){var n=e.pipes,i=e.pipesCount;e.pipes=null,e.pipesCount=0,e.flowing=!1;for(var o=0;o<i;o++)n[o].emit("unpipe",this,r);return this}var s=W(e.pipes,t);return-1===s||(e.pipes.splice(s,1),e.pipesCount-=1,1===e.pipesCount&&(e.pipes=e.pipes[0]),t.emit("unpipe",this,r)),this},w.prototype.on=function(t,e){var r=c.prototype.on.call(this,t,e);if("data"===t)!1!==this._readableState.flowing&&this.resume();else if("readable"===t){var n=this._readableState;n.endEmitted||n.readableListening||(n.readableListening=n.needReadable=!0,n.emittedReadable=!1,n.reading?n.length&&M(this):i.nextTick(D,this))}return r},w.prototype.addListener=w.prototype.on,w.prototype.resume=function(){var t=this._readableState;return t.flowing||(f("resume"),t.flowing=!0,U(this,t)),this},w.prototype.pause=function(){return f("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(f("pause"),this._readableState.flowing=!1,this.emit("pause")),this},w.prototype.wrap=function(t){var e=this,r=this._readableState,n=!1;for(var i in t.on("end",(function(){if(f("wrapped end"),r.decoder&&!r.ended){var t=r.decoder.end();t&&t.length&&e.push(t)}e.push(null)})),t.on("data",(function(i){f("wrapped data"),r.decoder&&(i=r.decoder.write(i)),r.objectMode&&null==i||(r.objectMode||i&&i.length)&&(e.push(i)||(n=!0,t.pause()))})),t)void 0===this[i]&&"function"==typeof t[i]&&(this[i]=function(e){return function(){return t[e].apply(t,arguments)}}(i));for(var o=0;o<y.length;o++)t.on(y[o],this.emit.bind(this,y[o]));return this._read=function(e){f("wrapped _read",e),n&&(n=!1,t.resume())},this},Object.defineProperty(w.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),w._fromList=F}).call(this,t("_process"),void 0!==M?M:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"_stream_duplex":98,"internal/streams/BufferList":103,"internal/streams/destroy":104,"internal/streams/stream":105,_process:92,"core-util-is":14,events:13,inherits:80,isarray:106,"process-nextick-args":91,"safe-buffer":110,"string_decoder/":107,util:11}],101:[function(t,e,r){e.exports=s;var n=t("_stream_duplex"),i=t("core-util-is");function o(t,e){var r=this._transformState;r.transforming=!1;var n=r.writecb;if(!n)return this.emit("error",new Error("write callback called multiple times"));r.writechunk=null,r.writecb=null,null!=e&&this.push(e),n(t);var i=this._readableState;i.reading=!1,(i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}function s(t){if(!(this instanceof s))return new s(t);n.call(this,t),this._transformState={afterTransform:o.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,t&&("function"==typeof t.transform&&(this._transform=t.transform),"function"==typeof t.flush&&(this._flush=t.flush)),this.on("prefinish",a)}function a(){var t=this;"function"==typeof this._flush?this._flush((function(e,r){c(t,e,r)})):c(this,null,null)}function c(t,e,r){if(e)return t.emit("error",e);if(null!=r&&t.push(r),t._writableState.length)throw new Error("Calling transform done when ws.length != 0");if(t._transformState.transforming)throw new Error("Calling transform done when still transforming");return t.push(null)}i.inherits=t("inherits"),i.inherits(s,n),s.prototype.push=function(t,e){return this._transformState.needTransform=!1,n.prototype.push.call(this,t,e)},s.prototype._transform=function(t,e,r){throw new Error("_transform() is not implemented")},s.prototype._write=function(t,e,r){var n=this._transformState;if(n.writecb=r,n.writechunk=t,n.writeencoding=e,!n.transforming){var i=this._readableState;(n.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}},s.prototype._read=function(t){var e=this._transformState;null!==e.writechunk&&e.writecb&&!e.transforming?(e.transforming=!0,this._transform(e.writechunk,e.writeencoding,e.afterTransform)):e.needTransform=!0},s.prototype._destroy=function(t,e){var r=this;n.prototype._destroy.call(this,t,(function(t){e(t),r.emit("close")}))}},{"_stream_duplex":98,"core-util-is":14,inherits:80}],102:[function(t,e,r){(function(r,n,i){var o=t("process-nextick-args");function s(t){var e=this;this.next=null,this.entry=null,this.finish=function(){U(e,t)}}e.exports=v;var a,c=!r.browser&&["v0.10","v0.9."].indexOf(r.version.slice(0,5))>-1?i:o.nextTick;v.WritableState=y;var u=t("core-util-is");u.inherits=t("inherits");var h={deprecate:t("util-deprecate")},d=t("internal/streams/stream"),l=t("safe-buffer").Buffer,_=n.Uint8Array||function(){};function p(t){return l.from(t)}function f(t){return l.isBuffer(t)||t instanceof _}var b,g=t("internal/streams/destroy");function m(){}function y(e,r){a=a||t("_stream_duplex"),e=e||{};var n=r instanceof a;this.objectMode=!!e.objectMode,n&&(this.objectMode=this.objectMode||!!e.writableObjectMode);var i=e.highWaterMark,o=e.writableHighWaterMark,c=this.objectMode?16:16384;this.highWaterMark=i||0===i?i:n&&(o||0===o)?o:c,this.highWaterMark=Math.floor(this.highWaterMark),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var u=!1===e.decodeStrings;this.decodeStrings=!u,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(t){x(r,t)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new s(this)}function v(e){if(a=a||t("_stream_duplex"),!(b.call(v,this)||this instanceof a))return new v(e);this._writableState=new y(e,this),this.writable=!0,e&&("function"==typeof e.write&&(this._write=e.write),"function"==typeof e.writev&&(this._writev=e.writev),"function"==typeof e.destroy&&(this._destroy=e.destroy),"function"==typeof e.final&&(this._final=e.final)),d.call(this)}function R(t,e){var r=new Error("write after end");t.emit("error",r),o.nextTick(e,r)}function w(t,e,r,n){var i=!0,s=!1;return null===r?s=new TypeError("May not write null values to stream"):"string"==typeof r||void 0===r||e.objectMode||(s=new TypeError("Invalid non-string/buffer chunk")),s&&(t.emit("error",s),o.nextTick(n,s),i=!1),i}function S(t,e,r){return t.objectMode||!1===t.decodeStrings||"string"!=typeof e||(e=l.from(e,r)),e}function T(t,e,r,n,i,o){if(!r){var s=S(e,n,i);n!==s&&(r=!0,i="buffer",n=s)}var a=e.objectMode?1:n.length;e.length+=a;var c=e.length<e.highWaterMark;if(c||(e.needDrain=!0),e.writing||e.corked){var u=e.lastBufferedRequest;e.lastBufferedRequest={chunk:n,encoding:i,isBuf:r,callback:o,next:null},u?u.next=e.lastBufferedRequest:e.bufferedRequest=e.lastBufferedRequest,e.bufferedRequestCount+=1}else C(t,e,!1,a,n,i,o);return c}function C(t,e,r,n,i,o,s){e.writelen=n,e.writecb=s,e.writing=!0,e.sync=!0,r?t._writev(i,e.onwrite):t._write(i,o,e.onwrite),e.sync=!1}function E(t,e,r,n,i){--e.pendingcb,r?(o.nextTick(i,n),o.nextTick(B,t,e),t._writableState.errorEmitted=!0,t.emit("error",n)):(i(n),t._writableState.errorEmitted=!0,t.emit("error",n),B(t,e))}function P(t){t.writing=!1,t.writecb=null,t.length-=t.writelen,t.writelen=0}function x(t,e){var r=t._writableState,n=r.sync,i=r.writecb;if(P(r),e)E(t,r,n,e,i);else{var o=k(r);o||r.corked||r.bufferProcessing||!r.bufferedRequest||M(t,r),n?c(I,t,r,o,i):I(t,r,o,i)}}function I(t,e,r,n){r||L(t,e),e.pendingcb--,n(),B(t,e)}function L(t,e){0===e.length&&e.needDrain&&(e.needDrain=!1,t.emit("drain"))}function M(t,e){e.bufferProcessing=!0;var r=e.bufferedRequest;if(t._writev&&r&&r.next){var n=e.bufferedRequestCount,i=new Array(n),o=e.corkedRequestsFree;o.entry=r;for(var a=0,c=!0;r;)i[a]=r,r.isBuf||(c=!1),r=r.next,a+=1;i.allBuffers=c,C(t,e,!0,e.length,i,"",o.finish),e.pendingcb++,e.lastBufferedRequest=null,o.next?(e.corkedRequestsFree=o.next,o.next=null):e.corkedRequestsFree=new s(e),e.bufferedRequestCount=0}else{for(;r;){var u=r.chunk,h=r.encoding,d=r.callback;if(C(t,e,!1,e.objectMode?1:u.length,u,h,d),r=r.next,e.bufferedRequestCount--,e.writing)break}null===r&&(e.lastBufferedRequest=null)}e.bufferedRequest=r,e.bufferProcessing=!1}function k(t){return t.ending&&0===t.length&&null===t.bufferedRequest&&!t.finished&&!t.writing}function A(t,e){t._final((function(r){e.pendingcb--,r&&t.emit("error",r),e.prefinished=!0,t.emit("prefinish"),B(t,e)}))}function O(t,e){e.prefinished||e.finalCalled||("function"==typeof t._final?(e.pendingcb++,e.finalCalled=!0,o.nextTick(A,t,e)):(e.prefinished=!0,t.emit("prefinish")))}function B(t,e){var r=k(e);return r&&(O(t,e),0===e.pendingcb&&(e.finished=!0,t.emit("finish"))),r}function D(t,e,r){e.ending=!0,B(t,e),r&&(e.finished?o.nextTick(r):t.once("finish",r)),e.ended=!0,t.writable=!1}function U(t,e,r){var n=t.entry;for(t.entry=null;n;){var i=n.callback;e.pendingcb--,i(r),n=n.next}e.corkedRequestsFree?e.corkedRequestsFree.next=t:e.corkedRequestsFree=t}u.inherits(v,d),y.prototype.getBuffer=function(){for(var t=this.bufferedRequest,e=[];t;)e.push(t),t=t.next;return e},function(){try{Object.defineProperty(y.prototype,"buffer",{get:h.deprecate((function(){return this.getBuffer()}),"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(t){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(b=Function.prototype[Symbol.hasInstance],Object.defineProperty(v,Symbol.hasInstance,{value:function(t){return!!b.call(this,t)||this===v&&t&&t._writableState instanceof y}})):b=function(t){return t instanceof this},v.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},v.prototype.write=function(t,e,r){var n=this._writableState,i=!1,o=!n.objectMode&&f(t);return o&&!l.isBuffer(t)&&(t=p(t)),"function"==typeof e&&(r=e,e=null),o?e="buffer":e||(e=n.defaultEncoding),"function"!=typeof r&&(r=m),n.ended?R(this,r):(o||w(this,n,t,r))&&(n.pendingcb++,i=T(this,n,o,t,e,r)),i},v.prototype.cork=function(){this._writableState.corked++},v.prototype.uncork=function(){var t=this._writableState;t.corked&&(t.corked--,t.writing||t.corked||t.finished||t.bufferProcessing||!t.bufferedRequest||M(this,t))},v.prototype.setDefaultEncoding=function(t){if("string"==typeof t&&(t=t.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((t+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+t);return this._writableState.defaultEncoding=t,this},Object.defineProperty(v.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),v.prototype._write=function(t,e,r){r(new Error("_write() is not implemented"))},v.prototype._writev=null,v.prototype.end=function(t,e,r){var n=this._writableState;"function"==typeof t?(r=t,t=null,e=null):"function"==typeof e&&(r=e,e=null),null!=t&&this.write(t,e),n.corked&&(n.corked=1,this.uncork()),n.ending||n.finished||D(this,n,r)},Object.defineProperty(v.prototype,"destroyed",{get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(t){this._writableState&&(this._writableState.destroyed=t)}}),v.prototype.destroy=g.destroy,v.prototype._undestroy=g.undestroy,v.prototype._destroy=function(t,e){this.end(),e(t)}}).call(this,t("_process"),void 0!==M?M:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("timers").setImmediate)},{"_stream_duplex":98,"internal/streams/destroy":104,"internal/streams/stream":105,_process:92,"core-util-is":14,inherits:80,"process-nextick-args":91,"safe-buffer":110,timers:112,"util-deprecate":115}],103:[function(t,e,r){function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var i=t("safe-buffer").Buffer,o=t("util");function s(t,e,r){t.copy(e,r)}e.exports=function(){function t(){n(this,t),this.head=null,this.tail=null,this.length=0}return t.prototype.push=function(t){var e={data:t,next:null};this.length>0?this.tail.next=e:this.head=e,this.tail=e,++this.length},t.prototype.unshift=function(t){var e={data:t,next:this.head};0===this.length&&(this.tail=e),this.head=e,++this.length},t.prototype.shift=function(){if(0!==this.length){var t=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,t}},t.prototype.clear=function(){this.head=this.tail=null,this.length=0},t.prototype.join=function(t){if(0===this.length)return"";for(var e=this.head,r=""+e.data;e=e.next;)r+=t+e.data;return r},t.prototype.concat=function(t){if(0===this.length)return i.alloc(0);if(1===this.length)return this.head.data;for(var e=i.allocUnsafe(t>>>0),r=this.head,n=0;r;)s(r.data,e,n),n+=r.data.length,r=r.next;return e},t}(),o&&o.inspect&&o.inspect.custom&&(e.exports.prototype[o.inspect.custom]=function(){var t=o.inspect({length:this.length});return this.constructor.name+" "+t})},{"safe-buffer":110,util:11}],104:[function(t,e,r){var n=t("process-nextick-args");function i(t,e){var r=this,i=this._readableState&&this._readableState.destroyed,o=this._writableState&&this._writableState.destroyed;return i||o?(e?e(t):!t||this._writableState&&this._writableState.errorEmitted||n.nextTick(s,this,t),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(t||null,(function(t){!e&&t?(n.nextTick(s,r,t),r._writableState&&(r._writableState.errorEmitted=!0)):e&&e(t)})),this)}function o(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}function s(t,e){t.emit("error",e)}e.exports={destroy:i,undestroy:o}},{"process-nextick-args":91}],105:[function(t,e,r){e.exports=t("events").EventEmitter},{events:13}],106:[function(t,e,r){var n={}.toString;e.exports=Array.isArray||function(t){return"[object Array]"==n.call(t)}},{}],107:[function(t,e,r){var n=t("safe-buffer").Buffer,i=n.isEncoding||function(t){switch((t=""+t)&&t.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function o(t){if(!t)return"utf8";for(var e;;)switch(t){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return t;default:if(e)return;t=(""+t).toLowerCase(),e=!0}}function s(t){var e=o(t);if("string"!=typeof e&&(n.isEncoding===i||!i(t)))throw new Error("Unknown encoding: "+t);return e||t}function a(t){var e;switch(this.encoding=s(t),this.encoding){case"utf16le":this.text=p,this.end=f,e=4;break;case"utf8":this.fillLast=d,e=4;break;case"base64":this.text=b,this.end=g,e=3;break;default:return this.write=m,void(this.end=y)}this.lastNeed=0,this.lastTotal=0,this.lastChar=n.allocUnsafe(e)}function c(t){return t<=127?0:t>>5==6?2:t>>4==14?3:t>>3==30?4:t>>6==2?-1:-2}function u(t,e,r){var n=e.length-1;if(n<r)return 0;var i=c(e[n]);return i>=0?(i>0&&(t.lastNeed=i-1),i):--n<r||-2===i?0:(i=c(e[n]))>=0?(i>0&&(t.lastNeed=i-2),i):--n<r||-2===i?0:(i=c(e[n]))>=0?(i>0&&(2===i?i=0:t.lastNeed=i-3),i):0}function h(t,e,r){if(128!=(192&e[0]))return t.lastNeed=0,"�";if(t.lastNeed>1&&e.length>1){if(128!=(192&e[1]))return t.lastNeed=1,"�";if(t.lastNeed>2&&e.length>2&&128!=(192&e[2]))return t.lastNeed=2,"�"}}function d(t){var e=this.lastTotal-this.lastNeed,r=h(this,t);return void 0!==r?r:this.lastNeed<=t.length?(t.copy(this.lastChar,e,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(t.copy(this.lastChar,e,0,t.length),void(this.lastNeed-=t.length))}function l(t,e){var r=u(this,t,e);if(!this.lastNeed)return t.toString("utf8",e);this.lastTotal=r;var n=t.length-(r-this.lastNeed);return t.copy(this.lastChar,0,n),t.toString("utf8",e,n)}function _(t){var e=t&&t.length?this.write(t):"";return this.lastNeed?e+"�":e}function p(t,e){if((t.length-e)%2==0){var r=t.toString("utf16le",e);if(r){var n=r.charCodeAt(r.length-1);if(n>=55296&&n<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=t[t.length-2],this.lastChar[1]=t[t.length-1],r.slice(0,-1)}return r}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=t[t.length-1],t.toString("utf16le",e,t.length-1)}function f(t){var e=t&&t.length?this.write(t):"";if(this.lastNeed){var r=this.lastTotal-this.lastNeed;return e+this.lastChar.toString("utf16le",0,r)}return e}function b(t,e){var r=(t.length-e)%3;return 0===r?t.toString("base64",e):(this.lastNeed=3-r,this.lastTotal=3,1===r?this.lastChar[0]=t[t.length-1]:(this.lastChar[0]=t[t.length-2],this.lastChar[1]=t[t.length-1]),t.toString("base64",e,t.length-r))}function g(t){var e=t&&t.length?this.write(t):"";return this.lastNeed?e+this.lastChar.toString("base64",0,3-this.lastNeed):e}function m(t){return t.toString(this.encoding)}function y(t){return t&&t.length?this.write(t):""}r.StringDecoder=a,a.prototype.write=function(t){if(0===t.length)return"";var e,r;if(this.lastNeed){if(void 0===(e=this.fillLast(t)))return"";r=this.lastNeed,this.lastNeed=0}else r=0;return r<t.length?e?e+this.text(t,r):this.text(t,r):e||""},a.prototype.end=_,a.prototype.text=l,a.prototype.fillLast=function(t){if(this.lastNeed<=t.length)return t.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);t.copy(this.lastChar,this.lastTotal-this.lastNeed,0,t.length),this.lastNeed-=t.length}},{"safe-buffer":110}],108:[function(t,e,r){(r=e.exports=t("lib/_stream_readable.js")).Stream=r,r.Readable=r,r.Writable=t("lib/_stream_writable.js"),r.Duplex=t("lib/_stream_duplex.js"),r.Transform=t("lib/_stream_transform.js"),r.PassThrough=t("lib/_stream_passthrough.js")},{"lib/_stream_duplex.js":98,"lib/_stream_passthrough.js":99,"lib/_stream_readable.js":100,"lib/_stream_transform.js":101,"lib/_stream_writable.js":102}],109:[function(t,e,r){function n(t,e,r){var n=this;this._callback=t,this._args=r,this._interval=setInterval(t,e,this._args),this.reschedule=function(t){t||(t=n._interval),n._interval&&clearInterval(n._interval),n._interval=setInterval(n._callback,t,n._args)},this.clear=function(){n._interval&&(clearInterval(n._interval),n._interval=void 0)},this.destroy=function(){n._interval&&clearInterval(n._interval),n._callback=void 0,n._interval=void 0,n._args=void 0}}function i(){if("function"!=typeof arguments[0])throw new Error("callback needed");if("number"!=typeof arguments[1])throw new Error("interval needed");var t;if(arguments.length>0){t=new Array(arguments.length-2);for(var e=0;e<t.length;e++)t[e]=arguments[e+2]}return new n(arguments[0],arguments[1],t)}e.exports=i},{}],110:[function(t,e,r){var n=t("buffer"),i=n.Buffer;function o(t,e){for(var r in t)e[r]=t[r]}function s(t,e,r){return i(t,e,r)}i.from&&i.alloc&&i.allocUnsafe&&i.allocUnsafeSlow?e.exports=n:(o(n,r),r.Buffer=s),o(i,s),s.from=function(t,e,r){if("number"==typeof t)throw new TypeError("Argument must not be a number");return i(t,e,r)},s.alloc=function(t,e,r){if("number"!=typeof t)throw new TypeError("Argument must be a number");var n=i(t);return void 0!==e?"string"==typeof r?n.fill(e,r):n.fill(e):n.fill(0),n},s.allocUnsafe=function(t){if("number"!=typeof t)throw new TypeError("Argument must be a number");return i(t)},s.allocUnsafeSlow=function(t){if("number"!=typeof t)throw new TypeError("Argument must be a number");return n.SlowBuffer(t)}},{buffer:12}],111:[function(t,e,r){function n(t){var e=t._readableState;return e?e.objectMode?t.read():t.read(i(e)):null}function i(t){return t.buffer.length?t.buffer.head?t.buffer.head.data.length:t.buffer[0].length:t.length}e.exports=n},{}],112:[function(t,e,r){(function(e,n){var i=t("process/browser.js").nextTick,o=Function.prototype.apply,s=Array.prototype.slice,a={},c=0;function u(t,e){this._id=t,this._clearFn=e}r.setTimeout=function(){return new u(o.call(setTimeout,window,arguments),clearTimeout)},r.setInterval=function(){return new u(o.call(setInterval,window,arguments),clearInterval)},r.clearTimeout=r.clearInterval=function(t){t.close()},u.prototype.unref=u.prototype.ref=function(){},u.prototype.close=function(){this._clearFn.call(window,this._id)},r.enroll=function(t,e){clearTimeout(t._idleTimeoutId),t._idleTimeout=e},r.unenroll=function(t){clearTimeout(t._idleTimeoutId),t._idleTimeout=-1},r._unrefActive=r.active=function(t){clearTimeout(t._idleTimeoutId);var e=t._idleTimeout;e>=0&&(t._idleTimeoutId=setTimeout((function(){t._onTimeout&&t._onTimeout()}),e))},r.setImmediate="function"==typeof e?e:function(t){var e=c++,n=!(arguments.length<2)&&s.call(arguments,1);return a[e]=!0,i((function(){a[e]&&(n?t.apply(null,n):t.call(null),r.clearImmediate(e))})),e},r.clearImmediate="function"==typeof n?n:function(t){delete a[t]}}).call(this,t("timers").setImmediate,t("timers").clearImmediate)},{"process/browser.js":92,timers:112}],113:[function(t,e,r){var n=t("punycode"),i=t("util");function o(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}r.parse=v,r.resolve=w,r.resolveObject=S,r.format=R,r.Url=o;var s=/^([a-z0-9.+-]+:)/i,a=/:[0-9]*$/,c=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,u=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),h=["'"].concat(u),d=["%","../default.htm","?",";","#"].concat(h),l=["../default.htm","?","#"],_=255,p=/^[+a-z0-9A-Z_-]{0,63}$/,f=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,b={javascript:!0,"javascript:":!0},g={javascript:!0,"javascript:":!0},m={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},y=t("querystring");function v(t,e,r){if(t&&i.isObject(t)&&t instanceof o)return t;var n=new o;return n.parse(t,e,r),n}function R(t){return i.isString(t)&&(t=v(t)),t instanceof o?t.format():o.prototype.format.call(t)}function w(t,e){return v(t,!1,!0).resolve(e)}function S(t,e){return t?v(t,!1,!0).resolveObject(e):e}o.prototype.parse=function(t,e,r){if(!i.isString(t))throw new TypeError("Parameter 'url' must be a string, not "+typeof t);var o=t.indexOf("?"),a=-1!==o&&o<t.indexOf("#")?"?":"#",u=t.split(a),v=/\\/g;u[0]=u[0].replace(v,"../default.htm");var R=t=u.join(a);if(R=R.trim(),!r&&1===t.split("#").length){var w=c.exec(R);if(w)return this.path=R,this.href=R,this.pathname=w[1],w[2]?(this.search=w[2],this.query=e?y.parse(this.search.substr(1)):this.search.substr(1)):e&&(this.search="",this.query={}),this}var S=s.exec(R);if(S){var T=(S=S[0]).toLowerCase();this.protocol=T,R=R.substr(S.length)}if(r||S||R.match(/^\/\/[^@\/]+@[^@\/]+/)){var C="//"===R.substr(0,2);!C||S&&g[S]||(R=R.substr(2),this.slashes=!0)}if(!g[S]&&(C||S&&!m[S])){for(var E,P,x=-1,I=0;I<l.length;I++)-1!==(L=R.indexOf(l[I]))&&(-1===x||L<x)&&(x=L);for(-1!==(P=-1===x?R.lastIndexOf("@"):R.lastIndexOf("@",x))&&(E=R.slice(0,P),R=R.slice(P+1),this.auth=decodeURIComponent(E)),x=-1,I=0;I<d.length;I++){var L;-1!==(L=R.indexOf(d[I]))&&(-1===x||L<x)&&(x=L)}-1===x&&(x=R.length),this.host=R.slice(0,x),R=R.slice(x),this.parseHost(),this.hostname=this.hostname||"";var M="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!M)for(var k=this.hostname.split(/\./),A=(I=0,k.length);I<A;I++){var O=k[I];if(O&&!O.match(p)){for(var B="",D=0,U=O.length;D<U;D++)O.charCodeAt(D)>127?B+="x":B+=O[D];if(!B.match(p)){var N=k.slice(0,I),q=k.slice(I+1),F=O.match(f);F&&(N.push(F[1]),q.unshift(F[2])),q.length&&(R="../"+q.join(".")+R),this.hostname=N.join(".");break}}}this.hostname.length>_?this.hostname="":this.hostname=this.hostname.toLowerCase(),M||(this.hostname=n.toASCII(this.hostname));var j=this.port?":"+this.port:"",V=this.hostname||"";this.host=V+j,this.href+=this.host,M&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"../default.htm"!==R[0]&&(R="../"+R))}if(!b[T])for(I=0,A=h.length;I<A;I++){var z=h[I];if(-1!==R.indexOf(z)){var H=encodeURIComponent(z);H===z&&(H=escape(z)),R=R.split(z).join(H)}}var G=R.indexOf("#");-1!==G&&(this.hash=R.substr(G),R=R.slice(0,G));var W=R.indexOf("?");if(-1!==W?(this.search=R.substr(W),this.query=R.substr(W+1),e&&(this.query=y.parse(this.query)),R=R.slice(0,W)):e&&(this.search="",this.query={}),R&&(this.pathname=R),m[T]&&this.hostname&&!this.pathname&&(this.pathname="../default.htm"),this.pathname||this.search){j=this.pathname||"";var K=this.search||"";this.path=j+K}return this.href=this.format(),this},o.prototype.format=function(){var t=this.auth||"";t&&(t=(t=encodeURIComponent(t)).replace(/%3A/i,":"),t+="@");var e=this.protocol||"",r=this.pathname||"",n=this.hash||"",o=!1,s="";this.host?o=t+this.host:this.hostname&&(o=t+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(o+=":"+this.port)),this.query&&i.isObject(this.query)&&Object.keys(this.query).length&&(s=y.stringify(this.query));var a=this.search||s&&"?"+s||"";return e&&":"!==e.substr(-1)&&(e+=":"),this.slashes||(!e||m[e])&&!1!==o?(o="//"+(o||""),r&&"../default.htm"!==r.charAt(0)&&(r="../"+r)):o||(o=""),n&&"#"!==n.charAt(0)&&(n="#"+n),a&&"?"!==a.charAt(0)&&(a="?"+a),e+o+(r=r.replace(/[?#]/g,(function(t){return encodeURIComponent(t)})))+(a=a.replace("#","%23"))+n},o.prototype.resolve=function(t){return this.resolveObject(v(t,!1,!0)).format()},o.prototype.resolveObject=function(t){if(i.isString(t)){var e=new o;e.parse(t,!1,!0),t=e}for(var r=new o,n=Object.keys(this),s=0;s<n.length;s++){var a=n[s];r[a]=this[a]}if(r.hash=t.hash,""===t.href)return r.href=r.format(),r;if(t.slashes&&!t.protocol){for(var c=Object.keys(t),u=0;u<c.length;u++){var h=c[u];"protocol"!==h&&(r[h]=t[h])}return m[r.protocol]&&r.hostname&&!r.pathname&&(r.path=r.pathname="../default.htm"),r.href=r.format(),r}if(t.protocol&&t.protocol!==r.protocol){if(!m[t.protocol]){for(var d=Object.keys(t),l=0;l<d.length;l++){var _=d[l];r[_]=t[_]}return r.href=r.format(),r}if(r.protocol=t.protocol,t.host||g[t.protocol])r.pathname=t.pathname;else{for(var p=(t.pathname||"").split("/");p.length&&!(t.host=p.shift()););t.host||(t.host=""),t.hostname||(t.hostname=""),""!==p[0]&&p.unshift(""),p.length<2&&p.unshift(""),r.pathname=p.join("/")}if(r.search=t.search,r.query=t.query,r.host=t.host||"",r.auth=t.auth,r.hostname=t.hostname||t.host,r.port=t.port,r.pathname||r.search){var f=r.pathname||"",b=r.search||"";r.path=f+b}return r.slashes=r.slashes||t.slashes,r.href=r.format(),r}var y=r.pathname&&"/"===r.pathname.charAt(0),v=t.host||t.pathname&&"/"===t.pathname.charAt(0),R=v||y||r.host&&t.pathname,w=R,S=r.pathname&&r.pathname.split("/")||[],T=(p=t.pathname&&t.pathname.split("/")||[],r.protocol&&!m[r.protocol]);if(T&&(r.hostname="",r.port=null,r.host&&(""===S[0]?S[0]=r.host:S.unshift(r.host)),r.host="",t.protocol&&(t.hostname=null,t.port=null,t.host&&(""===p[0]?p[0]=t.host:p.unshift(t.host)),t.host=null),R=R&&(""===p[0]||""===S[0])),v)r.host=t.host||""===t.host?t.host:r.host,r.hostname=t.hostname||""===t.hostname?t.hostname:r.hostname,r.search=t.search,r.query=t.query,S=p;else if(p.length)S||(S=[]),S.pop(),S=S.concat(p),r.search=t.search,r.query=t.query;else if(!i.isNullOrUndefined(t.search))return T&&(r.hostname=r.host=S.shift(),(I=!!(r.host&&r.host.indexOf("@")>0)&&r.host.split("@"))&&(r.auth=I.shift(),r.host=r.hostname=I.shift())),r.search=t.search,r.query=t.query,i.isNull(r.pathname)&&i.isNull(r.search)||(r.path=(r.pathname?r.pathname:"")+(r.search?r.search:"")),r.href=r.format(),r;if(!S.length)return r.pathname=null,r.search?r.path="../"+r.search:r.path=null,r.href=r.format(),r;for(var C=S.slice(-1)[0],E=(r.host||t.host||S.length>1)&&("."===C||".."===C)||""===C,P=0,x=S.length;x>=0;x--)"."===(C=S[x])?S.splice(x,1):".."===C?(S.splice(x,1),P++):P&&(S.splice(x,1),P--);if(!R&&!w)for(;P--;P)S.unshift("..");!R||""===S[0]||S[0]&&"/"===S[0].charAt(0)||S.unshift(""),E&&"../default.htm"!==S.join("/").substr(-1)&&S.push("");var I,L=""===S[0]||S[0]&&"/"===S[0].charAt(0);return T&&(r.hostname=r.host=L?"":S.length?S.shift():"",(I=!!(r.host&&r.host.indexOf("@")>0)&&r.host.split("@"))&&(r.auth=I.shift(),r.host=r.hostname=I.shift())),(R=R||r.host&&S.length)&&!L&&S.unshift(""),S.length?r.pathname=S.join("/"):(r.pathname=null,r.path=null),i.isNull(r.pathname)&&i.isNull(r.search)||(r.path=(r.pathname?r.pathname:"")+(r.search?r.search:"")),r.auth=t.auth||r.auth,r.slashes=r.slashes||t.slashes,r.href=r.format(),r},o.prototype.parseHost=function(){var t=this.host,e=a.exec(t);e&&(":"!==(e=e[0])&&(this.port=e.substr(1)),t=t.substr(0,t.length-e.length)),t&&(this.hostname=t)}},{"util":114,punycode:93,querystring:96}],114:[function(t,e,r){e.exports={isString:function(t){return"string"==typeof t},isObject:function(t){return"object"==typeof t&&null!==t},isNull:function(t){return null===t},isNullOrUndefined:function(t){return null==t}}},{}],115:[function(t,e,r){(function(t){function r(t,e){if(n("noDeprecation"))return t;var r=!1;function i(){if(!r){if(n("throwDeprecation"))throw new Error(e);n("traceDeprecation")?console.trace(e):console.warn(e),r=!0}return t.apply(this,arguments)}return i}function n(e){try{if(!t.localStorage)return!1}catch(n){return!1}var r=t.localStorage[e];return null!=r&&"true"===String(r).toLowerCase()}e.exports=r}).call(this,void 0!==M?M:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],116:[function(t,e,r){e.exports=function(t){return t&&"object"==typeof t&&"function"==typeof t.copy&&"function"==typeof t.fill&&"function"==typeof t.readUInt8}},{}],117:[function(t,e,r){(function(e,n){var i=/%[sdj%]/g;r.format=function(t){if(!w(t)){for(var e=[],r=0;r<arguments.length;r++)e.push(a(arguments[r]));return e.join(" ")}r=1;for(var n=arguments,o=n.length,s=String(t).replace(i,(function(t){if("%%"===t)return"%";if(r>=o)return t;switch(t){case"%s":return String(n[r++]);case"%d":return Number(n[r++]);case"%j":try{return JSON.stringify(n[r++])}catch(e){return"[Circular]"}default:return t}})),c=n[r];r<o;c=n[++r])y(c)||!E(c)?s+=" "+c:s+=" "+a(c);return s},r.deprecate=function(t,i){if(T(n.process))return function(){return r.deprecate(t,i).apply(this,arguments)};if(!0===e.noDeprecation)return t;var o=!1;function s(){if(!o){if(e.throwDeprecation)throw new Error(i);e.traceDeprecation?console.trace(i):console.error(i),o=!0}return t.apply(this,arguments)}return s};var o,s={};function a(t,e){var n={seen:[],stylize:u};return arguments.length>=3&&(n.depth=arguments[2]),arguments.length>=4&&(n.colors=arguments[3]),m(e)?n.showHidden=e:e&&r._extend(n,e),T(n.showHidden)&&(n.showHidden=!1),T(n.depth)&&(n.depth=2),T(n.colors)&&(n.colors=!1),T(n.customInspect)&&(n.customInspect=!0),n.colors&&(n.stylize=c),d(n,t,n.depth)}function c(t,e){var r=a.styles[e];return r?"["+a.colors[r][0]+"m"+t+"["+a.colors[r][1]+"m":t}function u(t,e){return t}function h(t){var e={};return t.forEach((function(t,r){e[t]=!0})),e}function d(t,e,n){if(t.customInspect&&e&&I(e.inspect)&&e.inspect!==r.inspect&&(!e.constructor||e.constructor.prototype!==e)){var i=e.inspect(n,t);return w(i)||(i=d(t,i,n)),i}var o=l(t,e);if(o)return o;var s=Object.keys(e),a=h(s);if(t.showHidden&&(s=Object.getOwnPropertyNames(e)),x(e)&&(s.indexOf("message")>=0||s.indexOf("description")>=0))return _(e);if(0===s.length){if(I(e)){var c=e.name?": "+e.name:"";return t.stylize("[Function"+c+"]","special")}if(C(e))return t.stylize(RegExp.prototype.toString.call(e),"regexp");if(P(e))return t.stylize(Date.prototype.toString.call(e),"date");if(x(e))return _(e)}var u,m="",y=!1,v=["{","}"];return g(e)&&(y=!0,v=["[","]"]),I(e)&&(m=" [Function"+(e.name?": "+e.name:"")+"]"),C(e)&&(m=" "+RegExp.prototype.toString.call(e)),P(e)&&(m=" "+Date.prototype.toUTCString.call(e)),x(e)&&(m=" "+_(e)),0!==s.length||y&&0!=e.length?n<0?C(e)?t.stylize(RegExp.prototype.toString.call(e),"regexp"):t.stylize("[Object]","special"):(t.seen.push(e),u=y?p(t,e,n,a,s):s.map((function(r){return f(t,e,n,a,r,y)})),t.seen.pop(),b(u,m,v)):v[0]+m+v[1]}function l(t,e){if(T(e))return t.stylize("undefined","undefined");if(w(e)){var r="'"+JSON.stringify(e).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return t.stylize(r,"string")}return R(e)?t.stylize(""+e,"number"):m(e)?t.stylize(""+e,"boolean"):y(e)?t.stylize("null","null"):void 0}function _(t){return"["+Error.prototype.toString.call(t)+"]"}function p(t,e,r,n,i){for(var o=[],s=0,a=e.length;s<a;++s)B(e,String(s))?o.push(f(t,e,r,n,String(s),!0)):o.push("");return i.forEach((function(i){i.match(/^\d+$/)||o.push(f(t,e,r,n,i,!0))})),o}function f(t,e,r,n,i,o){var s,a,c;if((c=Object.getOwnPropertyDescriptor(e,i)||{value:e[i]}).get?a=c.set?t.stylize("[Getter/Setter]","special"):t.stylize("[Getter]","special"):c.set&&(a=t.stylize("[Setter]","special")),B(n,i)||(s="["+i+"]"),a||(t.seen.indexOf(c.value)<0?(a=y(r)?d(t,c.value,null):d(t,c.value,r-1)).indexOf("\n")>-1&&(a=o?a.split("\n").map((function(t){return"  "+t})).join("\n").substr(2):"\n"+a.split("\n").map((function(t){return"   "+t})).join("\n")):a=t.stylize("[Circular]","special")),T(s)){if(o&&i.match(/^\d+$/))return a;(s=JSON.stringify(""+i)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(s=s.substr(1,s.length-2),s=t.stylize(s,"name")):(s=s.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),s=t.stylize(s,"string"))}return s+": "+a}function b(t,e,r){return t.reduce((function(t,e){return e.indexOf("\n"),t+e.replace(/\u001b\[\d\d?m/g,"").length+1}),0)>60?r[0]+(""===e?"":e+"\n ")+" "+t.join(",\n  ")+" "+r[1]:r[0]+e+" "+t.join(", ")+" "+r[1]}function g(t){return Array.isArray(t)}function m(t){return"boolean"==typeof t}function y(t){return null===t}function v(t){return null==t}function R(t){return"number"==typeof t}function w(t){return"string"==typeof t}function S(t){return"symbol"==typeof t}function T(t){return void 0===t}function C(t){return E(t)&&"[object RegExp]"===M(t)}function E(t){return"object"==typeof t&&null!==t}function P(t){return E(t)&&"[object Date]"===M(t)}function x(t){return E(t)&&("[object Error]"===M(t)||t instanceof Error)}function I(t){return"function"==typeof t}function L(t){return null===t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||"symbol"==typeof t||void 0===t}function M(t){return Object.prototype.toString.call(t)}function k(t){return t<10?"0"+t.toString(10):t.toString(10)}r.debuglog=function(t){if(T(o)&&(o=e.env.NODE_DEBUG||""),t=t.toUpperCase(),!s[t])if(new RegExp("\\b"+t+"\\b","i").test(o)){var n=e.pid;s[t]=function(){var e=r.format.apply(r,arguments);console.error("%s %d: %s",t,n,e)}}else s[t]=function(){};return s[t]},r.inspect=a,a.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},a.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},r.isArray=g,r.isBoolean=m,r.isNull=y,r.isNullOrUndefined=v,r.isNumber=R,r.isString=w,r.isSymbol=S,r.isUndefined=T,r.isRegExp=C,r.isObject=E,r.isDate=P,r.isError=x,r.isFunction=I,r.isPrimitive=L,r.isBuffer=t("./support/isBuffer");var A=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function O(){var t=new Date,e=[k(t.getHours()),k(t.getMinutes()),k(t.getSeconds())].join(":");return[t.getDate(),A[t.getMonth()],e].join(" ")}function B(t,e){return Object.prototype.hasOwnProperty.call(t,e)}r.log=function(){console.log("%s - %s",O(),r.format.apply(r,arguments))},r.inherits=t("inherits"),r._extend=function(t,e){if(!e||!E(e))return t;for(var r=Object.keys(e),n=r.length;n--;)t[r[n]]=e[r[n]];return t}}).call(this,t("_process"),void 0!==M?M:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":116,_process:92,inherits:80}],118:[function(t,e,r){(function(r,n){var i=t("readable-stream").Transform,o=t("duplexify"),s=t("ws"),a=t("safe-buffer").Buffer;function c(t,e,r){var n=new i({objectMode:t.objectMode});return n._write=e,n._flush=r,n}function u(t,e,i){var u,h,d="browser"===r.title,l=!!n.WebSocket,_=d?y:m;e&&!Array.isArray(e)&&"object"==typeof e&&(i=e,e=null,("string"==typeof i.protocol||Array.isArray(i.protocol))&&(e=i.protocol)),i||(i={}),void 0===i.objectMode&&(i.objectMode=!(!0===i.binary||void 0===i.binary));var p=c(i,_,v);i.objectMode||(p._writev=E);var f=i.browserBufferSize||524288,b=i.browserBufferTimeout||1e3;"object"==typeof t?h=t:(h=l&&d?new s(t,e):new s(t,e,i)).binaryType="arraybuffer",h.readyState===h.OPEN?u=p:(u=o.obj(),h.onopen=R),u.socket=h,h.onclose=w,h.onerror=S,h.onmessage=T,p.on("close",C);var g=!i.objectMode;function m(t,e,r){h.readyState===h.OPEN?(g&&"string"==typeof t&&(t=a.from(t,"utf8")),h.send(t,r)):r()}function y(t,e,r){if(h.bufferedAmount>f)setTimeout(y,b,t,e,r);else{g&&"string"==typeof t&&(t=a.from(t,"utf8"));try{h.send(t)}catch(n){return r(n)}r()}}function v(t){h.close(),t()}function R(){u.setReadable(p),u.setWritable(p),u.emit("connect")}function w(){u.end(),u.destroy()}function S(t){u.destroy(t)}function T(t){var e=t.data;e=e instanceof ArrayBuffer?a.from(e):a.from(e,"utf8"),p.push(e)}function C(){h.close()}function E(t,e){for(var r=new Array(t.length),n=0;n<t.length;n++)"string"==typeof t[n].chunk?r[n]=a.from(t[n],"utf8"):r[n]=t[n].chunk;this._write(a.concat(r),"binary",e)}return u}e.exports=u}).call(this,t("_process"),void 0!==M?M:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{_process:92,duplexify:17,"readable-stream":108,"safe-buffer":110,ws:119}],119:[function(t,e,r){var n=null;"undefined"!=typeof WebSocket?n=WebSocket:"undefined"!=typeof MozWebSocket?n=MozWebSocket:"undefined"!=typeof window&&(n=window.WebSocket||window.MozWebSocket),e.exports=n},{}],120:[function(t,e,r){function n(t,e){if(t&&e)return n(t)(e);if("function"!=typeof t)throw new TypeError("need wrapper function");return Object.keys(t).forEach((function(e){r[e]=t[e]})),r;function r(){for(var e=new Array(arguments.length),r=0;r<e.length;r++)e[r]=arguments[r];var n=t.apply(this,e),i=e[e.length-1];return"function"==typeof n&&n!==i&&Object.keys(i).forEach((function(t){n[t]=i[t]})),n}}e.exports=n},{}],121:[function(t,e,r){e.exports=i;var n=Object.prototype.hasOwnProperty;function i(){for(var t={},e=0;e<arguments.length;e++){var r=arguments[e];for(var i in r)n.call(r,i)&&(t[i]=r[i])}return t}},{}]},{},[9])(9)})),qt=function(){function t(){S.log("[rtc][MQTT]init"),this.mqtt_client_id_="",this.subscribe_topic_="",this.is_connected_=!1,this.is_subscribed_=!1,this.is_need_connect_=!0,this.mqtt_=null,this.timeoutId_=-1,this.connect_tag_=1,this.last_report_log_tm_=0}return t.instance=function(){return null==t.instance_&&(t.instance_=new t),t.instance_},t.prototype.startTimer=function(){this.stopTimer(),S.log("[rtc][MQTT]start reconnect timer.."),this.timeoutId_=window.setTimeout(this.onTimer.bind(this),Rt.mqtt_reconnect_dx_ms_)},t.prototype.stopTimer=function(){-1!=this.timeoutId_&&(window.clearTimeout(this.timeoutId_),this.timeoutId_=-1)},t.prototype.onTimer=function(){this.stopTimer(),S.log("[rtc][MQTT]reconnect..."),this.reconnect()},t.prototype.make_mqtt_client_id=function(){var t=e.pcdn_peer_id_.substr(8);return t+="@"+Math.random().toString(16).substr(2,6)},t.prototype.on_login=function(t){t===w.SUCCESS&&this.start_connect()},t.prototype.reconnect=function(){this.start_connect()},t.prototype.start_connect=function(){if(this.is_need_connect_){if(0===Rt.mqtt_host_.length||0===Rt.mqtt_port_.length)return S.error("[rtc][MQTT]host null"),this.close(null),void this.startTimer();S.log("[rtc][MQTT]connect..."),this.is_need_connect_=!1,this.mqtt_client_id_=this.make_mqtt_client_id(),this.subscribe_topic_=e.pcdn_peer_id_;var t="wss://"+Rt.mqtt_host_+":"+Rt.mqtt_port_+"/mqtt",r={keepalive:Rt.mqtt_ping_dx_second_,clientId:this.mqtt_client_id_,protocolId:"MQTT",protocolVersion:4,clean:!0,reconnectPeriod:0,connectTimeout:Rt.mqtt_connect_timeout_ms_,username:void 0,password:void 0,reschedulePings:!0,resubscribe:!1};Rt.mqtt_username_.length>0&&(r.username=Rt.mqtt_username_,r.password=Rt.mqtt_pwd_),S.log("[rtc][MQTT]client_id:",r.clientId,",len=",r.clientId.length),this.mqtt_=Nt.connect(t,r),this.mqtt_?(this.mqtt_.on("connect",this.on_connect.bind(this,this.connect_tag_)),this.mqtt_.on("reconnect",this.on_reconnect.bind(this,this.connect_tag_)),this.mqtt_.on("offline",this.on_offline.bind(this,this.connect_tag_)),this.mqtt_.on("error",this.on_error.bind(this,this.connect_tag_)),this.mqtt_.on("message",this.on_message.bind(this)),this.mqtt_.on("close",this.on_close.bind(this,this.connect_tag_))):S.error("[rtc][MQTT][Mqtt.connect]fail.")}else S.log("[rtc][MQTT]no need connect...")},t.prototype.close=function(t){return!!this.mqtt_&&(S.log("[rtc][MQTT]close..."),this.mqtt_.end(!0),this.is_connected_=!1,this.is_need_connect_=!0,this.is_subscribed_=!1,this.mqtt_=null,++this.connect_tag_,null!=t&&this.reportLog(t),!0)},t.prototype.is_ready=function(){return this.mqtt_&&this.is_connected_&&this.is_subscribed_},t.prototype.on_connect=function(t){var e=this;if(this.connect_tag_==t){if(this.mqtt_){S.log("[rtc][MQTT][Onconnect],subscribe:",this.subscribe_topic_,",clientid:",this.mqtt_client_id_),this.is_connected_=!0;this.mqtt_.subscribe(this.subscribe_topic_,{qos:0},(function(t,r){e.is_subscribed_=!0,S.log("[rtc][MQTT][subscribe]",e.subscribe_topic_,",ok.")}))}}else S.warn("[rtc][MQTT][on_connect]this.connect_tag:",this.connect_tag_,"!=",t)},t.prototype.test=function(){this.send("123",e.pcdn_peer_id_,It.xMqttRtcCmd.none,"dataxxxxxxxxxxxxx")},t.prototype.send=function(t,e,r,n){if(!this.is_ready())return S.warn("[rtc][MQTT]send faill,no is_ready."),!1;var i=new Et.Builder(1024),o=this.make_send_data(t,e,r,n,i),s=o.byteLength;return ft.addMqttBytes(s,!0),this.mqtt_.publish(e,o,null,(function(t){t?S.rtclog("[rtc][MQTT]send fail:",t):S.rtclog("[rtc][MQTT]send ok,to:",e,",byteLength:",s)})),!0},t.prototype.make_send_data=function(t,r,n,i,o){var s=It.xMqttWebRtc,a=o.createString(t),c=o.createString(e.pcdn_peer_id_),u=o.createString(r),h=o.createString(i);s.startxMqttWebRtc(o),s.addCmd(o,n),s.addSid(o,a),s.addFrom(o,c),s.addTo(o,u),s.addData(o,h);var d=s.endxMqttWebRtc(o),l=It.xMqtt;return l.startxMqtt(o),l.addXHead(o,It.xMqttHead.xMqttWebRtc),l.addXBodyType(o,It.xMqttBody.xMqttWebRtc),l.addXBody(o,d),o.finish(l.endxMqtt(o)),o.asUint8Array()},t.prototype.on_message=function(e,r){if(e===this.subscribe_topic_&&r){ft.addMqttBytes(r.byteLength,!1);var n=new Et.ByteBuffer(r),i=It.xMqtt.getRootAsxMqtt(n),o=i.xHead();if(It.xMqttHead.xMqttWebRtc==o&&i.xBodyType()==It.xMqttBody.xMqttWebRtc){var s=i.xBody(new It.xMqttWebRtc);if(s){var a=new x(s.cmd(),s.sid(),s.from(),s.data());t.P2PManager.instance().emit(T.MQTT,a)}else S.error("[rtc][MQTT]body empty")}else S.error("[rtc][MQTT]message,no support type",i.xHead())}else S.error("[rtc][MQTT]message[",e,"]!=[",this.subscribe_topic_,"]")},t.prototype.on_reconnect=function(t){this.connect_tag_==t?S.error("[rtc][MQTT][onReConnect],subscribe:",this.subscribe_topic_,",clientid:",this.mqtt_client_id_):S.warn("[rtc][MQTT][on_reconnect]this.connect_tag:",this.connect_tag_,"!=",t)},t.prototype.on_offline=function(t){this.connect_tag_==t?(S.error("[rtc][MQTT][onOffline],subscribe:",this.subscribe_topic_,",clientid:",this.mqtt_client_id_),this.close("offline")&&this.startTimer()):S.warn("[rtc][MQTT][on_offline]this.connect_tag:",this.connect_tag_,"!=",t)},t.prototype.reportLog=function(e){var r=dt.nowMs();if(!(this.last_report_log_tm_>0&&r-this.last_report_log_tm_<3e4)){this.last_report_log_tm_=r;var n={logtype:_t.ERROR,subtype:pt.DEFAULT,errcode:lt.MQTT_OFFLINE_ERR,ext:"mqtt"};S.log("[rtc][MQTT][reportLog]",e),t.P2PManager.instance().getLogReport().request(n)}},t.prototype.on_error=function(t,e){this.connect_tag_==t?(S.error("[rtc][MQTT][onError]",e),this.is_connected_=!1,this.is_need_connect_=!0,this.close("error")&&this.startTimer()):S.warn("[rtc][MQTT][on_error]this.connect_tag:",this.connect_tag_,"!=",t)},t.prototype.on_close=function(t){this.connect_tag_==t?(S.log("[rtc][MQTT][onClose]"),this.is_connected_=!1,this.is_need_connect_=!0,this.close("close")&&this.startTimer()):S.log("[rtc][MQTT][on_close]this.connect_tag:",this.connect_tag_,"!=",t)},t.instance_=null,t}();!function(t){t.unknow="unknow",t.create_offer="create_offer",t.create_answer="create_answer",t.send_offer="send_offer",t.send_answer="send_answer",t.recv_offer="recv_offer",t.recv_answer="recv_answer",t.recv_candidate="recv_candidate",t.connected="connected",t.disconnect="disconnect",t.fail="fail",t.close="close"}(At||(At={})),function(t){t.unknow="unknow",t.offer_fail="offer_fail",t.anwser_fail="anwser_fail",t.candidate_fail="candidate_fail",t.local_close="local_close",t.channal_error="channal_error",t.channal_close="channal_close",t.remote_close="remote_close",t.disconnect="disconnect",t.mqtt_fail="mqtt_fail",t.connect_timeout="connect_timeout",t.chunkWidthDiff="chunkWidthDiff",t.unSupportVersion="unSupportVersion",t.unActived="unActived",t.noData="noData"}(Ot||(Ot={})),function(t){t[t.not_close_offer=1]="not_close_offer",t[t.not_close_answer=2]="not_close_answer",t[t.not_close_candidate=4]="not_close_candidate"}(Bt||(Bt={}));var Ft=function(){function t(r,n){this.version_=null,this.clientType_=-1,this.mqtt_=qt.instance(),this.peerid_=r,this.is_edge_=dt.isEdgePeer(r),this.status_=At.unknow,this.is_close_=!1,this.is_channal_open_=!1,this.is_requsting_chunk_count_=0,this.close_res_=Ot.unknow,this.close_for_no_data_=!1,this.timer_=window.setInterval(this.onTimerTimeout.bind(this),e.p2p_connect_timeout_ms_),this.has_connected_history_=!1,this.p2pMgr_=t.P2PManager.instance(),this.cacheMgr_=t.CacheManager.instance(),this.has_mqtt_recv_=!1,this.requestingSn_=-1,this.rid2didMap_=new Map,this.did2RidMap_=new Map,this.rid2tsListMap_=new Map,this.curSnSet_=new Map,this.publishedLocalDids_=new Set,this.curChunkWidthKB_=this.is_edge_?e.chunk_width_KB_:-1,this.myRequestRid_=null,this.peerRequestRid_=null,this.dm_=t.DownloadManager.instance(),this.create_tm_=this.p2pMgr_.now(),this.requesting_tms_=new Map,this.score_=3,this.miss_ts_count_=0,this.uuid_=++t.s_UUID,n?(this.sid_=n,this.is_caller_=!1):(this.sid_=Dt.generate_sid(),this.is_caller_=!0),this.dc_=null,S.rtclog("[rtc][WebRtcClient]peerid:",this.peerid_,",ice:",JSON.stringify(Rt.ICE_SERVERS));var i=null;try{i=new Dt.RTCPeerConnection(Rt.ICE_SERVERS)}catch(ae){S.warn("[rtc][new RTCPeerConnection]fail",ae||"unknow")}if(!i)return this.pc_=null,void S.error("[rtc][new RTCPeerConnection]null");this.pc_=i,i.onicecandidate=this.onRtcIcecandidate.bind(this),i.oniceconnectionstatechange=this.onRtcIceconnectionstatechange.bind(this),this.is_caller_?(S.rtclog("[rtc][WebRtcClient]caller create,peerid:",this.peerid_,",sid:",this.sid_),this.createRtcDatachannal(),this.createRtcOffer()):(S.rtclog("[rtc][WebRtcClient]oncaller create,peerid:",this.peerid_,",sid:",this.sid_),i.ondatachannel=this.onRtcRemoteDatachannel.bind(this))}return t.prototype.isBadRtc=function(){return null==this.pc_},t.prototype.hasTs=function(t,e){if(null==t)return!1;var r=this.rid2tsListMap_.get(t);return null!=r&&r[e]},t.prototype.hasSubRid=function(t,r){var n=this.rid2tsListMap_.get(t);if(null==n)return!1;var i=r+e.subrid_batch_size_,o=e.publish_sub_have_ts_per_;if(i>n.length?(i=n.length,o/=2):0==r&&(o/=2),i==r)return!1;for(var s=0,a=r;a<i;++a)n[a]&&s++;S.rtclog("[p2p][hasSubRid]root_rid:",t,", begin_sn:",r,", hit_count:",s,", length:",i-r,", hit_limit:",o);var c=s/(i-r)>=o;return c||(this.close_for_no_data_=!0),c},t.prototype.isTsCompelte=function(t){return this.curSnSet_.get(t)===It.xRtcLiveNotifyTsCode.complete},t.prototype.isPublishDid=function(t){return this.publishedLocalDids_.has(t)},t.prototype.isCloseForNoData=function(){return this.close_for_no_data_},t.prototype.isClose=function(){return this.is_close_},t.prototype.onTimerTimeout=function(){this.stop_timer(),this.isConnected()||(S.rtclog("[rtc][client][timeout]do close:",this.peerid_,",sid:",this.sid_),this.close(Ot.connect_timeout,!0,!0))},t.prototype.isNeedReconnect=function(){return!1},t.prototype.stop_timer=function(){this.timer_&&(clearInterval(this.timer_),this.timer_=null)},t.prototype.createRtcDatachannal=function(){if(this.pc_){S.rtclog("[rtc][createRtcDatachannal]peerid:",this.peerid_,",sid:",this.sid_);var t=this.pc_.createDataChannel(this.peerid_);this.setupRtcDataChannel(t)}},t.prototype.onRtcRemoteDatachannel=function(t){S.rtclog("[rtc][onRtcRemoteDatachannel]peerid:",this.peerid_),this.is_close_||t.channel&&(this.dc_=t.channel,this.setupRtcDataChannel(t.channel))},t.prototype.sid=function(){return this.sid_},t.prototype.onMqtt=function(t){if(t.sid==this.sid_)if(t.from==this.peerid_)switch(this.has_mqtt_recv_||(this.has_mqtt_recv_=!0),t.cmd){case It.xMqttRtcCmd.offer:this.onMqttOffer(t.data);break;case It.xMqttRtcCmd.answer:this.onMqttAnswer(t.data);break;case It.xMqttRtcCmd.candidate:this.onMqttCandidate(t.data);break;case It.xMqttRtcCmd.close:S.rtclog("[rtc][client][xMqttRtcCmd.close]",this.peerid_,",sid:",this.sid_),this.close(Ot.remote_close,!0,!1)}else S.error("[rtc]diff peerid,this peerid:",this.peerid_,",peerid:",t.from);else S.error("[rtc]diff sid,this sid:",this.sid_,",sid:",t.sid)},t.prototype.onMqttOffer=function(t){var r=this;if(this.pc_)if(S.rtclog("[rtc]on_mqtt_offer:",this.peerid_,",",t),0!=t.length){this.status_=At.recv_offer;var n=JSON.parse(t);try{this.pc_.setRemoteDescription(n).then((function(){return r.createRtcAnswer()})).catch((function(t){S.rtclog("[rtc][on_mqtt_offer]setRemoteDescription fail,pid;",r.peerid_),0==(e.rtc_not_close_&Bt.not_close_offer)&&r.close(Ot.anwser_fail,!0,!1)}))}catch(ae){S.warn("[rtc][on_mqtt_offer]exception:",ae||"unkonw",",pid:",this.peerid_)}}else this.close(Ot.offer_fail,!0,!1)},t.prototype.onMqttAnswer=function(t){var r=this;if(S.rtclog("[rtc]on_mqtt_answer:",this.peerid_,",",t),!this.is_close_&&this.pc_){this.status_=At.recv_answer;var n=JSON.parse(t);try{this.pc_.setRemoteDescription(n).then((function(){return S.rtclog("[rtc][on_mqtt_answer][setRemoteDescription ok]peerid:",r.peerid_)})).catch((function(t){S.log("[rtc][on_mqtt_answer][setRemoteDescription fail]peerid:",r.peerid_,"e:",t),0!=(e.rtc_not_close_&Bt.not_close_answer)||r.is_edge_||r.close(Ot.anwser_fail,!0,!1)}))}catch(ae){S.warn("[rtc][on_mqtt_answer]exception:",ae||"unkonw",",pid:",this.peerid_)}}},t.prototype.createRtcOffer=function(){var t=this;if(this.pc_){S.rtclog("[rtc][createRtcOffer]peerid:",this.peerid_);this.status_=At.create_offer;try{this.pc_.createOffer({iceRestart:!0,offerToReceiveAudio:!1,offerToReceiveVideo:!1}).then((function(e){return t.onCreateRtcOfferAnswer(e,!0)})).catch((function(e){S.rtclog("[rtc][createRtcOffer]fail,pid;",t.peerid_),t.close(Ot.offer_fail,!0,!1)}))}catch(ae){S.warn("[rtc][createRtcOffer]exception:",ae||"unkonw",",pid:",this.peerid_)}}},t.prototype.onCreateRtcOfferAnswer=function(t,e){var r=this;if(this.pc_)try{this.pc_.setLocalDescription(t).then((function(){return r.sendMqttOfferAnswer(e)})).catch((function(n){S.warn("[rtc][",e?"offer":"answer","]setLocalDescription fail,pid:",r.peerid_,",",n||"unknow",",",JSON.stringify(t)),r.close(e?Ot.offer_fail:Ot.anwser_fail,!0,!1)}))}catch(ae){S.warn("[rtc][setLocalDescription]exception:",ae||"unkonw",",pid:",this.peerid_)}},t.prototype.createRtcAnswer=function(){var t=this;if(this.pc_){this.status_=At.create_answer,S.rtclog("[rtc][answer][create]peerid:",this.peerid_);try{this.pc_.createAnswer().then((function(e){return t.onCreateRtcOfferAnswer(e,!1)})).catch((function(e){S.warn("[rtc][createAnswer]fail,pid;",t.peerid_),t.close(Ot.anwser_fail,!0,!1)}))}catch(ae){S.warn("[rtc][createAnswer]exception:",ae||"unkonw",",pid:",this.peerid_)}}},t.prototype.sendMqttOfferAnswer=function(t){if(!this.pc_||!this.pc_.localDescription)return this.close(t?Ot.offer_fail:Ot.anwser_fail,!0,!1),!1;this.status_=t?At.send_offer:At.send_answer;var e=JSON.stringify(this.pc_.localDescription);return S.rtclog("[rtc]",t?"[sendMqttOffer]":"[sendMqttAnswer]","peerid:",this.peerid_),!!this.mqtt_.send(this.sid_,this.peerid_,t?It.xMqttRtcCmd.offer:It.xMqttRtcCmd.answer,e)||(S.rtclog("[rtc]",t?"[sendMqttOffer]":"[sendMqttAnswer]","fail,peerid:",this.peerid_),this.close(Ot.mqtt_fail,!0,!1),!1)},t.prototype.close=function(t,e,r){if(!this.is_close_&&this.pc_){this.stop_timer(),this.is_channal_open_&&(this.status_=At.disconnect),this.is_close_=!0,this.is_channal_open_=!1,this.close_res_=t;try{this.dc_&&this.dc_.close(),this.pc_.close(),this.pc_=null}catch(ae){S.rtclog("[rtc][close]peerid:",this.peerid_,",excelt:",ae)}S.rtclog("[rtc][close]peerid:",this.peerid_,",close_reason:",t,",status:",this.status_),e&&qt.P2PManager.instance().emit(T.RtcDisconnect,this)}},t.prototype.onRtcIcecandidate=function(t){var e=t.candidate;e?this.sendMqttCandidate(e):S.rtclog("[rtc][onRtcIcecandidate]All ICE candidates have been sent,pid:",this.peerid_)},t.prototype.onMqttCandidate=function(t){var r=this;if(S.rtclog("[rtc][on_mqtt_candidate]pid:",this.peerid_,",",t),!this.is_close_&&this.pc_){this.status_=At.recv_candidate;var n=JSON.parse(t);try{null!=n&&this.pc_.addIceCandidate(n).then((function(){S.rtclog("[rtc][addIceCandidate]ok,pid:",r.peerid_)})).catch((function(n){S.warn("[rtc][on_mqtt_candidate]addIceCandidate exception:",n||"unkonw",",pid:",r.peerid_,",data:",t),0==(e.rtc_not_close_&Bt.not_close_candidate)&&r.close(Ot.candidate_fail,!0,!1)}))}catch(ae){S.warn("[rtc][addIceCandidate]exception:",ae||"unkonw",",pid:",this.peerid_,",data:",t)}}},t.prototype.sendMqttCandidate=function(t){var e=JSON.stringify(t.toJSON());S.rtclog("[rtc][sendMqttCandidate]",this.peerid_),this.mqtt_.send(this.sid_,this.peerid_,It.xMqttRtcCmd.candidate,e)||(S.rtclog("[rtc][sendMqttCandidate]fail,pid:",this.peerid_),this.close(Ot.mqtt_fail,!0,!1))},t.prototype.onRtcIceconnectionstatechange=function(t){if(!this.is_close_&&this.pc_){var e=this.pc_.iceConnectionState;switch(S.rtclog("[rtc][onRtcIceconnectionstatechange]peerid:",this.peerid_,",",e),e){case"checking":break;case"closed":this.close(Ot.disconnect,!0,!1);break;case"completed":case"connected":break;case"disconnected":this.close(Ot.disconnect,!0,!0);break;case"failed":this.close(Ot.disconnect,!0,!1)}}},t.prototype.setupRtcDataChannel=function(t){S.rtclog("[rtc][setupRtcDataChannel]peerid:",this.peerid_,",sid:",this.sid_),this.dc_=t,t.binaryType="arraybuffer",t.onopen=this.onRtcDataChannlOpen.bind(this),t.onerror=this.onRtcDataChannlError.bind(this),t.onmessage=this.onRtcDataChannlMessage.bind(this),t.onclose=this.onRtcDataChannlClose.bind(this)},t.prototype.getCanRequestCount=function(t,r,n,i){if(!this.isConnected())return-1;if(this.is_edge_&&(!i||!e.can_use_edge()))return-2;var o=this.score_-this.is_requsting_chunk_count_;return S.rtclog("[rtc][p2p]getCanRequestCount, rid:",t,", sn: ",r,", peerid:",this.peerid_,", score:",this.score_,", req cnt:",this.is_requsting_chunk_count_,", dx:",o),o<=0?-3:n!=this.curChunkWidthKB_?(S.warn("[rtc][p2p]checkRequetDataStatus diff chunkWidth:",n,",this:",this.curChunkWidthKB_),this.close(Ot.chunkWidthDiff,!0,!1),-6):o},t.prototype.isConnected=function(){return!!this.dc_&&"open"==this.dc_.readyState},t.prototype.onRtcDataChannlOpen=function(t){this.has_connected_history_=!0,this.is_channal_open_=!0,this.status_=At.connected,S.rtclog("++[rtc][channal][onopen]pid:",this.peerid_,",sid:",this.sid_),this.p2pMgr_.emit(T.RtcConnected,this),this.sendVersion(),this.publishRid(),this.stop_timer()},t.prototype.sendVersion=function(){var t=Dt.makexRtcClientInfoPack();t&&this.send(t)},t.prototype.publishRid=function(){var t=this.dm_.getActivateM3u8Loader();if(t&&t.rid){this.myRequestRid_=t.rid;var e=t.getPublishRidPack(!1);e&&this.sendRtcVodPublishRid(t.rid,e)}},t.prototype.onRtcDataChannlClose=function(t){S.rtclog("[rtc][channal][onclose]pid:",this.peerid_),this.close(Ot.channal_close,!0,!1)},t.prototype.onRtcDataChannlError=function(t){S.rtclog("[rtc][channal][onerror]pid:",this.peerid_,",sid:",this.sid_),this.close(Ot.channal_error,!0,!1)},t.prototype.onRtcDataChannlMessage=function(t){if(t.data instanceof ArrayBuffer){var e=t.data,r=e.byteLength;if(r<=0)S.error("[rtc][data]data empty",",peerid:",this.peerid_);else{ft.addRtcBytes(r,!1);try{this.processRtcMsg(new Uint8Array(e))}catch(ae){S.error("[rtc][data]except",ae.toString(),",peerid:",this.peerid_)}}}else S.error("[rtc][data]data error type:",",peerid:",this.peerid_)},t.prototype.xRtcHead2String=function(t){return It.xRtcHead[t]},t.prototype.processRtcMsg=function(t){var e=new Et.ByteBuffer(t),r=It.xRtc.getRootAsxRtc(e);if(r){var n=r.xHead(),i=r.xBodyType();switch(S.rtclog("[rtc][processRtcMsg]peerid:",this.peerid_,",xRtcHead:",this.xRtcHead2String(n),",bodyType:",i),n){case It.xRtcHead.xRtcVodChunkReq:if(i!=It.xRtcBody.xRtcVodChunkReq)return void S.error("[rtc][processRtcMsg]xRtcVodChunkReq bodyType:",i);(s=r.xBody(new It.xRtcVodChunkReq))&&this.processRtcVodChunkReq(s);break;case It.xRtcHead.xRtcVodChunkRes:if(--this.is_requsting_chunk_count_,i!=It.xRtcBody.xRtcVodChunkRes)return void S.error("[rtc][p2p]xRtcVodChunkRes bodyType:",i);(s=r.xBody(new It.xRtcVodChunkRes))?this.processRtcVodChunkRes(s):S.error("[rtc][p2p]xRtcVodChunkRes empty");break;case It.xRtcHead.xRtcVodPublishRid:if(i!=It.xRtcBody.xRtcVodPublishRid)return void S.error("[rtc][publish]bodyType:",i);if(s=r.xBody(new It.xRtcVodPublishRid)){var o=s.rid();this.procesRtcVodPublishRid(s),this.sendRtcVodNotifyTs(o)}else S.error("[rtc][publish]body empty");break;case It.xRtcHead.xRtcClientInfo:if(i!=It.xRtcBody.xRtcClientInfo)return void S.error("[rtc][info]bodyType:",i);(s=r.xBody(new It.xRtcClientInfo))?this.processRtcClientInfo(s):S.error("[rtc][info]body empty");break;case It.xRtcHead.xRtcVodNotifyTs:if(i!=It.xRtcBody.xRtcVodNotifyTs)return void S.error("[rtc][info]bodyType:",i);var s;(s=r.xBody(new It.xRtcVodNotifyTs))?this.processRtcVodNotifyTs(s):S.error("[rtc][info]body empty");break;default:S.rtclog("[rtc][p2p]unkonw pack,bodyType:",i)}}else S.error("[rtc][processRtcMsg]fb fail:",this.peerid_)},t.prototype.processRtcVodChunkReq=function(t){for(var e=t.rid(),r=ht.ULongToNumber(t.sn()),n=t.mnsLength(),i=function(n){var i=t.mns(n);if(null!=i){var s=o;o.dm_.readChunk2(e,r,i,o.curChunkWidthKB_,(function(t){S.rtclog("[rtc][p2p][data][recv][req] sendRtcVodChunkRes rid:",e,"pid:",s.peerid_,",uuid:",s.uuid_,",sn:",r,",mn:",i," requsting_count:",s.is_requsting_chunk_count_),null!=i&&s.sendRtcVodChunkRes(e,r,i,t)}))}},o=this,s=0;s<n;++s)i(s)},t.prototype.sendRtcVodChunkRes=function(t,e,r,n){var i=n.data;if(!this.is_channal_open_||!this.dc_)return S.rtclog("[rtc][p2p][data][send]XXXX,no connect,rid:",t),!1;i||S.rtclog("[rtc][p2p][data][send]XXXX,no data,sn:",e," code:",It.xRtcVodChunkResCode[n.code]);var o=i?i.tsLength:-n.code;try{var s=i&&i.buffer?i.buffer:new Uint8Array(0),a=new Et.Builder(256+s.length),c=t?a.createString(t):void 0,u=It.xRtcVodChunkRes,h=u.createChunkMemVector(a,s);u.startxRtcVodChunkRes(a),null!=c&&u.addRid(a,c),u.addSn(a,ht.NumberToULong(e)),u.addMn(a,r),u.addChunkMem(a,h),u.addFileSizeCode(a,ht.NumberToLong(o));var d=u.endxRtcVodChunkRes(a),l=It.xRtc;l.startxRtc(a),l.addXHead(a,It.xRtcHead.xRtcVodChunkRes),l.addXBodyType(a,It.xRtcBody.xRtcVodChunkRes),l.addXBody(a,d),a.finish(l.endxRtc(a));var _=a.asUint8Array();this.send(_)}catch(ae){return S.error("[rtc][p2p][data][send]except:",ae.toString()),!1}return S.rtclog("[rtc][p2p][data][send]pid:",this.peerid_,",sn:",e,",mn:",r,",fileSizeCode:",o),!0},t.prototype.dumpDidError=function(){var t,e,r,n,i=[],o=[];try{for(var s=y(this.rid2didMap_),a=s.next();!a.done;a=s.next()){var c=v(a.value,2),u=c[0],h=c[1];i.push({rid:u,did:h})}}catch(p){t={error:p}}finally{try{a&&!a.done&&(e=s.return)&&e.call(s)}finally{if(t)throw t.error}}try{for(var d=y(this.did2RidMap_),l=d.next();!l.done;l=d.next()){var _=v(l.value,2);h=_[0],u=_[1];o.push({rid:u,did:h})}}catch(f){r={error:f}}finally{try{l&&!l.done&&(n=d.return)&&n.call(d)}finally{if(r)throw r.error}}return JSON.stringify({pid:this.peerid_,version:this.version_,rid:i,did:o})},t.prototype.processRtcClientInfo=function(t){this.clientType_=t.clientType(),this.version_=t.version(),S.rtclog("[rtc][info]pid:",this.peerid_,",type:",this.clientType_,",version:",this.version_)},t.prototype.processRtcVodChunkRes=function(t){var e=t.rid(),r=ht.ULongToNumber(t.sn()),n=t.mn(),i=t.chunkMemArray();i&&0==i.length&&(i=null);var o=ht.LongToNumber(t.fileSizeCode()),s=o<0?-o:0,a=o>0?o:0,c=this.checkMnTimeout(r,n,o);S.rtclog("[rtc][p2p][data][recv]uuid:",this.uuid_,",peerid:",this.peerid_,",sn:",r,",mn:",n,",len:",i?i.length:0,",fileSizeCode:",o,",time:",c,"ms, score:",this.score_,",reqCn:",this.requesting_tms_.size),e?this.p2pMgr_.emit(C(e,r),e,r,n,this.curChunkWidthKB_,s,a,i,this):S.error("[rtc][p2p][data][recv]rid empty ",",uuid:",this.uuid_,",pid:",this.peerid_,",",this.dumpDidError())},t.prototype.sendRtcVodPublishRid=function(t,e){if(!this.is_channal_open_||!this.dc_)return!1;var r=e;return S.rtclog("[rtc][publish][send]pid:",this.peerid_,",rid:",t,",len:",r.length),this.send(r),!0},t.prototype.sendRtcVodNotifyTs=function(e){if(null==e)return!1;var r=t.CacheManager.getM3u8Bitmap(e);if(null==r)return!1;var n=Dt.makexRtcVodNotifyTsPack(e,r.length,r);return null!=n&&this.send(n),S.rtclog("[rtc][notifyts][send] sendRtcVodNotifyTs rid:",e," tslist.length: ",r.length),!0},t.prototype.processRtcVodNotifyTs=function(t){try{var e=t.rid(),r=t.size(),n=t.snArray();if(null==e||null==n)return;for(var i=Array(r),o=0;o<r;o++)0==n[o]?i[o]=!1:i[o]=!0;this.rid2tsListMap_.set(e,i),S.rtclog("[rtc][notifyts][recv] processRtcVodNotifyTs rid:",e," tslist.length: ",i.length),this.p2pMgr_.emit(T.RtcNotifyTs,this,e)}catch(ae){}},t.prototype.procesRtcVodPublishRid=function(t){try{var e=t.chunkWidthKB(),r=t.rid();if(!r)return void S.error("[rtc][publish][recv]no find rid, ,pid:",this.peerid_);this.curChunkWidthKB_=e,this.peerRequestRid_=r,S.rtclog("[rtc][publish][recv]pid:",this.peerid_,",rid:",r),this.p2pMgr_.emit(T.RtcRidPublish,this,r)}catch(ae){}},t.prototype.send=function(t){if(this.dc_){try{this.dc_.send(t)}catch(ae){S.error("[rtc][p2p][send]except:",ae||"unknow")}ft.addRtcBytes(t.byteLength,!0)}},t.prototype.checkScore=function(){this.score_<=0?this.score_=1:this.score_>e.p2p_max_requsting_cn_&&(this.score_=e.p2p_max_requsting_cn_)},t.prototype.makeScoreKey=function(t,e){return(t<<14)+e},t.prototype.checkMnTimeout=function(t,r,n){var i=this.makeScoreKey(t,r),o=this.requesting_tms_.get(i);if(o){this.requesting_tms_.delete(i);var s=dt.nowMs()-o;return n<0?(this.score_=1,this.close(Ot.noData,!0,!1),this.close_for_no_data_=!0,s):(s<e.p2p_requst_min_timeout_ms_?(++this.score_,this.checkScore()):s>e.p2p_requst_max_timeout_ms_?this.score_=1:s>e.p2p_requst_middle_timeout_ms_&&(--this.score_,this.checkScore()),s)}return-1},t.prototype.requestP2P=function(t,e,r,n,i,o){var s,a;this.is_requsting_chunk_count_+=n.length;var c=dt.nowMs();try{var u=new Et.Builder(1024),h=It.xRtcVodChunkReq,d=t?u.createString(t):void 0,l=h.createMnsVector(u,n);h.startxRtcVodChunkReq(u),null!=d&&h.addRid(u,d),h.addSn(u,ht.NumberToULong(r)),h.addMns(u,l);var _=h.endxRtcVodChunkReq(u),p=It.xRtc;p.startxRtc(u),p.addXHead(u,It.xRtcHead.xRtcVodChunkReq),p.addXBodyType(u,It.xRtcBody.xRtcVodChunkReq),p.addXBody(u,_),u.finish(p.endxRtc(u));var f=u.asUint8Array();this.send(f);try{for(var b=y(n),g=b.next();!g.done;g=b.next()){var m=g.value;o.set(m,c),this.requesting_tms_.set(this.makeScoreKey(r,m),c)}}catch(v){s={error:v}}finally{try{g&&!g.done&&(a=b.return)&&a.call(b)}finally{if(s)throw s.error}}}catch(ae){return S.error("[rtc][p2p][data][req]except:",ae||"unknow"),-1}return S.rtclog("[rtc][p2p][data][req]rid:",t,",peerid:",this.peerid_,",sn:",r,",mn:",n.join(","),",requsting_count:",this.is_requsting_chunk_count_),n.length},t.s_UUID=0,t}(),jt=function(){function t(){this.engine_=null,this.isLogin_=!1,this.activateM3u8URL_="",this.fragForRequest_=null,this.cacheM3u8Param_=null,this.didCounter_=0,this.lastRid_=void 0,this.lastM3u8URL_=void 0,this.streamChangeCount_=0,this.rid2M3u8Loaders_=new Map,this.url2M3u8Loaders_=new Map,this.did2M3u8Loaders_=new Map,this.lastProgressData_={mode:0,index:0,loaded:0,total:0},this.lastUpdateUrlInfoTime_ms_=0,this.lastCheckUnActiveRtcTm_=0,this.activateLoader_=void 0}return t.instance=function(){return this.instance_||(this.instance_=new t),this.instance_},t.prototype.setEngine=function(t){this.engine_=t},t.prototype.isLogined=function(){return this.isLogin_},t.prototype.dump=function(){var t,e,r,n,i=[],o=[];try{for(var s=y(this.did2M3u8Loaders_),a=s.next();!a.done;a=s.next()){var c=v(a.value,2),u=(c[0],c[1]);o.push({did:u.did_,rid:u.rid,url:u.fullM3u8Url})}}catch(_){t={error:_}}finally{try{a&&!a.done&&(e=s.return)&&e.call(s)}finally{if(t)throw t.error}}try{for(var h=y(this.rid2M3u8Loaders_),d=h.next();!d.done;d=h.next()){var l=v(d.value,2);l[0],u=l[1];i.push({did:u.did_,rid:u.rid,url:u.fullM3u8Url})}}catch(p){r={error:p}}finally{try{d&&!d.done&&(n=h.return)&&n.call(h)}finally{if(r)throw r.error}}return JSON.stringify({rid:i,did:o},null,2)},t.prototype.updateM3u8Info=function(t,e,r,n){if(this.lastUpdateUrlInfoTime_ms_=dt.nowMs(),0!=r.length){var i,o=wt.isUpsM3u8(e);if(o)(s=this.getM3u8LoaderByUrl(t))&&(s.close(),this.url2M3u8Loaders_.delete(t),this.did2M3u8Loaders_.delete(s.did_),s.rid&&this.rid2M3u8Loaders_.delete(s.rid));if(S.log("[DMG][xplayer]update,ts-cn:",r.length,",last-sn:",r[r.length-1].sn,",url:",t,",start-sn:",n),o||this.activateM3u8URL_!==t){var s;(s=this.getM3u8LoaderByUrl(this.activateM3u8URL_))&&(s.pause(),this.lastRid_=s.rid,this.lastM3u8URL_=s.fullM3u8Url);var a=this.getM3u8LoaderByUrl(t);a||(++this.didCounter_,a=new Ut(this.didCounter_,t,e,o,this.onTsReadyForRequest.bind(this)),this.did2M3u8Loaders_.set(this.didCounter_,a),this.url2M3u8Loaders_.set(t,a),this.activateM3u8URL_=t,S.log("[DMG][xplayer]update, create new stream,did:",a.did_,",url:",t)),this.activateLoader_=i=a,this.streamChangeCount_++,S.log("[DMG][xplayer]update, stream changed,did:",i.did_,",url:",t,",rid=",this.activateLoader_.rid?this.activateLoader_.rid:"empty")}else this.activateLoader_||(this.activateLoader_=this.getM3u8LoaderByUrl(this.activateM3u8URL_)),i=this.activateLoader_;i&&(i.updateTsList(r,n),i.isRequested_&&i.start())}else S.warn("[DMG][xplayer]update,ts-empty,url:",t)},t.prototype.requestTSData=function(t,e){S.is_debug()&&S.log("[xplayer]request,sn:",e.sn,",m3u8URL:",t);var r=this.getM3u8LoaderByUrl(t);if(!r){var n={msg:"request_id_error",m3u8Url:t,tsUrl:e.url,sn:e.sn,errCode:1001};return this.engine_&&this.engine_.SendErrorToPlayer(n),void S.warn("[DMG][xplayer][request]no find url,sn:",e.sn,",m3u8URL:",t)}this.activateM3u8URL_!=t&&(S.warn("[DMG][xplayer][request]activateM3u8URL_ miss ,current:",this.activateM3u8URL_," ,new:",t),this.activateM3u8URL_=t,this.activateLoader_=r),this.fragForRequest_=e,r.requestTSData(e)},t.prototype.abortTSData=function(t,e){S.is_debug()&&S.log("[xplayer]abort,sn:",e.sn,",m3u8URL:",t);var r=this.getM3u8LoaderByUrl(t);r?r.abortTSData(e.sn):S.warn("[DMG][xplayer][abort]no find url,sn:",e.sn,",m3u8URL:",t)},t.prototype.setPlayerBufferDuration=function(t){this.activateLoader_&&this.activateLoader_.setPlayerBufferDuration(t)},t.prototype.readChunk2=function(e,r,n,i,o){var s={data:null,code:It.xRtcVodChunkResCode.unknow,localDid:0};if(!e)return S.log("[DMG][p2p]readChunk2,noDid",",sn:",r,",mn:",n),s.code=It.xRtcVodChunkResCode.noDid,ft.recordP2pDataError(101),void o(null);t.CacheManager.readTsData(e,r,n*i*1024,1024*i,!0,(function(i,a){if(null!=i&&null!=i.buffer)S.log("[DMG][p2p]readChunk2(), CacheManager.readTsData, bufffer.length=",i.buffer.length," tsSize=",i.tsLength),s.data={buffer:i.buffer,tsLength:i.tsLength},ft.T5_add(i.buffer.byteLength),S.log("[DMG][p2p]readChunk2()","succeed"," sn:",r," mn:",n," read bufLength=",i.buffer.byteLength," tsSize=",i.tsLength),o(s);else{S.log("[DMG][p2p]readChunk2()","chunk buffer is null"," sn:",r," mn:",n),s.code=It.xRtcVodChunkResCode.noSN,ft.recordP2pDataError(a),o(s);var c=t.CacheManager.m3u8Bitmap.get(e);c&&r>=0&&r<c.tsList.length&&c.tsList[r]&&(S.log("[DMG][p2p]readChunk2(), m3u8Bitmap miss, rid:",e),ft.recordP2pDataError(102),c.tsList[r]=!1,t.CacheManager.needUpdateM3u8Arr.add(e))}}))},t.prototype.getActivateRid=function(){return this.activateLoader_?this.activateLoader_.rid:void 0},t.prototype.getLastRid=function(){return this.lastRid_},t.prototype.getLastM3u8URL=function(){return this.lastM3u8URL_},t.prototype.getActivateFullM3u8Url=function(){return this.activateLoader_?this.activateLoader_.fullM3u8Url:void 0},t.prototype.getActivateM3u8Loader=function(){return this.activateLoader_},t.prototype.getTsMap=function(){return this.activateLoader_?this.activateLoader_.getTsLoaderMap():null},t.prototype.loginSucceed=function(t){this.isLogin_||(this.isLogin_=!0,this.lastCheckUnActiveRtcTm_=this.lastUpdateUrlInfoTime_ms_=t,this.isP2PReady())},t.prototype.checkProgressData=function(){ft.loadMode==this.lastProgressData_.mode&&ft.tsSn==this.lastProgressData_.index&&ft.loadSize==this.lastProgressData_.loaded&&ft.totalSize==this.lastProgressData_.total||(this.lastProgressData_={mode:ft.loadMode,index:ft.tsSn,loaded:ft.loadSize,total:ft.totalSize},this.engine_&&(this.engine_.SendProgressToPlayer(this.lastProgressData_),S.log("[CheckProgress] >>> ",JSON.stringify(this.lastProgressData_))))},t.prototype.onMainCoreTimer=function(t){this.checkProgressData(),this.checkRtc(t)},t.prototype.checkRtc=function(t){var r,n;if(!(t-this.lastCheckUnActiveRtcTm_<6e4)){this.lastCheckUnActiveRtcTm_=t;var i=this.getActivateM3u8Loader(),o=i?i.getP2PSeter():null;if(o){var s=o.get_cliets();try{for(var a=y(this.did2M3u8Loaders_),c=a.next();!c.done;c=a.next()){var u=v(c.value,2),h=(u[0],u[1]);h!=i&&t-h.pause_tm_>e.p2p_close_unactive_dx_ms_&&h.closeAllRtc(s)}}catch(d){r={error:d}}finally{try{c&&!c.done&&(n=a.return)&&n.call(a)}finally{if(r)throw r.error}}}}},t.prototype.onTsReadyForRequest=function(t,e,r){if(t!=this.activateLoader_)return S.log("[DMG]onTsReadyForRequest, activateLoader miss, m3u8Url:",t.fullM3u8Url,", sn:",e),void ft.recordP2pDataError(44);if(!this.fragForRequest_||e!==this.fragForRequest_.sn)return S.log("[DMG]onTsReadyForRequest, fragForRequest_ is miss, m3u8Url:",t.fullM3u8Url,", sn:",e),void ft.recordP2pDataError(45);ft.T8_add(r.byteLength),S.log("[DMG]onTsReadyForRequest,did: ",t.did_," sn:",e," bufferLength:",r.byteLength," url: ",this.fragForRequest_.url);var n={frag:this.fragForRequest_,fragdata:{payload:r,stats:{trequest:(new Date).getTime(),retry:0}}};this.engine_&&this.engine_.SendDataToPlayer(e,n),this.fragForRequest_=null},t.prototype.getM3u8LoaderByUrl=function(t){return this.url2M3u8Loaders_.get(t)},t.prototype.getM3u8LoaderByRid=function(t){return this.rid2M3u8Loaders_.get(t)},t.prototype.updateRid=function(t,e){this.rid2M3u8Loaders_.set(t,e)},t.prototype.isP2PReady=function(){return this.isLogin_&&e.is_use_p2p_&&!e.is_dyt_},t.prototype.getStreamChangeCount_diff=function(){var t=this.streamChangeCount_;return this.streamChangeCount_=0,t},t.prototype.is_vod_pause_or_stop=function(t){return this.isLogined(),!1},t.prototype.close=function(){var t,e,r=this.url2M3u8Loaders_;try{for(var n=y(r),i=n.next();!i.done;i=n.next()){var o=v(i.value,2),s=o[0],a=o[1];S.log("[DMG]close url2M3u8Loader, url:",s),a.close(),r.delete(s)}}catch(c){t={error:c}}finally{try{i&&!i.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}},t}();Ft.DownloadManager=jt;var Vt=function(){function t(){}return t.OID_STAT="oid_stat",t.ASN="asn",t.LOCATION="location",t.LOGCODE="logcode",t.RID="rid",t.PMODE="pmode",t.RID_LIST="rid_list",t.OID="oid",t.URL="url",t.TYPE="type",t.PID="pid",t.CLIENT_TYPE="client_type",t.PEER_LEVEL="peer_level",t.CTRL_CODE="ctrl_code",t.PEER_LIST="peer_list",t.PEER_HTTP="peer_http",t.PEER_FLASH="peer_flash",t.PEER_LEVEL2="peer_level2",t.TIMESTAMP="timestamp",t.CUSTOM_CONFIG="custom_config",t.DOMAIN="domain",t.FLASH_CONTROL_CONS="flash_control_cons",t.ADD_TIMESTAMP_VAL=86400,t.ADDR="addr",t.TRACKER="tracker",t.PGW="pgw",t.CPS="cps",t.CCD="stat",t.TRK_ADDR="tracker_addr",t.TRK_TCP_PORT="trk_tcp_port",t.TRK_UDP_PORT="trk_udp_port",t.CONS_KEY="cons_key",t.CONS_BILL="cons_bill",t.DELAY="delay",t.DELAY_MIN="delay_min",t.REPORT_INTVAL="reportIntval",t.PROTECTWINDOW="protectwindow",t.DOMAIN_B="domain_b",t.ORIGIN_KEY_DOMAINB="origin_key_domainb",t.CONS_KEY_DOMAINB="cons_key_domainb",t.CONS_BILL_DOMAINB="cons_bill_domainb",t.ABILITY="ability",t.REG="reg",t.OM_CONFIG="om_config",t.REAL_LOG_EN="rlog-en",t.SEND_REALTIMELOG_PER="srlog-per",t.WDC_LOG_EN="wlog-en",t.SEND_WDCLOG_PER="swlog-per",t.USE_P2P="usep2p",t.USE_PROXY="useproxy",t.USE_EDGE_PER="useedge-per",t.FORCE_PEAKMODE="force_peakmode",t.SIGNAL="signal",t.SIGNAL_USER_ID="sig_user_id",t.SIGNAL_USER_GROUP_ID="sig_user_group_id",t.SIGNAL_PASSWORD="sig_password",t.STUN="stun",t.STUN_USER_ID="stun_user_id",t.STUN_PASSWORD="stun_password",t.SIGNAL_WS="signal_ws",t.SIGNAL_WSS="signal_wss",t.SIGNAL_BAK_WS="signal_bak_ws",t.SIGNAL_BAK_WSS="signal_bak_wss",t.STUN_BAK="stun_bak",t.HOST="host",t.PORT="tcp_port",t.META="meta",t.BLOCK_SIZE="rid_size",t.RESOURCE_SIZE="resource_size",t.MD5V3="md5v3",t.RID_SIZE="ridsize",t.SCARCITY="scarcity",t.RTYPE="rid_type",t.CDN_DURATION="cdn-du",t.EDGE_DURATION="edge-du",t.MEMORY_SIZE="mms",t.CDN_CONNECT_TIMEOUT_MS="cdn-tmo",t.CDN_RETRY_MAX_COUNT="cdn-rcn",t.CDN_TIMEOUT_DONE="cdn-tmo-done",t.MAX_BLOCK_ACCESS_DX_SEC="c-as-dx",t.CHUNK_WIDTH_KB="ck-wt",t.MEMORY_POOL_LENGTH="memp-sz",t.MAX_TS_COUNT="ts-cn",t.P2P_CONCURRENT_REQUEST_COUNT="p2p-ccn",t.P2P_CONNECT_TIMEOUT_MS="p2p-ctmo",t.P2P_RTC_OFFER_TIMEOUT_MS="p2p-offer-tmo",t.P2P_TOP_LIST_SIZE="p2p-tp-sz",t.P2P_MAX_REQUSTING_CN="p2p-req-cn",t.P2P_PER_MAX_CONNECT_COUNT="p2p-per-max-cn",t.P2P_CONNECT_RETRY_MS="p2p-connect-retry-ms",t.P2P_ALL_CDN_RATIO="p2p-acdn-rat",t.P2P_REQUST_TIMER_MS="p2p-timer",t.P2P_REQUST_MN_TIMEOUT_MS="p2p-mn-tmo",t.P2P_REQUST_MIN_TIMEOUT_MS="p2p-min-tmo",t.P2P_REQUST_MIDDLE_TIMEOUT_MS="p2p-mid-tmo",t.P2P_REQUST_MAX_TIMEOUT_MS="p2p-max-tmo",t.P2P_LOADER_EXPIRE_MS="p2p-loader-expire-tmo",t.P2P_LOADER_USE_EDGE_MS="p2p-edge-tmo",t.P2P_IGNORE_ZERO_PEERS="p2p-ignore-zero-peers",t.USE_M3U8_FILESIZE="use-m3u8-fs",t.P2P_CLOSE_UNACTIVE_DX_MS="p2p-x-dx",t.ADDRESS_ERENGT_DX="ads-ert-dx",t.P2P_FIRST_MULTI_REQUEST_COUNT="p2p-fmrc",t.CALCULATE_SPEED_CDN_PER="sd-cdn-per",t.CALCULATE_SPEED_P2P_PER="sd-p2p-per",t.PUBLISH_TS_PER="publish-ts-per",t.PUBLISH_SUB_TS_PER="publish-sub-ts-per",t.SUBRID_BATCH_SIZE="subrid-batch-size",t.PUBLISH_BATCH_SIZE="publish-batch-size",t.DEL_BATCH_SIZE="del-batch-size",t.RTC_NOT_CLOSE="rtc-nc",t.send_address_log_per_="sd-adr-per",t.send_ccd_dx_seconds_="ccd-dx",t.send_rl_dx_seconds_="rl-dx",t.send_ccd_timeout_seconds_="ccd-tmo",t.send_ccd_retry_cn_="ccd-rcn",t.download_roi_min_dx_ms_="roi-min",t.MAX_PEER_COUNT="mpc",t.disconnect_max_peer_count_="dmpc",t.MAX_EDGE_COUNT="mec",t.PROTOCAL_NET_TIMEOUT_MS="pro-tmo",t.VERSION="version",t.rid_no_control_="rid-no-control",t.use_pgw_="use_pgw",t.change_resize_="ch-res",t.DB_NAME="pcdndata",t.TABLE_NAME="pcdnfiles",t.TABLE_BITMAP="pcdnResBitmap",t.KEY_NAME="resourceId",t.DB_NAME_OLD="pcdnfile",t.ALG_MAX_BLOCK_ACCESS_DX_SEC=30,t.ALG_MAX_LEVEL2_CACHE_COUNT="lv2-cache-count",t.ALG_MAX_LEVEL2_CACHE_TIMEOUT_SEC=120,t.DB_MAX_USED_SPACE="db-max-used-space",t.DB_READ_TIMEOUT="db-read-tmo",t.CORE_REQ_TIMEOUT="core-req-tmo",t.REPORT_WDC_TM="rep-wdc-tm",t}(),zt=function(){function t(t){this.is_init_=!1,this.jsonstring_=t,this.originKey_="",this.originIsFF_=0,this.rtype_=0}return t.prototype.getValue=function(t,e){return null==t?e:t},t.prototype.init=function(){if(this.is_init_)return 1;if(this.is_init_=!0,0===this.jsonstring_.length)return 0;var t=null;try{t=JSON.parse(this.jsonstring_)}catch(ae){return S.error("[Domain_config]json e:",ae),-1}return null==t?(S.error("[Domain_config]json null:",this.jsonstring_),-2):(this.originKey_=this.getValue(t[Vt.CONS_KEY],""),this.originIsFF_=this.getValue(t[Vt.CONS_BILL],0),this.rtype_=parseInt(this.getValue(t[Vt.RTYPE],"0")),0)},t}(),Ht=function(){function t(){}return t.set=function(e,r,n){var i=0,o=new zt(r);return n&&o.init()<0&&(i=-1),t.map_.set(e,o),i},t.get=function(e,r){var n=t.map_.get(e);return null==n?r?((n=new zt("")).is_init_=!0,n):null:(n.is_init_||n.init(),n)},t.login_cfg_resource_size_type=-1,t.map_=new Map,t}(),Gt=function(){function t(){}return t.OID_STAT_VAL="5df9",t.ASN_VAL="ce2f",t.LOCATION_VAL="7922",t.LOGCODE_VAL="379b",t.RID_VAL="dd1e",t.PMODE_VAL="b061",t.RID_LIST_VAL="eb54",t.OID_VAL="bb8a",t.URL_VAL="e5e6",t.TYPE_VAL="98a6",t.PID_VAL="adc6",t.CLIENT_TYPE_VAL="a3fb",t.PEER_LEVEL_VAL="093b",t.CTRL_CODE_VAL="ff15",t.PEER_LIST_VAL="9db7",t.PEER_HTTP_VAL="5f7e",t.PEER_FLASH_VAL="c990",t.PEER_LEVEL2_VAL="5f7f",t.TIMESTAMP_VAL="379a",t.CUSTOM_CONFIG_VAL="7ef6",t.DOMAIN_VAL="9a9c",t.ADDR_VAL="4050",t.TRACKER_VAL="73ba",t.TRK_ADDR_VAL="73be",t.TRK_UDP_PORT_VAL="73bd",t.TRK_TCP_PORT_VAL="73bc",t.ABILITY_VAL="a1a1",t.OID_VAL_SUCCESS=0,t.CTRL_CODE_VAL_SUCCESS=1,t.CTRL_CODE_VAL_NOP2P=2,t.CTRL_CODE_VAL_FORBID=3,t.ABILITY_VAL_FLV_LIVE=512,t.ABILITY_VAL_HLS_VOD=1024,t.META_VAL="m1m1",t.BLOCK_SIZE_VAL="c1c1",t.RESOURCE_SIZE_VAL="s1s1",t.MD53_VAL="d3d3",t.RID_SIZE_VAL="s3s3",t.SCARCITY_VAL="78e7",t.VERSION="b834",t}(),Wt=function(){function t(){}return t.get=function(e){var r=t.dict_.get(e);return null==r&&S.error("map error:",e),r||"unknow"},t.dict_=new Map([[Vt.OID_STAT,Gt.OID_STAT_VAL],[Vt.ASN,Gt.ASN_VAL],[Vt.LOCATION,Gt.LOCATION_VAL],[Vt.OID,Gt.OID_VAL],[Vt.RID,Gt.RID_VAL],[Vt.PMODE,Gt.PMODE_VAL],[Vt.RID_LIST,Gt.RID_LIST_VAL],[Vt.TYPE,Gt.TYPE_VAL],[Vt.PID,Gt.PID_VAL],[Vt.URL,Gt.URL_VAL],[Vt.CLIENT_TYPE,Gt.CLIENT_TYPE_VAL],[Vt.PEER_LEVEL,Gt.PEER_LEVEL_VAL],[Vt.CTRL_CODE,Gt.CTRL_CODE_VAL],[Vt.PEER_LIST,Gt.PEER_LIST_VAL],[Vt.PEER_HTTP,Gt.PEER_HTTP_VAL],[Vt.PEER_FLASH,Gt.PEER_FLASH_VAL],[Vt.PEER_LEVEL2,Gt.PEER_LEVEL2_VAL],[Vt.TIMESTAMP,Gt.TIMESTAMP_VAL],[Vt.CUSTOM_CONFIG,Gt.CUSTOM_CONFIG_VAL],[Vt.DOMAIN,Gt.DOMAIN_VAL],[Vt.ADDR,Gt.ADDR_VAL],[Vt.TRACKER,Gt.TRACKER_VAL],[Vt.TRK_ADDR,Gt.TRK_ADDR_VAL],[Vt.TRK_TCP_PORT,Gt.TRK_TCP_PORT_VAL],[Vt.TRK_UDP_PORT,Gt.TRK_UDP_PORT_VAL],[Vt.ABILITY,Gt.ABILITY_VAL],[Vt.LOGCODE,Gt.LOGCODE_VAL],[Vt.META,Gt.META_VAL],[Vt.BLOCK_SIZE,Gt.BLOCK_SIZE_VAL],[Vt.RESOURCE_SIZE,Gt.RESOURCE_SIZE_VAL],[Vt.MD5V3,Gt.MD53_VAL],[Vt.RID_SIZE,Gt.RID_SIZE_VAL],[Vt.SCARCITY,Gt.SCARCITY_VAL],[Vt.VERSION,Gt.VERSION]]),t}(),Kt=function(){function t(){this.http_request_=new vt(this.callback.bind(this)),this.status_=w.INIT,this.is_https_=!0,this.realtime_logmonitor_=new Tt}return t.prototype.isOk=function(){return w.SUCCESS===this.status_},t.prototype.request=function(){this.status_=w.LOGING;var r,n={oid:e.oid_,type:e.type_,client_type:e.client_type_,version:wt.GetVersionUint(),peer_id:e.pcdn_peer_id_};r=this.getSendData(JSON.stringify(n));var i=this.hexStringToUint8Array(r),o="";o="1"===e.use_pre_?Rt.PORTAL_HTTP+Rt.PRE_PORTAL_URI+"?p=00&o="+e.cid_+"&s=1":this.is_https_?Rt.PORTAL_HTTPS+Rt.PORTAL_PRE+Rt.MAIN_DOMAIN+Rt.PORTAL_SUF+"?p=00&o="+e.cid_+"&s=1":Rt.PORTAL_HTTP+Rt.PORTAL_PRE+Rt.MAIN_DOMAIN+Rt.PORTAL_SUF+"?p=00&o="+e.cid_+"&s=0",S.log("[quest][login]:",o),this.http_request_.post(o,t.timeout_ms_,i,"json")},t.prototype.getSendData=function(t){return N.AES.encrypt(t,N.enc.Utf8.parse(wt.getVal1()),{iv:N.enc.Utf8.parse(wt.getVal2()),mode:N.mode.CBC,padding:N.pad.Pkcs7}).ciphertext.toString()},t.prototype.getValue=function(t,e){return null==t?e:t},t.prototype.process=function(e){this.status_=e,t.P2PManager.instance().emit(T.LOGIN,this.status_)},t.prototype.callback=function(t,r){if(null!=t){ft.setLoginErrTimes(!1),"timeout"==t?S.error("[login]timeout"):S.error("[login]error:",t),this.process(w.ERROR);var n={logtype:_t.ERROR,subtype:pt.DEFAULT,errcode:lt.LOGIN_STATUS_ERR,ext:t};return this.realtime_logmonitor_.request(n),void this.tryAddress()}ft.setLoginErrTimes(!0);var i=null;try{var o=this.getReceiveData(r),s=o.substr(0,o.lastIndexOf("}")+1);i=JSON.parse(s)}catch(ae){S.error("[login]json error:",ae),this.process(w.ERROR);var a={logtype:_t.ERROR,subtype:pt.DEFAULT,errcode:lt.LOGIN_JSON_PARSE_ERR};return void this.realtime_logmonitor_.request(a)}if(null!=i){var c=i[Wt.get(Vt.OID_STAT)];if(null==c||c!==Gt.OID_VAL_SUCCESS)return S.error("[Login]result code:",c||"unkonw"),void this.process(w.FAIL);S.log("[Login]result code:",c),e.asn_str_=i[Wt.get(Vt.ASN)],e.asn_code_=parseInt(e.asn_str_),e.area_str_=i[Wt.get(Vt.LOCATION)],e.location_code_=(255&parseInt(e.area_str_))%100,e.location_str_=e.location_code_.toString(),wt.initLocationULong(e.location_code_),e.local_login_time_stamp_ms_=(new Date).getTime();var u=i[Wt.get(Vt.TIMESTAMP)];u?(e.server_current_time_stamp_ms_=1e3*parseInt(u),S.log("[Login]server tm:",u)):e.server_current_time_stamp_ms_=(new Date).getTime(),e.server_current_tickcount_=dt.getTickCountMs(),e.log_code_=this.getValue(i[Wt.get(Vt.LOGCODE)],"0");var h=i[Wt.get(Vt.ADDR)],d=h[Wt.get(Vt.TRACKER)],l=h[Vt.PGW],_=h[Vt.CPS];this.is_https_?(Rt.trackerURL="https://"+d[Wt.get(Vt.TRK_ADDR)]+":"+d[Wt.get(Vt.TRK_TCP_PORT)],Rt.pgwURL="https://"+l[Wt.get(Vt.TRK_ADDR)],Rt.cpsURL="https://"+_[Wt.get(Vt.TRK_ADDR)]):(Rt.trackerURL="http://"+d[Wt.get(Vt.TRK_ADDR)]+":"+d[Wt.get(Vt.TRK_TCP_PORT)],Rt.pgwURL="http://"+l[Wt.get(Vt.TRK_ADDR)],Rt.cpsURL="http://"+_[Wt.get(Vt.TRK_ADDR)]),Rt.wdcURL=Rt.pgwURL,S.log("[Login]trackerURL:",Rt.trackerURL),S.log("[Login]pgwURL:",Rt.pgwURL),S.log("[Login]cpsURL:",Rt.cpsURL);var p=i[Vt.SIGNAL];null!=p&&(Rt.mqtt_username_=p[Vt.SIGNAL_USER_GROUP_ID],Rt.mqtt_pwd_=p[Vt.SIGNAL_PASSWORD]);var f=i[Vt.STUN];null!=f&&(Rt.STUN_USER_ID=f[Vt.STUN_USER_ID],Rt.STUN_PASSWORD=f[Vt.STUN_PASSWORD]);var b=h[Vt.SIGNAL_WSS],g=h[Vt.SIGNAL_WS];this.is_https_?null!=b&&(Rt.mqtt_host_=b[Vt.HOST],Rt.mqtt_port_=b[Vt.PORT]):null!=g&&(Rt.mqtt_host_=b[Vt.HOST],Rt.mqtt_port_=b[Vt.PORT]);var m=h[Vt.STUN];null!=m&&(Rt.STUN_HOST=m[Vt.HOST],Rt.STUN_PORT=m[Vt.PORT]);var y="stun:"+Rt.STUN_HOST+":"+Rt.STUN_PORT;Rt.ICE_SERVERS={iceServers:[{urls:[y],username:Rt.STUN_USER_ID,credential:Rt.STUN_PASSWORD}]};var v=i[Vt.OM_CONFIG];null!=v&&this.parseOMConfig(v),e.use_pgw_?(S.log("[Login]Use pgw."),Rt.csnURL=Rt.pgwURL):(S.log("[Login]Use bgw."),Rt.csnURL=Rt.trackerURL,Rt.cpsURL=Rt.trackerURL);var R=h[Vt.CCD];e.dm_=e.dms_=R[Wt.get(Vt.TRK_ADDR)],S.log("[Login]csnURL: ",Rt.csnURL," cpsURL: ",Rt.cpsURL),S.log("[Login]success."),this.process(w.SUCCESS)}else{S.error("[login]json null."),this.process(w.FAIL);var T={logtype:_t.ERROR,subtype:pt.DEFAULT,errcode:lt.LOGIN_JSON_PARSE_ERR};this.realtime_logmonitor_.request(T)}},t.prototype.parseConfig=function(t){for(var e=!1,r=0;r<t.length;++r){var n=t[r],i=n[Wt.get(Vt.DOMAIN)];if(null!=i&&0!==i.length){var o=n[Vt.FLASH_CONTROL_CONS];Ht.set(i,o,!1)>=0&&(e=!0)}else S.error("[domain]domain null.")}return e},t.prototype.getInt=function(t,e){return t?parseInt(t):e},t.prototype.getIntCheckMin=function(t,e,r){var n=this.getInt(t,e);return n<r&&(n=r),n},t.prototype.getFloat=function(t,e){return t?parseFloat(t):e},t.prototype.getBoolean=function(t,e){return t?!!parseInt(t):e},t.prototype.parseOMConfig=function(t){var r=null;try{r=JSON.parse(t)}catch(ae){}S.log(typeof t,t,null!=r),null!=r&&(e.is_use_p2p_=this.getBoolean(r[Vt.USE_P2P],e.is_use_p2p_),e.is_use_proxy_=this.getBoolean(r[Vt.USE_PROXY],e.is_use_proxy_),e.use_edge_per_=this.getFloat(r[Vt.USE_EDGE_PER],e.use_edge_per_),e.force_peakmode_=this.getBoolean(r[Vt.FORCE_PEAKMODE],e.force_peakmode_),e.is_send_realtime_log_=this.getBoolean(r[Vt.REAL_LOG_EN],e.is_send_realtime_log_),e.is_send_wdc_log_=this.getBoolean(r[Vt.WDC_LOG_EN],e.is_send_wdc_log_),e.cdn_limit_duration_seconds_=this.getFloat(r[Vt.CDN_DURATION],e.cdn_limit_duration_seconds_),e.edge_limit_duration_seconds_=this.getFloat(r[Vt.EDGE_DURATION],e.edge_limit_duration_seconds_),e.chunk_width_KB_=this.getInt(r[Vt.CHUNK_WIDTH_KB],e.chunk_width_KB_),e.memory_pool_length_=this.getInt(r[Vt.MEMORY_POOL_LENGTH],e.memory_pool_length_),e.max_ts_count_=this.getInt(r[Vt.MAX_TS_COUNT],e.max_ts_count_),e.p2p_concurrent_request_count_=this.getInt(r[Vt.P2P_CONCURRENT_REQUEST_COUNT],e.p2p_concurrent_request_count_),e.cdn_connect_timeout_ms_=this.getInt(r[Vt.CDN_CONNECT_TIMEOUT_MS],e.cdn_connect_timeout_ms_),e.cdn_retry_max_count_=this.getInt(r[Vt.CDN_RETRY_MAX_COUNT],e.cdn_retry_max_count_),e.cdn_timeout_done_=this.getBoolean(r[Vt.CDN_TIMEOUT_DONE],e.cdn_timeout_done_),e.address_ergent_dx_seconds_=this.getInt(r[Vt.ADDRESS_ERENGT_DX],e.address_ergent_dx_seconds_),e.max_peer_count_=this.getInt(r[Vt.MAX_PEER_COUNT],e.max_peer_count_),e.disconnect_max_peer_count_=this.getInt(r[Vt.disconnect_max_peer_count_],e.disconnect_max_peer_count_),e.max_edge_count_=this.getInt(r[Vt.MAX_EDGE_COUNT],e.max_edge_count_),e.protocal_net_timeout_ms_=this.getInt(r[Vt.PROTOCAL_NET_TIMEOUT_MS],e.protocal_net_timeout_ms_),e.p2p_connect_timeout_ms_=this.getInt(r[Vt.P2P_CONNECT_TIMEOUT_MS],e.p2p_connect_timeout_ms_),e.p2p_rtc_offer_timeout_ms_=this.getInt(r[Vt.P2P_RTC_OFFER_TIMEOUT_MS],e.p2p_rtc_offer_timeout_ms_),e.p2p_top_list_size_=this.getInt(r[Vt.P2P_TOP_LIST_SIZE],e.p2p_top_list_size_),e.p2p_max_requsting_cn_=this.getInt(r[Vt.P2P_MAX_REQUSTING_CN],e.p2p_max_requsting_cn_),e.p2p_per_max_connect_count_=this.getInt(r[Vt.P2P_PER_MAX_CONNECT_COUNT],e.p2p_per_max_connect_count_),e.p2p_connect_retry_interval_=this.getInt(r[Vt.P2P_CONNECT_RETRY_MS],e.p2p_connect_retry_interval_),e.p2p_all_cdn_ratio_=this.getFloat(r[Vt.P2P_ALL_CDN_RATIO],e.p2p_all_cdn_ratio_),e.p2p_requst_timer_ms_=this.getInt(r[Vt.P2P_REQUST_TIMER_MS],e.p2p_requst_timer_ms_),e.p2p_requst_mn_timeout_ms_=this.getInt(r[Vt.P2P_REQUST_MN_TIMEOUT_MS],e.p2p_requst_mn_timeout_ms_),e.p2p_requst_min_timeout_ms_=this.getInt(r[Vt.P2P_REQUST_MIN_TIMEOUT_MS],e.p2p_requst_min_timeout_ms_),e.p2p_requst_middle_timeout_ms_=this.getInt(r[Vt.P2P_REQUST_MIDDLE_TIMEOUT_MS],e.p2p_requst_middle_timeout_ms_),e.p2p_requst_max_timeout_ms_=this.getInt(r[Vt.P2P_REQUST_MAX_TIMEOUT_MS],e.p2p_requst_max_timeout_ms_),e.p2p_loader_expire_ms_=this.getInt(r[Vt.P2P_LOADER_EXPIRE_MS],e.p2p_loader_expire_ms_),e.p2p_loader_use_edge_ms_=this.getInt(r[Vt.P2P_LOADER_USE_EDGE_MS],e.p2p_loader_use_edge_ms_),e.p2p_close_unactive_dx_ms_=this.getInt(r[Vt.P2P_CLOSE_UNACTIVE_DX_MS],e.p2p_close_unactive_dx_ms_),e.p2p_first_multi_request_count_=this.getFloat(r[Vt.P2P_FIRST_MULTI_REQUEST_COUNT],e.p2p_first_multi_request_count_),e.send_realtime_log_per_=this.getFloat(r[Vt.SEND_REALTIMELOG_PER],e.send_realtime_log_per_),e.send_wdc_log_per_=this.getFloat(r[Vt.SEND_WDCLOG_PER],e.send_wdc_log_per_),e.calculate_speed_cdn_per_=this.getFloat(r[Vt.CALCULATE_SPEED_CDN_PER],e.calculate_speed_cdn_per_),e.calculate_speed_p2p_per_=this.getFloat(r[Vt.CALCULATE_SPEED_P2P_PER],e.calculate_speed_p2p_per_),e.send_address_log_per_=this.getFloat(r[Vt.send_address_log_per_],e.send_address_log_per_),e.send_ccd_dx_seconds_=this.getInt(r[Vt.send_ccd_dx_seconds_],e.send_ccd_dx_seconds_),e.send_rl_dx_seconds_=this.getInt(r[Vt.send_rl_dx_seconds_],e.send_rl_dx_seconds_),e.send_ccd_timeout_seconds_=this.getInt(r[Vt.send_ccd_timeout_seconds_],e.send_ccd_timeout_seconds_),e.send_ccd_retry_cn_=this.getInt(r[Vt.send_ccd_retry_cn_],e.send_ccd_retry_cn_),e.download_roi_min_dx_ms_=this.getInt(r[Vt.download_roi_min_dx_ms_],e.download_roi_min_dx_ms_),e.publish_have_ts_per_=this.getFloat(r[Vt.PUBLISH_TS_PER],e.publish_have_ts_per_),e.publish_sub_have_ts_per_=this.getFloat(r[Vt.PUBLISH_SUB_TS_PER],e.publish_sub_have_ts_per_),e.subrid_batch_size_=this.getInt(r[Vt.SUBRID_BATCH_SIZE],e.subrid_batch_size_),e.publish_batch_size_=this.getInt(r[Vt.PUBLISH_BATCH_SIZE],e.publish_batch_size_),e.del_batch_size_=this.getInt(r[Vt.DEL_BATCH_SIZE],e.del_batch_size_),e.rid_no_control_=this.getBoolean(r[Vt.rid_no_control_],e.rid_no_control_),e.use_pgw_=this.getBoolean(r[Vt.use_pgw_],e.use_pgw_),e.change_resize_=this.getBoolean(r[Vt.change_resize_],e.change_resize_),e.db_max_used_space_=this.getInt(r[Vt.DB_MAX_USED_SPACE],e.db_max_used_space_),e.p2p_ignore_zero_peers_=this.getBoolean(r[Vt.P2P_IGNORE_ZERO_PEERS],e.p2p_ignore_zero_peers_),e.db_read_timeout_ms_=this.getInt(r[Vt.DB_READ_TIMEOUT],e.db_read_timeout_ms_),e.core_req_timeout_ms_=this.getInt(r[Vt.CORE_REQ_TIMEOUT],e.core_req_timeout_ms_),e.report_wdc_time_sec_=this.getFloat(r[Vt.REPORT_WDC_TM],e.report_wdc_time_sec_),e.lv2_cache_count_=this.getInt(r[Vt.ALG_MAX_LEVEL2_CACHE_COUNT],e.lv2_cache_count_),e.rtc_not_close_=this.getInt(r[Vt.RTC_NOT_CLOSE],e.rtc_not_close_),e.use_m3u8_filesize_=this.getBoolean(r[Vt.USE_M3U8_FILESIZE],e.use_m3u8_filesize_))},t.prototype.getReceiveData=function(t){var e=N.enc.Hex.parse(t),r=N.enc.Base64.stringify(e);return N.AES.decrypt(r,N.enc.Utf8.parse(wt.getVal1()),{iv:N.enc.Utf8.parse(wt.getVal2()),mode:N.mode.CBC,padding:N.pad.Pkcs7}).toString(N.enc.Utf8).toString()},t.prototype.hexStringToUint8Array=function(t){if(t.length%2!=0)throw"Invalid hexString";for(var e=new Uint8Array(t.length/2),r=0;r<t.length;r+=2){var n=parseInt(t.substr(r,2),16);if(isNaN(n))throw"Invalid hexString";e[r/2]=n}return e},t.prototype.tryAddress=function(){0===ft.getLoginErrTimes()&&(S.warn("[Login]timeout retry..."),this.request())},t.timeout_ms_=15e3,t}(),Xt=function(){function t(t){this.isPublish_=t,this.http_request_=new vt(this.callback.bind(this)),this.realtime_logmonitor_=new Tt}return t.prototype.request=function(t){var r=e.protocal_net_timeout_ms_,n=this.getRequestData(t),i=Rt.csnURL+(this.isPublish_?"/publish":"/unPublish");S.is_debug()&&S.log(this.isPublish_?"[publish]..":"[unpublish]",", peerid:",e.pcdn_peer_id_,", rids:",t),this.http_request_.post(i,r,n,"fb")},t.prototype.getRequestData=function(t){var r=new Et.Builder(1024);try{var n=r.createString("");Pt.Peer.startPeer(r),Pt.Peer.addPid(r,Pt.PeerId.createPeerId(r,wt.get_peerid_v1(e.pcdn_peer_id_),wt.get_peerid_v2(e.pcdn_peer_id_),wt.get_peerid_v3(e.pcdn_peer_id_)));var i=Pt.Peer;i.addPeerAbility(r,e.ability_val_hls_vod_),i.addNetAbility(r,e.live_net_ability_),i.addVersion(r,wt.GetVersionULong()),i.addAsn(r,e.asn_code_),i.addLoc(r,wt.getLocationULong()),i.addPeerLevel(r,e.peer_level_),i.addQuality(r,e.live_peer_quality_),i.addAddressInfo(r,n),i.addPublished(r,!1);var o=i.endPeer(r),s=[];if(t.forEach((function(t,n,i){var o=r.createString(""),a=Pt.Resource;a.startResource(r),a.addRid(r,Pt.Rid.createRid(r,wt.get_rid_v1(t),wt.get_rid_v2(t),wt.get_rid_v3(t),wt.get_rid_v4(t))),a.addDomain(r,o),a.addServiceType(r,e.vod_server_type_);var c=a.endResource(r);s.push(c)})),this.isPublish_){var a=Pt.PublishRequest.createRessVector(r,s);Pt.PublishRequest.startPublishRequest(r),Pt.PublishRequest.addPeer(r,o),Pt.PublishRequest.addRess(r,a);var c=Pt.PublishRequest.endPublishRequest(r);r.finish(c)}else{a=Pt.UnPublishRequest.createRessVector(r,s);Pt.UnPublishRequest.startUnPublishRequest(r),Pt.UnPublishRequest.addPeer(r,o),Pt.UnPublishRequest.addRess(r,a);c=Pt.UnPublishRequest.endUnPublishRequest(r);r.finish(c)}}catch(ae){var u={logtype:_t.ERROR,subtype:pt.DEFAULT,errcode:lt.PUBLISH_ARG_ERR,ext:ae};S.error("[publish] report PUBLISH_ARG_ERR."),this.realtime_logmonitor_.request(u)}return r.asUint8Array()},t.prototype.callback=function(t,e){if(null==t)if(this.isPublish_)try{var r=new Uint8Array(e),n=new Et.ByteBuffer(r),i=Pt.PublishResponse.getRootAsPublishResponse(n);if(null!=i){var o=i.ressLength();S.log("[publish][callback]n=",o)}else S.error("[publish][callback]empty.")}catch(ae){S.log("[publish][callback]fb error:",ae)}else try{r=new Uint8Array(e),n=new Et.ByteBuffer(r);var s=Pt.UnPublishResponse.getRootAsUnPublishResponse(n);if(null!=s){o=s.ressLength();S.log("[unpublish][callback]n=",o)}else S.error("[unpublish][callback]empty.")}catch(ae){S.log("[unpublish][callback]fb error:",ae)}else{var a={logtype:_t.ERROR,subtype:pt.DEFAULT,errcode:this.isPublish_?lt.PUBLISH_STATUS_ERR:lt.UNPUBLISH_STATUS_ERR,ext:t};this.realtime_logmonitor_.request(a),"timeout"==t?S.warn("[publish][callback]timeout, isUnpublish:",!this.isPublish_):S.warn("[publish][callback]net error, isUnpublish:",!this.isPublish_)}},t}(),Zt=function(){function t(t){this.rid_=t,this.clients_=new Set,this.edge_cnts_=0,this.sorted_clients_=[]}return t.prototype.get_cliets=function(){return this.clients_},t.prototype.sort_clients=function(){this.sorted_clients_.sort((function(t,e){return e.score_-t.score_}))},t.prototype.size=function(){return this.clients_.size},t.prototype.edge_size=function(){return this.edge_cnts_},t.prototype.is_empty=function(){return 0==this.clients_.size},t.prototype.push_client=function(t){this.clients_.has(t)||(this.clients_.add(t),this.sorted_clients_.push(t),t.is_edge_&&this.edge_cnts_++,S.log("[P2pSet][push_client]peerid:",t.peerid_,", clients size:",this.clients_.size,", sorted array size:",this.sorted_clients_.length,", edge cnt:",this.edge_cnts_))},t.prototype.remove_client=function(t,e){if(this.clients_.has(t)&&(this.clients_.delete(t),t.is_edge_&&this.edge_cnts_--,e)){var r=this.sorted_clients_.indexOf(t);-1==r&&S.error("[P2pSet][remove_client]sorted_clients_ miss, pid:",t.peerid_),this.sorted_clients_.splice(r,1),S.log("[P2pSet][remove_client]peerid:",t.peerid_,", clients size:",this.clients_.size,", sorted array size:",this.sorted_clients_.length)}},t.prototype.hasGoodClientVod=function(t,r){var n,i,o=!1,s=Math.round(e.p2p_all_cdn_ratio_*this.clients_.size);s<=0&&(s=1);try{for(var a=y(this.clients_),c=a.next();!c.done;c=a.next()){c.value.hasTs(t,r)&&0==--s&&(o=!0)}}catch(u){n={error:u}}finally{try{c&&!c.done&&(i=a.return)&&i.call(a)}finally{if(n)throw n.error}}return S.log("[P2pSet][hasGoodClientVod] clients_size: ",this.clients_.size," p2p_all_cdn_ratio_: ",e.p2p_all_cdn_ratio_," left cn: ",s," ret:",o),o},t.prototype.requestP2P=function(t,e,r,n,i,o){var s,a;S.rtclog("[P2pSet][requestP2P]file_size:",t,", sn:",e,", mns:",r,", dwning_size:",i.size,", clients_size: ",this.clients_.size,", sorted_clients_size: ",this.sorted_clients_.length);try{for(var c=y(this.sorted_clients_),u=c.next();!u.done;u=c.next()){var h=u.value;if(h.getCanRequestCount(this.rid_,e,n,o)>0&&h.hasTs(this.rid_,e)){var d=r.splice(0,1);h.requestP2P(this.rid_,t,e,d,n,i)}if(0==r.length)break}}catch(l){s={error:l}}finally{try{u&&!u.done&&(a=c.return)&&a.call(c)}finally{if(s)throw s.error}}},t.prototype.updateSubRidClient=function(t){var e,r,n=wt.getRootRid(t),i=wt.getSubBeginSn(t),o=[];try{for(var s=y(this.clients_),a=s.next();!a.done;a=s.next()){var c=a.value;c.hasSubRid(n,i)?o.push(c):(S.log("[P2pSet][updateSubRidClient] miss_next_sub_rid, delete, peer_id:",c.peerid_),this.remove_client(c,!1),c.close(Ot.unActived,!0,!1))}}catch(u){e={error:u}}finally{try{a&&!a.done&&(r=s.return)&&r.call(s)}finally{if(e)throw e.error}}this.sorted_clients_=o,this.sort_clients()},t.prototype.closeAll=function(t){var e,r;try{for(var n=y(this.clients_),i=n.next();!i.done;i=n.next()){var o=i.value;t.has(o)||(S.log("[rtc][p2p][closeAll][closeRtc]uuid:",o.uuid_),o.close(Ot.unActived,!0,!1))}}catch(s){e={error:s}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(e)throw e.error}}},t}(),Qt=function(){function t(t,r,n,i,o,s,a,c,u,h,d){this.rid_="",this.sn_=0,this.tempTsTask_=new yt(-1),this.tsLength_=0,this.url_="",this.isLoading_=!1,this.isAllFinished_=!1,this.isDestroyed_=!1,this.loadedSize_=0,this.loadIndex_=0,this.timer_=null,this.downingMns_=new Map,this.use_edge_=!1,this.chunkWidthKB_=t,this.p2pSet_=n,this.rid_=i,this.did_=o,this.sn_=s,this.tsLength_=e.use_m3u8_filesize_?a:0,this.url_=r,this.tsTask_=c,this.onLoadFinish_=u,this.onFilesize_=h,this.onLoadError_=d,this.tsTask_.pc_=this,this.tempTsTask_.pc_=this,this.realtime_logmonitor_=new Tt}return t.prototype.stopTimer=function(){null!=this.timer_&&(window.clearInterval(this.timer_),this.timer_=null,this.downingMns_.clear())},t.prototype.checkStartTimer=function(){this.timer_},t.prototype.isDwningMn=function(t){return this.downingMns_.has(t)},t.prototype.onTimer=function(){var t,r;if(null!=this.downingMns_){var n=dt.nowMs(),i=n-e.p2p_requst_mn_timeout_ms_;try{for(var o=y(this.downingMns_),s=o.next();!s.done;s=o.next()){var a=v(s.value,2),c=a[0],u=a[1];u<i&&(this.downingMns_.delete(c),S.rtclog("[p2p][timer][timeout]sn:",this.sn_,",mn:",c,",dx=",n-u))}}catch(h){t={error:h}}finally{try{s&&!s.done&&(r=o.return)&&r.call(o)}finally{if(t)throw t.error}}this.isAllFinished_||(this.multipleLoad(null),S.rtclog("[p2p][timer][requsting]cn:",this.downingMns_.size))}},t.prototype.OnTsPeerTsDataComplete=function(t){this.p2pSet_&&this.loadHandler(t,null)},t.prototype.setUseEdge=function(t){this.use_edge_=t},t.prototype.load=function(){if(this.isLoading_)return S.log("[P2PClient][down][p2p][loading]"," rid:",this.rid_," sn:",this.sn_),void this.onTimer();Ct.P2PManager.instance().engine_.SendP2PBeginToPlayer(this.sn_),S.log("[P2PClient][down][p2p]"," rid:",this.rid_," sn:",this.sn_,", file_size:",this.tsLength_),this.isLoading_=!0;var r=t.P2PManager.instance();r.on(C(this.rid_,this.sn_),this.onP2PData.bind(this)),r.on(E(this.rid_,this.sn_),this.OnTsPeerTsDataComplete.bind(this)),this.tsLength_>0?(this.initChunkList(this.tsLength_),this.multipleLoad(null)):(this.tempTsTask_.init(1024*this.chunkWidthKB_*e.p2p_first_multi_request_count_,this.chunkWidthKB_),this.multipleLoad(null))},t.prototype.destory=function(){if(!this.isDestroyed_){this.isDestroyed_=!0,this.stopTimer();var e=t.P2PManager.instance();e.off(C(this.rid_,this.sn_),this.onP2PData.bind(this)),e.off(E(this.rid_,this.sn_),this.OnTsPeerTsDataComplete.bind(this)),this.onLoadFinish_=null,this.onFilesize_=null,this.onLoadError_=null,this.p2pSet_=null}},t.prototype.onP2PData=function(t,e,r,n,i,o,s,a){if(s&&(a.is_edge_?ft.T2_add(s.byteLength):ft.T3_add(s.byteLength)),this.isAllFinished_||this.isDestroyed_)s&&S.log("[onP2PData]waste:ts finish,uuid:",a.uuid_,",sn:",e,",mn:",r,",byte:",s.byteLength);else{if(e!==this.sn_||n!==this.chunkWidthKB_||t!==this.rid_)return t!==this.rid_&&ft.recordP2pDataError(201),void S.warn("[P2PClient][onP2PData]waste:fail,obj:",JSON.stringify({pid:a.peerid_,rid:t,sn:e,chunkWidthKB:n}),",this:",JSON.stringify({rid:this.rid_,sn:this.sn_,chunkWidthKB:this.chunkWidthKB_}));if(o<=0)return S.log("[P2PClient][onP2PData]no data,pid:",a.peerid_,",rid:",this.rid_,",sn:",this.sn_," "),void(r<this.tsTask_.getChunkCount()&&(this.downingMns_.delete(r),S.log("[P2PClient][onP2PData]no data,downingMns_ delete mn:",r)));var c=!1;0===this.tsLength_&&(this.initChunkList(o),c=!0,S.log("[P2PClient][onP2PData]",",Setup Chunk List"," sn:",this.sn_)),this.tsTask_.isInited?r>=this.tsTask_.getChunkCount()?S.warn("[P2PClient][onP2PData]waste:fail,pid:",a.peerid_,",sn:",e,",mn:",r,">this.mn:",this.tsTask_.getChunkCount()-1,",byte:",s?s.byteLength:0):this.tsTask_.isChunkFinished(r)?S.is_debug()&&s&&S.log("[onP2PData]waste:mn,finish,uuid:",a.uuid_,",sn:",e,",mn:",r,",byte:",s.byteLength):(s&&s.byteLength>0&&this.tsTask_.getChunkSize(r)===s.byteLength&&this.tsLength_===o?(this.loadFinishHandler(r,s),S.rtclog("[P2PClient][onP2PData]chunk finish"," sn:",this.sn_," mn:",r),c||this.loadHandler(a,null)):this.loadFailHandler(e,r,o,s,a),this.tsLength_&&(ft.loadMode=I.P2P,ft.tsSn=this.sn_,ft.loadSize=this.loadedSize_>this.tsLength_?this.tsLength_:this.loadedSize_,ft.totalSize=this.tsLength_),c&&this.multipleLoad(a)):S.warn("[P2PClient][onP2PData]waste:chunkList null:",a.peerid_,",sn:",e,",mn:",r,",byte:",s?s.byteLength:0)}},t.prototype.multipleLoad=function(t){this.p2pSet_&&this.loadHandler(t,null)},t.prototype.loadHandler=function(t,r){if(this.isAllFinished_||this.isDestroyed_)return S.log("[P2PClient][loadHandler]task all finished, rid:",this.rid_,", sn:",this.sn_),!1;var n=this.tsTask_.isInited?this.tsTask_:this.tempTsTask_;if(!n.isInited)return S.log("[P2PClient][loadHandler]task not init, rid:",this.rid_,", sn:",this.sn_),!1;this.loadIndex_>=n.getChunkCount()&&(this.loadIndex_=0);for(var i=t;i;){var o=i.getCanRequestCount(this.rid_,this.sn_,this.chunkWidthKB_,this.use_edge_);if(o<=0)break;var s=[];if(0==n.findUnfinishTaskArray(this.loadIndex_,o,s))return this.isAllFinished_=!0,this.onLoadFinish_&&this.onLoadFinish_(!0),!0;if(0==s.length)return!1;if(i.hasTs(this.rid_,this.sn_)?o=i.requestP2P(this.rid_,this.tsLength_,this.sn_,s,this.chunkWidthKB_,this.downingMns_):i.miss_ts_count_++,o<=0)break;return this.loadIndex_=s[s.length-1]+1,!0}if(!this.p2pSet_)return S.log("[P2PClient][loadHandler]no p2p set, rid:",this.rid_,", sn:",this.sn_),!1;var a=[],c=n.findUnfinishTaskArray(this.loadIndex_,e.p2p_concurrent_request_count_,a);return S.log("[P2PClient][loadHandler], rid:",this.rid_,", sn:",this.sn_,", mns:",a,", max_cn:",c),0==c?(this.isAllFinished_=!0,this.onLoadFinish_&&this.onLoadFinish_(!0),!0):0!=a.length&&(this.loadIndex_=a[a.length-1]+1,this.p2pSet_.requestP2P(this.tsLength_,this.sn_,a,this.chunkWidthKB_,this.downingMns_,this.use_edge_),a.length>0&&(this.loadIndex_=a[0]),!(a.length>0))},t.prototype.loadFinishHandler=function(t,e){ft.T4_add(e.byteLength),this.downingMns_.delete(t),0==this.tsTask_.setBuffer(t,e)&&(this.loadedSize_+=e.byteLength)},t.prototype.loadFailHandler=function(t,e,r,n,i){var o;n&&n.byteLength>0&&r>0?(o="invalid_chunk_len",S.warn("[P2PClient][loadFailHandler]chunk error,pid:",i.peerid_,",sn:",t,",mn:",e,",buf.len:",n.byteLength,",chunk.size:",this.tsTask_.getChunkSize(e),",obj.tslen:",r,",tslen:",this.tsLength_)):r!=this.tsLength_?(o="unmatch_tslen",S.log("[P2PClient][loadFailHandler]unmatch_tslen,pid:",i.peerid_,",sn:",t,",mn:",e)):(o="unmatch_chunk",S.log("[P2PClient][loadFailHandler]no data,pid:",i.peerid_,",sn:",t,",mn:",e)),this.downingMns_.delete(e);var s={logtype:_t.ERROR,subtype:pt.P2PERR,errcode:lt.P2P_TS_DL_ERR,ext:o};this.realtime_logmonitor_.request(s)},t.prototype.initChunkList=function(t){if(this.tsLength_=t,this.tsTask_.init(this.tsLength_,this.chunkWidthKB_),this.tempTsTask_.isInited){for(var e=0;e<this.tsTask_.getChunkCount()&&!(e>=this.tempTsTask_.getChunkCount());e++){var r=this.tempTsTask_.getBuffer(e);r&&this.tsTask_.setBuffer(e,r.buffer)}this.tempTsTask_.destory()}this.onFilesize_&&this.onFilesize_(this.tsLength_)},t}();Ct.P2PClient=Qt;var Yt=function(){function t(t,r,n,i,o,s,a,c,u){this.timeout_=0,this.timeCleanId_=void 0,this.retryTimes_=0,this.retryMaxCount_=0,this.sn_=0,this.url_="",this.tsLength_=0,this.isLoading_=!1,this.isAbort_=!1,this.httpRequest_=null,this.fastRetry_=!0,this.rootRid_="",this.timeout_=e.cdn_connect_timeout_ms_,this.retryMaxCount_=e.cdn_retry_max_count_,this.chunkWidthKB_=t,this.url_=r,this.rootRid_=n,this.sn_=i,this.tsLength_=0,this.tsTask_=s,this.onLoadFinish_=a,this.onFilesize_=c,this.onLoadError_=u}return t.prototype.load=function(){this.isLoading_?S.log("[CdnClient][down][cdn][loading]sn:",this.sn_,",url:",this.url_):(Ct.P2PManager.instance().engine_.SendDownBeginToPlayer(this.url_),this.isLoading_=!0,this.parseBufferLength(!1),this.request(),this.startTimeout(),S.log("[CdnClient][down][cdn]sn:",this.sn_,",url:",this.url_))},t.prototype.request=function(){var t=new XMLHttpRequest;this.httpRequest_=t,t.responseType="arraybuffer",t.onreadystatechange=this.onStateChange.bind(this),t.onprogress=this.onProgress.bind(this),t.onerror=this.onLoadError.bind(this),t.open("GET",this.url_,!0),t.send()},t.prototype.destory=function(){this.isAbort_=!0,this.httpRequest_&&this.httpRequest_.abort(),this.httpRequest_=null,this.onLoadFinish_=null,this.onFilesize_=null,this.stopTimeout()},t.prototype.setUseEdge=function(t){},Object.defineProperty(t.prototype,"isLoading",{get:function(){return this.isLoading_},enumerable:!1,configurable:!0}),t.prototype.onStateChange=function(){if(this.httpRequest_&&!this.isAbort_)switch(this.httpRequest_.readyState){case 0:case 1:break;case 2:this.parseBufferLength(!1),e.cdn_timeout_done_||this.stopTimeout();break;case 3:break;case 4:this.parseBufferLength(!0),e.cdn_timeout_done_&&this.stopTimeout(),this.loadFinishHandler()}},t.prototype.onProgress=function(t){this.isAbort_||this.tsLength_&&t&&t.loaded&&(ft.loadMode=I.CDN,ft.tsSn=this.sn_,ft.loadSize=t.loaded,ft.totalSize=this.tsLength_)},t.prototype.parseBufferLength=function(t){if(this.tsLength_>0)this.tsTask_.isInited||this.initChunkList();else if(this.httpRequest_&&200===this.httpRequest_.status){var e=null;if(t){var r=this.httpRequest_.response;r&&r.byteLength>0&&(e=r.byteLength.toString())}else try{e=this.httpRequest_.getResponseHeader("Content-Length")}catch(ae){S.log("[CdnClient] parseBufferLength() failed"," e:",ae)}null!==e&&(this.tsLength_=parseInt(e),this.initChunkList())}},t.prototype.loadFinishHandler=function(){if(!this.isAbort_){if(!this.httpRequest_||200!==this.httpRequest_.status)return null!=this.httpRequest_&&null!=this.httpRequest_.status&&(S.log("[CdnClient] loadFinishHandler()"," http status:",this.httpRequest_.status),206!==this.httpRequest_.status&&this.recordRequestError(this.httpRequest_.status)),void this.fastRetry();var t=this.httpRequest_.response;if(!t||t.byteLength<5)return S.log("[CdnClient] loadFinishHandler() buffer size error, sn:",this.sn_," url:",this.url_),this.recordRequestError(601),void this.fastRetry();ft.T1_add(t.byteLength),ft.T4_add(t.byteLength),this.tsTask_.writeAllData(t),this.onLoadFinish_&&this.onLoadFinish_(!1),S.log("[CdnClient] loadFinishHandler()"," sn:",this.sn_)}},t.prototype.recordRequestError=function(t){var e=ft.cdnErrRecordMap_.get(t);null!=e?(e+=1,ft.cdnErrRecordMap_.set(t,e)):ft.cdnErrRecordMap_.set(t,1)},t.prototype.initChunkList=function(){this.tsTask_.init(this.tsLength_,this.chunkWidthKB_),this.onFilesize_&&this.onFilesize_(this.tsLength_),S.log("[CdnClient] initChunkList()"," sn:",this.sn_," tsLength_:",this.tsLength_)},t.prototype.onLoadError=function(){S.log("[CdnClient] onLoadError()"," sn:",this.sn_),this.isAbort_||this.fastRetry()},t.prototype.startTimeout=function(){this.timeCleanId_=window.setTimeout(this.onTimeout.bind(this),this.timeout_)},t.prototype.onTimeout=function(){S.log("[CdnClient] onTimeout()"," sn:",this.sn_),this.recordRequestError(602),this.isAbort_||this.retry()},t.prototype.stopTimeout=function(){-1!==this.timeCleanId_&&(window.clearTimeout(this.timeCleanId_),this.timeCleanId_=-1)},t.prototype.fastRetry=function(){this.fastRetry_?(this.retry(),this.fastRetry_=!1):this.onLoadError_&&this.onLoadError_()},t.prototype.retry=function(){if(this.httpRequest_&&!this.isAbort_){var t=this.httpRequest_;this.httpRequest_=null,t.abort(),this.retryTimes_>=this.retryMaxCount_?this.onLoadError_&&this.onLoadError_():(this.request(),this.stopTimeout(),this.startTimeout(),this.retryTimes_++,S.log("[CdnClient] retry()"," sn:",this.sn_))}},t}(),Jt=function(){function t(t){this.sendBuffer_=null,this.is_https_=!0,this.retry_cn_=0,this.data_=t}return t.prototype.send=function(){this.sendBuffer_=this.makeData(),this.postBuffer()},t.prototype.postBuffer=function(){if(null!=this.sendBuffer_){var t=wt.getSS(this.is_https_);new vt(this.callback.bind(this)).post(t,1e3*e.send_ccd_timeout_seconds_,this.sendBuffer_,"fb")}},t.prototype.makeData=function(){var t="KL",r="peer",n=e.pcdn_peer_id_+"\t"+e.asn_str_+"\t"+e.location_str_+"\t"+e.location_str_+"\thtml5\t"+L.version,i=e.module_name_prefix_+e.oid_send_+"-"+e.cid_+"-"+e.module_name_suffix_,o=wt.getDomin(this.data_.m3u8url),s="",a=Math.floor(dt.nowMs()/1e3);s+=e.oid_send_+"\t",s+=e.cid_+"\t",s+="0\t",s+=o+"\t",s+="1\t";var c=a.toString(16);s+=e.log_code_+c+"01\t",s+=a.toString()+"\t",s+=this.data_.t1.toString(10)+"\t",s+=this.data_.t2.toString(10)+"\t",s+=this.data_.t3.toString(10)+"\t",s+=this.data_.t4.toString(10)+"\t",s+=this.data_.t5.toString(10)+"\t",s+="0\t",s+="0\t",s+=this.data_.t8.toString(10)+"\t",s+="0\t",s+="0\t",s+="0\t",s+="0\t",s+="0\t",s+="0\t",s+="0\t",s+="0\t",s+="0\t",s+="0\t",s+="0\t",s+=e.ccd_type_value_;var u=e.module_name_prefix_+e.oid_send_+"-"+e.cid_+"-"+e.module_name_plx_,h="";h+=e.oid_send_+"\t",h+=e.cid_+"\t",h+=o+"\t",e.is_now_proxy_?h+="vvp\t":h+="vv\t",h+="0\t",h+="0\t",h+=this.data_.t1.toString(10)+"\t",h+=this.data_.t2.toString(10)+"\t",h+=this.data_.t3.toString(10)+"\t",h+=this.data_.t4.toString(10)+"\t",h+=this.data_.t5.toString(10)+"\t",h+=this.data_.t8.toString(10)+"\t",h+=wt.getURLWithParam(this.data_.m3u8url)+"\t",h+=e.ccd_type_value_+"\t",h+="0\t",h+="0\t",h+="0\t",h+="0\t",h+="-\t",h+="0\t",h+="0";for(var d=t.length+4+r.length+4+4+n.length+t.length+4+i.length+4+4+s.length+t.length+4+r.length+4+4+n.length+t.length+4+u.length+4+4+h.length,l=new ArrayBuffer(d),_=new DataView(l),p=0,f=0;f<t.length;f++)_.setUint8(p,t.charCodeAt(f)),p++;_.setUint32(p,r.length),p+=4;for(var b=0;b<r.length;b++)_.setUint8(p,r.charCodeAt(b)),p++;_.setUint32(p,1),p+=4,_.setUint32(p,n.length),p+=4;for(var g=0;g<n.length;g++)_.setUint8(p,n.charCodeAt(g)),p++;for(var m=0;m<t.length;m++)_.setUint8(p,t.charCodeAt(m)),p++;_.setUint32(p,i.length),p+=4;for(var y=0;y<i.length;y++)_.setUint8(p,i.charCodeAt(y)),p++;_.setUint32(p,1),p+=4,_.setUint32(p,s.length),p+=4;for(var v=0;v<s.length;v++)_.setUint8(p,s.charCodeAt(v)),p++;for(var R=0;R<t.length;R++)_.setUint8(p,t.charCodeAt(R)),p++;_.setUint32(p,r.length),p+=4;for(var w=0;w<r.length;w++)_.setUint8(p,r.charCodeAt(w)),p++;_.setUint32(p,1),p+=4,_.setUint32(p,n.length),p+=4;for(var S=0;S<n.length;S++)_.setUint8(p,n.charCodeAt(S)),p++;for(var T=0;T<t.length;T++)_.setUint8(p,t.charCodeAt(T)),p++;_.setUint32(p,i.length),p+=4;for(var C=0;C<u.length;C++)_.setUint8(p,u.charCodeAt(C)),p++;_.setUint32(p,1),p+=4,_.setUint32(p,h.length),p+=4;for(var E=0;E<h.length;E++)_.setUint8(p,h.charCodeAt(E)),p++;return new Uint8Array(l)},t.prototype.checkTry=function(){null==this.sendBuffer_||this.retry_cn_>=e.send_ccd_retry_cn_||(++this.retry_cn_,S.warn("[ccd]timeout retry...",this.retry_cn_),this.postBuffer())},t.prototype.callback=function(t,e){null!=t&&this.checkTry()},t}(),$t=function(){function t(t,e,r,n){this._dbName=t,this._storeName=e,this._storeBitmap=r,this._version=n,this._db=null,this.lv2_cache_map_=new Map,this.hit_cn_=0,this.get_cn_=0,this.last_check_l2chache_tm=null,this._used_space=0}return t.getInstance=function(){return null==t.self_&&(t.self_=new t(Vt.DB_NAME,Vt.TABLE_NAME,Vt.TABLE_BITMAP,1)),t.self_},t.prototype.open=function(){var t=this,e=window.indexedDB||window.webkitIndexedDB||window.mozIndexedDB||window.msIndexedDB;e.deleteDatabase(Vt.DB_NAME_OLD);var r=e.open(this._dbName,this._version);r.onsuccess=function(e){null!=e.target&&(t._db=r.result,S.log("[db]open success."),t.check_table(),t.traverse_bitmap(),S.log("[db]db data loaded"))},r.onupgradeneeded=function(e){null!=e.target&&(t._db=r.result,t.check_table(),S.log("[db]onupgradeneeded."))},r.onerror=function(e){t._db=null,S.error("[db]open fail:",e)}},t.prototype.check_table=function(){try{this._db.objectStoreNames.contains(this._storeName)||(this.store=this._db.createObjectStore(this._storeName,{keyPath:Vt.KEY_NAME})),this._db.objectStoreNames.contains(this._storeBitmap)||(this.storeBitmap=this._db.createObjectStore(this._storeBitmap,{keyPath:Vt.KEY_NAME}))}catch(ae){S.error("[db]create table exception:",ae)}},t.prototype.is_support=function(){return t.is_support_indexDB()},t.is_support_indexDB=function(){var t=window.indexedDB||window.webkitIndexedDB||window.mozIndexedDB||window.msIndexedDB;return null!=t&&null!=t},t.prototype.get=function(t,e){if(null!=this._db)try{var r=this._db.transaction(this._storeName,"readonly").objectStore(this._storeName).get(t);r.onerror=function(t){S.error("[db][get]error:",t),e(null)},r.onsuccess=function(t){e(t.target.result)}}catch(ae){S.error("[db][get]exception:",ae),e(null)}else e(null)},t.prototype.getBitmap=function(t,e){if(null!=this._db)try{var r=this._db.transaction(this._storeBitmap,"readonly").objectStore(this._storeBitmap).get(t);r.onerror=function(t){S.error("[db][get]error:",t),e(null)},r.onsuccess=function(t){e(t.target.result)}}catch(ae){S.error("[db][get]exception:",ae),e(null)}else e(null)},t.prototype.check_hit=function(t,e,r){var n=this.lv2_cache_map_.get(t);return null!=n&&(n.access=e,r(n,1),!0)},t.prototype.update_hit_cache=function(t){var r=this.lv2_cache_map_,n=e.lv2_cache_count_;if(r.size,n<=0)r.clear();else{for(var i=0,o=function(){if(++i>100)return r.clear(),"break";var t=null;return r.forEach((function(e,r){(null==t||t.access>e.access)&&(t=e)})),null==t?"break":!0===r.delete(t.resourceId)?"continue":void 0};r.size>=n;){if("break"===o())break}r.set(t.resourceId,t)}},t.prototype.dump_hit=function(){var t=this.hit_cn_/(0===this.get_cn_?1:this.get_cn_),e="{\n";return e+='"get_cn":\t'+this.get_cn_+",\n",e+='"hit_cn":\t'+this.hit_cn_+",\n",e+='"lv2_size":\t'+this.lv2_cache_map_.size+",\n",e+='"hit%":\t"'+(Math.floor(1e4*t)/100).toFixed(2)+'%"\n',e+="}"},t.prototype.check_lv2_cache_timeout=function(t){if(0!==this.lv2_cache_map_.size)if(null!=this.last_check_l2chache_tm){if(!(t-this.last_check_l2chache_tm<1e3*Vt.ALG_MAX_LEVEL2_CACHE_TIMEOUT_SEC)){this.last_check_l2chache_tm=t;var e=t-12e4,r=[];this.lv2_cache_map_.forEach((function(t,n){t.access<e&&r.push(n)}));for(var n=0;n<r.length;++n){var i=r[n];S.log("[db][lv2]delete:",i),this.lv2_cache_map_.delete(i)}}}else this.last_check_l2chache_tm=t},t.prototype.get_resource=function(r,n,i){var o=this;if(null==this._db)return S.log("[db][get_resource] error, db is null:"),void i(null,110);var s=(new Date).getTime()-e.local_login_time_stamp_ms_+e.server_current_time_stamp_ms_;if(0==e.peakmode_||n){if(this.check_hit(r,s,i))return++this.get_cn_,++this.hit_cn_,void this.check_lv2_cache_timeout(s);this.check_lv2_cache_timeout(s)}try{var a=this._db.transaction(this._storeName,"readonly").objectStore(this._storeName).get(r);a.onerror=function(t){S.error("[db][get]error:",t),i(null,111)},a.onsuccess=function(r){var a=r.target.result;null!=a?((0==e.peakmode_||n)&&(++o.get_cn_,a.access=s,o.update_hit_cache(a)),S.log("[db][update]rid:",a.resourceId,",tm:",a.access,",now count:",t.CacheManager.fileMap.size,",upload:",n),i(a,0)):i(a,112)}}catch(ae){S.error("[db][get_resource]exception:",ae),i(null,113)}},t.prototype.save_resource=function(t){if(null!=this._db)try{this.save_resource_imp(t.resourceId,t)}catch(ae){S.error("[db][add]rid:",t.resourceId,",excepthon:",ae)}},t.prototype.save_resource_imp=function(r,n){var i,o,s=this,a=n.data.byteLength,c={resourceId:n.resourceId,md5v3:n.md5v3,access:n.access,size:n.size},u=t.CacheManager.fileMap,h=u.size,d=u.get(r);if(null!=d){var l=c.access-d.access;if(c.md5v3===d.md5v3&&c.size===d.size&&l<1e3*Vt.ALG_MAX_BLOCK_ACCESS_DX_SEC)return void S.log("[db][add]map exist,ignore,rid:",r,",access:",c.access,",old_access:",d.access);S.log("[db][add]map exist,no ignore,rid:",r,",access:",c.access,",old_access:",d.access)}u.set(r,c),this._used_space+=c.size;var _,p=t.CacheManager.getRootId(r),f=t.CacheManager.loadingRids,b=t.CacheManager.m3u8Bitmap,g=!1,m=t.CacheManager.inComSubRids,v=this._used_space-e.db_max_used_space_;if(S.log("[db]current used space: ",this._used_space,", space limit: ",e.db_max_used_space_),v>0){var R=[];if(m.size>0){try{for(var w=y(m),T=w.next();!T.done;T=w.next()){var C=T.value,E=wt.getRootRid(C);if(p==E||f.has(E))S.log("[db][delete]is downloading subrid:",C,", jump");else{for(var P=wt.getSubBeginSn(C),x=b.get(E),I=P;I<P+e.subrid_batch_size_;++I){var L=t.CacheManager.getSubResourceId(E,I),M=u.get(L);if(null!=M&&R.push(M),x){if(t.CacheManager.needUpdateM3u8Arr.add(E),g=!0,!(I<x.tsList.length))break;x.tsList[I]=!1}}if(m.delete(C),R.length>e.del_batch_size_)break}}}catch(W){i={error:W}}finally{try{T&&!T.done&&(o=w.return)&&o.call(w)}finally{if(i)throw i.error}}S.log("[db][delete]remove by incomplete subrid, del count:",R.length,", remain subrids:",m.size)}if(0==R.length){var k=[];if(b.forEach((function(t,e){p==e||f.has(e)?S.log("[db][delete]is downloading rid:",e,", jump"):k.push(t)})),0==k.length)S.log("[db][delete]all rids jumped, not delete");else{k.sort((function(t,e){return t.access-e.access})),_=k[0];for(I=0;I<_.size;I++){L=t.CacheManager.getSubResourceId(_.resourceId,I);var A=u.get(L);null!=A&&R.push(A)}}}var O=(N=this._db.transaction(this._storeName,"readwrite")).objectStore(this._storeName);if(R.forEach((function(t){var e=t.resourceId;S.is_debug()&&S.log("[db][delete]rid:",e,",tm:",t.access,",",new Date(t.access).toLocaleString()),O.delete(e),S.log("[db][delete]rid:",e,",success."),u.delete(e),s._used_space-=t.size})),S.log("[db][add]rid:",r,",bytes:",a),O.put(n),N.oncomplete=function(t){S.log("[db][delete]transaction succedd")},N.onerror=function(t){S.log("[db][delete]transaction failed"),ft.recordP2pDataError(88)},S.log("[db][delete]count:",h," -> ",t.CacheManager.fileMap.size),_){var B=this._db.transaction(this._storeBitmap,"readwrite").objectStore(this._storeBitmap),D=_.resourceId,U=B.delete(D);U.onsuccess=function(t){S.log("[db][deleteBitmap]rid:",D,",success.")},U.onerror=function(t){S.error("[db][deleteBitmap]rid:",D,",error:",U.error)}}}else{var N,q=(N=this._db.transaction(this._storeName,"readwrite")).objectStore(this._storeName);S.log("[db][add]rid:",r,",bytes:",a);var F=q.put(n);F.onsuccess=function(e){S.log("[db][add]success,rid:",r,",now count:",t.CacheManager.fileMap.size)},F.onerror=function(t){S.error("[db][add]fail,rid:",r,",event:",t.type,",exception:",F.error)}}if(g&&t.P2PManager.instance().check_update_m3u8_to_db(!0),_){var j=_.resourceId;b.delete(j);for(var V=Math.ceil(_.size/e.subrid_batch_size_),z=[],H=0;H<V;H++){var G=wt.getSubRid(j,H*e.subrid_batch_size_);if(S.log("[UnPublish]rid:",j,", subrid index:",H,", subrid:",G),z.length>=e.publish_batch_size_)new Xt(!1).request(z),z=[];z.push(G)}if(z.length>0)new Xt(!1).request(z)}},t.prototype.set=function(t,e){var r;if(this.get(e,(function(t){r=t})),r)S.warn("[db][update]You should use function update");else try{this._db.transaction(this._storeName,"readwrite").objectStore(this._storeName).add(t,e).onerror=function(t){S.error("[db][update]Can not add value",t)}}catch(ae){S.error("[db][set]value:",t,"key",e,",exception:",ae)}},t.prototype.setBitmap=function(t,e){if(null!=this._db){var r;this.get(e,(function(t){r=t}));try{var n=this._db.transaction(this._storeBitmap,"readwrite").objectStore(this._storeBitmap);if(r)S.warn("[db][update]You should use function update");else n.add(t).onerror=function(t){S.error("[db][update]Can not add value bitmap",t)}}catch(ae){S.error("[db][setBitmap]value:",t,"key",e,",exception:",ae)}}},t.prototype.update=function(t,e){var r;if(null!=this._db)if(this.get(e,(function(t){r=t})),r)try{this._db.transaction(this._storeName,"readwrite").objectStore(this._storeName).put(t).onerror=function(t){S.error("[db][update]Can not update value:",t)}}catch(ae){S.error("[db][update]value:",t,"key",e,",exception:",ae)}else S.warn("[db][update]You should use function set")},t.prototype.updateBitmap=function(t,e){if(null!=this._db)try{this._db.transaction(this._storeBitmap,"readwrite").objectStore(this._storeBitmap).put(t).onerror=function(t){S.error("[db][update]Can not update value:",t)}}catch(ae){S.error("[db][updateBitmap]value:",t,"key",e,",exception:",ae)}},t.prototype.remove=function(t){if(null!=this._db)try{var e=this._db.transaction(this._storeName,"readwrite").objectStore(this._storeName).delete(t);e.onsuccess=function(e){S.log("[db][delete]rid:",t,",success.")},e.onerror=function(r){S.error("[db][delete]rid:",t,",error:",e.error)}}catch(ae){S.error("[db][delete]rid:",t,",exception:",ae)}},t.prototype.removeBitmapBatch=function(t){if(null!=this._db)try{var e=this._db.transaction(this._storeBitmap,"readwrite"),r=e.objectStore(this._storeBitmap);t.forEach((function(t){r.delete(t),S.log("[db][delete]rootRid:",t,",success.")})),e.oncomplete=function(t){S.log("[db][delete]removeBitmapBatch succedd")},e.onerror=function(t){S.log("[db][delete]removeBitmapBatch failed"),ft.recordP2pDataError(89)}}catch(ae){S.error("[db][deleteBitmaps],exception:",ae)}},t.prototype.removeBitmap=function(t){if(null!=this._db)try{var e=this._db.transaction(this._storeBitmap,"readwrite").objectStore(this._storeBitmap).delete(t);e.onsuccess=function(e){S.log("[db][delete]rid:",t,",success.")},e.onerror=function(r){S.error("[db][delete]rid:",t,",error:",e.error)}}catch(ae){S.error("[db][delete]rid:",t,",exception:",ae)}},t.prototype.close=function(){null!=this._db&&this._db.close()},t.prototype.traverse_data=function(){var e=this;if(null==this._db)return!1;try{var r=this._db.transaction(this._storeName,"readonly").objectStore(this._storeName).openCursor();r.onsuccess=function(r){var n=r.target.result;if(null!=n){var i=n.value;if(null!=i){var o={resourceId:i.resourceId,data:null,md5v3:i.md5v3,size:i.size,access:i.access,scarcity:0};if(t.CacheManager.fileMap.set(i.resourceId,o),i.resourceId){var s=t.CacheManager.getRootId(i.resourceId),a=t.CacheManager.getSn(i.resourceId),c=t.CacheManager.m3u8Bitmap.get(s);if(c)a>=0&&a<c.tsList.length&&!c.tsList[a]&&(c.tsList[a]=!0,t.CacheManager.needUpdateM3u8Arr.add(s));else{var u=wt.getSubRid(s,a);t.CacheManager.inComSubRids.add(u)}}e._used_space+=o.size}n.continue()}},r.onerror=function(t){S.error("[db]open cursor error:",r.error)}}catch(ae){S.error("[db][traverse_data]exception:",ae)}return S.log("[db][traverse_data]begin"),!0},t.prototype.traverse_bitmap=function(){if(null!=this._db)try{var e=this._db.transaction(this._storeBitmap,"readonly").objectStore(this._storeBitmap).openCursor();e.onsuccess=function(e){var r=e.target.result;if(null!=r){var n=r.value,i={resourceId:n.resourceId,fullM3u8Url:n.fullM3u8Url,size:n.size,tsList:n.tsList,access:n.access};t.CacheManager.m3u8Bitmap.set(n.resourceId,i),r.continue()}},e.onerror=function(t){S.error("[db]open cursor error:",e.error)}}catch(ae){S.error("[db][traverse_bitmap]exception:",ae)}},t.self_=null,t}(),te=function(t){function r(){var e=t.call(this)||this;return e.engine_=null,e.isLogin_=!1,e.connected_count_=0,e.webrtc_connect_fail4log_=0,e.webrtc_connect_succ4log_=0,e.dmg_=jt.instance(),e.timer_=0,e.is_run_=!1,e.time_now_=dt.nowMs(),e.login_last_time_=0,e.address_last_time_=0,e.publish_last_time_=0,e.publish_init_time_=0,e.keep_last_time_=0,e.update_last_time_=e.time_now_,e.scan_db_init_cnt_=0,e.scan_db_flag_=!1,e.send_flow_data_time_=0,e.send_realtime_log_time_=0,e.check_to_connect_peers_last_time_=0,e.realtime_logmonitor_=new Tt,e.good_rid_p2pset_map_=new Map,e.sid_client_map_=new Map,e.peerid_clients_map_=new Map,e.wait_peerids_=new Map,e.mqtt_=qt.instance(),e}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}m(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}(r,t),r.instance=function(){return null==r.instance_&&(r.instance_=new r),r.instance_},r.prototype.setEngine=function(t){this.engine_=t},r.prototype.getLogReport=function(){return this.realtime_logmonitor_},r.prototype.start=function(){if(!this.is_run_){this.is_run_=!0,this.timer_=window.setInterval(this.onTimer.bind(this),r.TIMER_MS),this.setMaxListeners(100),e.init(),this.on(T.MQTT,this.on_mqtt.bind(this)),this.on(T.ADDRESS,this.on_address.bind(this)),this.on(T.RtcConnected,this.onRtcConnected.bind(this)),this.on(T.RtcDisconnect,this.onRtcDisconnect.bind(this)),this.on(T.RtcRidPublish,this.onRtcRidPublish.bind(this)),this.on(T.RtcNotifyTs,this.onRtcNotifyTs.bind(this));var t=qt.instance();this.on(T.LOGIN,t.on_login.bind(t)),this.check_login(!0)}},r.prototype.onTimer=function(){this.time_now_=dt.nowMs(),this.check_login(!1),this.dmg_&&this.dmg_.isLogined()&&(this.check_scan_db(),this.check_address(!1),this.check_publish(!1),this.check_to_connect_peers(),this.check_send_flow_logic_data(),this.check_update_m3u8_to_db(!1),this.dmg_.onMainCoreTimer(this.time_now_))},r.prototype.getDownloadManager=function(){return this.dmg_?this.dmg_:this.dmg_=jt.instance()},r.prototype.stop=function(){0!=this.timer_&&(window.clearInterval(this.timer_),this.timer_=0)},r.prototype.loginSucceed=function(t){this.isLogin_=!0,this.login_last_time_>t&&(this.login_last_time_=t),0==this.send_flow_data_time_&&(this.send_flow_data_time_=t),0==this.send_realtime_log_time_&&(this.send_realtime_log_time_=t),this.check_address(!1)},r.prototype.isP2PReady=function(){return this.isLogin_&&e.is_use_p2p_&&!e.is_dyt_},r.prototype.isLogined=function(){return this.isLogin_},r.prototype.check_login=function(t){var r=e.login_dx_seconds_;if((ft.getLoginErrTimes()>=e.login_err_time_threshold_&&(r=e.login_special_dx_seconds_),!t)&&this.time_now_-this.login_last_time_<1e3*r)return;this.login_last_time_=this.time_now_,(new Kt).request()},r.prototype.check_scan_db=function(){this.scan_db_flag_||++this.scan_db_init_cnt_<15||(this.scan_db_flag_=r.CacheManager.indexDB_.traverse_data())},r.prototype.check_address=function(t){if(t)this.address_last_time_=this.time_now_;else if(this.dmg_){var r=this.dmg_.getActivateM3u8Loader();if(r&&r.sub_rid&&!r.isFullConnected()){var n=1e3*(1!=e.peakmode_||this.isFullWaiting()?e.address_dx_seconds_:e.address_ergent_dx_seconds_);if(!(this.time_now_-this.address_last_time_<n))S.log("[check_address]getActivateM3u8Loader, rid=",r.sub_rid),this.address_last_time_=this.time_now_,new Lt(r.sub_rid,r.fullM3u8Url).request(),S.log(this.dump_p2p_info())}}},r.prototype.stream_change_to_publish=function(){this.check_publish(!0)},r.prototype.check_publish=function(t){if(this.scan_db_flag_){if(!t)if(this.time_now_-this.publish_last_time_<1e3*e.publish_dx_seconds_)return;if(this.dmg_)if(this.dmg_.getActivateM3u8Loader()){var n=[],i=[],o=r.CacheManager.loadingRids;if(r.CacheManager.m3u8Bitmap&&r.CacheManager.m3u8Bitmap.forEach((function(t,s,a){if(t.size>0){for(var c=0,u=Math.ceil(t.size/e.subrid_batch_size_),h=Array(u).fill(0),d=0;d<t.size;d++)1==t.tsList[d]&&(c++,h[Math.floor(d/e.subrid_batch_size_)]++);0!=c||o.has(s)||i.push(s);for(d=0;d<u;d++){var l=0;l=d<u-1||t.size%e.subrid_batch_size_==0?h[d]/e.subrid_batch_size_:h[d]/(t.size%e.subrid_batch_size_);var _=0==d||d==u-1?e.publish_sub_have_ts_per_/2:e.publish_sub_have_ts_per_,p=wt.getSubRid(s,d*e.subrid_batch_size_);if(l>=_){if(S.log("[Publish]rid:",s,", subrid index:",d,", subrid:",p,", subPercent:",l),n.length>=e.publish_batch_size_)new Xt(!0).request(n),n=[];n.push(p),r.CacheManager.inComSubRids.delete(p)}else l>0&&r.CacheManager.inComSubRids.add(p)}}})),n.length>0)this.publish_init_time_=0,this.publish_last_time_=this.time_now_,new Xt(!0).request(n);else++this.publish_init_time_>3?this.publish_last_time_=this.time_now_:this.publish_last_time_=this.time_now_-1e3*(e.publish_dx_seconds_-5),S.log("[publish]rids is empty, not update request interval");if(i.length>0){var s=r.CacheManager.m3u8Bitmap;i.forEach((function(t){s.delete(t)})),r.CacheManager.indexDB_.removeBitmapBatch(i)}}}},r.prototype.check_send_flow_logic_data=function(){var t=this,n=this.time_now_-this.send_flow_data_time_;if(!(n<1e3*e.send_ccd_dx_seconds_)){var i=jt.instance();this.send_flow_data_time_=this.time_now_;var o=ft.T1_diff,s=ft.T2_diff,a=ft.T3_diff,c=ft.T4_diff,u=ft.T5_diff,h=ft.T8_diff;if(""!=e.dm_&&""!=e.dms_&&(0!==o||0!==s||0!==a||0!==c||0!==u||0!==h)){S.log("[flawData][T1]:",o,",[T2]:",s,",[T3]:",a,",[T4]:",c,",[T5]:",u,",[T8]:",h);var d=i.getActivateFullM3u8Url();if(null!=d)new Jt({m3u8url:d,t1:o,t2:s,t3:a,t4:c,t5:u,t8:h}).send()}if(!((n=this.time_now_-this.send_realtime_log_time_)<1e3*e.send_rl_dx_seconds_)){this.send_realtime_log_time_=this.time_now_;var l=null,_=ft.T1_diff_r,p=ft.T2_diff_r,f=ft.T3_diff_r,b=ft.T5_diff_r,g=ft.T8_diff_r;0===_&&0===p&&0===f&&0===b&&0===g||(l={logtype:_t.EVENT,subtype:pt.DEFAULT,t1:_,t2:p,t3:f,t5:b,t8:g}),this.has_connect_log()&&(l||(l={logtype:_t.EVENT,subtype:pt.DEFAULT}),l.rconfail=this.get_webrtc_connect_fail(!0),l.rconsucc=this.get_webrtc_connect_succ(!0)),l||(l={logtype:_t.EVENT,subtype:pt.DEFAULT}),l.curconnet=this.getConnectedCount(),l.activecount=0;var m=i.getActivateM3u8Loader();if(m){var y=m.getP2PSeter();y&&(l.activecount=y.size(),l.activeedgecount=y.edge_size())}if(l&&(l.errcode=0,l.streamchangecount=i.getStreamChangeCount_diff(),r.CacheManager.indexDB_&&(l.used_space=r.CacheManager.indexDB_._used_space),this.realtime_logmonitor_.request(l)),ft.hasCdnErrRecord())ft.getCdnErrRecord().forEach((function(e,r,n){var i={logtype:_t.EVENT,subtype:pt.CDNERR,errcode:r,errcnt:e};t.realtime_logmonitor_.request(i)})),ft.clearCdnErrRecord();if(ft.hasP2pErrRecord())ft.getP2pErrRecord().forEach((function(e,r,n){var i={logtype:_t.EVENT,subtype:pt.P2PERR,errcode:r,errcnt:e};t.realtime_logmonitor_.request(i)})),ft.clearP2pErrRecord()}}},r.prototype.check_update_m3u8_to_db=function(t){var n=this.time_now_-this.update_last_time_;!t&&n<1e3*e.update_m3u8_to_db_dx_seconds_number||(this.update_last_time_=this.time_now_,r.CacheManager.needUpdateM3u8Arr.forEach((function(t){var e=r.CacheManager.m3u8Bitmap.get(t);e&&(r.CacheManager.indexDB_.updateBitmap(e,t),S.log("[check_update_m3u8_to_db]rid:",t))})),r.CacheManager.needUpdateM3u8Arr.clear())},r.prototype.now=function(){return this.time_now_},r.prototype.is_vod_pause_or_stop=function(){return this.dmg_&&this.dmg_.is_vod_pause_or_stop(this.time_now_)},r.prototype.get_client=function(t){return this.sid_client_map_.get(t)},r.prototype.getConnectedCount=function(){return this.connected_count_},r.prototype.isFullWaiting=function(){return this.wait_peerids_.size>e.max_peer_count_},r.prototype.add_client=function(t){this.sid_client_map_.set(t.sid(),t);var e=this.peerid_clients_map_.get(t.peerid_);e||(e=new Set,this.peerid_clients_map_.set(t.peerid_,e)),e.add(t)},r.prototype.remove_client=function(t){this.sid_client_map_.delete(t.sid());var e=this.peerid_clients_map_.get(t.peerid_);e&&(e.delete(t),0==e.size&&this.peerid_clients_map_.delete(t.peerid_))},r.prototype.on_mqtt=function(t){if(t.is_valid()){var e=this.get_client(t.sid);if(It.xMqttRtcCmd.offer==t.cmd){if(e||0==t.data.length)return void S.rtclog("[rtc]too many offer sid:",t.sid);var r=this.dmg_.getActivateM3u8Loader();if(r&&r.isFullConnected4Offer())return void S.rtclog("[rtc]full connected,ignore sid:",t.sid);if((e=new Ft(t.from,t.sid)).isBadRtc())return;S.rtclog("[rtc][client][new][offer]pid:",e.peerid_,",sid:",e.sid_),this.add_client(e)}e?e.onMqtt(t):S.is_debug()&&S.rtclog("[rtc]no find client:",t.sid,",cmd:",Dt.xMqttRtcCmd2string(t.cmd),",data:",t.data)}else S.rtclog("[rtc]is no valid,from:",t.from,",sid:",t.sid)},r.prototype.onRtcConnected=function(t){++this.connected_count_,++this.webrtc_connect_succ4log_},r.prototype.onRtcRidPublish=function(t,e){e&&this.addGood(e).push_client(t)},r.prototype.onRtcNotifyTs=function(t,e){e&&t.myRequestRid_&&e==t.myRequestRid_&&this.addGood(t.myRequestRid_).push_client(t)},r.prototype.onRtcDisconnect=function(t){t.has_connected_history_?--this.connected_count_:t.isCloseForNoData()||++this.webrtc_connect_fail4log_,S.rtclog("[rtc][client][del]pid:",t.peerid_,",sid:",t.sid_),this.remove_client(t),t.myRequestRid_&&this.addGood(t.myRequestRid_).remove_client(t,!0),t.peerRequestRid_&&this.addGood(t.peerRequestRid_).remove_client(t,!0)},r.prototype.connect_peer=function(t){var e=new Ft(t,null);e.isBadRtc()||(S.rtclog("[rtc][client][new][connect]pid:",t,",sid:",e.sid()),this.add_client(e))},r.prototype.check_to_connect_peers=function(){var t,r;if(!(this.time_now_-this.check_to_connect_peers_last_time_<e.p2p_connect_retry_interval_)&&0!=this.wait_peerids_.size&&this.mqtt_.is_ready()){var n=this.dmg_.getActivateM3u8Loader();if(n&&n.sub_rid)if(n.isFullConnected())this.wait_peerids_.clear();else{var i=n.needMoreEdgeCnt();this.check_to_connect_peers_last_time_=this.time_now_;var o=n.sub_rid,s=0;try{for(var a=y(this.wait_peerids_),c=a.next();!c.done;c=a.next()){var u=v(c.value,2),h=u[0],d=u[1];if(d==o){var l=this.peerid_clients_map_.get(h);if(!l||0==l.size){if(dt.isEdgePeer(h)){if(i<=0){this.wait_peerids_.delete(h),S.rtclog("[p2p][connect]edge full ignore, peerid:",h,", rid:",d);continue}--i}this.connect_peer(h),++s}if(this.wait_peerids_.delete(h),s>e.p2p_per_max_connect_count_)break}else this.wait_peerids_.delete(h),S.rtclog("[p2p][connect]ignore rid diff,peerid:",h,", rid:",d," cur rid:",o)}}catch(_){t={error:_}}finally{try{c&&!c.done&&(r=a.return)&&r.call(a)}finally{if(t)throw t.error}}}}},r.prototype.on_address=function(t,r){var n,i,o,s,a=this.dmg_.getActivateM3u8Loader();if(a)if(a.sub_rid)if(a.sub_rid==t)if(a.setSubridAddressed(),0!=r.size){var c=a.getP2PSeter();if(c&&c.updateSubRidClient(t),a.isFullConnected())S.log("[address]callback,full connected,ignore rid:",t);else{var u=a.needMoreEdgeCnt();if(this.mqtt_.is_ready()){var h=0;try{for(var d=y(r),l=d.next();!l.done;l=d.next()){b=l.value;var _=this.peerid_clients_map_.get(b);if(!(_&&_.size>0)){if(dt.isEdgePeer(b)){if(u<=0)continue;--u}h>e.p2p_per_max_connect_count_?this.wait_peerids_.set(b,t):(++h,this.connect_peer(b))}}}catch(g){o={error:g}}finally{try{l&&!l.done&&(s=d.return)&&s.call(d)}finally{if(o)throw o.error}}this.check_to_connect_peers_last_time_=this.time_now_}else try{for(var p=y(r),f=p.next();!f.done;f=p.next()){var b=f.value;if(dt.isEdgePeer(b)){if(u<=0)continue;--u}this.wait_peerids_.set(b,t)}}catch(m){n={error:m}}finally{try{f&&!f.done&&(i=p.return)&&i.call(p)}finally{if(n)throw n.error}}}}else S.log("[address]callback, zero peers, rid:",t);else S.log("[address]callback,ignore,active rid:",a.sub_rid,",req rid:",t);else S.log("[address]callback,now rid null");else S.error("[address]callback,loader null")},r.prototype.addGood=function(t){var e=this.good_rid_p2pset_map_.get(t);return e||(e=new Zt(t),this.good_rid_p2pset_map_.set(t,e),e)},r.prototype.getP2pSet=function(t){return this.addGood(t)},r.prototype.onDownloadStreamChanged=function(t){var e=this.dmg_.getActivateM3u8Loader();if(t&&e){var r=e.getPublishRidPack(!1);if(r){var n=r;this.good_rid_p2pset_map_.forEach((function(e){e.get_cliets().forEach((function(e){e.sendRtcVodPublishRid(t,n)}))}))}}},r.prototype.has_connect_log=function(){return this.webrtc_connect_fail4log_>0||this.webrtc_connect_succ4log_>0},r.prototype.get_webrtc_connect_succ=function(t){if(t){var e=this.webrtc_connect_succ4log_;return this.webrtc_connect_succ4log_=0,e}return this.webrtc_connect_succ4log_},r.prototype.get_webrtc_connect_fail=function(t){if(t){var e=this.webrtc_connect_fail4log_;return this.webrtc_connect_fail4log_=0,e}return this.webrtc_connect_fail4log_},r.prototype.dumpRtc=function(t,e){return{pid:t.peerid_,sid:t.sid_,caller:t.is_caller_,status:t.status_,lived_seconds:((e-t.create_tm_)/1e3).toFixed(0)}},r.prototype.p2pdumpDetail=function(){var t,e,r=this,n=this.now(),i=new Array,o=new Array,s=new Array,a=new Array,c=new Array,u=this.dmg_.getActivateM3u8Loader();if(u){var h=u.getP2PSeter();if(h){var d=h.get_cliets();try{for(var l=y(d),_=l.next();!_.done;_=l.next()){var p=_.value;c.push({sid:p.sid(),pid:p.peerid_})}}catch(f){t={error:f}}finally{try{_&&!_.done&&(e=l.return)&&e.call(l)}finally{if(t)throw t.error}}}}return this.good_rid_p2pset_map_.forEach((function(t){t.get_cliets().forEach((function(t){o.push(r.dumpRtc(t,n))}))})),this.sid_client_map_.forEach((function(t){s.push(r.dumpRtc(t,n))})),this.peerid_clients_map_.forEach((function(t){t.forEach((function(t){a.push(r.dumpRtc(t,n))}))})),i.push({activeMap:c,ridMap_good:o,sessionMap:s,peeridMap:a}),JSON.stringify(i,null,2)},r.prototype.dump_p2p_info=function(){var t="",r=0;this.good_rid_p2pset_map_.forEach((function(e){r+=e.size(),e.get_cliets().forEach((function(e){t.length&&(t+=","),t+=e.peerid_}))}));var n="----------------------------\n";return n+='"all_connect":\t'+this.sid_client_map_.size+"\n",n+='"peer_count":\t'+this.peerid_clients_map_.size+"\n",n+='"connected":\t'+r+"\n",n+='"wait_connect":\t'+this.wait_peerids_.size+"\n",n+='"connected-peerid":\t'+t+"\n",n+='"this-peerid":\t'+e.pcdn_peer_id_+"\n",n+='"play_buffer:":\t'+this.engine_.playerBufferDuration_.toFixed(2)+"\n",n+="----------------------------"},r.instance_=null,r.TIMER_MS=1e3,r}(s.EventEmitter);S.GlobalConfig=e,e.GUtils=dt,jt.P2PManager=te,qt.P2PManager=te,Kt.P2PManager=te,Lt.P2PManager=te,Zt.P2PManager=te,Ut.P2PManager=te,Qt.P2PManager=te,xt.P2PManager=te,Ft.P2PManager=te,Dt.RealtimeLogMonitor=Tt,Ct.P2PManager=te,$t.P2PManager=te,Ct.CdnClient=Yt;var ee=function(t){this.element=t,this.next=null,this.pre=null},re=function(){function t(){this._head=new ee({}),this._tail=new ee({}),this._head.next=this._tail,this._tail.pre=this._head}return t.prototype.insert=function(t,e){var r=new ee(e),n=t.pre;n.next=r,r.next=t,r.pre=n,t.pre=r},t.prototype.remove=function(t){var e=t.pre,r=t.next;e.next=r,null!=r&&(r.pre=e)},t.prototype.find=function(t){for(var e=this._head.next;e!=this._tail;){if(e.element.rangeStart>t.rangeStart)break;e=e.next}return e},t.prototype.addElement=function(t){var e=this.find(t),r=e.pre;S.log("[linklist][addElement]:",t.rangeStart," rangeEnd:",t.rangeEnd),this.print(!0),r!=this._head&&r.element.rangeEnd+1>=t.rangeStart?(t.rangeEnd>r.element.rangeEnd&&(r.element.rangeEnd=t.rangeEnd),e!=this._tail&&r.element.rangeEnd+1>=e.element.rangeStart&&(r.element.rangeEnd<e.element.rangeEnd&&(r.element.rangeEnd=e.element.rangeEnd),this.remove(e))):e!=this._tail&&t.rangeEnd+1>=e.element.rangeStart?e.element.rangeStart=t.rangeStart:this.insert(e,t),this.print(!0)},t.prototype.isContains=function(t,e){for(var r=this._head.next,n=!1;r!=this._tail;){var i=r.element.rangeStart,o=r.element.rangeEnd;if(i<=t&&o>=e){n=!0;break}r=r.next}return n},t.prototype.get_has_length=function(t,e){if(e<t)return 0;var r=this._head.next;if(r===this._tail)return 0;var n=r.element.rangeStart,i=r.element.rangeEnd;return t<n?e<n?0:e>=n&&e<=i?e-n+1:i-n+1:t>=n&&t<=i?e<=i?e-t+1:i-t+1:0},t.prototype.print=function(t){if(!t||S.is_debug())for(var e=this._head.next,r=0;e!=this._tail;)(t?S.log:S.flog)("[linklist]print,i:",r," start:",e.element.rangeStart," end:",e.element.rangeEnd),e=e.next,r++},t.prototype.push=function(t){this.insert(this._tail,t)},t.prototype.pop=function(){this._head.next!=this._tail&&this.remove(this._head.next)},t.prototype.getSublist=function(e){for(var r=new t,n=e._head.next,i=this._head.next;n!=e._tail&&i!=this._tail;){var o,s=n.element.rangeStart,a=n.element.rangeEnd,c=i.element.rangeStart;if(i.element.rangeEnd,s<c)if(a<c)(o={}).rangeStart=s,o.rangeEnd=a,r.push(o),n=n.next;else if(a==c)(o={}).rangeStart=s,o.rangeEnd=a-1,n=n.next}},t.prototype.clear=function(){for(;this._head.next!=this._tail;)this.remove(this._head.next)},t}(),ne=function(){function t(r,n,i){this._rootRid=r,this._groupIndex=n,this._data=null,this._size=i,this._isReady=!1,this._md5v3=null,this._localmd5=null,this._rangeArray=[],this._md5v2Array=new Array,this._currentMD5V2Index=0,this._size%e.CHUNK_SIZE==0?this._count=this._size/e.CHUNK_SIZE:this._count=Math.ceil(this._size/e.CHUNK_SIZE),this._rangeList=new re,this._bitmapLength=0,i%e.CHUNK_SIZE==0?this._bitmapLength=i/e.CHUNK_SIZE:this._bitmapLength=Math.floor(i/e.CHUNK_SIZE)+1,this._requestingBitmap=new Array(this._bitmapLength).fill(t.INIT),this._currentIndex=-1}return t.prototype.getRangeFromIndex=function(t){var r={rangeStart:0,rangeEnd:0};return r.rangeStart=t*e.CHUNK_SIZE,t<this._bitmapLength-1?r.rangeEnd=r.rangeStart+e.CHUNK_SIZE-1:r.rangeEnd=this._size-1,r},t.prototype.getIndexFromRange=function(t){var r=t.rangeStart;return r%e.CHUNK_SIZE==0?r/e.CHUNK_SIZE:Math.floor(r/e.CHUNK_SIZE)},t.prototype.getRequestRange=function(){var r=[],n=this._currentIndex+1,i=n+e.TASK_NUM;for(i>this._bitmapLength&&(i=this._bitmapLength);n<i;)if(this._requestingBitmap[n]==t.INIT){var o={groupIndex:0,bitnum:0};o.groupIndex=this._groupIndex,o.bitnum=n,r.push(o),n++}else n++;return r},t.prototype.updateCurrentIndex=function(){for(var e=this._currentIndex+1;e<this._bitmapLength&&this._requestingBitmap[e]==t.READY;)e++;this._currentIndex=e-1},t.prototype.setCurrentIndex=function(t){var r=Math.floor(t/e.CHUNK_SIZE);this._currentIndex<r&&(this._currentIndex=r-1,this.updateCurrentIndex()),S.log("[setCurrentIndex], offset:",t,",cIndex:",r," curDownComplete cIndex:",this._currentIndex)},t.prototype.save=function(r,n,i){null==this._data&&(this._data=new ArrayBuffer(this._size)),S.log("[chunk][save]gIndex:",this._groupIndex,",start:",n,",end:",i,",length:",r.byteLength,",dist:",i-n+1);var o=new Uint8Array(this._data),s=new Uint8Array(r);o.set(s,n);var a={rangeStart:0,rangeEnd:0};a.rangeStart=n,a.rangeEnd=i;for(var c=this.getIndexFromRange(a),u=Math.floor((i-n+1)/e.CHUNK_SIZE),h=0;h<u&&c>=0&&c<this._bitmapLength;h++)this._requestingBitmap[c]=t.READY;return this.updateCurrentIndex(),this.isContains(n,i),this._rangeList.addElement(a),this.mergeRange()},t.prototype.resetBitmap=function(e){var r=this.getIndexFromRange(e);this._requestingBitmap[r]==t.REQUESTING&&(this._requestingBitmap[r]=t.INIT)},t.prototype.setBitmap=function(e){var r=this.getIndexFromRange(e);r>=this._requestingBitmap.length||this._requestingBitmap[r]==t.INIT&&(this._requestingBitmap[r]=t.REQUESTING)},t.prototype.addRange=function(t,e){var r=0,n={rangeStart:0,rangeEnd:0};for(n.rangeStart=t,n.rangeEnd=e;r<this._rangeArray.length;r++){var i=this._rangeArray[r];if(S.log("[rangeEnd], rangEnd:",i.rangeEnd," start:",t),i.rangeStart>t)break}S.log("[addRange], start:",t," end:",e," i:",r," length:",this._rangeArray.length);var o={rangeStart:0,rangeEnd:0},s={rangeStart:0,rangeEnd:0};r-1>=0?(o=this._rangeArray[r-1]).rangeEnd+1>=t?(e>o.rangeEnd&&(o.rangeEnd=e),r<this._rangeArray.length&&(s=this._rangeArray[r],o.rangeEnd+1>=s.rangeStart&&(o.rangeEnd<s.rangeEnd&&(o.rangeEnd=s.rangeEnd),this._rangeArray.splice(r,1)))):r<this._rangeArray.length?e+1>=(s=this._rangeArray[r]).rangeStart?s.rangeStart=t:this._rangeArray.splice(r,0,n):this._rangeArray.push(n):null!=s?e+1>=s.rangeStart?s.rangeStart=t:this._rangeArray.splice(0,0,n):this._rangeArray.push(n),this.mergeRange()},t.prototype.mergeRange=function(){var r=this._rangeList._head.next.element,n=r.rangeStart,i=r.rangeEnd;if(0==n&&i-n==this._size){if(this._isReady=!0,null==this._localmd5&&this.calculateMD5V3All(),S.log("[chunk][mergeRange]gIndex,",this._groupIndex,",isReady:",this._isReady),1==e.IS_USE_CACHE){var o={data:null,resourceId:"",size:0,md5v3:"",access:0,scarcity:0};o.data=this._data,o.resourceId=t.CacheManager.getSubResourceId(this._rootRid,this._groupIndex),o.size=this._size,o.md5v3=this._localmd5,o.access=(new Date).getTime()-e.local_login_time_stamp_ms_+e.server_current_time_stamp_ms_,$t.getInstance().save_resource(o)}return 1}return this.calculateMD5V2(),0},t.prototype.hexStringToUint8Array=function(t){if(t.length%2!=0)throw"Invalid hexString";for(var e=new Uint8Array(t.length/2),r=0;r<t.length;r+=2){var n=parseInt(t.substr(r,2),16);if(isNaN(n))throw"Invalid hexString";e[r/2]=n}return e},t.prototype.calculateMD5V2=function(){if(null==this._localmd5)for(this._currentMD5V2Index;this._currentMD5V2Index<this._count;){var t=this._currentMD5V2Index*e.CHUNK_SIZE,r=t+e.CHUNK_SIZE;if(r>this._size&&(r=this._size),1!=this.isContains(t,r))break;var n=this._data.slice(t,r),i=N.lib.WordArray.create(n);this._md5v2Array[this._currentMD5V2Index]="10000000"+N.MD5(i).toString(),this._currentMD5V2Index++}},t.prototype.calculateMD5V3All=function(){for(var t=this._currentMD5V2Index;t<this._count;t++){var r=t*e.CHUNK_SIZE,n=r+e.CHUNK_SIZE;n>this._size&&(n=this._size);var i=this._data.slice(r,n),o=N.lib.WordArray.create(i);this._md5v2Array[t]="10000000"+N.MD5(o).toString()}this._currentMD5V2Index=this._count;for(var s="",a=0;a<this._count;a++)s+=this._md5v2Array[a];var c=this.hexStringToUint8Array(s),u=N.lib.WordArray.create(c);this._localmd5="10000000"+N.MD5(u).toString().toUpperCase(),S.log("[chunk][mergeRange][calculateMD5V3All]gIndex:",this._groupIndex,",md5:",this._localmd5)},t.prototype.calculateMD5V3=function(){var t=0,r=0;r=this._size%e.CHUNK_SIZE==0?this._size/e.CHUNK_SIZE:Math.ceil(this._size/e.CHUNK_SIZE);for(var n="",i=0;i<r;i++){var o=t+e.CHUNK_SIZE;o>this._size&&(o=this._size);var s=this._data.slice(t,o),a=N.lib.WordArray.create(s);n+="10000000"+N.MD5(a).toString(),t=o}var c=this.hexStringToUint8Array(n),u=N.lib.WordArray.create(c);N.MD5(u).toString().toUpperCase()},t.prototype.clear=function(){this._data.length=0,this._data=null,this._isReady=!1;for(var e=0;e<this._bitmapLength;e++)this._requestingBitmap[e]=t.INIT;this._rangeList.clear()},t.prototype.isContains=function(t,e){return this._rangeList.isContains(t,e)},t.prototype.get_has_size4Range=function(t,e){return this._rangeList.get_has_size(t,e)},t.prototype.print_list=function(t){this._rangeList.print(t)},t.prototype.getStartSend_=function(t,e){if(S.is_debug()){S.log("[getStartSend], offset:",t);for(var r=0;r<this._rangeArray.length;r++)S.log("[getStartSend], start:",this._rangeArray[r].rangeStart," end:",this._rangeArray[r].rangeEnd)}var n,i=-1;for(r=0;r<this._rangeArray.length;r++){if(this._rangeArray[r].rangeStart>t){i=r;break}}return-1==i||(n=i>1?this._rangeArray[i-1].rangeEnd:this._rangeArray[0].rangeStart>t?0:this._rangeArray[0].rangeEnd)<=t?0:n-t+1},t.prototype.getStartSend=function(t,e){var r={rangeStart:0,rangeEnd:0};r.rangeStart=t,r.rangeEnd=t+e-1,S.log("[getStartSend], offset:",t),this._rangeList.print(!0);var n,i=this._rangeList.find(r).pre;return n=i!=this._rangeList._head?i.element.rangeEnd:0,S.log("[getStartSend], rangeEndSend:",n),n<t?0:n-t+1},t.INIT=0,t.READY=1,t.REQUESTING=2,t}(),ie=function(){function t(t,e){this._rootRid=t,this._tsCount=e,this._nextEmpty=0,this._cache=new Array(e)}return t.prototype.reset=function(){for(var t=0;t<this._cache.length;t++)this._cache[t]=null},t.prototype.free_group_mem=function(t){t>=0&&t<this._cache.length&&(this._cache[t]=null)},t.prototype.getChunkById=function(t,e,r){return t>=0&&t<this._cache.length?(null==this._cache[t]&&1==r&&t<this._cache.length&&(this._cache[t]=new ne(this._rootRid,t,e)),this._cache[t]):null},t.prototype.get_has_length=function(t,e){return this._rangeList.get_has_length(t,e)},t.prototype.getNextId=function(){return this._nextEmpty},t.prototype.setNextEmpty=function(t){this._nextEmpty=t},t.prototype.remove_imp=function(t,e,r,n,i){var o=0,s=0;!0===t?(o=0,s=e?r-1:r):(o=this._cache.length-1,s=e?r+21:r+20);for(var a=o;t?a<s:a>s;t?++a:--a){var c=this.getChunkById(a,0,!1);if(null!=c&&(null!=c._data&&(i+=c._length,this.free_group_mem(a),i>=n)))break}return i},t.prototype.removeChunk=function(t,e){var r=0;(r=this.remove_imp(!0,!0,t,e,r))>=e||(r=this.remove_imp(!0,!1,t,e,r))>=e||(r=this.remove_imp(!1,!0,t,e,r))>=e||(r=this.remove_imp(!1,!1,t,e,r))},t.prototype.getMemory=function(){for(var t=0,e=0;e<this._cache.length;e++){var r=this.getChunkById(e,0,!1);null!=r&&(null!=r._data&&(t+=r._length))}return t},t}(),oe=function(){function t(){}return t.instance=function(){return null==t.instance_&&(S.log("[CacheManager] instance created"),t.instance_=new t,t.m3u8Bitmap=new Map,t.fileMap=new Map,t.bufferMap=new Map,t.inComSubRids=new Set,t.loadingRids=new Set,t.needUpdateM3u8Arr=new Set,t.indexDB_=$t.getInstance(),t.indexDB_.open()),t.instance_},t.init=function(){S.log("[db][load]start...")},t.saveTsData=function(e,r,n,i,o,s){var a=t.bufferMap.get(e);if(null==a)return S.log("[CacheManager]saveTsData(), buffer is null"),-1;var c=a.getChunkById(r,s,!0);return null==c?(S.log("[CacheManager]saveTsData(), chunk is null, tsIndex:",r),-1):c.save(n,i,i+o)},t.hasTsData=function(e,r){if(null==e)return S.log("[CacheManager]hasTsData(), error rootRid is null"),!1;var n=t.m3u8Bitmap.get(e);return!!(n&&r>=0&&r<n.tsList.length)&&n.tsList[r]},t.readTsData=function(e,r,n,i,o,s){var a={buffer:null,tsLength:0};if(null==e)return S.log("[CacheManager]readTsData(), error rootRid is null"),void s(a,104);if(null==t.fileMap)return S.log("[CacheManager]readTsData(), error undefined fileMap"),void s(a,105);var c=t.getSubResourceId(e,r);if(null==c)return S.log("[CacheManager]readTsData(), error resourceId is null"),void s(a,106);var u=t.fileMap.get(c);null==u&&S.log("[CacheManager]readTsData(), get resourceId: ",c," failed from fileMap"),a.tsLength=u?u.size:0,t.indexDB_.get_resource(c,o,(function(t,e){if(null==t)return a.buffer=null,S.log("[CacheManager]readTsData(), get resourceId: ",c," failed from indexdDB"),void s(a,e);-1==i?a.buffer=new Uint8Array(t.data):t.size>n+i?a.buffer=new Uint8Array(t.data.slice(n,n+i)):a.buffer=new Uint8Array(t.data.slice(n,t.size)),0==a.tsLength&&(a.tsLength=t.size),null==a.buffer?S.log("[CacheManager]readTsData(), error ret.buffer is null, rid: ",c):S.log("[CacheManager]readTsData(), read fileMap.get rid=",c,", cacheMap size:",u?u.size:0," res size=",t.size," tsLength=",a.tsLength," offset=",n," readLength=",a.buffer.length),s(a,e)}))},t.createBuffer=function(e,r,n){if(S.log("[createBuffer]rid:",e," tsCount:",r),0!=r){var i=t.bufferMap.get(e);null==i?(i=new ie(e,r),t.bufferMap.set(e,i)):S.log("[createBuffer]Already exist, rid:",e," tsCount:",r);var o=t.m3u8Bitmap.get(e);if(null==o||0==o.size){for(var s=Array(r),a=0;a<r;a++)s[a]=!1;var c={resourceId:e,fullM3u8Url:n,size:r,tsList:s,access:(new Date).getTime()};t.m3u8Bitmap.set(e,c),null==o?(S.log("[new m3u8Bitmap]rid:",e," tsCount:",r," url=",n),t.indexDB_.setBitmap(c,e)):(S.log("[update m3u8Bitmap]rid:",e," tsCount:",r," url=",n),t.indexDB_.updateBitmap(c,e))}}},t.getM3u8Bitmap=function(e){var r=Array(),n=t.m3u8Bitmap.get(e);return null!=n?(r=n.tsList,n.access=(new Date).getTime(),t.indexDB_.updateBitmap(n,e),r):null},t.getSubResourceId=function(t,e){if(null==t||t.length<48)return null;for(var r=(e+=1).toString(16),n=r.length,i=0;i<4-n;i++)r="0"+r;return(t.substring(0,44)+r).toUpperCase()},t.getRootId=function(t){return t.substring(0,44)+"0000"},t.getSn=function(t){return parseInt(t.substring(44,48),16)-1},t.instance_=null,t}();ne.CacheManager=oe,te.CacheManager=oe,jt.CacheManager=oe,Ut.CacheManager=oe,Ct.CacheManager=oe,Yt.CacheManager=oe,$t.CacheManager=oe,Ft.CacheManager=oe;var se=function(){function t(t){this.fullM3u8Url_="",this.currentDomain_="",this.playerBufferDuration_=0,wt.checkInternational(),this.event_=new s.EventEmitter,this.event_.setMaxListeners(100),this.tsUrlMap_=new Map,this.is_run_=!1,this.isReportLog4Start_=!1,this.is_p2p_ready_=!1,this.dmg_=jt.instance(),this.dmg_.setEngine(this),this.pmg_=te.instance(),this.pmg_.setEngine(this),this.pmg_.on(T.LOGIN,this.on_login.bind(this)),this.cachemg_=oe.instance(),oe.init(),e.oid_=t.clientId,e.cid_=e.oid_.substring(0,6),e.oid_send_=e.oid_.substring(0,8),e.web_cna_=t.cna,S.log("p2p PcdnEngine start... version: ",L.version," clientId: ",t.clientId),this.isReportLog4Start_||(this.isReportLog4Start_=!0,Tt.reportStart()),this.is_run_=!0,this.pmg_.start()}return t.prototype.setUrlInfo=function(t){S.log("[PcdnEngine][setUrlInfo] m3u8Url: ",t.m3u8Url),this.fullM3u8Url_=t.m3u8Url;var e=this.pasrseTsUrlInfo(t);this.dmg_.updateM3u8Info(wt.fullM3u8Url2M3u8Url(this.fullM3u8Url_),this.fullM3u8Url_,e.tsList,e.startSn)},t.prototype.pasrseTsUrlInfo=function(t){for(var e={tsList:new Array(t.tsUrl.length),startSn:0},r=0,n=0;n<t.tsUrl.length;n++){var i=t.tsUrl[n],o={url:i.url,duration:i.duration,filesize:i.filesize||0,sn:r};o.url.indexOf("/ad/")>0||o.url.indexOf("ccode=0902")>0?S.error("[pasrseTsUrlInfo][ad url]:",o.url):(e.tsList[r]=o,this.tsUrlMap_.set(o.url,o.sn),r++)}return e.tsList=e.tsList.slice(0,r),S.log("[pasrseTsUrlInfo][TsUrlInfo]info ts_cn:",t.tsUrl.length,",this ts_cn:",e.tsList.length,",start_sn:",e.startSn),e},t.prototype.requestTSData=function(t){var e=this.tsUrlMap_.get(t.url);if(null==e||e<0){var r={msg:"ts_url_error",m3u8Url:this.fullM3u8Url_,tsUrl:t.url,sn:-1,errCode:1002};return this.SendErrorToPlayer(r),void S.log("[xplayer]requestTSDataErr sn:",e," tsUrl:",t.url)}t.sn=e,S.log("[xplayer]requestTSData,sn:",e," tsUrl:",t.url),this.dmg_.requestTSData(wt.fullM3u8Url2M3u8Url(this.fullM3u8Url_),t)},t.prototype.abortTSData=function(t){var e=this.tsUrlMap_.get(t.url);null==e||e<0?S.log("[xplayer]abortTSDataErr sn:",e," tsUrl:",t.url):(t.sn=e,S.log("[xplayer]abortTSData,sn:",e," tsUrl:",t.url),this.dmg_.abortTSData(wt.fullM3u8Url2M3u8Url(this.fullM3u8Url_),t))},t.prototype.setBufferDuration=function(t){this.playerBufferDuration_=t,this.dmg_.setPlayerBufferDuration(t)},t.prototype.SendDataToPlayer=function(e,r){S.log("[xplayer]SendData,sn:",e,r?",ok":",null"),this.event_.emit(t.Events.DATA,r)},t.prototype.SendProgressToPlayer=function(e){this.event_.emit(t.Events.PROGRESS,e)},t.prototype.SendDownBeginToPlayer=function(e){S.log("[xplayer]SendDownBegin,url:",e),this.event_.emit(t.Events.DLBEGIN,e)},t.prototype.SendP2PBeginToPlayer=function(e){S.log("[xplayer]SendP2PBegin,sn:",e),this.event_.emit(t.Events.P2PBEGIN,e)},t.prototype.SendDBCacheToPlayer=function(e){S.log("[xplayer]SendDBCache,sn:",e),this.event_.emit(t.Events.DBCACHE,e)},t.prototype.SendErrorToPlayer=function(e){this.event_.emit(t.Events.ERROR,e)},t.prototype.on_login=function(e){if(e===w.SUCCESS){if(S.log("[PcdnEngine][on_login] login SUCCESS"),this.is_p2p_ready_)return;var r=dt.nowMs();this.dmg_.loginSucceed(r),this.pmg_.loginSucceed(r),this.is_p2p_ready_=!0,this.event_.emit(t.Events.READY,null)}},t.prototype.addListener=function(t,e){this.event_.on(t,e)},t.prototype.removeListener=function(t,e){this.event_.off(t,e)},t.prototype.removeAllListeners=function(){this.event_.removeAllListeners()},t.prototype.on=function(t,e){this.event_.on(t,e)},t.prototype.off=function(t,e){this.event_.off(t,e)},t.prototype.setPlayDuration=function(t){S.is_debug()&&S.log("[xplayer]setBuf:",t.toFixed(2)),this.playerBufferDuration_=t,this.dmg_.setPlayerBufferDuration(t)},t.prototype.switchDomain=function(t){t!==this.currentDomain_&&(null==t||0===t.length?this.currentDomain_=null:this.currentDomain_=t,S.log("[switchDomain],new domain is:",null==t?"null":t))},t.prototype.close=function(){S.log("[PcdnEngine][close] "),this.dmg_.close(),this.pmg_.stop()},t.prototype.closeM3u8Loaders=function(){S.log("[PcdnEngine][closeM3u8Loaders] "),this.dmg_.close()},t.isSupported=function(){return Dt.isSupportWebRTC()},t.dumpDownDetail=function(){return ft.get_down_detail()},t.dumpDwn=function(){return jt.instance().dump()},t.dumpRTC=function(){return ft.dumpRtc()},t.dumpP2pDetail=function(){return te.instance().p2pdumpDetail()},t.instance_=null,t.Events={ERROR:"p2p_error",DATA:"data",SPEED:"speed",READY:"ready",INFO:"info",PROGRESS:"progress",DLBEGIN:"download_begin",P2PBEGIN:"p2p_begin",DBCACHE:"db_cache"},t.LoadModes={CDN:0,P2P:1,DB:2},t}();return window.PCDNDataManager=se,O(Object.freeze({__proto__:null,PcdnEngine:se})).default}();
